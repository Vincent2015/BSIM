var SNSApplication=function(a){if(!a||"SNSApplication cannot be new, use SNSApplication.getInstance() instead."!==a)throw"SNSApplication cannot be new, use SNSApplication.getInstance() instead.";this._id=Math.uuid();this._loginName;this._user=new SNSUser;this._messageInBox=new SNSMessageInBox;this._messageOutBox=new SNSMessageOutBox};SNSApplication.version="2.1";
SNSApplication.getInstance=function(){if(!SNSApplication._instance){SNSApplication._instance=new SNSApplication("SNSApplication cannot be new, use SNSApplication.getInstance() instead.");for(var a in SNSApplication._instance){var b=SNSApplication._instance[a];b&&b._init&&"function"==typeof b._init&&b._init()}SNSApplication._instance.getGlobalEventManager().trigger(SNS_EVENT_SUBJECT.AFTER_LOAD,[]);SNSIMWindow.getInstance()}return SNSApplication._instance};SNSApplication.prototype.getID=function(){return this._id};
SNSApplication.prototype.getUser=function(){return this._user};SNSApplication.prototype.getDomain=function(){return this._user&&this._user.jid?this._user.jid.getDomain():YYIMChat.getServerName()};SNSApplication.prototype.getGlobalEventManager=function(){return SNSGlobalEventManager.getInstance()};SNSApplication.prototype.getTemplateManager=function(){return this._templateManager};SNSApplication.prototype.getMessageInBox=function(){return this._messageInBox};
SNSApplication.prototype.getMessageOutBox=function(){return this._messageOutBox};SNSApplication.prototype.registerMessgeInFilter=function(a){SNSApplication.getInstance().getMessageInBox().filter.registerFilter(a)};SNSApplication.prototype.registerMessgeOutFilter=function(a){SNSApplication.getInstance().getMessageOutBox().filter.registerFilter(a)};
SNSApplication.prototype.login=function(a,b,c){if(!SNSCommonUtil.isStringAndNotEmpty(a)&&YYIMChat.enableAnonymous())YYIMChat.login(null,"anonymous",(new Date).getTime()+12096E5);else{!a||a.isEmpty()||!b||b.isEmpty();this._loginName=a;var d=a.indexOf("@"),e=a.indexOf(".");if(!(0>d&&0>e))if(0<=d&&0<=e&&d<e)YYIMChat.initSDK(a.substring(d+1,e),a.substring(e+1));else throw"\u591a\u79df\u6237\u683c\u5f0f\u9519\u8bef, \u6b63\u786e\u683c\u5f0f\u4e3a:name@app.etp";a=a.replace(/@/g,YYIMChat.getTenancy().SEPARATOR);
DEVELOP_MODE?YYIMChat.login(a,$.md5(b).toUpperCase()):c&&!0==c?YYIMChat.login(a,b):this.getToken(a,b)}};
SNSApplication.prototype.getToken=function(a,b){var c=YYIMChat.getTenancy(),d="username="+a+"&password="+b;c.ENABLE&&(d+="&app="+c.APP_KEY,d+="&etp="+c.ETP_KEY);jQuery.support.cors=!0;jQuery.ajax({url:SNS_REST_SERVER.TOKEN+"?"+d,dataType:"json",type:"get",success:function(b,c,d){YYIMChat.log("get token success",3,arguments);SNSApplication.saveLoginInfo({username:SNSApplication.getInstance()._loginName,token:b.token,expiration:b.expiration});YYIMChat.login(a,b.token,b.expiration)},error:function(a){SNSApplication.getInstance().tokenErrorHandler(a)}})};
SNSApplication.prototype.tokenErrorHandler=function(a,b){YYIMChat.log("get token error",2,arguments);b={};if(a.responseText)try{b=JSON.parse(a.responseText)}catch(c){YYIMChat.log(c,0)}YYIMChat.onAuthError({errorCode:a.status,message:b.message||"get token error"});this._afterLogout()};SNSApplication.prototype.logout=function(){YYIMChat.logout();SNSStorage.removeLocal("chatTabs#"+YYIMChat.getUserBareJID());SNSStorage.removeLocal("activeChatTab#"+YYIMChat.getUserBareJID());this._afterLogout()};
SNSApplication.prototype._afterLogout=function(){SNSApplication.resetCookie("token");SNSApplication.resetCookie("expiration");window.location.href=getSNSBasePath()};
SNSApplication.saveLoginInfo=function(a){var b=new Date;b.setTime(b.getTime()+12096E5);SNSApplication.setCookie("username",a.username,b);b=new Date;b.setTime(a.expiration);a&&a.token&&a.expiration&&(SNSApplication.setCookie("token",a.token,b),SNSApplication.setCookie("expiration",a.expiration,b),setTimeout(function(){alert("\u4f1a\u8bdd\u8fc7\u671f\uff0c\u8bf7\u91cd\u65b0\u767b\u5f55");SNSApplication.getInstance()._afterLogout()},Number(a.expiration)-(new Date).getTime()))};
SNSApplication.setCookie=function(a,b,c){var d=arguments,e=arguments.length;c=2<e?d[2]:null;var h=3<e?d[3]:null,s=4<e?d[4]:null,d=5<e?d[5]:!1;document.cookie=a+"="+escape(b)+(null==c?"":"; expires="+c.toGMTString())+(h?"/":"; path="+h)+(null==s?"":"; domain="+s)+(!0==d?"; secure":"")};SNSApplication.getCookie=function(a){for(var b=document.cookie.split(";"),c=0;c<b.length;c++){var d=b[c].split("="),e=d[0].replace(/(^\s*)|(\s$)/g,"");if(a==e)return unescape(d[1])}return null};
SNSApplication.getCookieVal=function(a){var b=document.cookie.indexOf(";",a);-1==b&&(b=document.cookie.length);return unescape(document.cookie.substring(a,b))};SNSApplication.resetCookie=function(a){a&&SNSApplication.setCookie(a,null,new Date)};var isSupportHtml5Upload=!!window.FormData&&"[object Function]"===Object.prototype.toString.call(FormData),SNSBaseRosterList=function(){};SNSBaseRosterList.prototype=new SNSBaseList;
SNSBaseRosterList.prototype.add=function(a){if(a&&(a instanceof SNSRoster||a instanceof SNSChatRoom)){var b=a.id;a instanceof SNSDeviceRoster&&(b=a.id);return SNSBaseList.prototype.add.call(this,b,a)}};SNSBaseRosterList.prototype.update=function(a){if(a&&(a instanceof SNSRoster||a instanceof SNSChatRoom)){var b=a.getID();SNSBaseList.prototype.update.call(this,b,a)}};
SNSBaseRosterList.prototype.contains=function(a){if(a)return a.id?SNSBaseList.prototype.contains.call(this,a.id):SNSBaseList.prototype.contains.call(this,a)};SNSBaseRosterList.prototype.get=function(a){return SNSBaseList.prototype.get.call(this,a)};SNSBaseRosterList.prototype.remove=function(a){return SNSBaseList.prototype.remove.call(this,a)};SNSBaseRosterList.prototype.toArray=function(){var a=[],b;for(b in this._list){var c=this._list[b];c&&(c instanceof SNSRoster||c instanceof SNSChatRoom)&&a.push(c)}return a};
var SNSPlugin=function(){this.name;this.enable=!0;this.loaded=!1;this.loadPeriod=SNS_EVENT_SUBJECT.AFTER_CONNECT};SNSPlugin.prototype._init=function(){this.loaded=!0};SNSPlugin.pluginList=new SNSBaseList;SNSPlugin.prototype.start=function(){this.enable&&!this.loaded&&(SNSApplication.getInstance().getGlobalEventManager().registerEventHandler(this.loadPeriod,!0,function(){this.loaded||this._init()},this),SNSPlugin.pluginList.add(this.name,this))};
var DEVELOP_MODE=!1,SNS_REST_SERVER={TOKEN:"http://im.yyuap.com/demo/token",UPLOADSWFURL:"http://im.yyuap.com/demo/"},SNS_DEBUG_LEVEL={ERROR:0,WARN:1,INFO:2,LOG:3,DEBUG:4},PACKETTYPE={LONGCONNECT:"long connection",SHORTCONNECT:"short connection"},INVITE_FRIEND_AUTO=!1,SNS_STATUS={CHAT:"chat",AWAY:"away",XA:"xa",DND:"dnd",UNAVAILABLE:"unavailable"},SNS_SUBSCRIBE={BOTH:"both",FROM:"from",TO:"to",NONE:"none",REMOVE:"remove"},SNS_TYPE={SET:"set",RESULT:"result",GET:"get",SUBMIT:"submit"},SNS_PRESENCE_TYPE=
{SUBSCRIBE:"subscribe",UNSUBSCRIBE:"unsubscribe",SUBSCRIBED:"subscribed",UNSUBSCRIBED:"unsubscribed",PROBE:"probe",UNAVAILABLE:"unavailable"},SNS_CHATROOM_CONFIG_FROM={CONFIG:"http://jabber.org/protocol/muc#roomconfig",NAME:"muc#roomconfig_roomname",DESC:"muc#roomconfig_roomdesc",PHOTO:"muc#roomconfig_photo",PERSIST:"muc#roomconfig_persistentroom",OWNERS:"muc#roomconfig_roomowners",ETP:"muc#roomconfig_etp",APP:"muc#roomconfig_app"},SNS_CHAT_TYPE={CHAT:"chat",GROUP_CHAT:"groupchat",DEVICE:"device",
PUB_ACCOUNT:"pubaccount"},SNS_MESSAGE_CONTENT_TYPE={MIXED:1,TEXT:2,FILE:4,IMAGE:8,SYSTEM:16,PUBLIC:32,SHARE:256},SNS_MESSAGE_TYPE={CHAT:"chat",ERROR:"error",GROUPCHAT:"groupchat",PUBACCOUNT:"pubaccount",HEADLINE:"headline",NORMAL:"normal",INVITE:"invite",SUBSCRIBE:"subscribe"},SNS_CHATROOM_MEMBER_UPDATE={JOIN:"join",QUIT:"quit"},SNS_ONLINE_SHOW={CHAT:"\u5728\u7ebf",AWAY:"\u79bb\u5f00",XA:"\u5fd9\u788c",DND:"\u5fd9\u788c",UNAVAILABLE:"\u9690\u8eab"},SNS_SHOW_PRIORITY={AVAILABLE:0,CHAT:1,AWAY:2,XA:3,
DND:4,UNAVAILABLE:5,OFFLINE:6},SNS_AFFILIATION_TYPE={OWNER:"owner",ADMIN:"admin",MEMBER:"member",OUTCAST:"outcast",NONE:"none"},SNS_GROUP_ROLE_TYPE={MODERATOR:"moderator",NONE:"none",PARTICIPANT:"participant",VISITOR:"visitor"},SNS_CHAT_ROOM_TYPE={INSTANT:"instant",RESERVED:"reserved"},SNS_GROUP_STATUS_CODE={},SNS_WIDE_TAB_TYPE={GROUPS:"GroupsChat",ROSTERS:"Rosters",RECENTS:"Recents",SEARCH:"Search",Organization:"Organization"},SNS_MOVE_ROSTER_TYPE={MOVE:"move",COPY:"copy"},SNS_ROSTER_SEARCH_TYPE=
{INVITE:"invite",ADD_FRIEND:"addFriend"},SNS_LANG_TEMPLATE={vcard_nickname:"\u59d3\u540d",vcard_email:"\u90ae\u7bb1",vcard_mobile:"\u624b\u673a",vcard_telephone:"\u7535\u8bdd"},SNS_KEY_CODE={ENTER:13},SNS_DIRECTION={TOP:0,RIGHT:1,BOTTOM:2,LEFT:3},SNS_CHATROOM_MEMBER_AFFILIATION={OWNER:"owner",ADMIN:"admin",MEMBER:"member",NONE:"none"},SNS_CHATROOM_MEMBER_ROLE={MODERATOR:"moderator",PARTICIPANT:"Participant"},SNS_CHATROOM_INFO={DESC:"muc#roominfo_description",SUBJECT:"muc#roominfo_subject",OCCUPANTS:"muc#roominfo_occupants",
CREATION_DATA:"x-muc#roominfo_creationdate"},SNS_EVENT_SUBJECT={AFTER_LOAD:"load$",BEFORE_LOGIN:"$login",AFTER_LOGIN:"login$",BEFORE_CONNECT:"$connect",CONNECT_FAILED:"connectFailed",AFTER_CONNECT:"connect$",AFTER_RECONNECT:"reconnect$",DISCONNECT:"disconnect",AFTER_INITIALIZED:"afterInitialized",ON_CONNECT_STATUS_CHANGE:"connectStatusChange",ON_USER_PRESENCE_CHANGE:"userPresenceChange",ON_ROSTER_PRESENCE_CHANGE:"rosterPresenceChange",ON_ROSTER_PHOTO_CHANGE:"rosterPhotoChange",ON_VCARD_CHANGE:"VCARD",
BEFORE_VCARD_SHOW:"$vcardShowt",BEFORE_ADD_TO_RECENTLIST:"$recent",AFTER_ADD_TO_RECENTLIST:"recent$",BEFORE_LOAD_ROSTER:"$loadRoster",AFTER_LOAD_ROSTER:"loadRoster$",BEFORE_LOAD_CHATROOM:"$loadChatRoom",AFTER_LOAD_CHATROOM:"loadChatRoom$",ON_ADD_ROSTER:"$addRoster",ON_REMOVE_ROSTER:"$removeRoster",AFTER_ADD_ROSTER:"addRoster$",ON_APPROVE_SUBSCRIBED:"approveSubscribe",ON_ADD_CHATROOM:"$addChatroom",AFTER_JOIN_CHATROOM:"joinChatroom$",ON_QUIT_CHATROOM:"$quitChatRoom",AFTER_ROSTER_LIST:"rosterList$",
ADD_TO_RENCENT:"addToRencent",BEFORE_UPDATE_ROSTER:"$updateRoster",AFTER_UPDATE_ROSTER:"updateRoster$",ON_MESSAGE_IN:"messageIn",BEFORE_MESSAGE_OUT:"$messageout",AFTER_MESSAGE_OUT:"messageout$",AFTER_MESSAGE_SHOW:"messageIn$",ON_CURRENT_CHAT_CHANGE:"on_current_chat_change",BEFORE_LOGOUT:"$logout",AFTER_LOGOUT:"logout$",BEFORE_DESTORY:"$destory",ON_ERROR:"error",HIDE_FLOAT:"hideFloat",TAB_OPENED:"tab_opened",TAB_CLOSED:"tab_closed"},SNSConfig={USER:{DEFAULT_AVATAR:"res/skin/default/icons/noavatar_big.gif",
DEFAULT_GRAY_AVATAR:"res/skin/default/icons/avatar_change.png"},ROSTER:{NAME_FORBIDDEN:"\" &'/:<>@".split(""),PUB_ACCOUNT_DEFAULT_AVATAR:"res/skin/default/icons/public_account_avatar.png",MY_TASK_DEFAULT_AVATAR:"res/skin/default/icons/my_task_head_icon.png",MY_DEVICE_DEFAULT_AVATAR:"res/skin/default/icons/my_android.png"},SYSTEM_ROSTER:{DEFAULT_AVATAR:"res/skin/default/icons/system_message_avatar.png"},CHAT_ROOM:{DEFAULT_AVATAR:"res/skin/default/icons/normal_pic_50x50.png"},GROUP:{GROUP_NONE:"\u672a\u5206\u7ec4",
GROUP_PUB_ACCOUNT:"\u516c\u5171\u8d26\u53f7",GROUP_DEVICE:"\u6211\u7684\u8bbe\u5907",NAME_FORBIDDEN:"\" &'/:<>@".split("")},MESSAGE:{SEND_TIMEOUT:3E4,MAX_CHARACHER:500},RECENT:{MAX_SIZE:30},CONNECTION:{RECONNECT_TIMER:10}},SNS_I18N={login_error_empty:"\u7528\u6237\u540d\u6216\u5bc6\u7801\u4e3a\u7a7a",login_error_tenancy:"\u591a\u79df\u6237\u683c\u5f0f\u9519\u8bef, \u6b63\u786e\u683c\u5f0f\u4e3a:name@app@etp",login_error_401:"401\uff1a\u7528\u6237\u540d\u5bc6\u7801\u9519\u8bef",login_error_408:"409: \u8bf7\u6c42\u8d85\u65f6",
login_error_409:"409: \u6ce8\u518c\u5931\u8d25\uff01\n\n\u8bf7\u6362\u4e00\u4e2a\u7528\u6237\u540d\uff01",login_error_503:"503: \u8fde\u63a5\u670d\u52a1\u5668\u5931\u8d25",login_conflict:"\u60a8\u5df2\u5728\u522b\u5904\u767b\u5f55, \u662f\u5426\u91cd\u65b0\u8fde\u63a5",roster_not_found:"\u672a\u627e\u5230\u6307\u5b9a\u7684\u7528\u6237",roster_rename:"\u4fee\u6539#\u7684\u5907\u6ce8",group_name:"\u8f93\u5165\u5206\u7ec4\u540d",confirm_add_friend:"\u8bf7\u6c42\u5df2\u53d1\u9001",confirm_join_chatroom:"\u786e\u8ba4\u52a0\u5165\u7fa4",
confirm_subscribe_pubaccount:"\u5df2\u5173\u6ce8",subscribe_request:"\u8bf7\u6c42\u6dfb\u52a0\u60a8\u4e3a\u597d\u53cb",subscribe_none:"\u60a8\u548c\u4ed6/\u5979\u8fd8\u4e0d\u662f\u597d\u53cb, \u70b9\u51fb\u6dfb\u52a0\u4e3a\u597d\u53cb",subscribe_none_po:"\u60a8\u5df2\u7ecf\u8bf7\u6c42\u6dfb\u52a0\u5bf9\u65b9\u4e3a\u597d\u53cb, \u6b63\u5728\u7b49\u5f85\u56de\u5e94",subscribe_none_pi:"\u5bf9\u65b9\u8bf7\u6c42\u6dfb\u52a0\u60a8\u4e3a\u597d\u53cb,\u70b9\u51fb\u540c\u610f\u6dfb\u52a0",subscribe_none_po_pi:"\u53cc\u65b9\u5df2\u53d1\u9001\u8bf7\u6c42, \u6b63\u5728\u7b49\u5f85\u56de\u5e94",
subscribe_to:"\u60a8\u5df2\u7ecf\u6dfb\u52a0\u5bf9\u65b9\u4e3a\u597d\u53cb",subscribe_to_pi:"\u60a8\u5df2\u7ecf\u6dfb\u52a0\u5bf9\u65b9\u4e3a\u597d\u53cb, \u5bf9\u65b9\u8bf7\u6c42\u6dfb\u52a0\u60a8\u4e3a\u597d\u53cb, \u70b9\u51fb\u540c\u610f",subscribe_from:"\u5bf9\u65b9\u5df2\u7ecf\u6dfb\u52a0\u60a8\u4e3a\u597d\u53cb, \u60a8\u8fd8\u672a\u6dfb\u52a0\u5bf9\u65b9\u4e3a\u597d\u53cb",subscribe_from_po:"\u5bf9\u65b9\u5df2\u7ecf\u6dfb\u52a0\u60a8\u4e3a\u597d\u53cb, \u60a8\u7684\u597d\u53cb\u8bf7\u6c42\u6b63\u5728\u7b49\u5f85\u5bf9\u65b9\u540c\u610f",
subscribe_both:"\u6211\u4eec\u5df2\u7ecf\u662f\u597d\u53cb\u4e86, \u5f00\u59cb\u5bf9\u8bdd\u5427.",subscribed:"\u5df2\u540c\u610f\u6dfb\u52a0\u60a8\u4e3a\u597d\u53cb, \u5f00\u59cb\u5bf9\u8bdd\u5427",subscribe_remove:"\u786e\u5b9a\u5220\u9664\u597d\u53cb",chatRoom_invitation:"\u9080\u8bf7\u60a8\u52a0\u5165\u623f\u95f4",chatRoom_joined:"\u60a8\u88ab\u9080\u8bf7\u52a0\u5165\u4e86\u7fa4\u804a",member_joined:"\u88ab\u9080\u8bf7\u52a0\u5165\u4e86\u7fa4\u804a",udnsubscribed:"\u5df2\u62d2\u7edd\u6dfb\u52a0\u60a8\u4e3a\u597d\u53cb",
vcard_request_service_unavailable:"\u8bf7\u6c42\u83b7\u53d6\u8054\u7cfb\u4eba\u540d\u7247\u5931\u8d25, \u7535\u5b50\u540d\u7247\u670d\u52a1\u4e0d\u53ef\u7528",vcard_request_empty:"\u8bf7\u6c42\u7684\u8054\u7cfb\u4eba\u7535\u5b50\u540d\u7247\u4e0d\u5b58\u5728",group_none:"\u672a\u5206\u7ec4",am:"\u4e0a\u5348 ",pm:"\u4e0b\u5348 ",reselect:"\u91cd\u65b0\u9009\u62e9",message_character_exceed:"\u6d88\u606f\u5b57\u6570\u8d85\u8fc7\u6700\u5927\u503c",message_remind_file:"\u53d1\u6765\u6587\u4ef6",message_remind_image:"\u53d1\u6765\u56fe\u7247",
message_remind_system:"\u9080\u8bf7\u6216\u597d\u53cb\u8bf7\u6c42",message_remind_unknow:"\u672a\u77e5\u7c7b\u578b",Default:"\u9ed8\u8ba4"},SNSHandler=function(a){if(!a||"SNSHandler cannot be new, use SNSHandler.getInstance() instead."!==a)throw"SNSHandler cannot be new, use SNSHandler.getInstance() instead.";this.afterInitialized=this._connConflict=!1};
SNSHandler.getInstance=function(){SNSHandler._instance||(SNSHandler._instance=new SNSHandler("SNSHandler cannot be new, use SNSHandler.getInstance() instead."));return SNSHandler._instance};
SNSHandler.prototype.onOpened=function(){YYIMChat.log("\u8fde\u63a5\u6210\u529f",3);snsLoginConflict=!1;jQuery("#sns_conflict_alert").hide();jQuery("#snsim_coverlayer").hide();delete SNSAuth;"undefined"!=typeof afterLogin&&"function"==typeof afterLogin&&afterLogin();YYIMChat.getRosterItems({success:function(a){SNSApplication.getInstance().getUser().rosterListHandler(a)},error:function(){YYIMChat.log("\u83b7\u53d6\u597d\u53cb\u5217\u8868\u5931\u8d25",0)},complete:function(){YYIMChat.getChatGroups({success:function(a){SNSApplication.getInstance().getUser().chatRoomList.chatRoomListHandler(a);
SNSApplication.getInstance().getGlobalEventManager().trigger(SNS_EVENT_SUBJECT.AFTER_LOAD_ROSTER,[{}])},error:function(){YYIMChat.log("\u83b7\u53d6\u7fa4\u5217\u8868\u5931\u8d25",0)},complete:function(){YYIMChat.getPubAccount({success:function(a){SNSApplication.getInstance().getUser().pubAccountListHandler(a);SNSApplication.getInstance().getGlobalEventManager().trigger("initChatWin");SNSApplication.getInstance().getGlobalEventManager().trigger("listenChatWinChange")},error:function(){YYIMChat.log("\u83b7\u53d6\u516c\u5171\u53f7\u5217\u8868\u5931\u8d25",
0)},complete:function(){var a=SNSApplication.getCookie("presence.status"),b={};YYIMCommonUtil.isStringAndNotEmpty(a)&&(b=JSON.parse(a));SNSApplication.getInstance().getUser().id==b.user&&YYIMCommonUtil.isStringAndNotEmpty(b.status)?YYIMChat.setPresence({status:b.status}):YYIMChat.setPresence();a=SNSApplication.getInstance().getUser();a.vcard||a.requestVCard();SNSApplication.getInstance().getGlobalEventManager().trigger(SNS_EVENT_SUBJECT.ON_USER_PRESENCE_CHANGE,[]);SNSApplication.getInstance().getGlobalEventManager().trigger(SNS_EVENT_SUBJECT.AFTER_INITIALIZED,
[]);SNSHandler.getInstance().afterInitialized=!0;YYIMChat.getOfflineMessage({});YYIMChat.getRecentContacts({success:function(a){for(var b in a)a[b].id&&SNSApplication.getInstance().getUser().recentList.addNewRoster(a[b].id)}})}})}})}});SNSGlobalEventManager.getInstance().trigger(SNS_EVENT_SUBJECT.AFTER_CONNECT,[])};
SNSHandler.prototype.onStatusChanged=function(a){a&&(this._connConflict=a&&409==a.code?!0:!1,SNSApplication.getInstance().getGlobalEventManager().trigger(SNS_EVENT_SUBJECT.ON_CONNECT_STATUS_CHANGE,[{status:a}]))};SNSHandler.prototype.onClosed=function(){YYIMChat.log("\u8fde\u63a5\u5173\u95ed",3);SNSGlobalEventManager.getInstance().trigger(SNS_EVENT_SUBJECT.DISCONNECT,[])};SNSHandler.prototype.onAuthError=function(a){alert(a.message);SNSApplication.getInstance()._afterLogout()};
SNSHandler.prototype.onConnectError=function(a){409==a.errorCode?(snsLoginConflict=!0,jQuery("#sns_conflict_alert").show(),jQuery("#snsim_coverlayer").show(),jQuery("#sns_conflict_reconnect").off("click").on("click",function(){YYIMChat.connect();jQuery("#sns_conflict_alert").hide();jQuery("#snsim_coverlayer").hide()})):(SNSApplication.getInstance().getGlobalEventManager().trigger(SNS_EVENT_SUBJECT.CONNECT_FAILED,[{errorCode:a.errorCode,message:a.message}]),SNSApplication.getInstance().getUser().setPresence(SNS_STATUS.UNAVAILABLE,
!1))};SNSHandler.prototype.onUserBind=function(a,b){var c=SNSApplication.getInstance().getUser();c.id=a;c.name=a;c.resource=b};
SNSHandler.prototype.onPresence=function(a){YYIMChat.log("\u597d\u53cb"+a.from+"\u7684\u72b6\u6001\u6539\u53d8",3,a);var b=a.from,c=new SNSPresence(a),d=SNSApplication.getInstance().getUser(),e=b==d.id;a=d.resource&&a.resource&&-1<d.resource.indexOf(a.resource);e&&a?(d.setPresence(c,!1),SNSApplication.setCookie("presence.status",JSON.stringify({user:d.id,status:c.status}),new Date((new Date).getTime()+12096E5))):d.getOrCreateRoster(b).setPresence(c)};
SNSHandler.prototype.onSubscribe=function(a){YYIMChat.log(a.from+" "+a.type,3,a);a.type==SNS_PRESENCE_TYPE.SUBSCRIBE&&(INVITE_FRIEND_AUTO?YYIMChat.approveSubscribe(a.from):SNSApplication.getInstance().getGlobalEventManager().trigger(SNS_PRESENCE_TYPE.SUBSCRIBE,a.from))};SNSHandler.prototype.onRosterUpdateded=function(a){SNSApplication.getInstance().getUser().rosterUpdateHandler({from:a.id,name:a.name,group:a.groups,type:SNS_SUBSCRIBE.BOTH})};
SNSHandler.prototype.onRosterDeleted=function(a){SNSApplication.getInstance().getUser().rosterUpdateHandler({from:a,type:SNS_SUBSCRIBE.NONE})};
SNSHandler.prototype.onRoomMemerPresence=function(a){YYIMChat.log(a.member.id+" "+a.type+" "+a.room,3,a);var b=SNSApplication.getInstance().getUser(),c=SNSApplication.getInstance().getUser().getRosterOrChatRoom(a.room);if(a.type==SNS_CHATROOM_MEMBER_UPDATE.QUIT)c.rosterList.remove(a.member.id),a.member.id==b.getID()&&(b.chatRoomList.remove(c.getID()),SNSApplication.getInstance().getGlobalEventManager().trigger(SNS_EVENT_SUBJECT.ON_QUIT_CHATROOM,[c]));else if(a.type==SNS_CHATROOM_MEMBER_UPDATE.JOIN){c=
SNSApplication.getInstance().getUser().getRosterOrChatRoom(a.room);c||(c=new SNSChatRoom(a.room),c.type=SNS_CHAT_ROOM_TYPE.RESERVED,c.nickname=SNSApplication.getInstance().getUser().getID(),SNSApplication.getInstance().getUser().chatRoomList.add(c),jQuery.when(c.queryInfo()).done(jQuery.proxy(function(){SNSApplication.getInstance().getGlobalEventManager().trigger(SNS_EVENT_SUBJECT.ON_ADD_CHATROOM,[this]);SNSApplication.getInstance().getGlobalEventManager().trigger(SNS_EVENT_SUBJECT.AFTER_JOIN_CHATROOM,
[this])},c)));var d=c.rosterList.get(a.member.id);d||(d=new SNSChatRoomMemberRoster(a.member.id,a.member.nick));d.photoUrl=a.member.photo?a.member.photo:SNSConfig.USER.DEFAULT_AVATAR;d.affiliation=a.member.affiliation;d.role=a.member.role;d.name=a.member.nick?a.member.nick:d.getID();c.addMember(d);d.getID()!==b.getID()&&SNSApplication.getInstance().getGlobalEventManager().trigger(SNS_EVENT_SUBJECT.AFTER_JOIN_CHATROOM,[c,d])}};
SNSHandler.prototype.onMessage=function(a){var b=SNSApplication.getInstance().getMessageInBox(),c=new SNSInMessage;SNSApplication.getInstance().getUser();a.type==SNS_CHAT_TYPE.GROUP_CHAT?c.initRoomMessage(a):a.type==SNS_CHAT_TYPE.CHAT||a.type==SNS_CHAT_TYPE.PUB_ACCOUNT?c.initRosterMessage(a):(a.type=SNS_CHAT_TYPE.DEVICE)&&c.initDeviceMessage(a);b.filter.doFilter(c);b.addToUnreadMessage(c);SNSHandler.getInstance().afterInitialized?SNSApplication.getInstance().getGlobalEventManager().trigger(SNS_EVENT_SUBJECT.ON_MESSAGE_IN,
[{message:c}]):b.addReceivedMessage(c)};SNSHandler.prototype.onReceipts=function(a){2==a.state&&YYIMChat.getUserID()};SNSHandler.prototype.onTextMessage=function(a){SNSHandler.getInstance().onMessage(a)};SNSHandler.prototype.onPictureMessage=function(a){SNSHandler.getInstance().onMessage(a)};SNSHandler.prototype.onFileMessage=function(a){SNSHandler.getInstance().onMessage(a)};SNSHandler.prototype.onDeviceMessage=function(a){SNSHandler.getInstance().onMessage(a)};
SNSHandler.prototype.onShareMessage=function(a){SNSHandler.getInstance().onMessage(a)};SNSHandler.prototype.onSystemMessage=function(a){SNSHandler.getInstance().onMessage(a)};SNSHandler.prototype.onPublicMessage=function(a){SNSHandler.getInstance().onMessage(a)};SNSHandler.prototype.onGroupUpdate=function(a){YYIMChat.log("\u7fa4\u7ec4\u4fe1\u606f\u66f4\u65b0",3,a)};SNSHandler.prototype.onTransferGroupOwner=function(a){YYIMChat.log("\u7fa4\u4e3b\u66f4\u65b0",3,a)};
SNSHandler.prototype.onKickedOutGroup=function(a){YYIMChat.log("\u88ab\u7fa4\u7ec4\u8e22\u51fa",3,a)};SNSHandler.prototype.onAudoMessage=function(a){YYIMChat.log("\u97f3\u9891\u6d88\u606f",3,a)};SNSHandler.prototype.onLocationMessage=function(a){YYIMChat.log("\u4f4d\u7f6e\u6d88\u606f",3,a)};SNSHandler.prototype.onWhiteBoardMessage=function(a){YYIMChat.log("\u767d\u677f\u6d88\u606f",3,a)};
SNSHandler.prototype.onPubaccountUpdate=function(a){YYIMChat.log("\u516c\u4f17\u53f7\u4fe1\u606f\u66f4\u65b0",3,a)};var SNSMessageFilter=function(){this.priority=99;this.type=SNS_FILTER_TYPE.RECEIVED|SNS_FILTER_TYPE.SEND;this.contentType=SNS_MESSAGE_CONTENT_TYPE.TEXT;this.doFilter=function(a){this.contentType&a.body.contentType|0&&this._doFilter(a)};this._doFilter=function(a){}};SNSMessageFilter.prototype=new SNSPlugin;
SNSMessageFilter.prototype._init=function(){0!=(this.type&SNS_FILTER_TYPE.RECEIVED)&&SNSApplication.getInstance().registerMessgeInFilter(this);0!=(this.type&SNS_FILTER_TYPE.SEND)&&SNSApplication.getInstance().registerMessgeOutFilter(this);SNSPlugin.prototype._init.call(this)};var SNS_FILTER_TYPE={RECEIVED:1,SEND:2},SNSMessageFilterChain=function(){this.filters=[]};
SNSMessageFilterChain.prototype.registerFilter=function(a){a instanceof SNSMessageFilter&&(YYIMChat.getArrayUtil().insert(this.filters,a.priority,a),this.filters.sort(function(a,c){return a.priority-c.priority}))};SNSMessageFilterChain.prototype.doFilter=function(a){if(a&&a instanceof SNSMessage)for(var b in this.filters){var c=this.filters[b];c&&c instanceof SNSMessageFilter&&c.doFilter(a)}};
var SNSMessageInBox=function(){this.unreadMessageList=new SNSBaseList;this.receivedMessageList=[];this.filter=new SNSMessageFilterChain};SNSMessageInBox.prototype._init=function(){SNSApplication.getInstance().getGlobalEventManager().registerEventHandler(SNS_EVENT_SUBJECT.AFTER_MESSAGE_SHOW,!0,this.removeFromUnreadMessage,this);SNSApplication.getInstance().getGlobalEventManager().registerEventHandler(SNS_EVENT_SUBJECT.AFTER_INITIALIZED,!0,this.notifyReceivedMessages,this)};
SNSMessageInBox.prototype.addToUnreadMessage=function(a){var b=a.getRosterOrChatRoom().getID(),b=a.to.id==YYIMChat.getUserID()?a.chatroom?a.chatroom.id:a.from.id:a.to.id,c=this.unreadMessageList.get(b);c||(c=[],this.unreadMessageList.add(b,c));c.push(a)};SNSMessageInBox.prototype.addReceivedMessage=function(a){this.receivedMessageList.push(a)};SNSMessageInBox.prototype.removeFromUnreadMessage=function(a,b){this.popUnreadMessageByRoster(b.getRosterOrChatRoom())};
SNSMessageInBox.prototype.popUnreadMessageByRoster=function(a){a=a.id;var b=this.unreadMessageList.get(a);this.unreadMessageList.remove(a);return b};SNSMessageInBox.prototype.getFilter=function(){return this.filter};
SNSMessageInBox.prototype.notifyReceivedMessages=function(){for(var a=0,b=this.receivedMessageList.length,c=SNSApplication.getInstance().getUser().recentList,d;a<b;)d=this.receivedMessageList[a++],c.addNew(d),SNSApplication.getInstance().getGlobalEventManager().trigger(SNS_EVENT_SUBJECT.ON_MESSAGE_IN,[{message:d}])};var SNSMessageOutBox=function(){this.filter=new SNSMessageFilterChain};SNSMessageOutBox.prototype._init=function(){};SNSMessageOutBox.prototype.getFilter=function(){return this.filter};
var SNSMessageStyle=function(a,b,c,d){this.font=a?a:0;this.size=b?b:12;this.color=c?c:"#470404";this.biu=d?d:0};SNSMessageStyle.used=!1;SNSMessageStyle.getInstance=function(){SNSMessageStyle.used=!0;SNSMessageStyle._instance||(SNSMessageStyle._instance=new SNSMessageStyle);return SNSMessageStyle._instance};
SNSMessageStyle.prototype.getStyleStr=function(){var a="",b=SNSMessageStyle.FONT_FAMILYS[this.font];b&&(a+="font-family:"+b+";");a+="font-size: "+this.size+"px;";0!=(this.biu&SNSMessageStyle.BIU_TYPE.BOLD)&&(a+="font-weight: bold;");0!=(this.biu&SNSMessageStyle.BIU_TYPE.ITALIC)&&(a+="font-style: italic;");0!=(this.biu&SNSMessageStyle.BIU_TYPE.UNDERLINE)&&(a+="text-decoration: underline;");return a+="color: "+this.color+";"};SNSMessageStyle.BIU_TYPE={BOLD:1,ITALIC:2,UNDERLINE:4};
SNSMessageStyle.FONT_FAMILYS={1:"\u5b8b\u4f53",2:"\u65b0\u5b8b\u4f53",3:"\u9ed1\u4f53",4:"\u5fae\u8f6f\u96c5\u9ed1",5:"Arial",6:"Verdana",7:"simsun",8:"Helvetica",9:"Trebuchet MS",10:"Tahoma",11:"Impact",12:"Times New Roman",13:"\u4eff\u5b8b,\u4eff\u5b8b_GB2312",14:"\u6977\u4f53,\u6977\u4f53_GB2312"};
var SNSMessage=function(a){this.id=Math.uuid();this.subject=this.thread=this.roster=this.chatroom=this.from=this.to=null;this.type=SNS_MESSAGE_TYPE.CHAT;this.body={expression:0,contentType:SNS_MESSAGE_CONTENT_TYPE.TEXT,content:null,dateline:(new Date).getTime()}};SNSMessage.prototype.getBodyHtml=function(){return!this.html||this.html.isEmpty()?this.body.content:this.html};SNSMessage.prototype.getRoster=function(){return this.to.id==YYIMChat.getUserID()?this.chatroom||this.from:this.to};
SNSMessage.prototype.getRosterOrChatRoom=function(){return this.type==SNS_MESSAGE_TYPE.CHAT||this.type==SNS_MESSAGE_TYPE.PUBACCOUNT?this.getRoster():this.type==SNS_MESSAGE_TYPE.GROUPCHAT?this.chatroom:this.from};SNSMessage.prototype.setThread=function(a){a&&a.notEmpty()&&(this.thread=a)};SNSMessage.prototype.setSubject=function(a){a&&a.notEmpty()&&(this.subject=a)};
SNSMessage.prototype.getHumanizeDateString=function(){function a(a){return 9<a?a:"0"+a}var b=this.body.dateline;b||(dataline=new Date);if("number"==typeof b){var c=new Date;c.setTime(b);b=c}if(b&&b instanceof Date){var d=b.getYear(),e=a(b.getMonth()+1),h=a(b.getDate()),s=a(b.getHours()),b=a(b.getMinutes()),c=new Date;return d!=c.getYear()?d+"-"+e+"-"+h+" "+s+":"+b:e!=c.getMonth()||h!=c.getDate()?e+"-"+h+" "+s+":"+b:12>s?SNS_I18N.am+s+":"+b:SNS_I18N.pm+s+":"+b}YYIMChat.log("snsMessage.getHumanizeDateString:invalid dateline",
1,this.dateline);return null};SNSMessage.prototype.decodeMessageStyle=function(a){return a?jQuery.extend(new SNSMessageStyle,a):a};var SNSInMessage=function(){this.id=Math.uuid()};SNSInMessage.prototype=new SNSMessage;
SNSInMessage.prototype.initRoomMessage=function(a){var b=SNSApplication.getInstance().getUser();this.id=a.id||this.id;this.type=SNS_CHAT_TYPE.GROUP_CHAT;this.from=b.getOrCreateRoster(a.from.roster);this.to=b.getOrCreateRoster(a.to);this.chatroom=b.chatRoomList.getChatRoom(a.from.room);this.body=Object.clone(a.data);this.body.style=this.decodeMessageStyle(a.data.style)};
SNSInMessage.prototype.initRosterMessage=function(a){this.id=a.id||this.id;this.type=SNS_CHAT_TYPE.CHAT;this.from=SNSApplication.getInstance().getUser().getOrCreateRoster(a.from,a.resource);this.to=SNSApplication.getInstance().getUser().getOrCreateRoster(a.to,a.resource);a.resource&&(this.resource=a.resource);this.body=Object.clone(a.data);this.body.style=this.decodeMessageStyle(a.data.style)};
SNSInMessage.prototype.initDeviceMessage=function(a){var b=SNSApplication.getInstance().getUser();this.id=a.id||this.id;this.type=SNS_CHAT_TYPE.CHAT;this.from=b.deviceList.get(b.getID()+"/"+a.from);this.body=Object.clone(a.data);this.body.style=this.decodeMessageStyle(a.data.style)};
var SNSOutMessage=function(a){this.id=a.id;this.to=SNSApplication.getInstance().getUser().getRosterOrChatRoom(a.to);this.type=a.type;this.to instanceof SNSChatRoom&&(this.chatroom=this.to);this.body={};this.body.dateline=a.body.dateline;this.setBody(a.body.content,a.body.contentType)};SNSOutMessage.prototype=new SNSMessage;SNSOutMessage.prototype.setFile=function(a){a&&a instanceof SNSFile&&("true"==a.isImage?this.setBody(a,SNS_MESSAGE_CONTENT_TYPE.IMAGE):this.setBody(a,SNS_MESSAGE_CONTENT_TYPE.FILE))};
SNSOutMessage.prototype.setImage=function(a){a&&a instanceof SNSFile&&this.setBody(a,SNS_MESSAGE_CONTENT_TYPE.IMAGE)};SNSOutMessage.prototype.setText=function(a){a&&a.notEmpty()&&this.setBody(a,SNS_MESSAGE_CONTENT_TYPE.TEXT)};SNSOutMessage.prototype.setMessage=function(a,b,c,d){this.setTo(a);this.type=b;this.setThread(c);this.setSubject(d)};SNSOutMessage.prototype.setBody=function(a,b){a&&(this.body.content=a,b&&(this.body.contentType=b))};
var SNSUser=function(){this.name;this.id;this.resource;this.vcard;this.presence=new SNSPresence;this.rosterList=new SNSRosterList;this.groupList=new SNSGroupList;this.recentList=new SNSRecentList;this.chatRoomList=new SNSChatRoomList;this.systemRoster=new SNSSystemRoster;this.deviceList=new SNSDeviceList;this._queryingVCard=!1;this._localSearchResult=[]};SNSUser.prototype._init=function(){YYIMChat.log("SNSUser.prototype.init",3)};
SNSUser.prototype.setPresence=function(a,b){var c=Object.clone(this.presence);a&&("string"==typeof a?this.presence.setStatus(a):a instanceof SNSPresence&&(this.presence=a),b||SNSApplication.getInstance().getGlobalEventManager().trigger(SNS_EVENT_SUBJECT.ON_USER_PRESENCE_CHANGE,[]),c.equals(this.presence)||b&&YYIMChat.setPresence({status:this.presence.status,type:this.presence.type}))};
SNSUser.prototype.getPhotoUrl=function(){if(this.vcard){if(this.vcard.getPhotoUrl().notEmpty())return this.vcard.getPhotoUrl()}else this.requestVCard();return SNSConfig.USER.DEFAULT_AVATAR};
SNSUser.prototype.requestVCard=function(){if(this._queryingVCard)return this._vcardDefer;this._queryingVCard=!0;this._vcardDefer=jQuery.Deferred();var a=this;YYIMChat.getVCard({success:function(b){a.setVCard(new SNSVCard(b));a._vcardDefer.resolve();a._queryingVCard=!1},error:function(){a._vcardDefer.reject();a._queryingVCard=!1}});return this._vcardDefer.promise()};
SNSUser.prototype.requestRosterVCards=function(){var a=this;YYIMChat.getVCards({success:function(b){for(var c=b.length;c--;){var d=b[c],e=a.getRoster(d.userId);e.setVCard(new SNSVCard(d));e.changePhoto&&e.changePhoto(d.photo)}}})};SNSUser.prototype.setVCard=function(a){this.vcard=a};
SNSUser.prototype.rosterListHandler=function(a){if((a=JSON.parse(a))&&!(0>=a.length)){for(var b=0;b<a.length;b++){var c=new SNSRoster(a[b].id);c.name=a[b].name;c.ask=a[b].ask;c.photoUrl=a[b].photo;c.subscription=a[b].subscription;if(c.subscription==SNS_SUBSCRIBE.BOTH){var d=a[b].group;if(d&&0!=d.length)for(var e=0;e<d.length;e++){var h=this.groupList.getGroup(d[e]);h||(h=this.groupList.addGroup(d[e]));c.addToGroup(h,!0)}else c.addToGroup(this.groupList.getGroup(SNSConfig.GROUP.GROUP_NONE),!0);this.addRoster(c)}}this.requestRosterVCards()}};
SNSUser.prototype.addRoster=function(a,b){var c=this.getRoster(a);if(b||c!=a)this.rosterList.add(a),SNSApplication.getInstance().getGlobalEventManager().trigger(SNS_EVENT_SUBJECT.ON_ADD_ROSTER,[{newValue:a,oldValue:c}])};SNSUser.prototype.getOrCreateRoster=function(a,b){var c=this.getRoster(a);c||(c=new SNSRoster(a),b&&(c.resource=b),this.addRoster(c));return c};SNSUser.prototype.getRoster=function(a){return this.systemRoster.getID()==a?this.systemRoster:this.rosterList.get(a)};
SNSUser.prototype.getRosterOrChatRoom=function(a){return this.chatRoomList.getChatRoom(a)?this.chatRoomList.getChatRoom(a):this.getRoster(a)};SNSUser.prototype.getRoom=function(a){return this.chatRoomList.getChatRoom(a)};
SNSUser.prototype.rosterUpdateHandler=function(a){var b=a.from,c=this.getRoster(b);if(!c)if(c=new SNSRoster(b),a.group&&0!=a.group.length)for(b=0;b<a.group.length;b++){var d=this.groupList.getGroup(a.group[b]);d||(d=this.groupList.addGroup(a.group[b]));c.addToGroup(d,!0)}else c.addToGroup(this.groupList.getGroup(SNSConfig.GROUP.GROUP_NONE),!0);if(c.subscription==SNS_SUBSCRIBE.TO||c.subscription==SNS_SUBSCRIBE.BOTH)a.type==SNS_SUBSCRIBE.NONE&&(c.subscription=a.type,SNSApplication.getInstance().getGlobalEventManager().trigger(SNS_EVENT_SUBJECT.ON_REMOVE_ROSTER,
[{roster:c}]));else if(c.ask=a.ask,c.name=a.name?a.name:c.getID(),c.subscription=a.type,c.subscription==SNS_SUBSCRIBE.TO||c.subscription==SNS_SUBSCRIBE.BOTH)this.addRoster(c,!0),SNSApplication.getInstance().getGlobalEventManager().trigger(SNS_EVENT_SUBJECT.ON_APPROVE_SUBSCRIBED,[c])};SNSUser.prototype.getGroupList=function(){return this.groupList};SNSUser.prototype.getRosterListByGroup=function(a){return this.groupList.getGroup(a)};
SNSUser.prototype.removeRosterFromLocal=function(a){this.rosterList.remove(a.id);for(var b in this.groupList._list)this.groupList._list[b].remove(a.id)};SNSUser.prototype.pubAccountListHandler=function(a){if((a=JSON.parse(a))&&!(0>=a.length))for(var b=0;b<a.length;b++){var c=new SNSPublicAccountRoster(a[b].id);c.name=a[b].name;this.addRoster(c)}};SNSUser.prototype.getID=function(){return this.id};
SNSUser.prototype.localSearch=function(a,b,c){function d(b){for(var c in b)0<=b[c].name.indexOf(a,0)&&SNSApplication.getInstance().getUser()._localSearchResult.push(b[c])}this._localSearchResult=[];if(!a)return null;if(void 0==b&&void 0==c)return this.localSearch(a,!0,!0);if(b||c)b&&d(this.rosterList._list),c&&d(this.chatRoomList._list);return this._localSearchResult};var SNSChatRoomFile=function(a,b,c){this.downloads=0;this.creator;this.time};SNSChatRoomFile.prototype=new SNSFile;
var SNSChatRoomFileList=function(a){this._roomId=a;this._list=[];this._requested=!1};SNSChatRoomFileList.prototype.clear=function(){return this._list=[]};SNSChatRoomFileList.prototype.getList=function(){return this._list};SNSChatRoomFileList.prototype.addFile=function(a){this._list.push(a);this._list.sort(function(a,c){return c.timestamp-a.timestamp});return this._list};
SNSChatRoomFileList.prototype.requestSharedFiles=function(){var a=jQuery.Deferred(),b=this;YYIMChat.getSharedFiles({id:this._roomId,start:0,size:20,success:function(c){b.clear();b._requested=!0;c=c.files;for(var d=c.length;d--;){var e=new SNSChatRoomFile;e.name=c[d].name;e.size=(new SNSFile("","",c[d].size)).size;e.downloads=c[d].downloads;e.creator=c[d].creator;e.time=c[d].createTime;e.type=c[d].type.toLowerCase();e.path=YYIMChat.getFileUrl(c[d].attachId);b.addFile(e)}a.resolve()}});return a.promise()};
SNSChatRoomFileList.prototype.hasRequested=function(){return this._requested};SNSChatRoomFileList.prototype.addFileFromMessage=function(a){var b=new SNSChatRoomFile(a.body.content.name,a.body.content.path,a.body.content.size);b.downloads=0;b.time=(new Date(a.body.dateline)).format("yyyy-MM-dd");b.creator=a instanceof SNSInMessage?a.from.name:SNSApplication.getInstance().getUser().name;this.addFile(b)};
var SNSChatRoom=function(a){this.id=a;this.desc;this.creationData;this.nickname;this.show="chatroom";this.type=SNS_CHAT_ROOM_TYPE.RESERVED;this.photoUrl;this.rosterList=new SNSRosterList;this.fileList=new SNSChatRoomFileList(this.id);this.memberListQueryed=this.infoQueryed=!1};SNSChatRoom.prototype.getPhotoUrl=function(){return this.photoUrl?YYIMChat.getFileUrl(this.photoUrl):SNSConfig.CHAT_ROOM.DEFAULT_AVATAR};
SNSChatRoom.prototype.addMember=function(a){if(a)if(this.rosterList.contains(a))this.updateMemberPhoto(a);else return this.rosterList.add(a),a};SNSChatRoom.prototype.updateMemberPhoto=function(a){this.rosterList.get(a.id)&&a.photoUrl&&(this.rosterList.get(a.id).photoUrl=a.photoUrl)};
SNSChatRoom.prototype.queryMembersHandler=function(a){if((a=JSON.parse(a))&&!(0>=a.length)){this.memberListQueryed=!0;for(var b=0;b<a.length;b++){var c=new SNSChatRoomMemberRoster(a[b].id,a[b].name);c.photoUrl=a[b].photo;a[b].affiliation&&(c.affiliation=a[b].affiliation);this.addMember(c)}}};SNSChatRoom.prototype.setMemberList=function(a){for(var b=0;b<a.length;b++)this.addMember(a[b])};
SNSChatRoom.prototype.queryInfo=function(){var a=jQuery.Deferred(),b=this;YYIMChat.getChatGroupInfo({id:this.getID(),success:function(c){b.infoQueryed=!0;b.name=c.name;b.desc=c.desc;a.resolve()},error:function(){a.reject()}});return a.promise()};
SNSChatRoom.prototype.update=function(a){if(a){var b=this;if(a.name&&a.name!=this.name||a.desc&&a.desc!=this.desc||a.photoUrl&&a.photoUrl!=this.photoUrl){var c=jQuery.Deferred();YYIMChat.updateChatGroup({id:this.getID(),name:a.name,desc:a.desc,photo:a.photoUrl,success:function(){b.name=a.name||a.name;b.desc=a.desc||b.desc;b.photoUrl=a.photoUrl||b.photoUrl;c.resolve()},error:function(){c.reject()}});return c.promise()}}};SNSChatRoom.prototype.getMe=function(){return this.rosterList.get(SNSApplication.getInstance().getUser().id)};
SNSChatRoom.prototype.getID=function(){return this.id};var SNSChatRoomList=function(){};SNSChatRoomList.prototype=new SNSBaseRosterList;SNSChatRoomList.prototype.setChatRoomList=function(a){for(var b=0;b<a.length;b++)this.add(a[b]);SNSApplication.getInstance().getGlobalEventManager().trigger(SNS_EVENT_SUBJECT.AFTER_LOAD_CHATROOM,[])};
SNSChatRoomList.prototype.chatRoomListHandler=function(a){if((a=JSON.parse(a))&&!(0>=a.length)){for(var b=[],c=0;c<a.length;c++){var d=new SNSChatRoom(a[c].id);d.name=a[c].name?a[c].name.substr(0,20):"noname";a[c].photo&&(d.photoUrl=a[c].photo);d.nickname=SNSApplication.getInstance().getUser().id;d.type=SNS_CHAT_ROOM_TYPE.RESERVED;b.push(d)}this.setChatRoomList(b)}};
SNSChatRoomList.prototype.addChatRoom=function(a){this.add(a)&&SNSApplication.getInstance().getGlobalEventManager().trigger(SNS_EVENT_SUBJECT.ON_ADD_CHATROOM,[a])};SNSChatRoomList.prototype.getChatRoom=function(a){return this.get(a)};SNSChatRoomList.prototype.createRoomHandler=function(a){var b=new SNSChatRoom(a.node);b.name=a.name;b.desc=a.desc;b.nickname=a.nickname;this.addChatRoom(b);return b};var SNSGroup=function(a){this.name=a;this.editable=!0};SNSGroup.prototype=new SNSBaseRosterList;
SNSGroup.prototype.getOnlineNumber=function(){var a=0,b;for(b in this._list)this._list[b]&&this._list[b]instanceof SNSRoster&&this._list[b].presence.status!=SNS_STATUS.UNAVAILABLE&&a++;return a};SNSGroup.prototype.getOnlineRosters=function(){var a=[],b;for(b in this._list)b&&b instanceof SNSRoster&&b.presence.status!=SNS_STATUS.UNAVAILABLE&&a.push(b);return a};SNSGroup.prototype.addRoster=function(a){a.addToGroup(this)};SNSGroup.prototype.removeRoster=function(a){a&&a instanceof SNSRoster&&a.removeFromGroup(this)};
var SNSGroupList=function(){this.groupNone=new SNSGroup(SNSConfig.GROUP.GROUP_NONE);this.publicServiceGroup=SNSPublicServiceGroup.getInstance();this.deviceGroup=new SNSDeviceGroup;this.addGroup(this.groupNone);this.addGroup(this.publicServiceGroup);this.addGroup(this.deviceGroup)};SNSGroupList.prototype=new SNSBaseList;SNSGroupList.prototype.getGroup=function(a){if(a){if("string"==typeof a)return this.get(a);if(a instanceof SNSGroup)return this.get(a.name)}};
SNSGroupList.prototype.contains=function(a){if(a){if("string"==typeof a)return SNSBaseList.prototype.contains.call(this,a);if(a instanceof SNSGroup)return SNSBaseList.prototype.contains.call(this,a.name)}};SNSGroupList.prototype.addGroup=function(a){if(this.contains(a))return this.get[a];if(a){if("string"==typeof a)return SNSGroupList.checkGroupName(a),a=new SNSGroup(a),this.add(a.name,a),a;if(a instanceof SNSGroup)return this.add(a.name,a),a}};
SNSGroupList.prototype.addRoster=function(a){if(a&&a instanceof SNSRoster)for(var b=0;b<a.groups.length;b++){var c=this.getGroup(a.groups[b]);c||(c=this.addGroup(a.groups[b]));c.add(a)}};SNSGroupList.prototype.toArray=function(){var a=[],b;for(b in this._list)this._list[b]&&this._list[b]instanceof SNSGroup&&a.push(this._list[b]);return a};
SNSGroupList.checkGroupName=function(a){if(!a||""===a)throw"groupname cannot be empty ";for(var b=0;b<SNSConfig.GROUP.NAME_FORBIDDEN.length;b++)if(-1!=a.indexOf(SNSConfig.GROUP.NAME_FORBIDDEN[b]))throw"forbidden char in groupname: "+SNSConfig.GROUP.NAME_FORBIDDEN[b];};SNSGroupList.prototype.moveRoster=function(a,b,c,d){b==SNS_MOVE_ROSTER_TYPE.MOVE?a.moveBetweenGroups(c,d):b==SNS_MOVE_ROSTER_TYPE.COPY&&this.getGroup(d).addRoster(a)};
SNSGroupList.prototype.availableGroups=function(a){var b=[],c;for(c in this._list)this._list[c].editable&&!this._list[c].contains(a)&&c!==SNSConfig.GROUP.GROUP_NONE&&b.push(this._list[c]);return b};var SNSPresence=function(a){this.status=SNS_STATUS.UNAVAILABLE;a&&(this.resource=a.resource,this.type=a.type,this.status=a.status)};SNSPresence.prototype.equals=function(a){return a&&a instanceof SNSPresence&&a.status==this.status&&this.priority==a.priority?!0:!1};
SNSPresence.prototype.setStatus=function(a){for(var b in SNS_STATUS)if(a==SNS_STATUS[b]){this.status=a;break}};var SNSRecentList=function(){this.list=[]};SNSRecentList.prototype.getFirstItem=function(){if(0<this.list.length)return this.list[0]};SNSRecentList.prototype.contains=function(a){for(var b=0;b<this.list.length;b++)if(a==this.list[b].id)return!0;return!1};
SNSRecentList.prototype.addNewRoster=function(a,b){if(!this.list[0]||this.list[0].id!=a){for(var c=this.list.unshift({id:a,message:b?b.body.content:""}),d=1;d<c;d++)if(this.list[d].id==a){this.list.splice(d,1);break}this.list.length>SNSConfig.RECENT.MAX_SIZE&&this.list.pop();SNSApplication.getInstance().getGlobalEventManager().trigger(SNS_EVENT_SUBJECT.ADD_TO_RENCENT,[])}};SNSRecentList.prototype.addNew=function(a){a=a.getRosterOrChatRoom().id;this.addNewRoster(a)};
var SNSRoster=function(a,b){this.name;this.id;this.photoUrl;this.vcard;this.presence=new SNSPresence;this.groups=[];this.subscription=SNS_SUBSCRIBE.NONE;this.resource;this.ask="";a&&(this.id=a,this.name=b?b:a);this._queryingVCard=!1;this._vcardDefer};SNSRoster.prototype.getPhotoUrl=function(){return this.photoUrl?YYIMChat.getFileUrl(this.photoUrl):SNSConfig.USER.DEFAULT_AVATAR};SNSRoster.prototype.rename=function(a){SNSRoster.checkName(a);this.name=a;return this.update()};
SNSRoster.prototype.addToGroup=function(a,b){if(a&&a instanceof SNSGroup){for(var c=0;c<this.groups.length;c++)if(this.groups[c].name==a.name)return;this.groups.push(a);a.add(this);if(!b)return this.update()}};SNSRoster.prototype.removeFromGroup=function(a){if(a&&a instanceof SNSGroup){for(var b=0;b<this.groups.length;b++)if(this.groups[b].name==a.name){a.remove(this);this.groups.splice(b,1);return}return this.update()}};
SNSRoster.prototype.moveBetweenGroups=function(a,b){for(var c=0;c<this.groups.length;c++)this.groups[c].name==a.name&&(this.groups.splice(c,1),a.remove(this.getID()));this.groups.push(b);b.add(this);return this.update()};SNSRoster.prototype.update=function(){for(var a=jQuery.Deferred(),b=[],c=this.groups.length;c--;)b.push(this.groups[c].name);YYIMChat.updateRosterItem({roster:{id:this.getID(),name:this.name,groups:b},success:function(){a.resolve()},error:function(){a.reject()}});return a.promise()};
SNSRoster.prototype.setPresence=function(a){if(a&&a instanceof SNSPresence&&a!=this.presence){var b=this.presence;this.presence=a;SNSApplication.getInstance().getGlobalEventManager().trigger(SNS_EVENT_SUBJECT.ON_ROSTER_PRESENCE_CHANGE,[{target:this,newValue:this.presence,oldValue:b}])}};SNSRoster.prototype.changePhoto=function(a){this.photoUrl=a;SNSApplication.getInstance().getGlobalEventManager().trigger(SNS_EVENT_SUBJECT.ON_ROSTER_PHOTO_CHANGE,[{photo:a,rosterId:this.getID()}])};
SNSRoster.prototype.getVCard=function(){if(this.vcard)return this.vcard};SNSRoster.prototype.whenVCardDone=function(a,b,c){this.vcard?b.apply(a,c):jQuery.when(this.queryVCard()).done(function(){b.apply(a,c)}).fail(function(){throw"execute error";})};
SNSRoster.prototype.queryVCard=function(){if(this._queryingVCard)return this._vcardDefer;this._queryingVCard=!0;this._vcardDefer=jQuery.Deferred();var a=this;YYIMChat.getVCard({id:a.getID(),success:function(b){a.setVCard(new SNSVCard(b));a._vcardDefer.resolve();a._queryingVCard=!1},error:function(){a._vcardDefer.reject();a._queryingVCard=!1}});return this._vcardDefer.promise()};SNSRoster.prototype.setVCard=function(a){this.vcard=a};
SNSRoster.checkName=function(a){if(!a||""===a)throw"rostername cannot be empty ";for(var b=0;b<SNSConfig.ROSTER.NAME_FORBIDDEN.length;b++)if(-1!=a.indexOf(SNSConfig.ROSTER.NAME_FORBIDDEN[b]))throw"forbidden char in rostername: "+SNSConfig.ROSTER.NAME_FORBIDDEN[b];};
SNSRoster.prototype.equals=function(a){if(a&&a instanceof SNSRoster){if(!this.jid.isEntity(a.jid)||this.name!=a.name||this.subscription!=a.subscription||this.presence.show!=a.presence.show)return!1;var b=0;if(this.groups.length==a.groups.length){for(var c=0;c<this.groups.length;c++)for(var d=0;d<a.groups.length;d++)if(this.groups[c].name==a.groups[d].name){b++;break}if(b==a.groups.length)return!0}}return!1};SNSRoster.prototype.getID=function(){return this.id};var SNSRosterList=function(){};
SNSRosterList.prototype=new SNSBaseRosterList;SNSRosterList.prototype.getOnlineRosters=function(){var a=[],b;for(b in this.list)b.presence.status!=SNS_STATUS.UNAVAILABLE&&a.push(b);return this.sortByStatus(a)};SNSRosterList.prototype.sortByStatus=function(a){function b(a,b){return SNS_SHOW_PRIORITY[a.presence.status.toUpperCase()]-SNS_SHOW_PRIORITY[b.presence.status.toUpperCase()]}if(!a)return this.toArray().sort(b);if(a&&a instanceof Array)return a.sort(b)};
SNSRosterList.prototype.getAvailableRosters=function(){var a=[],b;for(b in this.list)b.presence.status==SNS_STATUS.AVAILABLE&&a.push(b);return a};SNSRosterList.prototype.getRostersBySubscription=function(a,b,c){var d=[],e;for(e in this.list)for(var h=e.subscription,s=0;s<arguments.length;s++)argumetns[s]==h&&d.push(e);return d};var SNSSystemRoster=function(){this.name="\u7cfb\u7edf\u6d88\u606f";this.id="system";this.show="systemroster";this.messageList=[];this.photoUrl=SNSConfig.SYSTEM_ROSTER.DEFAULT_AVATAR};
SNSSystemRoster.prototype=new SNSRoster;SNSSystemRoster.prototype.getPhotoUrl=function(){return this.photoUrl};SNSSystemRoster.prototype.addMsg=function(a,b){b.from=this.id;var c={};c.uuid=a;c.msg=b;this._messageList.push(c);SNSRosterRender.findActiveRoster()instanceof SNSSystemRoster?(SNSMessageRender.showMessage(b),SNSWindow.changeCurrentChatTo(this.id)):(SNSRosterRender.isChatWindowLeftItemOpened(this.id)&&SNSMessageRender.showMessage(b),SNSMessageRender.twinkle(b,this.id))};
SNSSystemRoster.prototype.showMsg=function(){SNSWindow.changeCurrentChatTo(this.id);for(var a in this._messageList)this.isMsgRendered(this._messageList[a].uuid)||SNSMessageRender.showMessage(this._messageList[a].msg);SNSInitBinder.systemMessageBtn.find("span").attr("class","")};SNSSystemRoster.prototype.updateMsgContent=function(a,b){for(var c in this._messageList)this._messageList[c].uuid==a&&(this._messageList[c].msg.body.content=b)};
SNSSystemRoster.prototype.isMsgRendered=function(a){return 0<jQuery("div[action-data='"+a+"']").length};SNSSystemRoster.prototype.clearMsg=function(){this._messageList.splice(0,this._messageList.length)};SNSSystemRoster.prototype.getID=function(){return this.id};var SNSVCard=function(a){this.nickname=a.nickname;this.photo=a.photo;this.email=a.email;this.mobile=a.mobile;this.telephone=a.telephone;this.showpropList=["nickname","email","mobile","telephone"]};
SNSVCard.prototype.hasPhoto=function(){return!(!this.photo||!this.photo.notEmpty())};SNSVCard.prototype.getPhotoUrl=function(){return this.hasPhoto()?YYIMChat.getFileUrl(this.photo):SNSConfig.USER.DEFAULT_AVATAR};SNSVCard.prototype.updateUserPhotoUrl=function(a,b){this.photo=a;this.update(b)};
SNSVCard.prototype.update=function(a){YYIMChat.setVCard({vcard:this,success:function(){a.success&&a.success()},error:function(b){b={info:"\u83b7\u53d6\u597d\u53cb\u5217\u8868\u5931\u8d25",packet:b};a.error&&a.error(b)}})};var SNSDeviceGroup=function(){this.name=SNSConfig.GROUP.GROUP_DEVICE;this.editable=!1};SNSDeviceGroup.prototype=new SNSGroup;SNSDeviceGroup.getInstance=function(){SNSDeviceGroup._instance||(SNSDeviceGroup._instance=new SNSDeviceGroup);return SNSDeviceGroup._instance};
SNSDeviceGroup.prototype.getOnlineNumber=function(){var a=0,b=SNSApplication.getInstance().getUser().deviceList._list,c;for(c in b)b[c]&&b[c]instanceof SNSDeviceRoster&&b[c].presence.status!=SNS_STATUS.UNAVAILABLE&&a++;return a};SNSDeviceGroup.prototype.size=function(){return SNSApplication.getInstance().getUser().deviceList.size()};var SNSDeviceList=function(){};SNSDeviceList.prototype=new SNSBaseRosterList;
SNSDeviceList.prototype.get=function(a){if(!a)throw"id is null!";if(this._list){var b=a;"string"!=typeof a&&a.getID()&&(b=a.getID());return this._list[b]?this._list[b]:null}};var SNSDeviceRoster=function(a,b){if(!SNSCommonUtil.isStringAndNotEmpty(a))throw"resource is null or empty!";this.id=SNSApplication.getInstance().getUser().getID();this.resource=a;this.name=b?b:SNSApplication.getInstance().getUser().name;this.subscription=SNS_SUBSCRIBE.BOTH;this.vcard=SNSApplication.getInstance().getUser().vcard};
SNSDeviceRoster.prototype=new SNSRoster;SNSDeviceRoster.prototype.getPhotoUrl=function(){return SNSConfig.ROSTER.MY_DEVICE_DEFAULT_AVATAR};SNSDeviceRoster.prototype.setPresence=function(a){if(a&&a instanceof SNSPresence&&a!=this.presence&&a.resource&&a.resource==this.resource){var b=this.presence;this.presence=a;SNSApplication.getInstance().getGlobalEventManager().trigger(SNS_EVENT_SUBJECT.ON_ROSTER_PRESENCE_CHANGE,[{target:this,newValue:this.presence,oldValue:b}])}};
var SNSPublicAccountRoster=function(a,b){this.id=a;this.name=b?b:"\u516c\u5171\u53f7";this.accountName;this.presence.show="none";this.groups=[SNSPublicServiceGroup.getInstance()];this.subscription=SNS_SUBSCRIBE.BOTH;this.photoUrl;SNSPublicServiceGroup.getInstance().addRoster(this)};SNSPublicAccountRoster.prototype=new SNSRoster;SNSPublicAccountRoster.prototype.getPhotoUrl=function(){return this.photoUrl?YYIMChat.getFileUrl(this.photoUrl):SNSConfig.ROSTER.PUB_ACCOUNT_DEFAULT_AVATAR};
var SNSPublicServiceGroup=function(){this.name=SNSConfig.GROUP.GROUP_PUB_ACCOUNT;this.editable=!1};SNSPublicServiceGroup.prototype=new SNSGroup;SNSPublicServiceGroup.getInstance=function(){SNSPublicServiceGroup._instance||(SNSPublicServiceGroup._instance=new SNSPublicServiceGroup);return SNSPublicServiceGroup._instance};SNSPublicServiceGroup.prototype.addRoster=function(a){this.add(a)};
var SNSPublicServiceRoster=function(){this.jid;this.name;this.groups=[SNSPublicServiceGroup.getInstance()];this.presence.show="none";this.subscription=SNS_SUBSCRIBE.BOTH};SNSPublicServiceRoster.prototype=new SNSRoster;SNSPublicServiceRoster.prototype.getPhotoUrl=function(){return SNSConfig.ROSTER.MY_TASK_DEFAULT_AVATAR};var SNSChatRoomMemberRoster=function(a,b){this.affiliation=SNS_CHATROOM_MEMBER_AFFILIATION.NONE;this.role=SNS_CHATROOM_MEMBER_ROLE.PARTICIPANT;a&&(this.id=a,this.name=b?b:a)};
SNSChatRoomMemberRoster.prototype=new SNSRoster;SNSChatRoomMemberRoster.prototype.getPhotoUrl=function(){return this.photoUrl?YYIMChat.getFileUrl(this.photoUrl):SNSConfig.USER.DEFAULT_AVATAR};var SNSGlobalEventListener=function(a,b,c,d,e){this.subject=a;this.async=b;this.thisObj=d;this.callback=c||function(a,b){_logger.log("default global event callback")}},SNSGlobalEventManager=function(){this.BIND_DOM=jQuery(document);this.events={}};
SNSGlobalEventManager.getInstance=function(){SNSGlobalEventManager._instance||(SNSGlobalEventManager._instance=new SNSGlobalEventManager,SNSGlobalEventManager._instance&&SNSGlobalEventManager._instance._init&&"function"==typeof SNSGlobalEventManager._instance._init&&SNSGlobalEventManager._instance._init());return SNSGlobalEventManager._instance};
SNSGlobalEventManager.prototype.trigger=function(a,b){YYIMChat.log("SNSGlobalEventManager.prototype.trigger: ",3,a);this.BIND_DOM.trigger(a,b);if(this.events[a]&&this.events[a]instanceof Array)for(var c=this.events[a],d=0;d<c.length;d++){var e=c[d];try{e.callback.apply(e.thisObj,b)}catch(h){YYIMChat.log("SNSGlobalEventManager.prototype.trigger :exception",0,h,a,b);break}}};
SNSGlobalEventManager.prototype.registerEventHandler=function(a,b,c,d){b?this.BIND_DOM.bind(a,jQuery.proxy(c,d)):(this.events[a]||(this.events[a]=[]),this.events[a].push(new SNSGlobalEventListener(a,b,c,d)))};
(function(a){function b(a,b){var c=(a&65535)+(b&65535);return(a>>16)+(b>>16)+(c>>16)<<16|c&65535}function c(a,c,d,e,h,s){a=b(b(c,a),b(e,s));return b(a<<h|a>>>32-h,d)}function d(a,b,d,e,h,s,u){return c(b&d|~b&e,a,b,h,s,u)}function e(a,b,d,e,h,s,u){return c(b&e|d&~e,a,b,h,s,u)}function h(a,b,d,e,h,s,u){return c(d^(b|~e),a,b,h,s,u)}function s(a,k){a[k>>5]|=128<<k%32;a[(k+64>>>9<<4)+14]=k;var p,s,u,t,P,f=1732584193,m=-271733879,l=-1732584194,g=271733878;for(p=0;p<a.length;p+=16)s=f,u=m,t=l,P=g,f=d(f,
m,l,g,a[p],7,-680876936),g=d(g,f,m,l,a[p+1],12,-389564586),l=d(l,g,f,m,a[p+2],17,606105819),m=d(m,l,g,f,a[p+3],22,-1044525330),f=d(f,m,l,g,a[p+4],7,-176418897),g=d(g,f,m,l,a[p+5],12,1200080426),l=d(l,g,f,m,a[p+6],17,-1473231341),m=d(m,l,g,f,a[p+7],22,-45705983),f=d(f,m,l,g,a[p+8],7,1770035416),g=d(g,f,m,l,a[p+9],12,-1958414417),l=d(l,g,f,m,a[p+10],17,-42063),m=d(m,l,g,f,a[p+11],22,-1990404162),f=d(f,m,l,g,a[p+12],7,1804603682),g=d(g,f,m,l,a[p+13],12,-40341101),l=d(l,g,f,m,a[p+14],17,-1502002290),
m=d(m,l,g,f,a[p+15],22,1236535329),f=e(f,m,l,g,a[p+1],5,-165796510),g=e(g,f,m,l,a[p+6],9,-1069501632),l=e(l,g,f,m,a[p+11],14,643717713),m=e(m,l,g,f,a[p],20,-373897302),f=e(f,m,l,g,a[p+5],5,-701558691),g=e(g,f,m,l,a[p+10],9,38016083),l=e(l,g,f,m,a[p+15],14,-660478335),m=e(m,l,g,f,a[p+4],20,-405537848),f=e(f,m,l,g,a[p+9],5,568446438),g=e(g,f,m,l,a[p+14],9,-1019803690),l=e(l,g,f,m,a[p+3],14,-187363961),m=e(m,l,g,f,a[p+8],20,1163531501),f=e(f,m,l,g,a[p+13],5,-1444681467),g=e(g,f,m,l,a[p+2],9,-51403784),
l=e(l,g,f,m,a[p+7],14,1735328473),m=e(m,l,g,f,a[p+12],20,-1926607734),f=c(m^l^g,f,m,a[p+5],4,-378558),g=c(f^m^l,g,f,a[p+8],11,-2022574463),l=c(g^f^m,l,g,a[p+11],16,1839030562),m=c(l^g^f,m,l,a[p+14],23,-35309556),f=c(m^l^g,f,m,a[p+1],4,-1530992060),g=c(f^m^l,g,f,a[p+4],11,1272893353),l=c(g^f^m,l,g,a[p+7],16,-155497632),m=c(l^g^f,m,l,a[p+10],23,-1094730640),f=c(m^l^g,f,m,a[p+13],4,681279174),g=c(f^m^l,g,f,a[p],11,-358537222),l=c(g^f^m,l,g,a[p+3],16,-722521979),m=c(l^g^f,m,l,a[p+6],23,76029189),f=c(m^
l^g,f,m,a[p+9],4,-640364487),g=c(f^m^l,g,f,a[p+12],11,-421815835),l=c(g^f^m,l,g,a[p+15],16,530742520),m=c(l^g^f,m,l,a[p+2],23,-995338651),f=h(f,m,l,g,a[p],6,-198630844),g=h(g,f,m,l,a[p+7],10,1126891415),l=h(l,g,f,m,a[p+14],15,-1416354905),m=h(m,l,g,f,a[p+5],21,-57434055),f=h(f,m,l,g,a[p+12],6,1700485571),g=h(g,f,m,l,a[p+3],10,-1894986606),l=h(l,g,f,m,a[p+10],15,-1051523),m=h(m,l,g,f,a[p+1],21,-2054922799),f=h(f,m,l,g,a[p+8],6,1873313359),g=h(g,f,m,l,a[p+15],10,-30611744),l=h(l,g,f,m,a[p+6],15,-1560198380),
m=h(m,l,g,f,a[p+13],21,1309151649),f=h(f,m,l,g,a[p+4],6,-145523070),g=h(g,f,m,l,a[p+11],10,-1120210379),l=h(l,g,f,m,a[p+2],15,718787259),m=h(m,l,g,f,a[p+9],21,-343485551),f=b(f,s),m=b(m,u),l=b(l,t),g=b(g,P);return[f,m,l,g]}function u(a){var b,c="";for(b=0;b<32*a.length;b+=8)c+=String.fromCharCode(a[b>>5]>>>b%32&255);return c}function t(a){var b,c=[];c[(a.length>>2)-1]=void 0;for(b=0;b<c.length;b+=1)c[b]=0;for(b=0;b<8*a.length;b+=8)c[b>>5]|=(a.charCodeAt(b/8)&255)<<b%32;return c}function v(a){return u(s(t(a),
8*a.length))}function Q(a){var b="",c,d;for(d=0;d<a.length;d+=1)c=a.charCodeAt(d),b+="0123456789abcdef".charAt(c>>>4&15)+"0123456789abcdef".charAt(c&15);return b}function W(a,b){var c=unescape(encodeURIComponent(a)),d=unescape(encodeURIComponent(b)),e=t(c),h=[],P=[];h[15]=P[15]=void 0;16<e.length&&(e=s(e,8*c.length));for(c=0;16>c;c+=1)h[c]=e[c]^909522486,P[c]=e[c]^1549556828;d=s(h.concat(t(d)),512+8*d.length);return u(s(P.concat(d),640))}a.md5=function(a,b,c){return b?c?W(b,a):Q(W(b,a)):c?v(unescape(encodeURIComponent(a))):
Q(v(unescape(encodeURIComponent(a))))}})("function"===typeof jQuery?jQuery:this);
(function(a){var b,c,d,e,h,s,u={},t={},v={},Q={treeId:"",treeObj:null,view:{addDiyDom:null,autoCancelSelected:!0,dblClickExpand:!0,expandSpeed:"fast",fontCss:{},nameIsHTML:!1,selectedMulti:!0,showIcon:!0,showLine:!0,showTitle:!0,txtSelectedEnable:!1},data:{key:{children:"children",name:"name",title:"",url:"url"},simpleData:{enable:!1,idKey:"id",pIdKey:"pId",rootPId:null},keep:{parent:!1,leaf:!1}},async:{enable:!1,contentType:"application/x-www-form-urlencoded",type:"post",dataType:"text",url:"",autoParam:[],
otherParam:[],dataFilter:null},callback:{beforeAsync:null,beforeClick:null,beforeDblClick:null,beforeRightClick:null,beforeMouseDown:null,beforeMouseUp:null,beforeExpand:null,beforeCollapse:null,beforeRemove:null,onAsyncError:null,onAsyncSuccess:null,onNodeCreated:null,onClick:null,onDblClick:null,onRightClick:null,onMouseDown:null,onMouseUp:null,onExpand:null,onCollapse:null,onRemove:null}},W=[function(a){var b=a.treeObj,c=q.event;b.bind(c.NODECREATED,function(b,c,A){n.apply(a.callback.onNodeCreated,
[b,c,A])});b.bind(c.CLICK,function(b,c,A,d,H){n.apply(a.callback.onClick,[c,A,d,H])});b.bind(c.EXPAND,function(b,c,A){n.apply(a.callback.onExpand,[b,c,A])});b.bind(c.COLLAPSE,function(b,c,A){n.apply(a.callback.onCollapse,[b,c,A])});b.bind(c.ASYNC_SUCCESS,function(b,c,A,d){n.apply(a.callback.onAsyncSuccess,[b,c,A,d])});b.bind(c.ASYNC_ERROR,function(b,c,A,d,H,e){n.apply(a.callback.onAsyncError,[b,c,A,d,H,e])});b.bind(c.REMOVE,function(b,c,A){n.apply(a.callback.onRemove,[b,c,A])})}],C=[function(a){var b=
q.event;a.treeObj.unbind(b.NODECREATED).unbind(b.CLICK).unbind(b.EXPAND).unbind(b.COLLAPSE).unbind(b.ASYNC_SUCCESS).unbind(b.ASYNC_ERROR).unbind(b.REMOVE)}],k=[function(a){var b=g.getCache(a);b||(b={},g.setCache(a,b));b.nodes=[];b.doms=[]}],p=[function(a,b,c,d,e,J){if(c){var f=g.getRoot(a),h=a.data.key.children;c.level=b;c.tId=a.treeId+"_"+ ++f.zId;c.parentTId=d?d.tId:null;c.open="string"==typeof c.open?n.eqs(c.open,"true"):!!c.open;c[h]&&0<c[h].length?(c.isParent=!0,c.zAsync=!0):(c.isParent="string"==
typeof c.isParent?n.eqs(c.isParent,"true"):!!c.isParent,c.open=c.isParent&&!a.async.enable?c.open:!1,c.zAsync=!c.isParent);c.isFirstNode=e;c.isLastNode=J;c.getParentNode=function(){return g.getNodeCache(a,c.parentTId)};c.getPreNode=function(){return g.getPreNode(a,c)};c.getNextNode=function(){return g.getNextNode(a,c)};c.isAjaxing=!1;g.fixPIdKeyValue(a,c)}}],E=[function(a){var A=a.target,H=g.getSetting(a.data.treeId),L="",F=null,J="",f="",m=null,l=null,k=null;if(n.eqs(a.type,"mousedown"))f="mousedown";
else if(n.eqs(a.type,"mouseup"))f="mouseup";else if(n.eqs(a.type,"contextmenu"))f="contextmenu";else if(n.eqs(a.type,"click"))if(n.eqs(A.tagName,"span")&&null!==A.getAttribute("treeNode"+q.id.SWITCH))L=n.getNodeMainDom(A).id,J="switchNode";else{if(k=n.getMDom(H,A,[{tagName:"a",attrName:"treeNode"+q.id.A}]))L=n.getNodeMainDom(k).id,J="clickNode"}else n.eqs(a.type,"dblclick")&&(f="dblclick",k=n.getMDom(H,A,[{tagName:"a",attrName:"treeNode"+q.id.A}]))&&(L=n.getNodeMainDom(k).id,J="switchNode");0<f.length&&
0==L.length&&(k=n.getMDom(H,A,[{tagName:"a",attrName:"treeNode"+q.id.A}]))&&(L=n.getNodeMainDom(k).id);if(0<L.length)switch(F=g.getNodeCache(H,L),J){case "switchNode":F.isParent?n.eqs(a.type,"click")||n.eqs(a.type,"dblclick")&&n.apply(H.view.dblClickExpand,[H.treeId,F],H.view.dblClickExpand)?m=b:J="":J="";break;case "clickNode":m=c}switch(f){case "mousedown":l=d;break;case "mouseup":l=e;break;case "dblclick":l=h;break;case "contextmenu":l=s}return{stop:!1,node:F,nodeEventType:J,nodeEventCallback:m,
treeEventType:f,treeEventCallback:l}}],I=[function(a){var b=g.getRoot(a);b||(b={},g.setRoot(a,b));b[a.data.key.children]=[];b.expandTriggerFlag=!1;b.curSelectedList=[];b.noSelection=!0;b.createdNodes=[];b.zId=0;b._ver=(new Date).getTime()}],M=[],P=[],f=[],m=[],l=[],g={addNodeCache:function(a,b){g.getCache(a).nodes[g.getNodeCacheId(b.tId)]=b},getNodeCacheId:function(a){return a.substring(a.lastIndexOf("_")+1)},addAfterA:function(a){P.push(a)},addBeforeA:function(a){M.push(a)},addInnerAfterA:function(a){m.push(a)},
addInnerBeforeA:function(a){f.push(a)},addInitBind:function(a){W.push(a)},addInitUnBind:function(a){C.push(a)},addInitCache:function(a){k.push(a)},addInitNode:function(a){p.push(a)},addInitProxy:function(a,b){b?E.splice(0,0,a):E.push(a)},addInitRoot:function(a){I.push(a)},addNodesData:function(a,b,c){var d=a.data.key.children;b[d]||(b[d]=[]);0<b[d].length&&(b[d][b[d].length-1].isLastNode=!1,r.setNodeLineIcos(a,b[d][b[d].length-1]));b.isParent=!0;b[d]=b[d].concat(c)},addSelectedNode:function(a,b){var c=
g.getRoot(a);g.isSelectedNode(a,b)||c.curSelectedList.push(b)},addCreatedNode:function(a,b){(a.callback.onNodeCreated||a.view.addDiyDom)&&g.getRoot(a).createdNodes.push(b)},addZTreeTools:function(a){l.push(a)},exSetting:function(b){a.extend(!0,Q,b)},fixPIdKeyValue:function(a,b){a.data.simpleData.enable&&(b[a.data.simpleData.pIdKey]=b.parentTId?b.getParentNode()[a.data.simpleData.idKey]:a.data.simpleData.rootPId)},getAfterA:function(a,b,c){for(var d=0,e=P.length;d<e;d++)P[d].apply(this,arguments)},
getBeforeA:function(a,b,c){for(var d=0,e=M.length;d<e;d++)M[d].apply(this,arguments)},getInnerAfterA:function(a,b,c){for(var d=0,e=m.length;d<e;d++)m[d].apply(this,arguments)},getInnerBeforeA:function(a,b,c){for(var d=0,e=f.length;d<e;d++)f[d].apply(this,arguments)},getCache:function(a){return v[a.treeId]},getNextNode:function(a,b){if(!b)return null;for(var c=a.data.key.children,d=b.parentTId?b.getParentNode():g.getRoot(a),e=0,f=d[c].length-1;e<=f;e++)if(d[c][e]===b)return e==f?null:d[c][e+1];return null},
getNodeByParam:function(a,b,c,d){if(!b||!c)return null;for(var e=a.data.key.children,f=0,h=b.length;f<h;f++){if(b[f][c]==d)return b[f];var m=g.getNodeByParam(a,b[f][e],c,d);if(m)return m}return null},getNodeCache:function(a,b){if(!b)return null;var c=v[a.treeId].nodes[g.getNodeCacheId(b)];return c?c:null},getNodeName:function(a,b){return""+b[a.data.key.name]},getNodeTitle:function(a,b){return""+b[""===a.data.key.title?a.data.key.name:a.data.key.title]},getNodes:function(a){return g.getRoot(a)[a.data.key.children]},
getNodesByParam:function(a,b,c,d){if(!b||!c)return[];for(var e=a.data.key.children,f=[],h=0,m=b.length;h<m;h++)b[h][c]==d&&f.push(b[h]),f=f.concat(g.getNodesByParam(a,b[h][e],c,d));return f},getNodesByParamFuzzy:function(a,b,c,d){if(!b||!c)return[];var e=a.data.key.children,f=[];d=d.toLowerCase();for(var h=0,m=b.length;h<m;h++)"string"==typeof b[h][c]&&-1<b[h][c].toLowerCase().indexOf(d)&&f.push(b[h]),f=f.concat(g.getNodesByParamFuzzy(a,b[h][e],c,d));return f},getNodesByFilter:function(a,b,c,d,e){if(!b)return d?
null:[];for(var f=a.data.key.children,h=d?null:[],m=0,l=b.length;m<l;m++){if(n.apply(c,[b[m],e],!1)){if(d)return b[m];h.push(b[m])}var k=g.getNodesByFilter(a,b[m][f],c,d,e);if(d&&k)return k;h=d?k:h.concat(k)}return h},getPreNode:function(a,b){if(!b)return null;for(var c=a.data.key.children,d=b.parentTId?b.getParentNode():g.getRoot(a),e=0,f=d[c].length;e<f;e++)if(d[c][e]===b)return 0==e?null:d[c][e-1];return null},getRoot:function(a){return a?t[a.treeId]:null},getRoots:function(){return t},getSetting:function(a){return u[a]},
getSettings:function(){return u},getZTreeTools:function(a){return(a=this.getRoot(this.getSetting(a)))?a.treeTools:null},initCache:function(a){for(var b=0,c=k.length;b<c;b++)k[b].apply(this,arguments)},initNode:function(a,b,c,d,e,g){for(var f=0,h=p.length;f<h;f++)p[f].apply(this,arguments)},initRoot:function(a){for(var b=0,c=I.length;b<c;b++)I[b].apply(this,arguments)},isSelectedNode:function(a,b){for(var c=g.getRoot(a),d=0,e=c.curSelectedList.length;d<e;d++)if(b===c.curSelectedList[d])return!0;return!1},
removeNodeCache:function(a,b){var c=a.data.key.children;if(b[c])for(var d=0,e=b[c].length;d<e;d++)arguments.callee(a,b[c][d]);g.getCache(a).nodes[g.getNodeCacheId(b.tId)]=null},removeSelectedNode:function(a,b){for(var c=g.getRoot(a),d=0,e=c.curSelectedList.length;d<e;d++)b!==c.curSelectedList[d]&&g.getNodeCache(a,c.curSelectedList[d].tId)||(c.curSelectedList.splice(d,1),d--,e--)},setCache:function(a,b){v[a.treeId]=b},setRoot:function(a,b){t[a.treeId]=b},setZTreeTools:function(a,b){for(var c=0,d=l.length;c<
d;c++)l[c].apply(this,arguments)},transformToArrayFormat:function(a,b){if(!b)return[];var c=a.data.key.children,d=[];if(n.isArray(b))for(var e=0,f=b.length;e<f;e++)d.push(b[e]),b[e][c]&&(d=d.concat(g.transformToArrayFormat(a,b[e][c])));else d.push(b),b[c]&&(d=d.concat(g.transformToArrayFormat(a,b[c])));return d},transformTozTreeFormat:function(a,b){var c,d,e=a.data.simpleData.idKey,g=a.data.simpleData.pIdKey,f=a.data.key.children;if(!e||""==e||!b)return[];if(n.isArray(b)){var h=[],m=[];c=0;for(d=
b.length;c<d;c++)m[b[c][e]]=b[c];c=0;for(d=b.length;c<d;c++)m[b[c][g]]&&b[c][e]!=b[c][g]?(m[b[c][g]][f]||(m[b[c][g]][f]=[]),m[b[c][g]][f].push(b[c])):h.push(b[c]);return h}return[b]}},G={bindEvent:function(a){for(var b=0,c=W.length;b<c;b++)W[b].apply(this,arguments)},unbindEvent:function(a){for(var b=0,c=C.length;b<c;b++)C[b].apply(this,arguments)},bindTree:function(a){var b={treeId:a.treeId},c=a.treeObj;a.view.txtSelectedEnable||c.bind("selectstart",function(a){a=a.originalEvent.srcElement.nodeName.toLowerCase();
return"input"===a||"textarea"===a}).css({"-moz-user-select":"-moz-none"});c.bind("click",b,G.proxy);c.bind("dblclick",b,G.proxy);c.bind("mouseover",b,G.proxy);c.bind("mouseout",b,G.proxy);c.bind("mousedown",b,G.proxy);c.bind("mouseup",b,G.proxy);c.bind("contextmenu",b,G.proxy)},unbindTree:function(a){a.treeObj.unbind("click",G.proxy).unbind("dblclick",G.proxy).unbind("mouseover",G.proxy).unbind("mouseout",G.proxy).unbind("mousedown",G.proxy).unbind("mouseup",G.proxy).unbind("contextmenu",G.proxy)},
doProxy:function(a){for(var b=[],c=0,d=E.length;c<d;c++){var e=E[c].apply(this,arguments);b.push(e);if(e.stop)break}return b},proxy:function(a){var b=g.getSetting(a.data.treeId);if(!n.uCanDo(b,a))return!0;for(var b=G.doProxy(a),c=!0,d=0,e=b.length;d<e;d++){var f=b[d];f.nodeEventCallback&&(c=f.nodeEventCallback.apply(f,[a,f.node])&&c);f.treeEventCallback&&(c=f.treeEventCallback.apply(f,[a,f.node])&&c)}return c}};b=function(a,b){var c=g.getSetting(a.data.treeId);if(b.open){if(!1==n.apply(c.callback.beforeCollapse,
[c.treeId,b],!0))return!0}else if(!1==n.apply(c.callback.beforeExpand,[c.treeId,b],!0))return!0;g.getRoot(c).expandTriggerFlag=!0;r.switchNode(c,b);return!0};c=function(a,b){var c=g.getSetting(a.data.treeId),d=c.view.autoCancelSelected&&(a.ctrlKey||a.metaKey)&&g.isSelectedNode(c,b)?0:c.view.autoCancelSelected&&(a.ctrlKey||a.metaKey)&&c.view.selectedMulti?2:1;if(!1==n.apply(c.callback.beforeClick,[c.treeId,b,d],!0))return!0;0===d?r.cancelPreSelectedNode(c,b):r.selectNode(c,b,2===d);c.treeObj.trigger(q.event.CLICK,
[a,c.treeId,b,d]);return!0};d=function(a,b){var c=g.getSetting(a.data.treeId);n.apply(c.callback.beforeMouseDown,[c.treeId,b],!0)&&n.apply(c.callback.onMouseDown,[a,c.treeId,b]);return!0};e=function(a,b){var c=g.getSetting(a.data.treeId);n.apply(c.callback.beforeMouseUp,[c.treeId,b],!0)&&n.apply(c.callback.onMouseUp,[a,c.treeId,b]);return!0};h=function(a,b){var c=g.getSetting(a.data.treeId);n.apply(c.callback.beforeDblClick,[c.treeId,b],!0)&&n.apply(c.callback.onDblClick,[a,c.treeId,b]);return!0};
s=function(a,b){var c=g.getSetting(a.data.treeId);n.apply(c.callback.beforeRightClick,[c.treeId,b],!0)&&n.apply(c.callback.onRightClick,[a,c.treeId,b]);return"function"!=typeof c.callback.onRightClick};var n={apply:function(a,b,c){return"function"==typeof a?a.apply(ka,b?b:[]):c},canAsync:function(a,b){var c=a.data.key.children;return a.async.enable&&b&&b.isParent&&!(b.zAsync||b[c]&&0<b[c].length)},clone:function(a){if(null===a)return null;var b=n.isArray(a)?[]:{},c;for(c in a)b[c]=a[c]instanceof Date?
new Date(a[c].getTime()):"object"===typeof a[c]?arguments.callee(a[c]):a[c];return b},eqs:function(a,b){return a.toLowerCase()===b.toLowerCase()},isArray:function(a){return"[object Array]"===Object.prototype.toString.apply(a)},$:function(b,c,d){c&&"string"!=typeof c&&(d=c,c="");return"string"==typeof b?a(b,d?d.treeObj.get(0).ownerDocument:null):a("#"+b.tId+c,d?d.treeObj:null)},getMDom:function(a,b,c){if(!b)return null;for(;b&&b.id!==a.treeId;){for(var d=0,e=c.length;b.tagName&&d<e;d++)if(n.eqs(b.tagName,
c[d].tagName)&&null!==b.getAttribute(c[d].attrName))return b;b=b.parentNode}return null},getNodeMainDom:function(b){return a(b).parent("li").get(0)||a(b).parentsUntil("li").parent().get(0)},isChildOrSelf:function(b,c){return 0<a(b).closest("#"+c).length},uCanDo:function(){return!0}},r={addNodes:function(a,b,c,d){if(!a.data.keep.leaf||!b||b.isParent)if(n.isArray(c)||(c=[c]),a.data.simpleData.enable&&(c=g.transformTozTreeFormat(a,c)),b){var e=y(b,q.id.SWITCH,a),f=y(b,q.id.ICON,a),h=y(b,q.id.UL,a);b.open||
(r.replaceSwitchClass(b,e,q.folder.CLOSE),r.replaceIcoClass(b,f,q.folder.CLOSE),b.open=!1,h.css({display:"none"}));g.addNodesData(a,b,c);r.createNodes(a,b.level+1,c,b);d||r.expandCollapseParentNode(a,b,!0)}else g.addNodesData(a,g.getRoot(a),c),r.createNodes(a,0,c,null)},appendNodes:function(a,b,c,d,e,f){if(!c)return[];for(var h=[],m=a.data.key.children,l=0,k=c.length;l<k;l++){var n=c[l];if(e){var p=(d?d:g.getRoot(a))[m].length==c.length&&0==l;g.initNode(a,b,n,d,p,l==c.length-1,f);g.addNodeCache(a,
n)}p=[];n[m]&&0<n[m].length&&(p=r.appendNodes(a,b+1,n[m],n,e,f&&n.open));f&&(r.makeDOMNodeMainBefore(h,a,n),r.makeDOMNodeLine(h,a,n),g.getBeforeA(a,n,h),r.makeDOMNodeNameBefore(h,a,n),g.getInnerBeforeA(a,n,h),r.makeDOMNodeIcon(h,a,n),g.getInnerAfterA(a,n,h),r.makeDOMNodeNameAfter(h,a,n),g.getAfterA(a,n,h),n.isParent&&n.open&&r.makeUlHtml(a,n,h,p.join("")),r.makeDOMNodeMainAfter(h,a,n),g.addCreatedNode(a,n))}return h},appendParentULDom:function(a,b){var c=[],d=y(b,a);!d.get(0)&&b.parentTId&&(r.appendParentULDom(a,
b.getParentNode()),d=y(b,a));var e=y(b,q.id.UL,a);e.get(0)&&e.remove();e=r.appendNodes(a,b.level+1,b[a.data.key.children],b,!1,!0);r.makeUlHtml(a,b,c,e.join(""));d.append(c.join(""))},asyncNode:function(b,c,d,e){var f,h;if(c&&!c.isParent)return n.apply(e),!1;if(c&&c.isAjaxing)return!1;if(!1==n.apply(b.callback.beforeAsync,[b.treeId,c],!0))return n.apply(e),!1;c&&(c.isAjaxing=!0,y(c,q.id.ICON,b).attr({style:"","class":q.className.BUTTON+" "+q.className.ICO_LOADING}));var m={};f=0;for(h=b.async.autoParam.length;c&&
f<h;f++){var l=b.async.autoParam[f].split("="),k=l;1<l.length&&(k=l[1],l=l[0]);m[k]=c[l]}if(n.isArray(b.async.otherParam))for(f=0,h=b.async.otherParam.length;f<h;f+=2)m[b.async.otherParam[f]]=b.async.otherParam[f+1];else for(var p in b.async.otherParam)m[p]=b.async.otherParam[p];var s=g.getRoot(b)._ver;a.ajax({contentType:b.async.contentType,type:b.async.type,url:n.apply(b.async.url,[b.treeId,c],b.async.url),data:m,dataType:b.async.dataType,success:function(a){if(s==g.getRoot(b)._ver){var f=[];try{f=
a&&0!=a.length?"string"==typeof a?eval("("+a+")"):a:[]}catch(h){f=a}c&&(c.isAjaxing=null,c.zAsync=!0);r.setNodeLineIcos(b,c);f&&""!==f?(f=n.apply(b.async.dataFilter,[b.treeId,c,f],f),r.addNodes(b,c,f?n.clone(f):[],!!d)):r.addNodes(b,c,[],!!d);b.treeObj.trigger(q.event.ASYNC_SUCCESS,[b.treeId,c,a]);n.apply(e)}},error:function(a,d,e){s==g.getRoot(b)._ver&&(c&&(c.isAjaxing=null),r.setNodeLineIcos(b,c),b.treeObj.trigger(q.event.ASYNC_ERROR,[b.treeId,c,a,d,e]))}});return!0},cancelPreSelectedNode:function(a,
b){for(var c=g.getRoot(a).curSelectedList,d=c.length-1;0<=d;d--)if(!b||b===c[d])if(y(c[d],q.id.A,a).removeClass(q.node.CURSELECTED),b){g.removeSelectedNode(a,b);break}b||(g.getRoot(a).curSelectedList=[])},createNodeCallback:function(a){if(a.callback.onNodeCreated||a.view.addDiyDom)for(var b=g.getRoot(a);0<b.createdNodes.length;){var c=b.createdNodes.shift();n.apply(a.view.addDiyDom,[a.treeId,c]);a.callback.onNodeCreated&&a.treeObj.trigger(q.event.NODECREATED,[a.treeId,c])}},createNodes:function(a,
b,c,d){if(c&&0!=c.length){var e=g.getRoot(a),f=a.data.key.children,f=!d||d.open||!!y(d[f][0],a).get(0);e.createdNodes=[];b=r.appendNodes(a,b,c,d,!0,f);d?(d=y(d,q.id.UL,a),d.get(0)&&d.append(b.join(""))):a.treeObj.append(b.join(""));r.createNodeCallback(a)}},destroy:function(a){a&&(g.initCache(a),g.initRoot(a),G.unbindTree(a),G.unbindEvent(a),a.treeObj.empty(),delete u[a.treeId])},expandCollapseNode:function(a,b,c,d,e){var f=g.getRoot(a),h=a.data.key.children;if(b){if(f.expandTriggerFlag){var m=e;
e=function(){m&&m();b.open?a.treeObj.trigger(q.event.EXPAND,[a.treeId,b]):a.treeObj.trigger(q.event.COLLAPSE,[a.treeId,b])};f.expandTriggerFlag=!1}!b.open&&b.isParent&&(!y(b,q.id.UL,a).get(0)||b[h]&&0<b[h].length&&!y(b[h][0],a).get(0))&&(r.appendParentULDom(a,b),r.createNodeCallback(a));if(b.open==c)n.apply(e,[]);else{c=y(b,q.id.UL,a);var f=y(b,q.id.SWITCH,a),l=y(b,q.id.ICON,a);b.isParent?(b.open=!b.open,b.iconOpen&&b.iconClose&&l.attr("style",r.makeNodeIcoStyle(a,b)),b.open?(r.replaceSwitchClass(b,
f,q.folder.OPEN),r.replaceIcoClass(b,l,q.folder.OPEN),!1==d||""==a.view.expandSpeed?(c.show(),n.apply(e,[])):b[h]&&0<b[h].length?c.slideDown(a.view.expandSpeed,e):(c.show(),n.apply(e,[]))):(r.replaceSwitchClass(b,f,q.folder.CLOSE),r.replaceIcoClass(b,l,q.folder.CLOSE),!1!=d&&""!=a.view.expandSpeed&&b[h]&&0<b[h].length?c.slideUp(a.view.expandSpeed,e):(c.hide(),n.apply(e,[])))):n.apply(e,[])}}else n.apply(e,[])},expandCollapseParentNode:function(a,b,c,d,e){b&&(b.parentTId?(r.expandCollapseNode(a,b,
c,d),b.parentTId&&r.expandCollapseParentNode(a,b.getParentNode(),c,d,e)):r.expandCollapseNode(a,b,c,d,e))},expandCollapseSonNode:function(a,b,c,d,e){var f=g.getRoot(a),h=a.data.key.children,f=b?b[h]:f[h],h=b?!1:d,m=g.getRoot(a).expandTriggerFlag;g.getRoot(a).expandTriggerFlag=!1;if(f)for(var l=0,n=f.length;l<n;l++)f[l]&&r.expandCollapseSonNode(a,f[l],c,h);g.getRoot(a).expandTriggerFlag=m;r.expandCollapseNode(a,b,c,d,e)},makeDOMNodeIcon:function(a,b,c){var d=g.getNodeName(b,c),d=b.view.nameIsHTML?
d:d.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");a.push("<span id='",c.tId,q.id.ICON,"' title='' treeNode",q.id.ICON," class='",r.makeNodeIcoClass(b,c),"' style='",r.makeNodeIcoStyle(b,c),"'></span><span id='",c.tId,q.id.SPAN,"'>",d,"</span>")},makeDOMNodeLine:function(a,b,c){a.push("<span id='",c.tId,q.id.SWITCH,"' title='' class='",r.makeNodeLineClass(b,c),"' treeNode",q.id.SWITCH,"></span>")},makeDOMNodeMainAfter:function(a){a.push("</li>")},makeDOMNodeMainBefore:function(a,
b,c){a.push("<li id='",c.tId,"' class='",q.className.LEVEL,c.level,"' tabindex='0' hidefocus='true' treenode>")},makeDOMNodeNameAfter:function(a){a.push("</a>")},makeDOMNodeNameBefore:function(a,b,c){var d=g.getNodeTitle(b,c),e=r.makeNodeUrl(b,c),f=r.makeNodeFontCss(b,c),h=[],m;for(m in f)h.push(m,":",f[m],";");a.push("<a id='",c.tId,q.id.A,"' class='",q.className.LEVEL,c.level,"' treeNode",q.id.A,' onclick="',c.click||"",'" ',null!=e&&0<e.length?"href='"+e+"'":""," target='",r.makeNodeTarget(c),
"' style='",h.join(""),"'");n.apply(b.view.showTitle,[b.treeId,c],b.view.showTitle)&&d&&a.push("title='",d.replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),"'");a.push(">")},makeNodeFontCss:function(a,b){var c=n.apply(a.view.fontCss,[a.treeId,b],a.view.fontCss);return c&&"function"!=typeof c?c:{}},makeNodeIcoClass:function(a,b){var c=["ico"];b.isAjaxing||(c[0]=(b.iconSkin?b.iconSkin+"_":"")+c[0],b.isParent?c.push(b.open?q.folder.OPEN:q.folder.CLOSE):c.push(q.folder.DOCU));return q.className.BUTTON+
" "+c.join("_")},makeNodeIcoStyle:function(a,b){var c=[];if(!b.isAjaxing){var d=b.isParent&&b.iconOpen&&b.iconClose?b.open?b.iconOpen:b.iconClose:b.icon;d&&c.push("background:url(",d,") 0 0 no-repeat;");!1!=a.view.showIcon&&n.apply(a.view.showIcon,[a.treeId,b],!0)||c.push("width:0px;height:0px;")}return c.join("")},makeNodeLineClass:function(a,b){var c=[];a.view.showLine?0==b.level&&b.isFirstNode&&b.isLastNode?c.push(q.line.ROOT):0==b.level&&b.isFirstNode?c.push(q.line.ROOTS):b.isLastNode?c.push(q.line.BOTTOM):
c.push(q.line.CENTER):c.push(q.line.NOLINE);b.isParent?c.push(b.open?q.folder.OPEN:q.folder.CLOSE):c.push(q.folder.DOCU);return r.makeNodeLineClassEx(b)+c.join("_")},makeNodeLineClassEx:function(a){return q.className.BUTTON+" "+q.className.LEVEL+a.level+" "+q.className.SWITCH+" "},makeNodeTarget:function(a){return a.target||"_blank"},makeNodeUrl:function(a,b){var c=a.data.key.url;return b[c]?b[c]:null},makeUlHtml:function(a,b,c,d){c.push("<ul id='",b.tId,q.id.UL,"' class='",q.className.LEVEL,b.level,
" ",r.makeUlLineClass(a,b),"' style='display:",b.open?"block":"none","'>");c.push(d);c.push("</ul>")},makeUlLineClass:function(a,b){return a.view.showLine&&!b.isLastNode?q.line.LINE:""},removeChildNodes:function(a,b){if(b){var c=a.data.key.children,d=b[c];if(d){for(var e=0,f=d.length;e<f;e++)g.removeNodeCache(a,d[e]);g.removeSelectedNode(a);delete b[c];a.data.keep.parent?y(b,q.id.UL,a).empty():(b.isParent=!1,b.open=!1,c=y(b,q.id.SWITCH,a),d=y(b,q.id.ICON,a),r.replaceSwitchClass(b,c,q.folder.DOCU),
r.replaceIcoClass(b,d,q.folder.DOCU),y(b,q.id.UL,a).remove())}}},setFirstNode:function(a,b){var c=a.data.key.children;0<b[c].length&&(b[c][0].isFirstNode=!0)},setLastNode:function(a,b){var c=a.data.key.children,d=b[c].length;0<d&&(b[c][d-1].isLastNode=!0)},removeNode:function(a,b){var c=g.getRoot(a),d=a.data.key.children,e=b.parentTId?b.getParentNode():c;b.isFirstNode=!1;b.isLastNode=!1;b.getPreNode=function(){return null};b.getNextNode=function(){return null};if(g.getNodeCache(a,b.tId)){y(b,a).remove();
g.removeNodeCache(a,b);g.removeSelectedNode(a,b);for(var f=0,h=e[d].length;f<h;f++)if(e[d][f].tId==b.tId){e[d].splice(f,1);break}r.setFirstNode(a,e);r.setLastNode(a,e);var m,f=e[d].length;if(!a.data.keep.parent&&0==f)e.isParent=!1,e.open=!1,f=y(e,q.id.UL,a),h=y(e,q.id.SWITCH,a),m=y(e,q.id.ICON,a),r.replaceSwitchClass(e,h,q.folder.DOCU),r.replaceIcoClass(e,m,q.folder.DOCU),f.css("display","none");else if(a.view.showLine&&0<f){var l=e[d][f-1],f=y(l,q.id.UL,a),h=y(l,q.id.SWITCH,a);m=y(l,q.id.ICON,a);
e==c?1==e[d].length?r.replaceSwitchClass(l,h,q.line.ROOT):(c=y(e[d][0],q.id.SWITCH,a),r.replaceSwitchClass(e[d][0],c,q.line.ROOTS),r.replaceSwitchClass(l,h,q.line.BOTTOM)):r.replaceSwitchClass(l,h,q.line.BOTTOM);f.removeClass(q.line.LINE)}}},replaceIcoClass:function(a,b,c){if(b&&!a.isAjaxing&&(a=b.attr("class"),void 0!=a)){a=a.split("_");switch(c){case q.folder.OPEN:case q.folder.CLOSE:case q.folder.DOCU:a[a.length-1]=c}b.attr("class",a.join("_"))}},replaceSwitchClass:function(a,b,c){if(b){var d=
b.attr("class");if(void 0!=d){d=d.split("_");switch(c){case q.line.ROOT:case q.line.ROOTS:case q.line.CENTER:case q.line.BOTTOM:case q.line.NOLINE:d[0]=r.makeNodeLineClassEx(a)+c;break;case q.folder.OPEN:case q.folder.CLOSE:case q.folder.DOCU:d[1]=c}b.attr("class",d.join("_"));c!==q.folder.DOCU?b.removeAttr("disabled"):b.attr("disabled","disabled")}}},selectNode:function(a,b,c){c||r.cancelPreSelectedNode(a);y(b,q.id.A,a).addClass(q.node.CURSELECTED);g.addSelectedNode(a,b)},setNodeFontCss:function(a,
b){var c=y(b,q.id.A,a),d=r.makeNodeFontCss(a,b);d&&c.css(d)},setNodeLineIcos:function(a,b){if(b){var c=y(b,q.id.SWITCH,a),d=y(b,q.id.UL,a),e=y(b,q.id.ICON,a),f=r.makeUlLineClass(a,b);0==f.length?d.removeClass(q.line.LINE):d.addClass(f);c.attr("class",r.makeNodeLineClass(a,b));b.isParent?c.removeAttr("disabled"):c.attr("disabled","disabled");e.removeAttr("style");e.attr("style",r.makeNodeIcoStyle(a,b));e.attr("class",r.makeNodeIcoClass(a,b))}},setNodeName:function(a,b){var c=g.getNodeTitle(a,b),d=
y(b,q.id.SPAN,a);d.empty();a.view.nameIsHTML?d.html(g.getNodeName(a,b)):d.text(g.getNodeName(a,b));n.apply(a.view.showTitle,[a.treeId,b],a.view.showTitle)&&y(b,q.id.A,a).attr("title",c?c:"")},setNodeTarget:function(a,b){y(b,q.id.A,a).attr("target",r.makeNodeTarget(b))},setNodeUrl:function(a,b){var c=y(b,q.id.A,a),d=r.makeNodeUrl(a,b);null==d||0==d.length?c.removeAttr("href"):c.attr("href",d)},switchNode:function(a,b){b.open||!n.canAsync(a,b)?r.expandCollapseNode(a,b,!b.open):a.async.enable?r.asyncNode(a,
b)||r.expandCollapseNode(a,b,!b.open):b&&r.expandCollapseNode(a,b,!b.open)}};a.fn.zTree={consts:{className:{BUTTON:"button",LEVEL:"level",ICO_LOADING:"ico_loading",SWITCH:"switch"},event:{NODECREATED:"ztree_nodeCreated",CLICK:"ztree_click",EXPAND:"ztree_expand",COLLAPSE:"ztree_collapse",ASYNC_SUCCESS:"ztree_async_success",ASYNC_ERROR:"ztree_async_error",REMOVE:"ztree_remove"},id:{A:"_a",ICON:"_ico",SPAN:"_span",SWITCH:"_switch",UL:"_ul"},line:{ROOT:"root",ROOTS:"roots",CENTER:"center",BOTTOM:"bottom",
NOLINE:"noline",LINE:"line"},folder:{OPEN:"open",CLOSE:"close",DOCU:"docu"},node:{CURSELECTED:"curSelectedNode"}},_z:{tools:n,view:r,event:G,data:g},getZTreeObj:function(a){return(a=g.getZTreeTools(a))?a:null},destroy:function(a){if(a&&0<a.length)r.destroy(g.getSetting(a));else for(var b in u)r.destroy(u[b])},init:function(b,c,d){var e=n.clone(Q);a.extend(!0,e,c);e.treeId=b.attr("id");e.treeObj=b;e.treeObj.empty();u[e.treeId]=e;"undefined"===typeof document.body.style.maxHeight&&(e.view.expandSpeed=
"");g.initRoot(e);b=g.getRoot(e);c=e.data.key.children;d=d?n.clone(n.isArray(d)?d:[d]):[];b[c]=e.data.simpleData.enable?g.transformTozTreeFormat(e,d):d;g.initCache(e);G.unbindTree(e);G.bindTree(e);G.unbindEvent(e);G.bindEvent(e);d={setting:e,addNodes:function(a,b,c){function d(){r.addNodes(e,a,f,!0==c)}if(!b)return null;a||(a=null);if(a&&!a.isParent&&e.data.keep.leaf)return null;var f=n.clone(n.isArray(b)?b:[b]);n.canAsync(e,a)?r.asyncNode(e,a,c,d):d();return f},cancelSelectedNode:function(a){r.cancelPreSelectedNode(e,
a)},destroy:function(){r.destroy(e)},expandAll:function(a){a=!!a;r.expandCollapseSonNode(e,null,a,!0);return a},expandNode:function(a,b,c,d,f){if(!a||!a.isParent)return null;!0!==b&&!1!==b&&(b=!a.open);if((f=!!f)&&b&&!1==n.apply(e.callback.beforeExpand,[e.treeId,a],!0)||f&&!b&&!1==n.apply(e.callback.beforeCollapse,[e.treeId,a],!0))return null;b&&a.parentTId&&r.expandCollapseParentNode(e,a.getParentNode(),b,!1);if(b===a.open&&!c)return null;g.getRoot(e).expandTriggerFlag=f;if(!n.canAsync(e,a)&&c)r.expandCollapseSonNode(e,
a,b,!0,function(){if(!1!==d)try{y(a,e).focus().blur()}catch(b){}});else if(a.open=!b,r.switchNode(this.setting,a),!1!==d)try{y(a,e).focus().blur()}catch(h){}return b},getNodes:function(){return g.getNodes(e)},getNodeByParam:function(a,b,c){return a?g.getNodeByParam(e,c?c[e.data.key.children]:g.getNodes(e),a,b):null},getNodeByTId:function(a){return g.getNodeCache(e,a)},getNodesByParam:function(a,b,c){return a?g.getNodesByParam(e,c?c[e.data.key.children]:g.getNodes(e),a,b):null},getNodesByParamFuzzy:function(a,
b,c){return a?g.getNodesByParamFuzzy(e,c?c[e.data.key.children]:g.getNodes(e),a,b):null},getNodesByFilter:function(a,b,c,d){b=!!b;return a&&"function"==typeof a?g.getNodesByFilter(e,c?c[e.data.key.children]:g.getNodes(e),a,b,d):b?null:[]},getNodeIndex:function(a){if(!a)return null;for(var b=e.data.key.children,c=a.parentTId?a.getParentNode():g.getRoot(e),d=0,f=c[b].length;d<f;d++)if(c[b][d]==a)return d;return-1},getSelectedNodes:function(){for(var a=[],b=g.getRoot(e).curSelectedList,c=0,d=b.length;c<
d;c++)a.push(b[c]);return a},isSelectedNode:function(a){return g.isSelectedNode(e,a)},reAsyncChildNodes:function(a,b,c){if(this.setting.async.enable){var d=!a;d&&(a=g.getRoot(e));if("refresh"==b){b=this.setting.data.key.children;for(var f=0,h=a[b]?a[b].length:0;f<h;f++)g.removeNodeCache(e,a[b][f]);g.removeSelectedNode(e);a[b]=[];d?this.setting.treeObj.empty():y(a,q.id.UL,e).empty()}r.asyncNode(this.setting,d?null:a,!!c)}},refresh:function(){this.setting.treeObj.empty();var a=g.getRoot(e),b=a[e.data.key.children];
g.initRoot(e);a[e.data.key.children]=b;g.initCache(e);r.createNodes(e,0,a[e.data.key.children])},removeChildNodes:function(a){if(!a)return null;var b=a[e.data.key.children];r.removeChildNodes(e,a);return b?b:null},removeNode:function(a,b){a&&(b=!!b,b&&!1==n.apply(e.callback.beforeRemove,[e.treeId,a],!0)||(r.removeNode(e,a),b&&this.setting.treeObj.trigger(q.event.REMOVE,[e.treeId,a])))},selectNode:function(a,b){if(a&&n.uCanDo(e)){b=e.view.selectedMulti&&b;if(a.parentTId)r.expandCollapseParentNode(e,
a.getParentNode(),!0,!1,function(){try{y(a,e).focus().blur()}catch(b){}});else try{y(a,e).focus().blur()}catch(c){}r.selectNode(e,a,b)}},transformTozTreeNodes:function(a){return g.transformTozTreeFormat(e,a)},transformToArray:function(a){return g.transformToArrayFormat(e,a)},updateNode:function(a){a&&y(a,e).get(0)&&n.uCanDo(e)&&(r.setNodeName(e,a),r.setNodeTarget(e,a),r.setNodeUrl(e,a),r.setNodeLineIcos(e,a),r.setNodeFontCss(e,a))}};b.treeTools=d;g.setZTreeTools(e,d);b[c]&&0<b[c].length?r.createNodes(e,
0,b[c]):e.async.enable&&e.async.url&&""!==e.async.url&&r.asyncNode(e);return d}};var ka=a.fn.zTree,y=n.$,q=ka.consts})(jQuery);
(function(a){"function"===typeof define&&define.amd?define(["jquery"],a):"object"===typeof exports?a(require("jquery")):a(jQuery)})(function(a){function b(a){return"string"===typeof a?parseInt(a,10):~~a}var c={wheelSpeed:1,wheelPropagation:!1,minScrollbarLength:null,maxScrollbarLength:null,useBothWheelAxes:!1,useKeyboard:!0,suppressScrollX:!1,suppressScrollY:!1,scrollXMarginOffset:0,scrollYMarginOffset:0,includePadding:!1,hiddenScrollY:!1,setOffsetRight:!1,offsetRight:3},d=0,e=function(){var a=d++;
return function(b){var c=".perfect-scrollbar-"+a;return"undefined"===typeof b?c:b+c}};a=navigator.userAgent.toLowerCase();/msie/.test(a)&&!/opera/.test(a)?jQuery.fn.perfectScrollbar=function(){}:jQuery.fn.perfectScrollbar=function(a,d){return this.each(function(){function u(a){C.minScrollbarLength&&(a=Math.max(a,C.minScrollbarLength));C.maxScrollbarLength&&(a=Math.min(a,C.maxScrollbarLength));return a}function t(){k.removeClass("ps-active-x");k.removeClass("ps-active-y");p=C.includePadding?k.innerWidth():
k.width();E=C.includePadding?k.innerHeight():k.height();I=k.prop("scrollWidth");M=k.prop("scrollHeight");!C.suppressScrollX&&p+C.scrollXMarginOffset<I?(G=!0,n=u(b(p*p/I)),r=b(k.scrollLeft()*(p-n)/(I-p))):(G=!1,r=n=0,k.scrollLeft(0));!C.suppressScrollY&&E+C.scrollYMarginOffset<M?(L=!0,F=u(b(E*E/M)),J=b(k.scrollTop()*(E-F)/(M-E))):(L=!1,J=F=0,k.scrollTop(0));r>=p-n&&(r=p-n);J>=E-F&&(J=E-F);var a={width:p,display:G?"inherit":"none"};a.left=P?k.scrollLeft()+p-I:k.scrollLeft();y?a.bottom=ka-k.scrollTop():
a.top=q+k.scrollTop();l.css(a);a={top:k.scrollTop(),height:E,display:L?"inherit":"none"};C.hiddenScrollY&&(a.display="none");ma?(a.right=P?I-k.scrollLeft()-X-H.outerWidth():X-k.scrollLeft(),C.setOffsetRight&&(a.right=C.offsetRight)):a.left=P?k.scrollLeft()+2*p-I-D-H.outerWidth():D+k.scrollLeft();A.css(a);g.css({left:r,width:n-Ta});H.css({top:J,height:F-R});G&&k.addClass("ps-active-x");L&&k.addClass("ps-active-y")}function v(a,b){var c=k.scrollTop();if(0===a){if(!L)return!1;if(0===c&&0<b||c>=M-E&&
0>b)return!C.wheelPropagation}c=k.scrollLeft();if(0===b){if(!G)return!1;if(0===c&&0>a||c>=I-p&&0<a)return!C.wheelPropagation}return!0}function Q(){var a=!1;k.bind(f("mouseenter"),function(b){a=!0});k.bind(f("mouseleave"),function(b){a=!1});var b=!1;jQuery(m).bind(f("keydown"),function(c){if((!c.isDefaultPrevented||!c.isDefaultPrevented())&&a){for(var d=document.activeElement?document.activeElement:m.activeElement;d.shadowRoot;)d=d.shadowRoot.activeElement;if(!jQuery(d).is(":input,[contenteditable]")){var e=
d=0;switch(c.which){case 37:d=-30;break;case 38:e=30;break;case 39:d=30;break;case 40:e=-30;break;case 33:e=90;break;case 32:case 34:e=-90;break;case 35:e=c.ctrlKey?-M:-E;break;case 36:e=c.ctrlKey?k.scrollTop():E;break;default:return}k.scrollTop(k.scrollTop()-e);k.scrollLeft(k.scrollLeft()+d);(b=v(d,e))&&c.preventDefault()}}})}function W(a,b){var c,d;function e(a,b){k.scrollTop(k.scrollTop()-b);k.scrollLeft(k.scrollLeft()-a);t()}function g(a){q=!0}function h(a){q=!1}function m(a){a=a.originalEvent;
return a.targetTouches&&1===a.targetTouches.length||a.pointerType&&"mouse"!==a.pointerType?!0:!1}function l(a){if(m(a)){s=!0;var b=a.originalEvent.targetTouches?a.originalEvent.targetTouches[0]:a.originalEvent;r.pageX=b.pageX;r.pageY=b.pageY;ba=(new Date).getTime();null!==fa&&clearInterval(fa);a.stopPropagation()}}function n(a){if(!q&&s&&m(a)){var b=a.originalEvent.targetTouches?a.originalEvent.targetTouches[0]:a.originalEvent,f={pageX:b.pageX,pageY:b.pageY},b=f.pageX-r.pageX,g=f.pageY-r.pageY;e(b,
g);r=f;var f=(new Date).getTime(),h=f-ba;0<h&&(c=b/h,d=g/h,ba=f);a.stopPropagation();a.preventDefault()}}function p(a){!q&&s&&(s=!1,clearInterval(fa),fa=setInterval(function(){.01>Math.abs(c)&&.01>Math.abs(d)?clearInterval(fa):(e(30*c,30*d),c*=.8,d*=.8)},10))}var r={},ba=0;d=c=void 0;var fa=null,q=!1,s=!1;a&&(jQuery(window).bind(f("touchstart"),g),jQuery(window).bind(f("touchend"),h),k.bind(f("touchstart"),l),k.bind(f("touchmove"),n),k.bind(f("touchend"),p));b&&(window.PointerEvent?(jQuery(window).bind(f("pointerdown"),
g),jQuery(window).bind(f("pointerup"),h),k.bind(f("pointerdown"),l),k.bind(f("pointermove"),n),k.bind(f("pointerup"),p)):window.MSPointerEvent&&(jQuery(window).bind(f("MSPointerDown"),g),jQuery(window).bind(f("MSPointerUp"),h),k.bind(f("MSPointerDown"),l),k.bind(f("MSPointerMove"),n),k.bind(f("MSPointerUp"),p)))}var C=jQuery.extend(!0,{},c),k=jQuery(this);"object"===typeof a?jQuery.extend(!0,C,a):d=a;if("update"===d)return k.data("perfect-scrollbar-update")&&k.data("perfect-scrollbar-update")(),k;
if("destroy"===d)return k.data("perfect-scrollbar-destroy")&&k.data("perfect-scrollbar-destroy")(),k;if(k.data("perfect-scrollbar"))return k.data("perfect-scrollbar");k.addClass("ps-container");var p,E,I,M,P="rtl"===k.css("direction"),f=e(),m=this.ownerDocument||document,l=jQuery("<div class='ps-scrollbar-x-rail'>").appendTo(k),g=jQuery("<div class='ps-scrollbar-x'>").appendTo(l),G,n,r,ka=b(l.css("bottom")),y=ka===ka,q=y?null:b(l.css("top")),Ta=b(l.css("borderLeftWidth"))+b(l.css("borderRightWidth")),
A=jQuery("<div class='ps-scrollbar-y-rail'>").appendTo(k),H=jQuery("<div class='ps-scrollbar-y'>").appendTo(A),L,F,J,X=b(A.css("right")),ma=X===X,D=ma?null:b(A.css("left")),R=b(A.css("borderTopWidth"))+b(A.css("borderBottomWidth")),Y="ontouchstart"in window||window.DocumentTouch&&document instanceof window.DocumentTouch,x=null!==window.navigator.msMaxTouchPoints;t();(function(){k.bind(f("scroll"),function(a){t()})})();(function(){var a,c,d=!1;g.bind(f("mousedown"),function(b){c=b.pageX;a=g.position().left;
l.addClass("in-scrolling");d=!0;b.stopPropagation();b.preventDefault()});jQuery(m).bind(f("mousemove"),function(e){if(d){var f=a+(e.pageX-c),g=p-n;r=0>f?0:f>g?g:f;f=b(r*(I-p)/(p-n));k.scrollLeft(f);t();e.stopPropagation();e.preventDefault()}});jQuery(m).bind(f("mouseup"),function(a){d&&(d=!1,l.removeClass("in-scrolling"))});a=c=null})();(function(){var a,c,d=!1;H.bind(f("mousedown"),function(b){c=b.pageY;a=H.position().top;d=!0;A.addClass("in-scrolling");b.stopPropagation();b.preventDefault()});jQuery(m).bind(f("mousemove"),
function(e){if(d){var f=a+(e.pageY-c),g=E-F;J=0>f?0:f>g?g:f;f=b(J*(M-E)/(E-F));k.scrollTop(f);t();e.stopPropagation();e.preventDefault()}});jQuery(m).bind(f("mouseup"),function(a){d&&(d=!1,A.removeClass("in-scrolling"))});a=c=null})();(function(){function a(b){b.stopPropagation()}H.bind(f("click"),a);A.bind(f("click"),function(a){var c=b(F/2);a=(a.pageY-A.offset().top-c)/(E-F);0>a?a=0:1<a&&(a=1);k.scrollTop((M-E)*a)});g.bind(f("click"),a);l.bind(f("click"),function(a){var c=b(n/2);a=(a.pageX-l.offset().left-
c)/(p-n);0>a?a=0:1<a&&(a=1);k.scrollLeft((I-p)*a)})})();(function(){function a(){var b=window.getSelection?window.getSelection():document.getSlection?document.getSlection():{rangeCount:0};return 0===b.rangeCount?null:b.getRangeAt(0).commonAncestorContainer}function b(){d||(d=setInterval(function(){k.scrollTop(k.scrollTop()+e.top);k.scrollLeft(k.scrollLeft()+e.left);t()},50))}function c(){d&&(clearInterval(d),d=null);l.removeClass("in-scrolling");A.removeClass("in-scrolling")}var d=null,e={top:0,left:0},
g=!1;jQuery(m).bind(f("selectionchange"),function(b){jQuery.contains(k[0],a())?g=!0:(g=!1,c())});jQuery(window).bind(f("mouseup"),function(a){g&&(g=!1,c())});jQuery(window).bind(f("mousemove"),function(a){if(g){var d=a.pageX;a=a.pageY;var f=k.offset(),h=f.left,m=f.left+k.outerWidth(),n=f.top,f=f.top+k.outerHeight();d<h+3?(e.left=-5,l.addClass("in-scrolling")):d>m-3?(e.left=5,l.addClass("in-scrolling")):e.left=0;a<n+3?(e.top=5>n+3-a?-5:-20,A.addClass("in-scrolling")):a>f-3?(e.top=5>a-f+3?5:20,A.addClass("in-scrolling")):
e.top=0;0===e.top&&0===e.left?c():b()}})})();(function(){function a(c){var d,e=c.originalEvent.deltaX;d=-1*c.originalEvent.deltaY;if("undefined"===typeof e||"undefined"===typeof d)e=-1*c.originalEvent.wheelDeltaX/6,d=c.originalEvent.wheelDeltaY/6;c.originalEvent.deltaMode&&1===c.originalEvent.deltaMode&&(e*=10,d*=10);e!==e&&d!==d&&(e=0,d=c.originalEvent.wheelDelta);d=[e,d];e=d[0];d=d[1];b=!1;C.useBothWheelAxes?L&&!G?(d?k.scrollTop(k.scrollTop()-d*C.wheelSpeed):k.scrollTop(k.scrollTop()+e*C.wheelSpeed),
b=!0):G&&!L&&(e?k.scrollLeft(k.scrollLeft()+e*C.wheelSpeed):k.scrollLeft(k.scrollLeft()-d*C.wheelSpeed),b=!0):(k.scrollTop(k.scrollTop()-d*C.wheelSpeed),k.scrollLeft(k.scrollLeft()+e*C.wheelSpeed));t();if(b=v(e,d))c.stopPropagation(),c.preventDefault()}var b=!1;"undefined"!==typeof window.onwheel?k.bind(f("wheel"),a):"undefined"!==typeof window.onmousewheel&&k.bind(f("mousewheel"),a)})();(Y||x)&&W(Y,x);C.useKeyboard&&Q();k.data("perfect-scrollbar",k);k.data("perfect-scrollbar-update",t);k.data("perfect-scrollbar-destroy",
function(){k.unbind(f());jQuery(window).unbind(f());jQuery(m).unbind(f());k.data("perfect-scrollbar",null);k.data("perfect-scrollbar-update",null);k.data("perfect-scrollbar-destroy",null);g.remove();H.remove();l.remove();A.remove();l=A=g=H=G=L=p=E=I=M=n=r=ka=y=q=F=J=X=ma=D=P=f=null});return k})}});
(function(a,b,c){function d(a,c,d,e){for(var g=[],h=0;h<a.length;h++){var n=a[h];if(n){var k=tinycolor(n),p=.5>k.toHsl().l?"sp-thumb-el sp-thumb-dark":"sp-thumb-el sp-thumb-light",p=p+(tinycolor.equals(c,n)?" sp-thumb-active":""),n=k.toString(e.preferredFormat||"rgb"),s=E?"background-color:"+k.toRgbString():"filter:"+k.toFilter();g.push('<span title="'+n+'" data-color="'+k.toRgbString()+'" class="'+p+'"><span class="sp-thumb-inner" style="'+s+';" /></span>')}else g.push(b("<div />").append(b('<span data-color="" style="background-color:transparent;" class="sp-clear-display"></span>').attr("title",
e.noColorSelectedText)).html())}return"<div class='sp-cf "+d+"'>"+g.join("")+"</div>"}function e(a,c){var d=b.extend({},C,a);d.callbacks={move:v(d.move,c),change:v(d.change,c),show:v(d.show,c),hide:v(d.hide,c),beforeShow:v(d.beforeShow,c)};return d}function h(h,f){function m(){x.showPaletteOnly&&(x.showPalette=!0);Ha.text(x.showPaletteOnly?x.togglePaletteMoreText:x.togglePaletteLessText);if(x.palette){xa=x.palette.slice(0);sa=b.isArray(xa[0])?xa:[xa];ya={};for(var a=0;a<sa.length;a++)for(var c=0;c<
sa[a].length;c++){var d=tinycolor(sa[a][c]).toRgbString();ya[d]=!0}}B.toggleClass("sp-flat",Z);B.toggleClass("sp-input-disabled",!x.showInput);B.toggleClass("sp-alpha-enabled",x.showAlpha);B.toggleClass("sp-clear-enabled",la);B.toggleClass("sp-buttons-disabled",!x.showButtons);B.toggleClass("sp-palette-buttons-disabled",!x.togglePaletteOnly);B.toggleClass("sp-palette-disabled",!x.showPalette);B.toggleClass("sp-palette-only",x.showPaletteOnly);B.toggleClass("sp-initial-disabled",!x.showInitial);B.addClass(x.className).addClass(x.containerClassName);
R()}function l(){if(T&&a.localStorage){try{var c=a.localStorage[T].split(",#");1<c.length&&(delete a.localStorage[T],b.each(c,function(a,b){g(b)}))}catch(d){}try{ca=a.localStorage[T].split(";")}catch(e){}}}function g(c){if(Fa){c=tinycolor(c).toRgbString();if(!ya[c]&&-1===b.inArray(c,ca))for(ca.push(c);ca.length>Ua;)ca.shift();if(T&&a.localStorage)try{a.localStorage[T]=ca.join(";")}catch(d){}}}function u(){var a=[];if(x.showPalette)for(var b=0;b<ca.length;b++){var c=tinycolor(ca[b]).toRgbString();
ya[c]||a.push(ca[b])}return a.reverse().slice(0,x.maxSelectionSize)}function n(){var a=F(),c=b.map(sa,function(b,c){return d(b,a,"sp-palette-row sp-palette-row-"+c,x)});l();ca&&c.push(d(u(),a,"sp-palette-row sp-palette-row-selection",x));Oa.html(c.join(""))}function r(){if(x.showInitial){var a=ga,b=F();Pa.html(d([a,b],b,"sp-palette-row-initial",x))}}function v(){(0>=U||0>=w||0>=V)&&R();B.addClass("sp-dragging");ha=null;N.trigger("dragstart.spectrum",[F()])}function y(){B.removeClass("sp-dragging");
N.trigger("dragstop.spectrum",[F()])}function q(){var a=ia.val();null!==a&&""!==a||!la?(a=tinycolor(a),a.isValid()?(L(a),D(!0)):ia.addClass("sp-validation-error")):(L(null),D(!0))}function C(){da?H():A()}function A(){var c=b.Event("beforeShow.spectrum");if(da)R();else if(N.trigger(c,[F()]),!1!==O.beforeShow(F())&&!c.isDefaultPrevented()){for(c=0;c<k.length;c++)k[c]&&k[c].hide();da=!0;b(Ia).bind("click.spectrum",H);b(a).bind("resize.spectrum",S);na.addClass("sp-active");B.removeClass("sp-hidden");
R();X();ga=F();r();O.show(ga);N.trigger("show.spectrum",[ga])}}function H(c){c&&"click"==c.type&&2==c.button||!da||Z||(da=!1,b(Ia).unbind("click.spectrum",H),b(a).unbind("resize.spectrum",S),na.removeClass("sp-active"),B.addClass("sp-hidden"),tinycolor.equals(F(),ga)||(Va&&"cancel"!==c?D(!0):L(ga,!0)),O.hide(F()),N.trigger("hide.spectrum",[F()]))}function L(a,b){if(tinycolor.equals(a,F()))X();else{var c,d;!a&&la?ja=!0:(ja=!1,c=tinycolor(a),d=c.toHsv(),qa=d.h%360/360,ra=d.s,pa=d.v,aa=d.a);X();c&&c.isValid()&&
!b&&(ta=Ja||c.getFormat())}}function F(a){a=a||{};return la&&ja?null:tinycolor.fromRatio({h:qa,s:ra,v:pa,a:Math.round(100*aa)/100},{format:a.format||ta})}function J(){X();O.move(F());N.trigger("move.spectrum",[F()])}function X(){ia.removeClass("sp-validation-error");ma();var a=tinycolor.fromRatio({h:qa,s:1,v:1});za.css("background-color",a.toHexString());a=ta;!(1>aa)||0===aa&&"name"===a||"hex"!==a&&"hex3"!==a&&"hex6"!==a&&"name"!==a||(a="rgb");var b=F({format:a}),c="";oa.removeClass("sp-clear-display");
oa.css("background-color","transparent");if(!b&&la)oa.addClass("sp-clear-display");else{var c=b.toHexString(),d=b.toRgbString();E||1===b.alpha?oa.css("background-color",d):(oa.css("background-color","transparent"),oa.css("filter",b.toFilter()));if(x.showAlpha){d=b.toRgb();d.a=0;var d=tinycolor(d).toRgbString(),e="linear-gradient(left, "+d+", "+c+")";p?ua.css("filter",tinycolor(d).toFilter({gradientType:1},c)):(ua.css("background","-webkit-"+e),ua.css("background","-moz-"+e),ua.css("background","-ms-"+
e),ua.css("background","linear-gradient(to right, "+d+", "+c+")"))}c=b.toString(a)}x.showInput&&ia.val(c);x.showPalette&&n();r()}function ma(){var a=ra,b=pa;la&&ja?(Aa.hide(),Ba.hide(),Ca.hide()):(Aa.show(),Ba.show(),Ca.show(),a*=w,b=U-b*U,a=Math.max(-ea,Math.min(w-ea,a-ea)),b=Math.max(-ea,Math.min(U-ea,b-ea)),Ca.css({top:b+"px",left:a+"px"}),Aa.css({left:aa*Ga-ba/2+"px"}),Ba.css({top:qa*V-fa+"px"}))}function D(a){var b=F(),c="",d=!tinycolor.equals(b,ga);b&&(c=b.toString(ta),g(b));Da&&N.val(c);ga=
b;a&&d&&(O.change(b),N.trigger("change",[b]))}function R(){w=za.width();U=za.height();ea=Ca.height();Ka.width();V=Ka.height();fa=Ba.height();Ga=Qa.width();ba=Aa.width();Z||(B.css("position","absolute"),B.offset(s(B,va)));ma();x.showPalette&&n();N.trigger("reflow.spectrum")}function Y(){H();La=!0;N.attr("disabled",!0);va.addClass("sp-disabled")}var x=e(f,h),Z=x.flat,Fa=x.showSelectionPalette,T=x.localStorageKey,z=x.theme,O=x.callbacks,S=W(R,10),da=!1,w=0,U=0,ea=0,V=0,Ga=0,ba=0,fa=0,qa=0,ra=0,pa=0,
aa=1,xa=[],sa=[],ya={},ca=x.selectionPalette.slice(0),Ua=x.maxSelectionSize,ha=null,Ia=h.ownerDocument,N=b(h),La=!1,B=b(M,Ia).addClass(z),Wa=B.find(".sp-picker-container"),za=B.find(".sp-color"),Ca=B.find(".sp-dragger"),Ka=B.find(".sp-hue"),Ba=B.find(".sp-slider"),ua=B.find(".sp-alpha-inner"),Qa=B.find(".sp-alpha"),Aa=B.find(".sp-alpha-handle"),ia=B.find(".sp-input"),Oa=B.find(".sp-palette"),Pa=B.find(".sp-initial"),Ra=B.find(".sp-cancel"),Ma=B.find(".sp-clear"),Sa=B.find(".sp-choose"),Ha=B.find(".sp-palette-toggle"),
Da=N.is("input"),Xa=Da&&I&&"color"===N.attr("type"),Na=Da&&!Z,na=Na?b("<div class='sp-replacer'><div class='sp-preview'><div class='sp-preview-inner'></div></div><div class='sp-dd'>&#9660;</div></div>").addClass(z).addClass(x.className).addClass(x.replacerClassName):b([]),va=Na?na:N,oa=na.find(".sp-preview-inner"),wa=x.color||Da&&N.val(),ga=!1,Ja=x.preferredFormat,ta=Ja,Va=!x.showButtons||x.clickoutFiresChange,ja=!wa,la=x.allowEmpty&&!Xa;(function(){function a(c){c.data&&c.data.ignore?(L(b(c.target).closest(".sp-thumb-el").data("color")),
J()):(L(b(c.target).closest(".sp-thumb-el").data("color")),J(),D(!0),x.hideAfterPaletteSelect&&H());return!1}p&&B.find("*:not(input)").attr("unselectable","on");m();Na&&N.after(na).hide();la||Ma.hide();if(Z)N.after(B).hide();else{var c="parent"===x.appendTo?N.parent():b(x.appendTo);1!==c.length&&(c=b("body"));c.append(B)}l();va.bind("click.spectrum touchstart.spectrum",function(a){La||C();a.stopPropagation();b(a.target).is("input")||a.preventDefault()});(N.is(":disabled")||!0===x.disabled)&&Y();B.click(t);
ia.change(q);ia.bind("paste",function(){setTimeout(q,1)});ia.keydown(function(a){13==a.keyCode&&q()});Ra.text(x.cancelText);Ra.bind("click.spectrum",function(a){a.stopPropagation();a.preventDefault();H("cancel")});Ma.attr("title",x.clearText);Ma.bind("click.spectrum",function(a){a.stopPropagation();a.preventDefault();ja=!0;J();Z&&D(!0)});Sa.text(x.chooseText);Sa.bind("click.spectrum",function(a){a.stopPropagation();a.preventDefault();ia.hasClass("sp-validation-error")||(D(!0),H())});Ha.text(x.showPaletteOnly?
x.togglePaletteMoreText:x.togglePaletteLessText);Ha.bind("click.spectrum",function(a){a.stopPropagation();a.preventDefault();x.showPaletteOnly=!x.showPaletteOnly;x.showPaletteOnly||Z||B.css("left","-="+(Wa.outerWidth(!0)+5));m()});Q(Qa,function(a,b,c){aa=a/Ga;ja=!1;c.shiftKey&&(aa=Math.round(10*aa)/10);J()},v,y);Q(Ka,function(a,b){qa=parseFloat(b/V);ja=!1;x.showAlpha||(aa=1);J()},v,y);Q(za,function(a,b,c){c.shiftKey?ha||(c=U-pa*U,ha=Math.abs(a-ra*w)>Math.abs(b-c)?"x":"y"):ha=null;c=!ha||"y"===ha;
ha&&"x"!==ha||(ra=parseFloat(a/w));c&&(pa=parseFloat((U-b)/U));ja=!1;x.showAlpha||(aa=1);J()},v,y);wa?(L(wa),X(),ta=Ja||tinycolor(wa).format,g(wa)):X();Z&&A();c=p?"mousedown.spectrum":"click.spectrum touchstart.spectrum";Oa.delegate(".sp-thumb-el",c,a);Pa.delegate(".sp-thumb-el:nth-child(1)",c,{ignore:!0},a)})();var Ea={show:A,hide:H,toggle:C,reflow:R,option:function(a,d){if(a===c)return b.extend({},x);if(d===c)return x[a];x[a]=d;m()},enable:function(){La=!1;N.attr("disabled",!1);va.removeClass("sp-disabled")},
disable:Y,set:function(a){L(a);D()},get:F,destroy:function(){N.show();va.unbind("click.spectrum touchstart.spectrum");B.remove();na.remove();k[Ea.id]=null},container:B};Ea.id=k.push(Ea)-1;return Ea}function s(a,c){var d=a.outerWidth(),e=a.outerHeight(),g=c.outerHeight(),h=a[0].ownerDocument,n=h.documentElement,k=n.clientWidth+b(h).scrollLeft(),h=n.clientHeight+b(h).scrollTop(),n=c.offset();n.top+=g;n.left-=Math.min(n.left,n.left+d>k&&k>d?Math.abs(n.left+d-k):0);n.top-=Math.min(n.top,n.top+e>h&&h>
e?Math.abs(e+g-0):0);return n}function u(){}function t(a){a.stopPropagation()}function v(a,b){var c=Array.prototype.slice,d=c.call(arguments,2);return function(){return a.apply(b,d.concat(c.call(arguments)))}}function Q(c,d,e,h){function g(a){a.stopPropagation&&a.stopPropagation();a.preventDefault&&a.preventDefault();a.returnValue=!1}function k(a){if(s){if(p&&9>r.documentMode&&!a.button)return n();var b=a.originalEvent.touches,e=b?b[0].pageY:a.pageY,b=Math.max(0,Math.min((b?b[0].pageX:a.pageX)-u.left,
v)),e=Math.max(0,Math.min(e-u.top,q));t&&g(a);d.apply(c,[b,e,a])}}function n(){s&&(b(r).unbind(E),b(r.body).removeClass("sp-dragging"),h.apply(c,arguments));s=!1}d=d||function(){};e=e||function(){};h=h||function(){};var r=document,s=!1,u={},q=0,v=0,t="ontouchstart"in a,E={};E.selectstart=g;E.dragstart=g;E["touchmove mousemove"]=k;E["touchend mouseup"]=n;b(c).bind("touchstart mousedown",function(a){(a.which?3==a.which:2==a.button)||s||!1===e.apply(c,arguments)||(s=!0,q=b(c).height(),v=b(c).width(),
u=b(c).offset(),b(r).bind(E),b(r.body).addClass("sp-dragging"),t||k(a),g(a))})}function W(a,b,c){var d;return function(){var e=this,h=arguments,k=function(){d=null;a.apply(e,h)};c&&clearTimeout(d);if(c||!d)d=setTimeout(k,b)}}var C={beforeShow:u,move:u,change:u,show:u,hide:u,color:!1,flat:!1,showInput:!1,allowEmpty:!1,showButtons:!0,clickoutFiresChange:!1,showInitial:!1,showPalette:!1,showPaletteOnly:!1,hideAfterPaletteSelect:!1,togglePaletteOnly:!1,showSelectionPalette:!0,localStorageKey:!1,appendTo:"body",
maxSelectionSize:7,cancelText:"cancel",chooseText:"choose",togglePaletteMoreText:"more",togglePaletteLessText:"less",clearText:"Clear Color Selection",noColorSelectedText:"No Color Selected",preferredFormat:!1,className:"",containerClassName:"",replacerClassName:"",showAlpha:!1,theme:"sp-light",palette:["#ffffff #000000 #ff0000 #ff8000 #ffff00 #008000 #0000ff #4b0082 #9400d3".split(" ")],selectionPalette:[],disabled:!1},k=[],p=!!/msie/i.exec(a.navigator.userAgent),E=function(){var a=document.createElement("div").style;
a.cssText="background-color:rgba(0,0,0,.5)";return!!~(""+a.backgroundColor).indexOf("rgba")||!!~(""+a.backgroundColor).indexOf("hsla")}(),I=function(){var a=b("<input type='color' value='!' />")[0];return"color"===a.type&&"!"!==a.value}(),M=function(){var a="";if(p)for(var b=1;6>=b;b++)a+="<div class='sp-"+b+"'></div>";return["<div class='sp-container sp-hidden'><div class='sp-palette-container'><div class='sp-palette sp-thumb sp-cf'></div><div class='sp-palette-button-container sp-cf'><button type='button' class='sp-palette-toggle'></button></div></div><div class='sp-picker-container'><div class='sp-top sp-cf'><div class='sp-fill'></div><div class='sp-top-inner'><div class='sp-color'><div class='sp-sat'><div class='sp-val'><div class='sp-dragger'></div></div></div></div><div class='sp-clear sp-clear-display'></div><div class='sp-hue'><div class='sp-slider'></div>",
a,"</div></div><div class='sp-alpha'><div class='sp-alpha-inner'><div class='sp-alpha-handle'></div></div></div></div><div class='sp-input-container sp-cf'><input class='sp-input' type='text' spellcheck='false'  /></div><div class='sp-initial sp-thumb sp-cf'></div><div class='sp-button-container sp-cf'><a class='sp-cancel' href='#'></a><button type='button' class='sp-choose'></button></div></div></div>"].join("")}();b.fn.spectrum=function(a,c){if("string"==typeof a){var d=this,e=Array.prototype.slice.call(arguments,
1);this.each(function(){var c=k[b(this).data("spectrum.id")];if(c){var f=c[a];if(!f)throw Error("Spectrum: no such method: '"+a+"'");"get"==a?d=c.get():"container"==a?d=c.container:"option"==a?d=c.option.apply(c,e):"destroy"==a?(c.destroy(),b(this).removeData("spectrum.id")):f.apply(c,e)}});return d}return this.spectrum("destroy").each(function(){var c=b.extend({},a,b(this).data()),c=h(this,c);b(this).data("spectrum.id",c.id)})};b.fn.spectrum.load=!0;b.fn.spectrum.loadOpts={};b.fn.spectrum.draggable=
Q;b.fn.spectrum.defaults=C;b.spectrum={};b.spectrum.localization={};b.spectrum.palettes={};b.fn.spectrum.processNativeColorInputs=function(){I||b("input[type=color]").spectrum({preferredFormat:"hex6"})};(function(){function b(a,c,d){a=D(a,255);c=D(c,255);d=D(d,255);var e=S(a,c,d),f=O(a,c,d),h,g=(e+f)/2;if(e==f)h=f=0;else{var k=e-f,f=.5<g?k/(2-e-f):k/(e+f);switch(e){case a:h=(c-d)/k+(c<d?6:0);break;case c:h=(d-a)/k+2;break;case d:h=(a-c)/k+4}h/=6}return{h:h,s:f,l:g}}function c(a,b,d){function e(a,
b,c){0>c&&(c+=1);1<c&&(c-=1);return c<1/6?a+6*(b-a)*c:.5>c?b:c<2/3?a+(b-a)*(2/3-c)*6:a}a=D(a,360);b=D(b,100);d=D(d,100);if(0===b)d=b=a=d;else{var f=.5>d?d*(1+b):d+b-d*b,h=2*d-f;d=e(h,f,a+1/3);b=e(h,f,a);a=e(h,f,a-1/3)}return{r:255*d,g:255*b,b:255*a}}function d(a,b,c){a=D(a,255);b=D(b,255);c=D(c,255);var e=S(a,b,c),f=O(a,b,c),h,g=e-f;if(e==f)h=0;else{switch(e){case a:h=(b-c)/g+(b<c?6:0);break;case b:h=(c-a)/g+2;break;case c:h=(a-b)/g+4}h/=6}return{h:h,s:0===e?0:g/e,v:e}}function e(a,b,c,d){a=[R(z(a).toString(16)),
R(z(b).toString(16)),R(z(c).toString(16))];return d&&a[0].charAt(0)==a[0].charAt(1)&&a[1].charAt(0)==a[1].charAt(1)&&a[2].charAt(0)==a[2].charAt(1)?a[0].charAt(0)+a[1].charAt(0)+a[2].charAt(0):a.join("")}function h(a,b,c,d){return[R(Math.round(255*parseFloat(d)).toString(16)),R(z(a).toString(16)),R(z(b).toString(16)),R(z(c).toString(16))].join("")}function k(a,b){b=0===b?0:b||10;var c=w(a).toHsl();c.s-=b/100;c.s=O(1,S(0,c.s));return w(c)}function n(a,b){b=0===b?0:b||10;var c=w(a).toHsl();c.s+=b/100;
c.s=O(1,S(0,c.s));return w(c)}function p(a){return w(a).desaturate(100)}function s(a,b){b=0===b?0:b||10;var c=w(a).toHsl();c.l+=b/100;c.l=O(1,S(0,c.l));return w(c)}function u(a,b){b=0===b?0:b||10;var c=w(a).toRgb();c.r=S(0,O(255,c.r-z(255*-(b/100))));c.g=S(0,O(255,c.g-z(255*-(b/100))));c.b=S(0,O(255,c.b-z(255*-(b/100))));return w(c)}function q(a,b){b=0===b?0:b||10;var c=w(a).toHsl();c.l-=b/100;c.l=O(1,S(0,c.l));return w(c)}function v(a,b){var c=w(a).toHsl(),d=(z(c.h)+b)%360;c.h=0>d?360+d:d;return w(c)}
function t(a){a=w(a).toHsl();a.h=(a.h+180)%360;return w(a)}function E(a){var b=w(a).toHsl(),c=b.h;return[w(a),w({h:(c+120)%360,s:b.s,l:b.l}),w({h:(c+240)%360,s:b.s,l:b.l})]}function Q(a){var b=w(a).toHsl(),c=b.h;return[w(a),w({h:(c+90)%360,s:b.s,l:b.l}),w({h:(c+180)%360,s:b.s,l:b.l}),w({h:(c+270)%360,s:b.s,l:b.l})]}function W(a){var b=w(a).toHsl(),c=b.h;return[w(a),w({h:(c+72)%360,s:b.s,l:b.l}),w({h:(c+216)%360,s:b.s,l:b.l})]}function C(a,b,c){b=b||6;c=c||30;var d=w(a).toHsl();c=360/c;a=[w(a)];for(d.h=
(d.h-(c*b>>1)+720)%360;--b;)d.h=(d.h+c)%360,a.push(w(d));return a}function I(a,b){b=b||6;for(var c=w(a).toHsv(),d=c.h,e=c.s,c=c.v,f=[],h=1/b;b--;)f.push(w({h:d,s:e,v:c})),c=(c+h)%1;return f}function M(a){a=parseFloat(a);if(isNaN(a)||0>a||1<a)a=1;return a}function D(a,b){var c=a;"string"==typeof c&&-1!=c.indexOf(".")&&1===parseFloat(c)&&(a="100%");c="string"===typeof a&&-1!=a.indexOf("%");a=O(b,S(0,parseFloat(a)));c&&(a=parseInt(a*b,10)/100);return 1E-6>T.abs(a-b)?1:a%b/parseFloat(b)}function R(a){return 1==
a.length?"0"+a:""+a}function Y(a){1>=a&&(a=100*a+"%");return a}var x=/^[\s,#]+/,Z=/\s+$/,Fa=0,T=Math,z=T.round,O=T.min,S=T.max,da=T.random,w=function ba(a,b){var d,e,h,g,k;a=a?a:"";b=b||{};if(a instanceof ba)return a;if(!(this instanceof ba))return new ba(a,b);e=a;k={r:0,g:0,b:0};var m=1;h=d=!1;if("string"==typeof e)a:{e=e.replace(x,"").replace(Z,"").toLowerCase();var l=!1;if(U[e])e=U[e],l=!0;else if("transparent"==e){e={r:0,g:0,b:0,a:0,format:"name"};break a}e=(g=V.rgb.exec(e))?{r:g[1],g:g[2],b:g[3]}:
(g=V.rgba.exec(e))?{r:g[1],g:g[2],b:g[3],a:g[4]}:(g=V.hsl.exec(e))?{h:g[1],s:g[2],l:g[3]}:(g=V.hsla.exec(e))?{h:g[1],s:g[2],l:g[3],a:g[4]}:(g=V.hsv.exec(e))?{h:g[1],s:g[2],v:g[3]}:(g=V.hex8.exec(e))?{a:parseInt(g[1],16)/255,r:parseInt(g[2],16),g:parseInt(g[3],16),b:parseInt(g[4],16),format:l?"name":"hex8"}:(g=V.hex6.exec(e))?{r:parseInt(g[1],16),g:parseInt(g[2],16),b:parseInt(g[3],16),format:l?"name":"hex"}:(g=V.hex3.exec(e))?{r:parseInt(g[1]+""+g[1],16),g:parseInt(g[2]+""+g[2],16),b:parseInt(g[3]+
""+g[3],16),format:l?"name":"hex"}:!1}if("object"==typeof e){if(e.hasOwnProperty("r")&&e.hasOwnProperty("g")&&e.hasOwnProperty("b"))k=e.g,d=e.b,k={r:255*D(e.r,255),g:255*D(k,255),b:255*D(d,255)},d=!0,h="%"===String(e.r).substr(-1)?"prgb":"rgb";else if(e.hasOwnProperty("h")&&e.hasOwnProperty("s")&&e.hasOwnProperty("v")){e.s=Y(e.s);e.v=Y(e.v);h=e.h;l=e.s;k=e.v;h=6*D(h,360);l=D(l,100);k=D(k,100);d=T.floor(h);var n=h-d;h=k*(1-l);g=k*(1-n*l);l=k*(1-(1-n)*l);d%=6;k={r:255*[k,g,h,h,l,k][d],g:255*[l,k,k,
g,h,h][d],b:255*[h,h,l,k,k,g][d]};d=!0;h="hsv"}else e.hasOwnProperty("h")&&e.hasOwnProperty("s")&&e.hasOwnProperty("l")&&(e.s=Y(e.s),e.l=Y(e.l),k=c(e.h,e.s,e.l),d=!0,h="hsl");e.hasOwnProperty("a")&&(m=e.a)}m=M(m);e=e.format||h;h=O(255,S(k.r,0));g=O(255,S(k.g,0));k=O(255,S(k.b,0));this._r=h;this._g=g;this._b=k;this._a=m;this._roundA=z(100*this._a)/100;this._format=b.format||e;this._gradientType=b.gradientType;1>this._r&&(this._r=z(this._r));1>this._g&&(this._g=z(this._g));1>this._b&&(this._b=z(this._b));
this._ok=d;this._tc_id=Fa++};w.prototype={isDark:function(){return 128>this.getBrightness()},isLight:function(){return!this.isDark()},isValid:function(){return this._ok},getFormat:function(){return this._format},getAlpha:function(){return this._a},getBrightness:function(){var a=this.toRgb();return(299*a.r+587*a.g+114*a.b)/1E3},setAlpha:function(a){this._a=M(a);this._roundA=z(100*this._a)/100;return this},toHsv:function(){var a=d(this._r,this._g,this._b);return{h:360*a.h,s:a.s,v:a.v,a:this._a}},toHsvString:function(){var a=
d(this._r,this._g,this._b),b=z(360*a.h),c=z(100*a.s),a=z(100*a.v);return 1==this._a?"hsv("+b+", "+c+"%, "+a+"%)":"hsva("+b+", "+c+"%, "+a+"%, "+this._roundA+")"},toHsl:function(){var a=b(this._r,this._g,this._b);return{h:360*a.h,s:a.s,l:a.l,a:this._a}},toHslString:function(){var a=b(this._r,this._g,this._b),c=z(360*a.h),d=z(100*a.s),a=z(100*a.l);return 1==this._a?"hsl("+c+", "+d+"%, "+a+"%)":"hsla("+c+", "+d+"%, "+a+"%, "+this._roundA+")"},toHex:function(a){return e(this._r,this._g,this._b,a)},toHexString:function(a){return"#"+
this.toHex(a)},toHex8:function(){return h(this._r,this._g,this._b,this._a)},toHex8String:function(){return"#"+this.toHex8()},toRgb:function(){return{r:z(this._r),g:z(this._g),b:z(this._b),a:this._a}},toRgbString:function(){return 1==this._a?"rgb("+z(this._r)+", "+z(this._g)+", "+z(this._b)+")":"rgba("+z(this._r)+", "+z(this._g)+", "+z(this._b)+", "+this._roundA+")"},toPercentageRgb:function(){return{r:z(100*D(this._r,255))+"%",g:z(100*D(this._g,255))+"%",b:z(100*D(this._b,255))+"%",a:this._a}},toPercentageRgbString:function(){return 1==
this._a?"rgb("+z(100*D(this._r,255))+"%, "+z(100*D(this._g,255))+"%, "+z(100*D(this._b,255))+"%)":"rgba("+z(100*D(this._r,255))+"%, "+z(100*D(this._g,255))+"%, "+z(100*D(this._b,255))+"%, "+this._roundA+")"},toName:function(){return 0===this._a?"transparent":1>this._a?!1:ea[e(this._r,this._g,this._b,!0)]||!1},toFilter:function(a){var b="#"+h(this._r,this._g,this._b,this._a),c=b,d=this._gradientType?"GradientType = 1, ":"";a&&(c=w(a).toHex8String());return"progid:DXImageTransform.Microsoft.gradient("+
d+"startColorstr="+b+",endColorstr="+c+")"},toString:function(a){var b=!!a;a=a||this._format;var c=!1,d=1>this._a&&0<=this._a;if(!b&&d&&("hex"===a||"hex6"===a||"hex3"===a||"name"===a))return"name"===a&&0===this._a?this.toName():this.toRgbString();"rgb"===a&&(c=this.toRgbString());"prgb"===a&&(c=this.toPercentageRgbString());if("hex"===a||"hex6"===a)c=this.toHexString();"hex3"===a&&(c=this.toHexString(!0));"hex8"===a&&(c=this.toHex8String());"name"===a&&(c=this.toName());"hsl"===a&&(c=this.toHslString());
"hsv"===a&&(c=this.toHsvString());return c||this.toHexString()},_applyModification:function(a,b){var c=a.apply(null,[this].concat([].slice.call(b)));this._r=c._r;this._g=c._g;this._b=c._b;this.setAlpha(c._a);return this},lighten:function(){return this._applyModification(s,arguments)},brighten:function(){return this._applyModification(u,arguments)},darken:function(){return this._applyModification(q,arguments)},desaturate:function(){return this._applyModification(k,arguments)},saturate:function(){return this._applyModification(n,
arguments)},greyscale:function(){return this._applyModification(p,arguments)},spin:function(){return this._applyModification(v,arguments)},_applyCombination:function(a,b){return a.apply(null,[this].concat([].slice.call(b)))},analogous:function(){return this._applyCombination(C,arguments)},complement:function(){return this._applyCombination(t,arguments)},monochromatic:function(){return this._applyCombination(I,arguments)},splitcomplement:function(){return this._applyCombination(W,arguments)},triad:function(){return this._applyCombination(E,
arguments)},tetrad:function(){return this._applyCombination(Q,arguments)}};w.fromRatio=function(a,b){if("object"==typeof a){var c={},d;for(d in a)a.hasOwnProperty(d)&&(c[d]="a"===d?a[d]:Y(a[d]));a=c}return w(a,b)};w.equals=function(a,b){return a&&b?w(a).toRgbString()==w(b).toRgbString():!1};w.random=function(){return w.fromRatio({r:da(),g:da(),b:da()})};w.mix=function(a,b,c){c=0===c?0:c||50;a=w(a).toRgb();b=w(b).toRgb();c/=100;var d=2*c-1,e=b.a-a.a,d=((-1==d*e?d:(d+e)/(1+d*e))+1)/2,e=1-d;return w({r:b.r*
d+a.r*e,g:b.g*d+a.g*e,b:b.b*d+a.b*e,a:b.a*c+a.a*(1-c)})};w.readability=function(a,b){var c=w(a),d=w(b),e=c.toRgb(),f=d.toRgb(),c=c.getBrightness(),d=d.getBrightness(),e=Math.max(e.r,f.r)-Math.min(e.r,f.r)+Math.max(e.g,f.g)-Math.min(e.g,f.g)+Math.max(e.b,f.b)-Math.min(e.b,f.b);return{brightness:Math.abs(c-d),color:e}};w.isReadable=function(a,b){var c=w.readability(a,b);return 125<c.brightness&&500<c.color};w.mostReadable=function(a,b){for(var c=null,d=0,e=!1,f=0;f<b.length;f++){var g=w.readability(a,
b[f]),h=125<g.brightness&&500<g.color,g=g.brightness/125*3+g.color/500;if(h&&!e||h&&e&&g>d||!h&&!e&&g>d)e=h,d=g,c=w(b[f])}return c};var U=w.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",
crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",
firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",
lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",
mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",
seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},ea=w.hexNames=function(a){var b={},c;for(c in a)a.hasOwnProperty(c)&&(b[a[c]]=c);return b}(U),V={rgb:/rgb[\s|\(]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))[,|\s]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))[,|\s]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))\s*\)?/,
rgba:/rgba[\s|\(]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))[,|\s]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))[,|\s]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))[,|\s]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))\s*\)?/,hsl:/hsl[\s|\(]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))[,|\s]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))[,|\s]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))\s*\)?/,hsla:/hsla[\s|\(]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))[,|\s]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))[,|\s]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))[,|\s]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))\s*\)?/,
hsv:/hsv[\s|\(]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))[,|\s]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))[,|\s]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))\s*\)?/,hex3:/^([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex8:/^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/};a.tinycolor=w})();b(function(){b.fn.spectrum.load&&b.fn.spectrum.processNativeColorInputs()})})(window,jQuery);
var SNSComponent=function(){this.type="component";this.id;this.selector;this._jQueryDom;this.containerSelector;this._containerDom;this.triggerSelector;this._triggerDom;this.hideFloat=SNSComponent.HIDE_TYPE.IGNORE;this.transparentPanelSelector="#snsim_coverlayer";this.dragging=!1;this.useDefaultPosition=!0;this.maskLayerSelector="#snsim_coverlayer";this.maskOthers=!1;this.oldZIndex=0;this.newZIndex=parseInt(jQuery(this.maskLayerSelector).css("z-index"))+1};SNSComponent.HIDE_TYPE={HIDE:0,IGNORE:1,HIDE_IGNORE_SELF:2};
SNSComponent.prototype._init=function(){this.hideFloat==SNSComponent.HIDE_TYPE.HIDE?SNSApplication.getInstance().getGlobalEventManager().registerEventHandler(SNS_EVENT_SUBJECT.HIDE_FLOAT,!0,function(a,b){if(this.visible()){var c=jQuery(b.event.target);c===this.getTriggerDom()||c[0]===this.getTriggerDom()[0]||0<this.getTriggerDom().find(c).length||this.hide()}},this):this.hideFloat==SNSComponent.HIDE_TYPE.HIDE_IGNORE_SELF&&SNSApplication.getInstance().getGlobalEventManager().registerEventHandler(SNS_EVENT_SUBJECT.HIDE_FLOAT,
!0,function(a,b){if(this.visible()){var c=jQuery(b.event.target);c===this.getTriggerDom()||c[0]===this.getTriggerDom()[0]||0<this.getTriggerDom().find(c).length||0<this.getDom().find(c).length||this.hide()}},this);this.mask&&(this.oldZIndex=parseInt(this.getDom().css("z-index")),this.getDom().css("z-index",++this.newZIndex))};SNSComponent.prototype.getDom=function(){this._jQueryDom&&0!=this._jQueryDom.length||(this._jQueryDom=jQuery(this.selector));return this._jQueryDom};
SNSComponent.prototype.getContainerDom=function(){this._containerDom&&0!=this._containerDom.length||(this._containerDom=jQuery(this.containerSelector));return this._containerDom};SNSComponent.prototype.getTriggerDom=function(){this._triggerDom&&0!=this._triggerDom.length||(this._triggerDom=jQuery(this.triggerSelector));return this._triggerDom};SNSComponent.prototype.toggle=function(){this.visible()?this.hide():this.show()};SNSComponent.prototype.visible=function(){if(this.getDom().is(":visible"))return!0};
SNSComponent.prototype.beforeShow=function(){};SNSComponent.prototype.show=function(){if(this.maskOthers||this.mask)this.getDom().css("z-index",++this.newZIndex),jQuery(this.maskLayerSelector).show();if(!this.visible()){var a=this.getDom();this.beforeShow();a.show("fast");this.afterShow()}};SNSComponent.prototype.afterShow=function(){};SNSComponent.prototype.hide=function(){var a=this.getDom();!0===this.maskOthers&&(a.css("z-index",this.oldZIndex),jQuery(this.maskLayerSelector).hide());a.hide("fast")};
SNSComponent.prototype.remove=function(){this.getDom().remove()};SNSComponent.prototype.enableMove=function(){if(YYIMCommonUtil.isStringAndNotEmpty(this.getDragComponentSelector())&&YYIMCommonUtil.isStringAndNotEmpty(this.getMoveComponentSelector())){var a=this;jQuery(this.getDragComponentSelector()).bind("mouseenter",function(){SNSComponent.prototype.move.call(a,this)})}};SNSComponent.prototype.getDragComponentSelector=function(){};SNSComponent.prototype.getMoveComponentSelector=function(){};
SNSComponent.prototype.validateMovability=function(){return!1};
SNSComponent.prototype.move=function(a){var b=this,c,d;a.onmousedown=function(a){b.validateMovability(a)&&(jQuery(b.transparentPanelSelector).show(),!1===!!a&&(a=window.event),a.preventDefault?a.preventDefault():a.returnValue=!1,b.dragging=!0,c=a.clientX,d=a.clientY,document.onmousemove=function(a){b.useDefaultPosition=!1;!1===!!a&&(a=window.event);var e=a.clientX-c,u=a.clientY-d;if(b.dragging){var t=jQuery(b.getMoveComponentSelector());0>=t.offset().left&&0>e||jQuery(window).width()-t.width()<=t.offset().left&&
0<e?e=0:c=a.clientX;0>=t.offset().top&&0>u||jQuery(window).height()-t.height()<=t.offset().top&&0<u?u=0:d=a.clientY;a=Math.max(t.offset().top+u,0);e=Math.max(t.offset().left+e,0);t.css("left",e);t.css("top",a);window.location&&window.localStorage.setItem(YYIMChat.getUserNode()+"_position",JSON.stringify([e,a]))}else jQuery(b.transparentPanelSelector).hide()})};document.onmouseup=function(){var a=jQuery(b.getMoveComponentSelector()),c=a.offset().left,d=a.offset().top;0>a.offset().left?c=0:jQuery(window).width()-
a.width()<a.offset().left&&(c=jQuery(window).width()-a.width());0>a.offset().top?d=0:jQuery(window).height()-a.height()<a.offset().top&&(d=jQuery(window).height()-a.height());a.css("left",c);a.css("top",d);window.location&&window.localStorage.setItem(YYIMChat.getUserNode()+"_position",JSON.stringify([c,d]));b.dragging=!1;jQuery(b.transparentPanelSelector).hide()}};SNSComponent.prototype.shadeShow=function(){jQuery(this.transparentPanelSelector).show()};SNSComponent.prototype.shadeHide=function(){jQuery(this.transparentPanelSelector).hide()};
var SNSTab=function(){this.index;this.name=Math.uuid();this.type="tab";this.closeable=!1};SNSTab.prototype=new SNSComponent;SNSTab.prototype._init=function(){};SNSTab.prototype.visible=function(){return this.isContentVisible()};SNSTab.prototype.isHeadVisible=function(){if(this.getHeadDom().is(":visible"))return!0};SNSTab.prototype.isContentVisible=function(){if(this.getContentDom().is(":visible"))return!0};
SNSTab.prototype.getHeadDom=function(){this._headDom&&0!=this._headDom.length||(this._headDom=jQuery(this.headSelector));return this._headDom};SNSTab.prototype.getContentDom=function(){this._contentDom&&0!=this._contentDom.length||(this._contentDom=jQuery(this.contentSelector));return this._contentDom};SNSTab.prototype.getHeadHtml=function(){return TemplateUtil.genHtml(this.getHeadTemplate(),this)};SNSTab.prototype.getContentHtml=function(){return TemplateUtil.genHtml(this.getContentTemplate(),this)};
SNSTab.prototype.getHeadTemplate=function(){return this.headTemplate?this.headTemplate:SNSTab.headTemplate};SNSTab.prototype.getContentTemplate=function(){return this.contentTemplate?this.contentTemplate:SNSTab.contentTemplate};SNSTab.prototype.beforeSelect=function(){};SNSTab.prototype.select=function(){var a=this.getHeadDom();if(!a.hasClass("cur")){var b=this.getContentDom();this.beforeSelect();a.addClass("cur");b.addClass("cur");this.afterSelect()}};SNSTab.prototype.afterSelect=function(){};
SNSTab.prototype.beforeUnselect=function(){};SNSTab.prototype.unselect=function(){var a=this.getHeadDom();if(a.hasClass("cur")){var b=this.getContentDom();this.beforeUnselect();a.removeClass("cur");b.removeClass("cur")}};var SNSTabList=function(){};SNSTabList.prototype=new SNSBaseList;SNSTabList.prototype.add=function(a){a&&a instanceof SNSTab&&SNSBaseList.prototype.add.call(this,a.name,a)};
SNSTabList.prototype.get=function(a){if(a){if("string"==typeof a&&a.notEmpty())return SNSBaseList.prototype.get.call(this,a);if(a instanceof SNSTab)return SNSBaseList.prototype.get.call(this,a.name)}};SNSTabList.prototype.remove=function(a){if(a){if("string"==typeof a&&a.notEmpty())return SNSBaseList.prototype.remove.call(this,a);if(a instanceof SNSTab)return SNSBaseList.prototype.remove.call(this,a.name)}};SNSTabList.prototype.getCurrentTab=function(){return this.get(this.tabCurName)};
SNSTabList.prototype.changeCurrentTo=function(a){this.tabCurName=this.get(a).name};var SNSTabContainer=function(){this.selector;this.headContainerSelector;this.contentContainerSelector;this.tabs=new SNSTabList;this._headContainer;this._contentContainer};SNSTabContainer.prototype=new SNSComponent;SNSTabContainer.prototype._init=function(){YYIMChat.log("SNSTabContainer.prototype._init",3)};
SNSTabContainer.prototype.addTab=function(a){YYIMChat.log("addTab:",3,this.tabs,a);a.getHeadTemplate()&&this.getHeadContainer().append(a.getHeadHtml());a.getContentTemplate()&&this.getContentContainer().append(a.getContentHtml());this.tabs.add(a);a._init();this._bindDomEvent(a)};SNSTabContainer.prototype.getHeadContainer=function(){this._headContainer&&0!=this._headContainer.length||(this._headContainer=jQuery(this.headContainerSelector));return this._headContainer};
SNSTabContainer.prototype.getContentContainer=function(){this._contentContainer&&0!=this._contentContainer.length||(this._contentContainer=jQuery(this.contentContainerSelector));return this._contentContainer};SNSTabContainer.prototype._bindDomEvent=function(a){var b=this;a.getHeadDom().bind("click",function(){b.changeTabTo(a)})};SNSTabContainer.prototype.getTab=function(a){return this.tabs.get(a)};SNSTabContainer.prototype.size=function(){return this.tabs.size()};
SNSTabContainer.prototype.removeTab=function(a){var b=this.getCurrentTab();this.tabs.remove(a);if(b.name==a.name&&(this.tabs.tabCurName=null,0!=this.size()))return this.tabs.toArray()[0]};SNSTabContainer.prototype.onTabChange=function(a,b){};
SNSTabContainer.prototype.changeTabTo=function(a){var b=a.roster||a.chatroom;if(!b||b.id&&"undefined"!=b.id)if(this.setPicLocal(a),this.onTabChange(this.getCurrentTab(),a),this.getCurrentTab()!=this.tabs.get(a)){this.tabs.changeCurrentTo(a);for(var b=this.tabs.toArray(),c=0;c<b.length;c++)b[c]==a?b[c].select():b[c].unselect()}};
SNSTabContainer.prototype.setPicLocal=function(a){if(a)if("recent"==a.name||"chatroom"==a.name||"roster"==a.name){var b=YYIMChat.getUserNode()+"_curTab";window.localStorage&&window.localStorage.setItem(b,a.name)}else if(a.roster||a.chatroom)if(a=a.roster||a.chatroom,b=YYIMChat.getUserNode()+"_tablist",window.localStorage){var c=window.localStorage.getItem(b);try{c=JSON.parse(c)}catch(d){}c=c||[];jQuery("#snsim_chat_window_tab_head").find('li[id*="'+a.id+'"]').length?-1==c.indexOf(a.id)&&c.push(a.id):
(-1<c.indexOf(a.id)&&c.splice(c.indexOf(a.id),1),c.push(a.id));window.initLastChatList||window.localStorage.setItem(YYIMChat.getUserNode()+"_tabCurEntity",a.id);var e=window.localStorage.getItem(YYIMChat.getUserNode()+"_closeId");a.id==e&&window.localStorage.setItem(YYIMChat.getUserNode()+"_closeId","");window.localStorage.setItem(b,JSON.stringify(c));window.initLastChatList=!1}};SNSTabContainer.prototype.getCurrentTab=function(){return this.tabs.getCurrentTab()};
var SNSFloatPanel=function(a){this.uuid=Math.uuid();this.title=a;this.selector="#snsim_float_window_"+this.uuid;this.triggerSelector="";this.closeBtnSelector=".snsim_float_window_head_close_btn";this.headSelector=".snsim_float_window_head";this.footSelector=".snsim_float_window_foot";this.contentSelector=".snsim_float_window_content";this.hideFloat=SNSComponent.HIDE_TYPE.IGNORE};SNSFloatPanel.template='<div id="snsim_float_window_##{{uuid}}" class="snsim_float_window"><div class="snsim_float_window_head"><span class="snsim_float_window_head_title">##{{title}}</span><span class="snsim_float_window_head_close_btn"><a title="\u5173\u95ed"></a>  </span></div><div class="snsim_float_window_content"></div><div class="snsim_float_window_foot"></div></div>';
SNSFloatPanel.prototype=new SNSComponent;SNSFloatPanel.prototype._init=function(){SNSComponent.prototype._init.call(this)};SNSFloatPanel.prototype._bindDomEvent=function(){if(this.closeBtnSelector){var a=this.getDom().find(this.closeBtnSelector);if(0==a.length&&(a=jQuery(this.closeBtnSelector),!a))throw"invalid close button selector";a.bind("click",jQuery.proxy(this.hide,this))}};
SNSFloatPanel.prototype.show=function(){if(0==this.getDom().length){var a=this.buildHtml();this.getInsertDom&&"function"==typeof this.getInsertDom?jQuery(this.getInsertDom()).prepend(a):jQuery("body").append(a);this._bindDomEvent()}SNSComponent.prototype.show.call(this);return this};SNSFloatPanel.prototype.buildHtml=function(){return TemplateUtil.genHtml(this.getTemplate(),this)};SNSFloatPanel.prototype.getTemplate=function(){return SNSFloatPanel.template};
var SNSWindow=function(a){this.type="window";this.mask=a&&a.mask?a.mask:!1};SNSWindow.prototype=new SNSFloatPanel;var SNSIFrameFloatPanel=function(a,b,c,d){this.id=b||Math.uuid();this.url=a;this.width=c||500;this.height=d||300;this.selector="#"+b;this.containerSelector="";this.closeBtnSelector=".snsim_float_window_close_btn"};SNSIFrameFloatPanel.template='<div id="##{{id}}" class="snsim_float_window"><span class="snsim_float_window_head><span class="snsim_float_window_head_title"></span> <a title="\u5173\u95ed" class="snsim_float_window_close_btn"></a></span><iframe src="##{{url}}" frameborder="0" scrolling="no" width="##{{width}}" height="##{{height}}"></iframe></div>';
SNSIFrameFloatPanel.prototype=new SNSFloatPanel;SNSIFrameFloatPanel.prototype._init=function(){};SNSIFrameFloatPanel.prototype.getTemplate=function(){return SNSIFrameFloatPanel.template};SNSIFrameFloatPanel.prototype._bindDomEvent=function(){this.getDom().find(this.closeBtnSelector).bind("click",jQuery.proxy(function(){this.remove()},this))};var SNSTriggerBtn=function(){this.selector;this.containerSelector;this.html;this.target};SNSTriggerBtn.prototype=new SNSComponent;
SNSTriggerBtn.prototype._init=function(){this.getContainerDom().append(this.html);this.getDom().on("click",jQuery.proxy(this.onclick,this))};SNSTriggerBtn.prototype.onclick=function(a){this.target.show()};var SNSChatRoomController=function(){};SNSChatRoomController.prototype._init=function(){SNSApplication.getInstance().getGlobalEventManager().registerEventHandler(SNS_EVENT_SUBJECT.AFTER_JOIN_CHATROOM,!0,this.remindJoinedChatRoom,this)};
SNSChatRoomController.prototype.remindJoinedChatRoom=function(a,b,c){a=new SNSInMessage;a.type=SNS_MESSAGE_TYPE.GROUPCHAT;a.from=SNSApplication.getInstance().getUser().systemRoster;a.body={contentType:SNS_MESSAGE_CONTENT_TYPE.TEXT,content:SNS_I18N.chatRoom_joined,dateline:(new Date).getTime()};c&&(a.body.content=c.name+SNS_I18N.member_joined);a.chatroom=b;SNSApplication.getInstance().getMessageInBox().addToUnreadMessage(a);SNSApplication.getInstance().getGlobalEventManager().trigger(SNS_EVENT_SUBJECT.ON_MESSAGE_IN,
[{message:a}])};
SNSChatRoomController.prototype.joinChatRoom=function(a,b){var c=new SNSChatRoom(a);c.name=b;c.nickname=SNSApplication.getInstance().getUser().getID();SNSIMWindow.getInstance().getDialog().set(DIALOG_TYPE.CONFIRM,SNS_I18N.confirm_join_chatroom+b,function(){YYIMChat.joinChatGroup({id:c.getID(),success:function(){SNSApplication.getInstance().getUser().chatRoomList.addChatRoom(c);SNSIMWindow.getInstance().getChatWindow().openChatWith(c);SNSIMWindow.getInstance().getDialog().hide()}})});SNSIMWindow.getInstance().getDialog().show()};
var SNSSubscribeController=function(){};SNSSubscribeController.prototype._init=function(){SNSApplication.getInstance().getGlobalEventManager().registerEventHandler(SNS_PRESENCE_TYPE.SUBSCRIBE,!0,this.subscribeProcessor,this);SNSApplication.getInstance().getGlobalEventManager().registerEventHandler(SNS_EVENT_SUBJECT.ON_APPROVE_SUBSCRIBED,!0,this.remindApprovedSubscribe,this)};
SNSSubscribeController.prototype.subscribeProcessor=function(a,b){SNSApplication.getInstance().getUser().getRoster(b);var c=this.convertToMessage(b),d=SNSApplication.getInstance().getMessageInBox();d.filter.doFilter(c);d.addToUnreadMessage(c);SNSApplication.getInstance().getUser().recentList.addNew(c);SNSApplication.getInstance().getGlobalEventManager().trigger(SNS_EVENT_SUBJECT.ON_MESSAGE_IN,[{message:c}])};
SNSSubscribeController.prototype.remindApprovedSubscribe=function(a,b){var c=new SNSInMessage;c.type=SNS_MESSAGE_TYPE.CHAT;c.from=b;c.body={contentType:SNS_MESSAGE_CONTENT_TYPE.TEXT,content:SNS_I18N.subscribe_both,dateline:(new Date).getTime()};SNSApplication.getInstance().getMessageInBox().addToUnreadMessage(c);SNSApplication.getInstance().getGlobalEventManager().trigger(SNS_EVENT_SUBJECT.ON_MESSAGE_IN,[{message:c}])};
SNSSubscribeController.prototype.convertToMessage=function(a){var b=new SNSInMessage;b.type=SNS_MESSAGE_TYPE.SUBSCRIBE;b.body={};b.body.contentType=SNS_MESSAGE_CONTENT_TYPE.SYSTEM;var c=SNSApplication.getInstance().getUser().getRoster(a);c||(c=new SNSRoster(a));b.roster=c;b.from=SNSApplication.getInstance().getUser().systemRoster;return b};
var TemplateUtil={genHtml:function(a,b){function c(a,b){a=(""+a).trim().replace(/##{{([\w()_.]+)}}/,"$1");for(var c,d=0;d<b.length;d++)try{if((c=eval("arguments[1]["+d+"]."+a))&&("string"==typeof c&&c.notEmpty()||"number"==typeof c))return c}catch(e){}if(0==a.indexOf("LANG_"))return SNS_LANG_TEMPLATE[a.replace("LANG_","")];if(0==a.indexOf("lang_"))return SNS_LANG_TEMPLATE[a.replace("lang_","")];try{var h=eval(a);if(h&&"string"==typeof h)return h}catch(C){}return""}if(null==a||a.isEmpty())YYIMChat.log("template can not be null",
0);else{b instanceof Array||(b=[b]);var d=a,e=a.match(/##\{\{([\w()_.]+)\}\}/g),h;for(h in e)e[h].length!=a.length&&(d=d.replace(e[h],c(e[h],b)));return d}}},SNSChatRoomTab=function(){this.name="chatroom";this.selector="#snsim_wide_tab_container";this.headSelector="#snsim_tab_head_chatroom";this.contentSelector="#snsim_tab_content_chatroom";this.chatroomContainerSelector="#snsim_chatroom_list_container";this.roomItemIdPrefix="snsim_window_wide_tab_chatroom_";this.createChatroomPanel=new SNSCreateChatroomPanel;
this.chatroomItemTemplate='<li id="'+this.roomItemIdPrefix+'##{{getID()}}" class="clearfix"><div class="snsim_list_head sns_roster_list_wide_head"><span class="head_pic"><img src="##{{getPhotoUrl()}}" onerror="YYIMChat.defaultImg(this)"/></span><span node-type="chatRoomItemNewMsg" class="WBIM_icon_new"></span></div><div class="snsim_list_name"><span class="user_name" title="##{{name}}">##{{name}}</span></div><div style="float:right; cursor: pointer;margin: 16px 10px 0 0;"><a class="snsim_chatroom_invite_btn" onclick="SNSIMWindow.getInstance().getInvitationWindow().show(\'##{{getID()}}\')"><span class="invite_btn"></span></a></div></li>'};
SNSChatRoomTab.prototype=new SNSTab;
SNSChatRoomTab.prototype._init=function(){this.createChatroomPanel._init();SNSApplication.getInstance().getGlobalEventManager().registerEventHandler(SNS_EVENT_SUBJECT.AFTER_LOAD_CHATROOM,!1,this.renderChatRoomList,this);SNSApplication.getInstance().getGlobalEventManager().registerEventHandler(SNS_EVENT_SUBJECT.ON_ADD_CHATROOM,!0,this.renderAddChatRoom,this);SNSApplication.getInstance().getGlobalEventManager().registerEventHandler(SNS_EVENT_SUBJECT.ON_QUIT_CHATROOM,!0,this.renderRemoveChatRoom,this)};
SNSChatRoomTab.prototype.renderAddChatRoom=function(a,b){this.addChatRoom(b)};SNSChatRoomTab.prototype.renderRemoveChatRoom=function(a,b){jQuery(this.chatroomContainerSelector).find("#"+this.roomItemIdPrefix+b.getID()).remove();SNSIMWindow.getInstance().getChatWindow().getTab(b).getCloseBtnDom().trigger("click")};SNSChatRoomTab.prototype.renderChatRoomList=function(){var a=SNSApplication.getInstance().getUser().chatRoomList.toArray(),b;for(b in a){var c=a[b];c&&c instanceof SNSChatRoom&&this.addChatRoom(c)}};
SNSChatRoomTab.prototype.addChatRoom=function(a){if(!(0<jQuery("#"+this.roomItemIdPrefix+a.getID()).length)){var b=TemplateUtil.genHtml(this.chatroomItemTemplate,a);jQuery(this.chatroomContainerSelector).append(b);this._bindChatRoomItemEvent(a)}};SNSChatRoomTab.prototype._bindChatRoomItemEvent=function(a){this.getDom().find("#"+this.roomItemIdPrefix+a.getID()).bind("click",{chatroom:a},function(a){SNSIMWindow.getInstance().getChatWindow().openChatWith(a.data.chatroom)})};
SNSChatRoomTab.prototype.renderUnreadMsgNum=function(a,b){var c=this.getDom().find("#"+this.roomItemIdPrefix+a.getID());c.find(this.unreadMsgNumSelector).text(b);c.find(this.unreadMsgNumSelector).show()};SNSChatRoomTab.prototype.clearUnreadMsgNum=function(a){this.getDom().find("#"+this.roomItemIdPrefix+a.getID()).find(this.unreadMsgNumSelector).hide()};
var SNSChatWindow=function(){this.selector="#snsim_chat_window";this.titleContainerSelector="#snsim_chat_rt_title";this.chatBoxSelector="#snsim_chat_box";this.miniBtnSelector="#snsim_chat_windown_mini_btn";this.closeBtnSelector="#snsim_chat_windown_close_btn";this.headContainerSelector="#snsim_chat_window_tab_head";this.contentContainerSelector="#snsim_chat_window_tab_content";this.currentChatPhotoSelector=".snsim_current_roster_photo";this.currentChatRosterNameSelector=".sns_curchat_title";this.showChatroomMembersSelector=
"#show_chatroom_members";this.scrollTopSelector=".snsim_scroll_top";this.scrollBottomSelector=".snsim_scroll_bottom";this.sendBox=new SNSSendBox};SNSChatWindow.prototype=new SNSTabContainer;SNSChatWindow.prototype.getSendBox=function(){return this.sendBox};
SNSChatWindow.prototype._init=function(){YYIMChat.log("SNSChatWindow.prototype._init",3);this.transPosition(!0);this.enableMove();jQuery(".snsim_chat_friend_box").perfectScrollbar({suppressScrollX:!0,setOffsetRight:!0,offsetRight:0});this._bindWindowButtonEvent();SNSApplication.getInstance().getGlobalEventManager().registerEventHandler(SNS_EVENT_SUBJECT.ON_MESSAGE_IN,!0,this.onMessageIn,this);SNSApplication.getInstance().getGlobalEventManager().registerEventHandler("initChatWin",!0,this.initChatWin,
this);SNSApplication.getInstance().getGlobalEventManager().registerEventHandler("listenChatWinChange",!0,this.listenChatWinChange,this)};
SNSChatWindow.prototype.initChatWin=function(){if(window.localStorage){var a=window.localStorage.getItem(YYIMChat.getUserNode()+"_tablist");try{a=JSON.parse(a)}catch(b){}var a=a||[],c=window.localStorage.getItem(YYIMChat.getUserNode()+"_closeId"),d;for(d in a){var e=a[d];if("string"===typeof e&&e!==c)try{jQuery("#snsim_chat_window_tab_head").find('li[id$="_'+e+'"]').length||(window.initLastChatList=!0,SNSIMWindow.getInstance().getChatWindow().openChatWith(e))}catch(h){}}if((a=window.localStorage.getItem(YYIMChat.getUserNode()+
"_tabCurEntity"))&&a!==c)try{jQuery("#snsim_chat_window_tab_head").find('li[id$="_'+a+'"]').is(".cur")||(window.initLastChatList=!0,SNSIMWindow.getInstance().getChatWindow().openChatWith(a))}catch(s){}jQuery("#snsim_chat_window_tab_head").find('li[id$="_'+c+'"]').length&&jQuery("#snsim_chat_window_tab_head").find('li[id$="_'+c+'"]').find(".snsim_chat_window_tab_close_btn").trigger("click");(c=window.localStorage.getItem(YYIMChat.getUserNode()+"_curTab"))&&jQuery(".tab_list [id*='"+c+"']").trigger("click");
SNSIMWindow.getInstance()._initNarrowWideWindow();if(c=window.localStorage.getItem(YYIMChat.getUserNode()+"_position"))try{c=JSON.parse(c),jQuery(".snsim_chat_box").css({left:c[0],top:c[1]})}catch(u){}"closed"==window.localStorage.getItem(YYIMChat.getUserNode()+"_isChatClosed")&&jQuery("#snsim_chat_window").hide()}};
SNSChatWindow.prototype.listenChatWinChange=function(){var a=this;document.attachEvent&&!K.Browser.opera?document.attachEvent("onstorage",function(){a.initChatWin()}):window.addEventListener("storage",function(){a.initChatWin()},!1)};SNSChatWindow.prototype.onMessageIn=function(a,b){var c=b.message;c&&c instanceof SNSMessage&&this.addMessage(c)};
SNSChatWindow.prototype.addMessage=function(a){var b=a.getRosterOrChatRoom();if(b=this.getTab(b))b.addMessage(a),this.getCurrentTab()!==b?a.from.id!=YYIMChat.getUserID()&&b.addMsgRemind():a.body.receipt&&(SNSApplication.getInstance().getUser().recentList.addNew(a),YYIMChat.sendReceiptsPacket(a.body.receipt),YYIMChat.sendReadedReceiptsPacket(a.body.receipt));if("groupchat"==a.type)try{jQuery("#snsim_tab_content_share_"+a.chatroom.getID()).find(".snsim_share_file_refresh_btn").click()}catch(c){YYIMChat.log("groupshare_refresh",
1,a,c)}};
SNSChatWindow.prototype._bindWindowButtonEvent=function(){jQuery(this.miniBtnSelector).on("click",function(){SNSIMWindow.getInstance()._toggleMiniChatWindow()});jQuery(this.closeBtnSelector).on("click",jQuery.proxy(function(){this.hide();window.localStorage&&window.localStorage.setItem(YYIMChat.getUserNode()+"_isChatClosed","closed")},this));jQuery(this.showChatroomMembersSelector).on("click",jQuery.proxy(function(){this.getActiveRoster()instanceof SNSChatRoom&&SNSIMWindow.getInstance().getChatroomMembersPanel().show()},this))};
SNSChatWindow.prototype.getTab=function(a){return a.id?this.tabs.get(a.id):this.tabs.get(a)};SNSChatWindow.prototype.getActiveRoster=function(){var a=this.getCurrentTab();if(a)return a instanceof SNSChatRoomChatTab?a.chatroom:a instanceof SNSPublicRosterChatTab?a.publicRoster:a.roster};
SNSChatWindow.prototype.chatWithAnyRoster=function(a){if(a&&a.id&&(this.queryRosterIng=this.queryRosterIng||{},!this.queryRosterIng[a.id])){this.queryRosterIng[a.id]=!0;var b=new SNSRoster(a.id);SNSApplication.getInstance().getUser().addRoster(b,!0);var c=this;YYIMChat.getVCard({id:b.id,success:function(d){b.setVCard(new SNSVCard(d));b.name=d.nickname||a.id;b.photo=d.photo;b.queryed=!0;c.queryRosterIng[a.id]=!1;SNSIMWindow.getInstance().getChatWindow().openChatWithOld(a.id)}})}};
SNSChatWindow.prototype.openChatWith=function(a,b){var c;a.id?(c=a.id,b=a.name||b):c=a;if(c){var d=SNSApplication.getInstance().getUser().getRosterOrChatRoom(c);d&&(d.name!=d.id||d.queryed)?this.openChatWithOld(a):this.chatWithAnyRoster({id:c,name:b})}};
SNSChatWindow.prototype.openChatWithOld=function(a){var b;if((b=a.id?a.id:a)&&"undefined"!=b&&b!=YYIMChat.getUserID()){var c=this.getTab(b);if(!c){if("string"==typeof a&&(a=SNSApplication.getInstance().getUser().getRosterOrChatRoom(a),!a))throw"invalid roster";c=this._addNewChat(a)}if(this.getCurrentTab()!=c){var d=this.getCurrentTab();this.changeTabTo(c);this.updateTitle(d,c)}this._renderUnreadMessage(a);SNSIMWindow.getInstance().getUnreadMessagePanel().removeUnreadMessage(b);this.visible()||(this.show(),
window.localStorage&&window.localStorage.setItem(YYIMChat.getUserNode()+"_isChatClosed",""));setTimeout(function(){jQuery("#snsim_sendbox_content").focus()},0)}};SNSChatWindow.prototype.onTabChange=function(a,b){b.removeMsgRemind();this.updateTitle(a,b);SNSApplication.getInstance().getGlobalEventManager().trigger(SNS_EVENT_SUBJECT.ON_CURRENT_CHAT_CHANGE,[{oldValue:a,newValue:b}])};
SNSChatWindow.prototype.updateTitle=function(a,b){var c=b.getTarget();jQuery(this.showChatroomMembersSelector).removeClass();c instanceof SNSRoster?jQuery(this.showChatroomMembersSelector).addClass("snsim_current_session_roster"):c instanceof SNSChatRoom?jQuery(this.showChatroomMembersSelector).addClass("snsim_current_session_group"):jQuery(this.showChatroomMembersSelector).addClass("snsim_current_session_others");this.getDom().find(this.currentChatPhotoSelector).attr("src",c.getPhotoUrl());this.getDom().find(this.currentChatRosterNameSelector).text(c.name)};
SNSChatWindow.prototype.afterShow=function(){SNSIMWindow.getInstance().getMiniChatWindow().hide()};
SNSChatWindow.prototype._addNewChat=function(a){if(a){var b;a instanceof SNSPublicServiceRoster?b=new SNSPublicRosterChatTab(a):a instanceof SNSDeviceRoster?b=new SNSDeviceRosterChatTab(a):a instanceof SNSRoster?b=new SNSRosterChatTab(a):a instanceof SNSChatRoom?b=new SNSChatRoomChatTab(a):a instanceof SNSSystemRoster&&(b=new SNSSystemRosterChatTab(a));if(b)return this.addTab(b),b.scrollContent(),this._bindTabHeadEvent(b),b}};
SNSChatWindow.prototype._renderUnreadMessage=function(a){if(a=SNSApplication.getInstance().getMessageInBox().popUnreadMessageByRoster(a))for(var b in a){var c=a[b];c&&c instanceof SNSInMessage&&this.addMessage(c)}};
SNSChatWindow.prototype._bindTabHeadEvent=function(a){a.getCloseBtnDom().bind("click",{tab:a},jQuery.proxy(function(b){b.data.tab.getHeadDom().remove();b.data.tab.getContentDom().remove();if((b.data.tab.roster||b.data.tab.chatroom)&&window.localStorage){var c=YYIMChat.getUserNode()+"_tablist";b=b.data.tab.roster||b.data.tab.chatroom;var d=window.localStorage.getItem(c);try{d=JSON.parse(d)}catch(e){}d=d||[];-1<d.indexOf(b.id)&&d.splice(d.indexOf(b.id),1);window.localStorage.setItem(c,JSON.stringify(d));
window.localStorage.setItem(YYIMChat.getUserNode()+"_closeId",b.id)}c=this.removeTab(a);0==this.tabs.size()&&this.hide();c&&(window.localStorage&&window.localStorage.setItem(YYIMChat.getUserNode()+"_tabCurEntity",c.id),this.changeTabTo(c));SNSApplication.getInstance().getGlobalEventManager().trigger(SNS_EVENT_SUBJECT.TAB_CLOSED,[a])},this));a.getHeadDom().bind("mouseenter",{tab:a},function(a){a.data.tab.getHeadDom().hasClass("snsim_active")||a.data.tab.getCloseBtnDom().css("display","block")});a.getHeadDom().bind("mouseleave",
{tab:a},function(a){a.data.tab.getCloseBtnDom().css("display","none")})};SNSChatWindow.prototype.afterSendMessage=function(a){SNSApplication.getInstance().getUser().recentList.addNew(a);SNSApplication.getInstance().getMessageInBox().filter.doFilter(a);SNSIMWindow.getInstance().getChatWindow().getTab(a.to).addMessage(a);if("groupchat"==a.type)try{jQuery("#snsim_tab_content_share_"+a.chatroom.getID()).find(".snsim_share_file_refresh_btn").click()}catch(b){YYIMChat.log("groupshare_refresh",1,a,b)}};
SNSChatWindow.prototype.scrollTabList=function(a){var b=this.getDom().find(this.scrollTopSelector).offset().top-59;a==SNS_DIRECTION.TOP&&45>this._headContainer.offset().top?this._headContainer.offset({top:this._headContainer.offset().top+59}):a==SNS_DIRECTION.BOTTOM&&b<this._headContainer.children().last().offset().top&&this._headContainer.offset({top:this._headContainer.offset().top-59})};
SNSChatWindow.prototype.transPosition=function(a){if(this.useDefaultPosition){var b=jQuery(window).width()-this.getDom().width()-44,c=jQuery(window).height()-this.getDom().height()-47,b=a?b-SNSIMWindow.getInstance().getWideWindow().width:b-SNSIMWindow.getInstance().getNarrowWindow().width;jQuery(this.chatBoxSelector).css("top",c);jQuery(this.chatBoxSelector).css("left",b)}};
SNSChatWindow.prototype.validateMovability=function(a){a=a&&a.target?"#"+jQuery(a.target).attr("id"):"#"+jQuery(window.event.srcElement).attr("id");return a==this.miniBtnSelector||a==this.closeBtnSelector||a==this.showChatroomMembersSelector?!1:!0};SNSChatWindow.prototype.getDragComponentSelector=function(){return SNSIMWindow.getInstance().getChatWindow().titleContainerSelector};SNSChatWindow.prototype.getMoveComponentSelector=function(){return SNSIMWindow.getInstance().getChatWindow().chatBoxSelector};
var SNSNarrowWindow=function(){this.selector="#snsim_window_narrow";this.rosterContainerSelector="#narrow_roster_container";this.rosterIdPrefix="narrow_roster_";this.width;this.rosterTemplate='<li id="'+this.rosterIdPrefix+'##{{getID()}}" rosterId="##{{getID()}}" class="clearfix"><div class="snsim_list_head snsim_head_30" style="padding:8px 8px 4px 8px;"><span class="head_pic"><img class="snsim_roster_photo snsim_user_item_img" rosterId="##{{getID()}}" src="##{{getPhotoUrl()}}" alt="##{{name}}" jid="##{{jid.getBareJID()}}" onerror="YYIMChat.defaultImg(this)"></span><span node-type="statusNode" class="snsim_roster_presence W_chat_stat snsim_##{{presence.status}}"></span></div></li>'};
SNSNarrowWindow.prototype=new SNSWindow;SNSNarrowWindow.prototype._init=function(){this.width=this.getDom().width();jQuery(this.rosterContainerSelector).parent().perfectScrollbar({suppressScrollX:!0,setOffsetRight:!0,offsetRight:0});SNSApplication.getInstance().getGlobalEventManager().registerEventHandler(SNS_EVENT_SUBJECT.AFTER_LOAD_ROSTER,!1,function(a){this.renderRosterList()},this)};
SNSNarrowWindow.prototype.renderRosterList=function(){var a=SNSApplication.getInstance().getUser().rosterList.sortByStatus();jQuery(this.rosterContainerSelector).empty();for(var b=0;b<a.length;b++){var c=a[b];c&&c instanceof SNSRoster&&this.addRoster(c)}};SNSNarrowWindow.prototype.renderRosterPhoto=function(a){jQuery("li[id$='"+a.getID()+"'] img.snsim_roster_photo").attr("src",a.vcard.getPhotoUrl())};
SNSNarrowWindow.prototype.addRoster=function(a){var b=TemplateUtil.genHtml(this.rosterTemplate,a);jQuery(this.rosterContainerSelector).append(b);this._bindRosterClickEvent(a)};
SNSNarrowWindow.prototype._bindRosterClickEvent=function(a){this.getDom().find("li#narrow_roster_"+a.getID()).bind("click",{roster:a},function(a){SNSIMWindow.getInstance().getChatWindow().openChatWith(a.data.roster)});this.getDom().find(".snsim_roster_photo[rosterId='"+a.getID()+"']").bind("mouseover",{roster:a},function(a){var c=SNSVCardPanel.getInstance(a.data.roster);c.mouseover=!0;c.show(a.target)});this.getDom().find(".snsim_roster_photo[rosterId='"+a.getID()+"']").bind("mouseout",{roster:a},
function(a){var c=SNSVCardPanel.getInstance(a.data.roster);c.mouseover=!1;setTimeout(function(){c.mouseover||c.hide()},200)})};
var SNSRecentTab=function(){this.name="recent";this.headSelector="#snsim_tab_recent_head";this.contentSelector="#snsim_tab_recent_content";this.containerSelector="#snsim_tab_recent_container";this.rosterTemplate='<li id="snsim_tab_recent_roster_##{{getID()}}" class="snsim_recent_roster_item clearfix sns_roster_list_wide_item"><div class="snsim_list_head webim_head_30 sns_roster_list_wide_head"><span class="head_pic"><img width="31" height="31" src="##{{getPhotoUrl()}}" class="snsim_user_item_img" onerror="YYIMChat.defaultImg(this)"></span><span class="snsim_roster_presence W_chat_stat snsim_##{{presence.status}}"></span><span class="WBIM_icon_new" node-type="snsNewMsgIcon"></span></div><div class="snsim_list_name"><span class="user_name" title="##{{name}}">##{{name}}</span></div></li>';this.headTemplate=
'<li title="\u6700\u8fd1\u8054\u7cfb\u4eba" id="snsim_tab_recent_head" class="snsim_tab_head snsim_tab_recent_head clearfix"><a href="javascript:void(0);"><span class=" snsim_icon_tab snsim_icontab_last"></span></a></li>';this.contentTemplate='<div id="snsim_tab_recent_content" class="snsim_tab_content snsim_tab_recent_content snsRecentsScroll"><div class="snsim_list_con"><div class="list_box clearfix"><div class="list_content"><ul id="snsim_tab_recent_container" class="list_content_li"></ul></div></div></div></div>'};
SNSRecentTab.prototype=new SNSTab;SNSRecentTab.prototype._init=function(){SNSApplication.getInstance().getGlobalEventManager().registerEventHandler(SNS_EVENT_SUBJECT.ADD_TO_RENCENT,!1,this.updateRecent,this);var a=this;jQuery(this.headSelector).bind("click",function(){SNSIMWindow.getInstance().getWideWindow().changeTabTo(a)})};
SNSRecentTab.prototype.updateRecent=function(){var a=SNSApplication.getInstance().getUser().recentList.getFirstItem(),b=this.getContentDom().find("#snsim_tab_recent_roster_"+a.id),c=jQuery(this.containerSelector);if(0<b.length)c.prepend(b);else{var d=this;d.queryRosterIng=d.queryRosterIng||{};if(!d.queryRosterIng[a.id]){var e=SNSApplication.getInstance().getUser().getRosterOrChatRoom(a.id);e&&e.name&&e.name!=e.id?(b=TemplateUtil.genHtml(this.rosterTemplate,[SNSApplication.getInstance().getUser().getRosterOrChatRoom(a.id),
a.message]),c.prepend(b),this._bindRosterDomEvent(a),a=this.getContentDom().find("li[id^='snsim_tab_recent_roster_']"),a.length>SNSConfig.RECENT.MAX_SIZE&&this.getContentDom().find("li[id^='snsim_tab_recent_roster_']:last").remove()):(e=new SNSRoster(a.id),SNSApplication.getInstance().getUser().addRoster(e,!0),d.queryRosterIng[e.id]=!0,YYIMChat.getVCard({id:e.id,success:function(a){e.setVCard(new SNSVCard(a));e.name=a.nickname||e.id;e.photo=a.photo;e.queryed=!0;d.queryRosterIng[e.id]=!1;jQuery("#snsim_tab_recent_roster_"+
e.id).find(".user_name").html(e.name);jQuery("#snsim_tab_recent_roster_"+e.id).find(".snsim_user_item_img").attr("src",e.getPhotoUrl())}}),b=TemplateUtil.genHtml(d.rosterTemplate,[SNSApplication.getInstance().getUser().getRosterOrChatRoom(a.id),a.message]),c.prepend(b),d._bindRosterDomEvent(a),a=d.getContentDom().find("li[id^='snsim_tab_recent_roster_']"),a.length>SNSConfig.RECENT.MAX_SIZE&&d.getContentDom().find("li[id^='snsim_tab_recent_roster_']:last").remove())}}};
SNSRecentTab.prototype._bindRosterDomEvent=function(a){this.getContentDom().find("#snsim_tab_recent_roster_"+a.id).bind("click",{id:a.id},function(a,c){SNSIMWindow.getInstance().getChatWindow().openChatWith(a.data.id)})};SNSRecentTab.prototype.getHeadTemplate=function(){return this.headTemplate};SNSRecentTab.prototype.getContentTemplate=function(){return this.contentTemplate};
var SNSRosterTab=function(){this.name="roster";this.selector="#snsim_wide_tab_container";this.headSelector="#snsim_tab_head_roster";this.contentSelector="#snsim_tab_content_roster";this.groupContainerSelector="#grouproster_container";this.operateBtnSelector=".snsim_operation_panel_trigger_btn";this.unreadMsgNumSelector=".snsim_unread_msg_num";this.currentOperationRoster;this.rosterTemplate='<li id="grouproster_##{{groupname}}_##{{id}}" groupname="##{{groupname}}" rosterId="##{{getID()}}" class="clearfix sns_roster_list_wide_item"><div class="snsim_list_head sns_roster_list_wide_head"><span class="head_pic"><img src="##{{getPhotoUrl()}}" rosterId="##{{getID()}}" class="snsim_roster_photo" onerror="YYIMChat.defaultImg(this)"></span><span class="snsim_roster_presence W_chat_stat snsim_##{{presence.status}}"></span><span class="WBIM_icon_new" node-type="snsNewMsgIcon"></span></div><div class="snsim_list_name"><span class="user_name" title="##{{name}}">##{{name}}</span></div><div style="float:right; margin: 16px 10px 0 0; cursor: pointer;"><a class="snsim_operation_panel_trigger_btn snsim_list_opt"></a><span class="snsim_unread_msg_num">0</span></div><div><p class="sns_roster_list_wide_menu_btn" onclick="SNSRosterRender.showMemu()"></p></div></li>';
this.groupTempalte='<div id="'+SNSRosterTab.groupPrefixId+'##{{name}}" class="list_box list_box_unfold clearfix"><div id="title_container_##{{name}}" class="list_title"> <p class="title_cate"><a class="list_title_a" href="javascript:void(0);" title="##{{name}}"> <span class="sns_snsim_arrow"></span><span id="title_node_##{{name}}">##{{name}}</span>(<span id="online_count_##{{name}}">0/0</span>)</a></p></div><div class="list_content"><ul id="list_content_##{{name}}" class="list_content_li"></ul></div></div>'};
SNSRosterTab.groupPrefixId="snsim_tab_roster_group_";SNSRosterTab.prototype=new SNSTab;
SNSRosterTab.prototype._init=function(){this._addGroupNone();SNSApplication.getInstance().getGlobalEventManager().registerEventHandler(SNS_EVENT_SUBJECT.ON_ADD_ROSTER,!1,function(a){this.addRoster(a.newValue)},this);SNSApplication.getInstance().getGlobalEventManager().registerEventHandler(SNS_EVENT_SUBJECT.ON_REMOVE_ROSTER,!1,function(a){this.removeRoster(a.roster)},this);SNSApplication.getInstance().getGlobalEventManager().registerEventHandler(SNS_EVENT_SUBJECT.ON_ROSTER_PHOTO_CHANGE,!1,function(a){this.changeRosterPhoto(a.photo,
a.rosterId)},this);var a=this;jQuery(this.headSelector).bind("click",function(){SNSIMWindow.getInstance().getWideWindow().changeTabTo(a)})};SNSRosterTab.prototype._addGroupNone=function(){var a=SNSApplication.getInstance().getUser().groupList.groupNone;return this.addGroup(a)};
SNSRosterTab.prototype.addRoster=function(a){if(a&&a instanceof SNSRoster&&(a.subscription==SNS_SUBSCRIBE.BOTH||a.subscription==SNS_SUBSCRIBE.TO)){if(0<a.groups.length)for(var b=0;b<a.groups.length;b++)this.addRosterToGroup(a,a.groups[b]);else b=SNSApplication.getInstance().getUser().groupList.groupNone,this.addRosterToGroup(a,b);this.updateGroupsInfo()}};SNSRosterTab.prototype.removeRosterFromGroup=function(a,b){this.addGroup(b).find("li[rosterId='"+a.getID()+"']").remove();this.updateGroupsInfo()};
SNSRosterTab.prototype.removeRoster=function(a){if(a.subscription==SNS_SUBSCRIBE.NONE){var b=this.getDom().find("li[rosterId='"+a.getID()+"']");0<b.length&&b.remove();(a=SNSIMWindow.getInstance().getChatWindow().getTab(a))&&a.getCloseBtnDom().trigger("click")}else YYIMChat.deleteRosterItem({id:a.getID(),success:jQuery.proxy(function(a){a=SNSApplication.getInstance().getUser().getRosterOrChatRoom(a);SNSApplication.getInstance().getUser().removeRosterFromLocal(a);var b=this.getDom().find("li[rosterId='"+
a.getID()+"']");0<b.length&&b.remove();(a=SNSIMWindow.getInstance().getChatWindow().getTab(a))&&a.getCloseBtnDom().trigger("click")},this)}),this.updateGroupsInfo()};SNSRosterTab.prototype.renameRoster=function(a){var b=this;jQuery.when(a.update()).done(function(){var c=b.getDom().find("li[rosterId='"+a.getID()+"'] .user_name");a.name?c.text(a.name):c.text(a.getID())})};
SNSRosterTab.prototype.addRosterToGroup=function(a,b){if(!this.isRosterInGroup(a,b)){this.addGroup(b);var c=TemplateUtil.genHtml(this.rosterTemplate,[a,{groupname:b.name}]);jQuery("#list_content_"+b.name).append(c);this._bindRosterEvent(a,b);this.updateGroupsInfo()}};
SNSRosterTab.prototype.moveRosterBetweenGroups=function(a,b,c){a=this.addGroup(b).find("li[rosterId='"+a.getID()+"']");this.addGroup(c);a.appendTo(jQuery("#list_content_"+c.name));a.attr("groupname",c.name);a.attr("id",a.attr("id").replace("_"+b.name+"_","_"+c.name+"_"));this.updateGroupsInfo()};SNSRosterTab.prototype.renderRosterPhoto=function(a){a.vcard.hasPhoto()&&jQuery("li[id$='"+a.getID()+"'] img.snsim_roster_photo").attr("src",a.getPhotoUrl())};
SNSRosterTab.prototype._bindRosterEvent=function(a,b){var c=this.getDom().find("li[id$='"+b.name+"_"+a.getID()+"']");c.bind("click",{roster:a},function(a){SNSIMWindow.getInstance().getChatWindow().openChatWith(a.data.roster)});c.bind("mouseenter",jQuery.proxy(function(a){if(jQuery(a.currentTarget).find(this.unreadMsgNumSelector).is(":visible"))jQuery(a.currentTarget).find(this.operateBtnSelector).hide();else{var b=jQuery(a.currentTarget).attr("rosterId");(b=SNSApplication.getInstance().getUser().getRosterOrChatRoom(b))&&
b instanceof SNSDeviceRoster?jQuery(a.currentTarget).find(this.operateBtnSelector).hide():jQuery(a.currentTarget).find(this.operateBtnSelector).show()}},this));c.bind("mouseleave",jQuery.proxy(function(a){jQuery(a.currentTarget).find(this.operateBtnSelector).hide()},this));c.find(this.operateBtnSelector).bind("click",function(a){var b=SNSIMWindow.getInstance().getRosterOperationPanel();b.attachDom(a.target);b.show();a.stopPropagation()});this.getDom().find(".snsim_roster_photo[rosterId='"+a.getID()+
"']").bind("mouseover",function(a){var b=jQuery(this).attr("rosterId"),c=SNSApplication.getInstance().getUser().getRoster(b);c&&c instanceof SNSRoster&&(b=SNSVCardPanel.getInstance(b),b.mouseover=!0,b.show(a.target))});this.getDom().find(".snsim_roster_photo[rosterId='"+a.getID()+"']").bind("mouseout",function(a){a=jQuery(this).attr("rosterId");var b=SNSApplication.getInstance().getUser().getRoster(a);if(b&&b instanceof SNSRoster){var c=SNSVCardPanel.getInstance(a);c.mouseover=!1;setTimeout(function(){c.mouseover||
c.hide()},200)}})};SNSRosterTab.prototype.addGroup=function(a){if("\u516c\u5171\u8d26\u53f7"!=a.name){if(a&&a instanceof SNSGroup){var b=this.getGroupDom(a);return b?b:(b=TemplateUtil.genHtml(this.groupTempalte,[a]),this.getDom().find(this.groupContainerSelector).append(b),this._bindGroupFoldEvent(a))}throw"invalid group, shoud be instanceof SNSGroup";}};
SNSRosterTab.prototype._bindGroupFoldEvent=function(a){var b=this.getGroupDom(a).find("a.list_title_a");b?b.bind("click",function(b){var d=jQuery(this).parents("#snsim_tab_roster_group_"+a.name);d.hasClass("list_box_fold")?(d.removeClass("list_box_fold"),d.addClass("list_box_unfold")):(d.removeClass("list_box_unfold"),d.addClass("list_box_fold"));b.stopPropagation()}):null;return b};SNSRosterTab.prototype.getGroupDom=function(a){a=this.getDom().find("#snsim_tab_roster_group_"+a.name);if(0!=a.length)return jQuery(a[0])};
SNSRosterTab.prototype.isRosterInGroup=function(a,b){if(0<this.addGroup(b).find("li[rosterid='"+a.id+"']").length)return!0};SNSRosterTab.prototype.renderUnreadMsgNum=function(a,b){var c=this.getDom().find("li[rosterId='"+a.getID()+"']");c.find(this.unreadMsgNumSelector).text(b);c.find(this.unreadMsgNumSelector).show()};SNSRosterTab.prototype.clearUnreadMsgNum=function(a){this.getDom().find("li[rosterId='"+a.getID()+"']").find(this.unreadMsgNumSelector).hide()};
SNSRosterTab.prototype.updateGroupsInfo=function(){var a=SNSIMWindow.getInstance().getWideWindow().getTab("roster"),b=SNSApplication.getInstance().getUser().groupList._list,c;for(c in b)a.getDom().find("#online_count_"+c).text(b[c].getOnlineNumber()+"/"+b[c].size())};SNSRosterTab.prototype.changeRosterPhoto=function(a,b){this.getDom().find("li[rosterId='"+b+"']").find("img[rosterid="+b+"]").attr("src",YYIMChat.getFileUrl(a))};
var SNSWideWindow=function(){this.selector="#snsim_window_wide";this.headContainerSelector="#snsim_wide_tab_head_container ul.tab_list";this.contentContainerSelector="#snsim_wide_tab_content_container";this.width};SNSWideWindow.prototype=new SNSTabContainer;SNSWideWindow.prototype._init=function(){this.width=this.getDom().width();this.addTab(new SNSRosterTab);this.addTab(new SNSChatRoomTab);this.addTab(new SNSRecentTab)};
var SNSSendBox=function(){this._unCompleteMessage={};this.selector="#snsim_chat_sendbox";this.contentDomSelector="#snsim_sendbox_content";this.characterCounterSelector="#snsim_sendbox_available_num";this.sendBtnSelector="#snsim_message_send_btn";this.expressionPattern=/<img[\w\W]+?node-type=\"expression\"[\w\W]+?>/ig;this.characterExceedClass="snsim_message_character_exceed";this._init()};SNSSendBox.prototype=new SNSComponent;SNSSendBox.prototype._init=function(){this._bindPasteEvent();this._bindSendEvent()};
SNSSendBox.prototype._bindSendEvent=function(){var a=this;jQuery(this.sendBtnSelector).on("click",jQuery.proxy(this.send,this));jQuery(this.contentDomSelector).on("keydown",function(b){b.keyCode==SNS_KEY_CODE.ENTER&&(a.send(),b.preventDefault())});jQuery(this.contentDomSelector).on("keyup",function(b){a.getContentLength()>SNSConfig.MESSAGE.MAX_CHARACHER?(alert("\u6d88\u606f\u8d85\u51fa\u957f\u5ea6\u9650\u5236"),b.preventDefault()):a.updateContentLength()})};
SNSSendBox.prototype.send=function(){if(this.getContent())if(this.getContentLength()>SNSConfig.MESSAGE.MAX_CHARACHER)alert("\u6d88\u606f\u8d85\u51fa\u957f\u5ea6\u9650\u5236");else{var a=SNS_CHAT_TYPE.CHAT,b=SNSIMWindow.getInstance().getChatWindow().getActiveRoster(),c=b.id;b instanceof SNSPublicAccountRoster?a=SNS_CHAT_TYPE.PUB_ACCOUNT:b instanceof SNSChatRoom&&(a=SNS_CHAT_TYPE.GROUP_CHAT);var d={to:c,msg:this.getContent(),type:a,success:jQuery.proxy(function(a){if("groupchat"!=a.type){var b=new SNSOutMessage(a);
b.setText(a.body.content);d.style&&(b.body.style=new SNSMessageStyle(d.style.font,d.style.size,d.style.color,d.style.biu));SNSApplication.getInstance().getUser().recentList.addNew(b);SNSApplication.getInstance().getMessageInBox().filter.doFilter(b);SNSIMWindow.getInstance().getChatWindow().getTab(b.to).addMessage(b)}this.clearContent()},this)};b.resource&&(d.resource=b.resource);SNSMessageStyle.used&&(d.style=SNSMessageStyle.getInstance());YYIMChat.sendTextMessage(d)}};
SNSSendBox.prototype.getContent=function(){var a=this.getContentDom().html(),a=a.replace(/(^(\s|&nbsp;)*)|((\s|&nbsp;)*$)/g,"");return this.html_decode(SNSExpressionOutFilter.genContent(a))};SNSSendBox.prototype.getContentDom=function(){return jQuery(this.contentDomSelector)};SNSSendBox.prototype.clearContent=function(){jQuery(this.contentDomSelector).empty();jQuery(this.characterCounterSelector).text(SNSConfig.MESSAGE.MAX_CHARACHER)};
SNSSendBox.prototype.updateContentLength=function(){var a=jQuery(this.characterCounterSelector),b=SNSConfig.MESSAGE.MAX_CHARACHER-this.getContentLength();a.text(0<b?b:0);0>=b?a.addClass(this.characterExceedClass):a.removeClass(this.characterExceedClass)};SNSSendBox.prototype.getContentLength=function(){return this.getContent().replace(this.expressionPattern," ").length};
SNSSendBox.prototype._bindPasteEvent=function(){jQuery(this.contentDomSelector).bind("beforepaste paste",function(a){var b=jQuery(this);setTimeout(function(){b.html(b.html().replace(SNSExpressionOutFilter.pattern,"$1"));b.html(b.html().replace(/<[^<]*>/g,""));b.html(SNSExpressionInFilter.decode(b.html()))},0)})};
SNSSendBox.prototype.insertHtmlContent=function(a){var b=jQuery(this.contentDomSelector),c;if(window.getSelection){if(b=window.getSelection(),b.getRangeAt&&b.rangeCount){c=b.getRangeAt(0);c.deleteContents();var d=document.createElement("div");d.innerHTML=a;a=document.createDocumentFragment();for(var e,h;e=d.firstChild;)h=a.appendChild(e);(d=c.commonAncestorContainer.parentElement)&&"true"==d.contentEditable?c.insertNode(a):this.getContentDom().append(a);h&&(c=c.cloneRange(),c.setStartAfter(h),c.collapse(!0),
b.removeAllRanges(),b.addRange(c))}}else document.selection&&"Control"!=document.selection.type&&(jQuery(b).focus(),ierange=document.selection.createRange(),ierange.pasteHTML(a),jQuery(b).focus())};SNSSendBox.prototype.html_encode=function(a){var b="";if(0==a.length)return"";b=a.replace(/&/g,"&gt;");b=b.replace(/</g,"&lt;");b=b.replace(/>/g,"&gt;");b=b.replace(/\s/g,"&nbsp;");b=b.replace(/\'/g,"&#39;");b=b.replace(/\"/g,"&quot;");return b=b.replace(/\n/g,"<br>")};
SNSSendBox.prototype.html_decode=function(a){var b="";if(0==a.length)return"";b=a.replace(/&gt;/g,"&");b=b.replace(/&lt;/g,"<");b=b.replace(/&gt;/g,">");b=b.replace(/&nbsp;/g," ");b=b.replace(/&#39;/g,"'");b=b.replace(/&quot;/g,'"');return b=b.replace(/<br>/g,"\n")};
var SNSRosterChatTab=function(a){this.name=(this.roster=a)?a.id:"";this.closeable=!0;this.lastMessageDateline=0;this.headSelector=a?"#"+SNSRosterChatTab.headIdPrefix+a.getID():"";this.contentSelector=a?"#"+SNSRosterChatTab.contentIdPrefix+a.getID():"";this.twinkling=!1};SNSRosterChatTab.headIdPrefix="snsim_chat_window_roster_tab_head_";SNSRosterChatTab.contentIdPrefix="snsim_chat_window_roster_tab_content_";SNSRosterChatTab.headTemplate='<li id="'+SNSRosterChatTab.headIdPrefix+'##{{roster.getID()}}" title="##{{roster.name}}" class="snsim_tab_head"><div class="list_head_item"><div class="list_head_state"><span class="snsim_roster_presence W_chat_stat snsim_##{{roster.presence.status}}"></span></div><div class="snsim_username">##{{roster.name}}<span class="wbim_icon_vf"></span></div><a hidefloat="true" class="snsim_chat_window_tab_close_btn"></a><span class="unread_msg_num">0</span></div></li>';
SNSRosterChatTab.contentTemplate='<div id="'+SNSRosterChatTab.contentIdPrefix+'##{{roster.getID()}}" class="snsim_tab_content snsim_dia_list"><div class="sns_message_container cur"><div class="snsim_message_box_container sns_message_panel"></div></div></div>';SNSRosterChatTab.prototype=new SNSTab;SNSRosterChatTab.prototype._init=function(a){};SNSRosterChatTab.prototype.scrollToTop=function(){this.getMessageContainer().scrollTop(0)};
SNSRosterChatTab.prototype.scrollToBottom=function(){this.getMessageContainer().scrollTop(this.getMessageContainer()[0].scrollHeight+300)};SNSRosterChatTab.prototype.scrollContent=function(){this.getMessageContainer().perfectScrollbar({suppressScrollX:!0,wheelPropagation:!0})};SNSRosterChatTab.prototype.getMessageContainer=function(){return this.getContentDom().find(".sns_message_container")};SNSRosterChatTab.prototype.getHeadTemplate=function(){return SNSRosterChatTab.headTemplate};
SNSRosterChatTab.prototype.getContentTemplate=function(){return SNSRosterChatTab.contentTemplate};SNSRosterChatTab.prototype.getCloseBtnDom=function(){var a=this.getHeadDom().find(".snsim_chat_window_tab_close_btn");if(0<a.length)return a};SNSRosterChatTab.prototype.addMsgRemind=function(){this.getHeadDom().find(".unread_msg_num").text(parseInt(this.getHeadDom().find(".unread_msg_num").text())+1);this.getHeadDom().addClass("snsim_active")};
SNSRosterChatTab.prototype.removeMsgRemind=function(){this.getHeadDom().find(".unread_msg_num").text(0);this.getHeadDom().removeClass("snsim_active")};
SNSRosterChatTab.prototype.addMessage=function(a){var b;b=a instanceof SNSOutMessage?new SNSSentMessageBox(a):new SNSReceivedMessageBox(a);a.from&&a.from.id==YYIMChat.getUserID()?b=new SNSSentMessageBox(a):a.to&&a.to.id==YYIMChat.getUserID()&&(b=new SNSReceivedMessageBox(a));var c=b.getHtml();this.getContentDom().find(".snsim_message_box_container").append(c);45E3>a.body.dateline-this.lastMessageDateline&&b.getDom().find(".dia_info").css("display","none");b.show();this.scrollToBottom();this.lastMessageDateline=
a.body.dateline};SNSRosterChatTab.prototype.getTarget=function(){return this.roster};var SNSChatRoomChatTab=function(a){this.name=a.id;this.chatroom=a;this.tabContainer=new SNSInnerChatTabContainer(a);this.closeable=!0;this.headSelector="#"+SNSChatRoomChatTab.headIdPrefix+a.getID();this.contentSelector="#"+SNSChatRoomChatTab.contentIdPrefix+a.getID()};SNSChatRoomChatTab.headIdPrefix="snsim_chat_window_inner_tab_head_";SNSChatRoomChatTab.contentIdPrefix="snsim_chat_window_inner_tab_content_";
SNSChatRoomChatTab.headTemplate='<li id="'+SNSChatRoomChatTab.headIdPrefix+'##{{chatroom.getID()}}" title="##{{chatroom.name}}" class="snsim_tab_head"><div class="list_head_item"><div class="list_head_state" style="margin-left: 12px;margin-right: 2px;"><span class="snsim_roster_presence W_chat_stat snsim_chatroom"></span></div><div class="snsim_username">##{{chatroom.name}}<span class="wbim_icon_vf"></span></div><a hidefloat="true" class="snsim_chat_window_tab_close_btn"></a></div></li>';
SNSChatRoomChatTab.contentTemplate='<div id="'+SNSChatRoomChatTab.contentIdPrefix+'##{{chatroom.getID()}}"  class="snsim_tab_content snsim_tab_content_container snsim_dia_list snsim_dia_chatroom_list" ><div class="snsim_tab sns_chat_inner_tab"><ul class="snsim_tab_head_container tab_list clearfix"><li id="snsim_tab_head_message_##{{chatroom.getID()}}" title="\u7fa4\u6d88\u606f" class="snsim_tab_head snsim_tab_head_message cur"><a class="snsim_dia_chatroom_tab_head"><span class="snsim_message_tab_icon"></span><span class="snsim_tab_title">\u7fa4\u6d88\u606f</span> </a></li></ul></div><div id="snsim_tab_content_message_##{{chatroom.getID()}}" class="snsim_tab_content snsim_tab_content_message sns_message_container cur"><div class="snsim_message_box_container sns_message_panel"></div></div><div id="snsim_tab_content_share_##{{chatroom.getID()}}" class="snsim_tab_content snsim_tab_content_share sns_share_container"><div class="sns_share_panel"><div class="snsim_share_panel_head"><span>\u5171<span class="snsim_share_file_num">0</span>\u4e2a\u6587\u4ef6</span><a id="snsim_share_file_refresh_btn" class="snsim_share_file_refresh_btn"><span class="refresh_icon"></span></a></div><div id="snsim_sharefile_box" class="snsim_sharefile_box"><ul class="snsim_sharefile_container"></ul></div></div></div></div>';
SNSChatRoomChatTab.prototype=new SNSRosterChatTab;SNSChatRoomChatTab.prototype._init=function(){YYIMChat.log("SNSChatRoomChatTab.prototype._init ",3);this.tabContainer._init();var a=new SNSInnerMessageTab(this.chatroom);this.tabContainer.addTab(a);a=new SNSInnerShareTab(this.chatroom);this.tabContainer.addTab(a);a=new SNSInnerAppTab(this.chatroom);this.tabContainer.addTab(a)};SNSChatRoomChatTab.prototype.getHeadTemplate=function(){return SNSChatRoomChatTab.headTemplate};
SNSChatRoomChatTab.prototype.getContentTemplate=function(){return SNSChatRoomChatTab.contentTemplate};SNSChatRoomChatTab.prototype.getTarget=function(){return this.chatroom};var SNSDeviceRosterChatTab=function(a){this.name=(this.roster=a)?a.getID():"";this.headSelector=a?"#"+SNSDeviceRosterChatTab.headIdPrefix+a.getID():"";this.contentSelector=a?"#"+SNSDeviceRosterChatTab.contentIdPrefix+a.getID():""};SNSDeviceRosterChatTab.headIdPrefix="snsim_chat_window_device_tab_head_";
SNSDeviceRosterChatTab.contentIdPrefix="snsim_chat_window_device_tab_content_";SNSDeviceRosterChatTab.headTemplate='<li id="'+SNSDeviceRosterChatTab.headIdPrefix+'##{{roster.getID()}}" title="##{{roster.name}}" class="snsim_tab_head"><div class="list_head_item"><div class="list_head_state"><span class="snsim_roster_presence W_chat_stat snsim_##{{roster.presence.status}}"></span></div><div class="snsim_username">##{{roster.name}}<span class="wbim_icon_vf"></span></div><a hidefloat="true" class="snsim_chat_window_tab_close_btn"></a></div></li>';
SNSDeviceRosterChatTab.contentTemplate='<div id="'+SNSDeviceRosterChatTab.contentIdPrefix+'##{{roster.getID()}}" class="snsim_tab_content snsim_dia_list"><div class="sns_message_container cur"><div class="snsim_message_box_container sns_message_panel"></div></div></div>';SNSDeviceRosterChatTab.prototype=new SNSRosterChatTab;SNSDeviceRosterChatTab.prototype.getHeadTemplate=function(){return SNSDeviceRosterChatTab.headTemplate};SNSDeviceRosterChatTab.prototype.getContentTemplate=function(){return SNSDeviceRosterChatTab.contentTemplate};
var SNSIFrameChatTab=function(a,b){this.type="iframeChatTab";this.name=a;this.url=b;this.headSelector="#"+SNSIFrameChatTab.idPrefix+"head_"+a;this.contentSelector="#"+SNSIFrameChatTab.idPrefix+"content_"+a;this.iframePanel=new SNSIFrameFloatPanel(b,a,410,377);this.closeable=!0};SNSIFrameChatTab.idPrefix="snsim_iframe_chat_tab_";SNSIFrameChatTab.headTemplate='<li id="'+SNSIFrameChatTab.idPrefix+'head_##{{name}}" title="##{{name}}" class="snsim_tab_head"><div class="list_head_item"><div class="list_head_state"><span class="snsim_roster_presence W_chat_stat snsim_##{{type}}"></span></div><div class="snsim_username">##{{name}}<span class="wbim_icon_vf"></span></div><a hidefloat="true" class="snsim_chat_window_tab_close_btn"></a></div></li>';
SNSIFrameChatTab.contentTemplate='<div id="'+SNSIFrameChatTab.idPrefix+'content_##{{name}}" class="snsim_tab_content snsim_dia_list"><div class="sns_message_container cur">##{{iframePanel.buildHtml()}}</div></div>';SNSIFrameChatTab.prototype=new SNSRosterChatTab;SNSIFrameChatTab.prototype.getHeadTemplate=function(){return SNSIFrameChatTab.headTemplate};SNSIFrameChatTab.prototype.getContentTemplate=function(){return SNSIFrameChatTab.contentTemplate};var SNSMiniChatWindow=function(){this.selector="#snsim_chat_window_mini"};
SNSMiniChatWindow.prototype=new SNSWindow;SNSMiniChatWindow.prototype._init=function(){this.getDom().bind("click",function(){SNSIMWindow.getInstance()._toggleMiniChatWindow()})};SNSMiniChatWindow.prototype.beforeShow=function(){var a=SNSIMWindow.getInstance().getChatWindow().getActiveRoster();this.setTitle(a.name)};SNSMiniChatWindow.prototype.setTitle=function(a){this.getDom().text(a)};
var SNSPublicRosterChatTab=function(a){this.name=a.jid.getBareJID();this.publicRoster=a;this.tabContainer=new SNSInnerChatTabContainer(a);this.closeable=!0;this.headSelector="#"+SNSPublicRosterChatTab.headIdPrefix+a.getID();this.contentSelector="#"+SNSPublicRosterChatTab.contentIdPrefix+a.getID()};SNSPublicRosterChatTab.prototype=new SNSRosterChatTab;SNSPublicRosterChatTab.headIdPrefix="snsim_chat_window_inner_tab_head_";SNSPublicRosterChatTab.contentIdPrefix="snsim_chat_window_inner_tab_content_";
SNSPublicRosterChatTab.headTemplate='<li id="'+SNSPublicRosterChatTab.headIdPrefix+'##{{publicRoster.getID()}}" title="##{{name}}" class="snsim_tab_head"><div class="list_head_item"><div class="list_head_state"><span class="snsim_roster_presence W_chat_stat snsim_chatroom"></span></div><div class="snsim_username">##{{publicRoster.name}}<span class="wbim_icon_vf"></span></div><a hidefloat="true" class="snsim_chat_window_tab_close_btn"></a></div></li>';
SNSPublicRosterChatTab.contentTemplate='<div id="'+SNSPublicRosterChatTab.contentIdPrefix+'##{{publicRoster.getID()}}" jid="##{{publicRoster.jid.getBareJID()}}" class="snsim_tab_content snsim_tab_content_container snsim_dia_list snsim_dia_chatroom_list" ><div class="snsim_tab sns_chat_inner_tab"><ul class="snsim_tab_head_container tab_list clearfix"><li id="snsim_tab_head_message_##{{publicRoster.getID()}}" title="\u6d41\u7a0b\u6d88\u606f" class="snsim_tab_head snsim_tab_head_message cur"><a href="javascript:void(0);" class="process_tab"><span class="snsim_icon_tab ">\u4efb\u52a1\u6d88\u606f</span> </a></li></ul></div><div id="snsim_tab_content_message_##{{publicRoster.getID()}}" class="snsim_tab_content snsim_tab_content_message sns_message_container cur"><div class="snsim_message_box_container sns_message_panel"></div></div></div>';
SNSPublicRosterChatTab.prototype=new SNSRosterChatTab;SNSPublicRosterChatTab.prototype._init=function(){YYIMChat.log("SNSPublicRosterChatTab.prototype._init ",3);this.tabContainer._init()};SNSPublicRosterChatTab.prototype.getHeadTemplate=function(){return SNSPublicRosterChatTab.headTemplate};SNSPublicRosterChatTab.prototype.getContentTemplate=function(){return SNSPublicRosterChatTab.contentTemplate};SNSPublicRosterChatTab.prototype.getTarget=function(){return this.publicRoster};
var SNSSystemRosterChatTab=function(a){this.name=(this.roster=a)?a.getID():"";this.headSelector=a?"#"+SNSSystemRosterChatTab.headIdPrefix+a.getID():"";this.contentSelector=a?"#"+SNSSystemRosterChatTab.contentIdPrefix+a.getID():""};SNSSystemRosterChatTab.headIdPrefix="snsim_chat_window_system_tab_head_";SNSSystemRosterChatTab.contentIdPrefix="snsim_chat_window_system_tab_content_";SNSSystemRosterChatTab.headTemplate='<li id="'+SNSSystemRosterChatTab.headIdPrefix+'##{{roster.getID()}}" title="##{{name}}" class="snsim_tab_head"><div class="list_head_item"><div class="list_head_state"><span class="snsim_roster_presence W_chat_stat snsim_system_roster"></span></div><div class="snsim_username">##{{roster.name}}<span class="wbim_icon_vf"></span></div><a hidefloat="true" class="snsim_chat_window_tab_close_btn"></a></div></li>';
SNSSystemRosterChatTab.contentTemplate='<div id="'+SNSSystemRosterChatTab.contentIdPrefix+'##{{roster.getID()}}" class="snsim_tab_content snsim_dia_list"><div class="sns_message_container cur"><div class="snsim_message_box_container sns_message_panel"></div></div></div>';SNSSystemRosterChatTab.prototype=new SNSRosterChatTab;SNSSystemRosterChatTab.prototype.getHeadTemplate=function(){return SNSSystemRosterChatTab.headTemplate};SNSSystemRosterChatTab.prototype.getContentTemplate=function(){return SNSSystemRosterChatTab.contentTemplate};
var SNSMessageBox=function(){this.message;this.selector};SNSMessageBox.prototype=new SNSComponent;SNSMessageBox.prototype.showSendFailed=function(){};SNSMessageBox.prototype.getHtml=function(){return TemplateUtil.genHtml(this.getTemplate(),this.message)};SNSMessageBox.prototype.getTemplate=function(){return""};SNSMessageBox.prototype.show=function(){if(!this.visible()){var a=this.getDom();this.beforeShow();a.show("fast")}this.afterShow()};
SNSMessageBox.prototype.afterShow=function(){SNSApplication.getInstance().getGlobalEventManager().trigger(SNS_EVENT_SUBJECT.AFTER_MESSAGE_SHOW,[this.message]);YYIMChat.log("trigger",SNS_EVENT_SUBJECT.AFTER_MESSAGE_SHOW)};var SNSReceivedMessageBox=function(a){this.message;if(a&&a instanceof SNSMessage)this.message=a;else throw"SNSReceivedMessageBox: Constructor: invalid param: message:"+a;this.selector="#"+SNSReceivedMessageBox.ID_PREFIX+a.id};SNSReceivedMessageBox.ID_PREFIX="snsim_message_box_received_";
SNSReceivedMessageBox.prototype=new SNSMessageBox;SNSReceivedMessageBox.template='<div id="'+SNSReceivedMessageBox.ID_PREFIX+'##{{id}}" class="snsim_message_box_received snsim_dia_box snsim_dia_l"><div class="dia_info"><span class="info_date">##{{getHumanizeDateString()}}</span></div><div style="margin:10px 0 0 10px;" class="clearfix"><p style="color:#b3b3b3;">##{{getRoster().name}}</p><img style="border-radius:30px; width:35px;height:35px;float:left;" src="##{{getRoster().getPhotoUrl()}}"/><div class="snsim_dia_bg"><div class="dia_txt">##{{getBodyHtml()}}</div><div class="msg_arr"></div></div></div></div>';
SNSReceivedMessageBox.prototype.getTemplate=function(){return SNSReceivedMessageBox.template};var SNSSentMessageBox=function(a){this.message;if(a&&a instanceof SNSMessage)this.message=a;else throw"SNSReceivedMessageBox: Constructor: invalid param: message:"+a;this.selector="#snsim_message_box_sent_"+a.id};SNSSentMessageBox.prototype=new SNSMessageBox;SNSSentMessageBox.template='<div id="snsim_message_box_sent_##{{id}}" style="margin:10px 0 0 0" class="nsim_message_box_sent snsim_dia_box snsim_dia_r clearfix"><div class="dia_info"><span class="info_date" action-data="##{{body.dateline}}">##{{getHumanizeDateString()}}</span></div><div class="snsim_dia_bg W_fr"><div class="dia_con"><div class="dia_txt">##{{getBodyHtml()}}</div></div><div class="msg_arr"></div></div><div class="sns_message_status W_fr" style="top: 26px; position: relative;"></div></div>';
SNSSentMessageBox.prototype.getTemplate=function(){return SNSSentMessageBox.template};var SNSUnreadMessagePanel=function(){this.selector="#snsim_unread_message_panel";this.containerSelector=this.selector+" ul";this.ignoreAllBtnSelector="#ignore_all";this.checkAllBtnSelector="#check_all";this.indicator="#snsim_unread_message_indicator";this.messageTemplate='<li rosterId="##{{getRosterOrChatRoom().getID()}}" style="cursor: pointer;"><div class="name_content"><div style="display:block;margin-top: 12px;">##{{getRosterOrChatRoom().name}}</div><div class="remind_message_content">##{{body.content}}</div></div><span class="remind_message_num">1</span></li>'};
SNSUnreadMessagePanel.prototype=new SNSFloatPanel;
SNSUnreadMessagePanel.prototype._init=function(){SNSApplication.getInstance().getGlobalEventManager().registerEventHandler(SNS_EVENT_SUBJECT.ON_MESSAGE_IN,!0,this.onMessageIn,this);SNSApplication.getInstance().getGlobalEventManager().registerEventHandler(SNS_EVENT_SUBJECT.ON_CURRENT_CHAT_CHANGE,!0,this.onChatTabChange,this);jQuery(this.indicator).bind("mouseenter",jQuery.proxy(function(){var a=this.getContainerDom().find("li");a&&0<a.length&&this.show()},this));jQuery(this.indicator).bind("mouseleave",
jQuery.proxy(function(){var a=!1;this.getDom().bind("mouseenter",jQuery.proxy(function(){a=!0;this.show()},this));this.getDom().bind("mouseleave",jQuery.proxy(function(){a=!0;this.hide()},this));setTimeout(jQuery.proxy(function(){a||this.hide()},this),200)},this));jQuery(this.indicator).bind("click",jQuery.proxy(function(){SNSIMWindow.getInstance().getChatWindow().openChatWith(SNSApplication.getInstance().getUser().systemRoster.getID())},this));jQuery(this.ignoreAllBtnSelector).bind("click",jQuery.proxy(function(){this.ignoreAllMsg()},
this));jQuery(this.checkAllBtnSelector).bind("click",jQuery.proxy(function(){this.checkAllMsg()},this))};SNSUnreadMessagePanel.prototype.onMessageIn=function(a,b){var c=b.message,d=c.getRosterOrChatRoom();(d=SNSIMWindow.getInstance().getChatWindow().getTab(d))&&d.isHeadVisible()||this.renderUnreadMessage(c)};SNSUnreadMessagePanel.prototype.onChatTabChange=function(a,b){var c=b.newValue.getTarget().id;this.getContainerDom().find("li[id='"+c+"']");this.removeUnreadMessage(c)};
SNSUnreadMessagePanel.prototype.renderUnreadMessage=function(a){var b=a.getRosterOrChatRoom(),c=b.getID(),b=a.to.id==YYIMChat.getUserID()?a.chatroom||a.from:a.to,c=b.id,d=this.getContainerDom().find("li[rosterId='"+c+"']"),e;e="groupchat"==a.type?SNSIMWindow.getInstance().getWideWindow().getTab("chatroom"):SNSIMWindow.getInstance().getWideWindow().getTab("roster");d&&0<d.length?(c=parseInt(d.find(".remind_message_num").text()),d.find(".remind_message_num").text(c+1),d.find(".remind_message_content").text(a.body.content),
e.renderUnreadMsgNum(b,c+1)):(a=TemplateUtil.genHtml(this.messageTemplate,a),this.getContainerDom().append(a),this._bindClickEvent(c),this.updateUnreadMessageIndicator(),e.renderUnreadMsgNum(b,1))};
SNSUnreadMessagePanel.prototype._bindClickEvent=function(a){this.getContainerDom().find("li[rosterId='"+a+"']").bind("click",{self:this,rId:a},function(a){var c=a.data.self,d=a.data.rId,e=SNSApplication.getInstance().getUser();e.getRosterOrChatRoom(d)||e.rosterList.add(new SNSRoster(d));SNSIMWindow.getInstance().getChatWindow().openChatWith(a.data.rId);c.removeUnreadMessage(d)})};
SNSUnreadMessagePanel.prototype.beforeShow=function(){var a=this.getDom(),b=jQuery(this.indicator).offset(),c=this.getContainerDom().find("li").length;4<c?c=4:null;a.css("top",b.top-30-66*c);a.css("left",b.left-62)};
SNSUnreadMessagePanel.prototype.removeUnreadMessage=function(a){this.getContainerDom().find("li[rosterId='"+a+"']").remove();this.updateUnreadMessageIndicator();a=SNSApplication.getInstance().getUser().getRosterOrChatRoom(a);(a instanceof SNSChatRoom?SNSIMWindow.getInstance().getWideWindow().getTab("chatroom"):SNSIMWindow.getInstance().getWideWindow().getTab("roster")).clearUnreadMsgNum(a);(a=this.getContainerDom().find("li"))&&0!=a.length||this.hide()};
SNSUnreadMessagePanel.prototype.updateUnreadMessageIndicator=function(){var a=this.getContainerDom().find("li");a&&0!=a.length?(jQuery(this.indicator).find("span").addClass("unread_system_messages"),jQuery(this.indicator).removeClass("system_messages_bg")):(jQuery(this.indicator).find("span").removeClass("unread_system_messages"),jQuery(this.indicator).addClass("system_messages_bg"))};
SNSUnreadMessagePanel.prototype.ignoreAllMsg=function(){for(var a=this.getContainerDom().find("li"),b=SNSApplication.getInstance().getUser(),c=0;c<a.length;c++){var d=jQuery(a[c]).attr("rosterId");b.getRosterOrChatRoom(d);this.removeUnreadMessage(d);SNSApplication.getInstance().getMessageInBox().popUnreadMessageByRoster(b.getRosterOrChatRoom(d))}};SNSUnreadMessagePanel.prototype.checkAllMsg=function(){for(var a=this.getContainerDom().find("li"),b=0;b<a.length;b++)jQuery(a[b]).trigger("click")};
var SNSCreateChatroomPanel=function(){this.triggerSelector=".snsim_create_chatroom_btn";this.selector=".sns_chatroom_name_div";this.submitBtn=".sns_chatroom_name_btn";this.inputBox=".sns_chatroom_name_input";this.hideFloat=SNSComponent.HIDE_TYPE.HIDE_IGNORE_SELF};SNSCreateChatroomPanel.prototype=new SNSComponent;
SNSCreateChatroomPanel.prototype._init=function(){jQuery(this.triggerSelector).bind("click",jQuery.proxy(function(a){jQuery(this.selector).toggle()},this));jQuery(this.inputBox).bind("keydown",jQuery.proxy(function(a){a.keyCode==SNS_KEY_CODE.ENTER&&jQuery(this.submitBtn).trigger("click")},this));jQuery(this.submitBtn).on("click",jQuery.proxy(function(){var a=jQuery(this.inputBox).val().substr(0,8);if(a.notEmpty()){var b=Math.uuid().replace(/\-/g,"").toLowerCase().substr(0,8);YYIMChat.addChatGroup({name:a,
node:b,success:jQuery.proxy(function(a){a=SNSApplication.getInstance().getUser().chatRoomList.createRoomHandler(a);SNSIMWindow.getInstance().getChatWindow().openChatWith(a);this.hide()},this)});jQuery(this.inputBox).val("")}},this));SNSComponent.prototype._init.call(this)};var SNSInnerAppTab=function(a){this.name="app";this.headSelector="#snsim_tab_head_app_"+a.getID();this.contentSelector="#snsim_tab_content_app_"+a.getID()};SNSInnerAppTab.prototype=new SNSTab;
SNSInnerAppTab.prototype._init=function(){YYIMChat.log("SNSInnerAppTab.prototype._init",3)};var SNSInnerChatTabContainer=function(a){this.roster=a;this.tabs=new SNSTabList;this.headContainerSelector="#snsim_chat_window_inner_tab_content_"+a.getID()+" .snsim_tab_head_container";this.contentContainerSelector="#snsim_chat_window_inner_tab_content_"+a.getID()+".snsim_tab_content_container"};SNSInnerChatTabContainer.prototype=new SNSTabContainer;
SNSInnerChatTabContainer.prototype._init=function(){YYIMChat.log("SNSInnerChatTabContainer.prototype._init ",3)};var SNSInnerMessageTab=function(a){this.name="message";this.headSelector="#snsim_tab_head_message_"+a.getID();this.contentSelector="#snsim_tab_content_message_"+a.getID()};SNSInnerMessageTab.prototype=new SNSTab;SNSInnerMessageTab.prototype._init=function(){YYIMChat.log("SNSInnerMessageTab.prototype._init ",3)};
var SNSInnerShareTab=function(a){this.name="share";this.chatroom=a;this.headSelector="#snsim_tab_head_share_"+a.getID();this.contentSelector="#snsim_tab_content_share_"+a.getID();this.containerSelector=this.contentSelector+" .snsim_sharefile_container";this.fileBoxSelector=".snsim_sharefile_box";this.refreshBtn=".snsim_share_file_refresh_btn";this.fileNumSelector=".snsim_share_file_num"};SNSInnerShareTab.fileTemplate='<li><div style="display: inline-block; margin-top: 7px;vertical-align: top;"><img width="24" height="28" src="res/skin/default/icons/filetype/##{{type}}.png"></div><div class="snsim_file_info"><span class="name">##{{name}}</span><span class="size">##{{renderSize()}}</span><span class="creator"> ##{{creator}}</span><span class="time"> ##{{time}}</span></div><a class="download_btn" style="margin-top:13px;" href="##{{path}}" target="_blank"><span class="download_icon"></span><span class="download_info"></span></a></li>';
SNSInnerShareTab.noFileTips="<span>\u5f53\u524d\u7fa4\u7ec4\u6ca1\u6709\u88ab\u5171\u4eab\u7684\u6587\u4ef6\u3002</span>";SNSInnerShareTab.prototype=new SNSTab;
SNSInnerShareTab.prototype._init=function(){YYIMChat.log("SNSInnerShareTab.prototype._init ",3);this.getContentDom().find(this.fileBoxSelector).perfectScrollbar({suppressScrollX:!0});this.getContentDom().find(this.refreshBtn).bind("click",jQuery.proxy(function(){jQuery.when(this.chatroom.fileList.requestSharedFiles()).done(jQuery.proxy(this.showFiles,this))},this))};
SNSInnerShareTab.prototype.beforeSelect=function(){var a=this.chatroom.fileList;a.hasRequested()?0<a.getList().length&&this.getContainerDom().html().isEmpty()&&this.showFiles():jQuery.when(a.requestSharedFiles()).done(jQuery.proxy(this.showFiles,this))};
SNSInnerShareTab.prototype.showFiles=function(){this.getContainerDom().empty();var a=this.chatroom.fileList.getList();this.getContentDom().find(this.fileNumSelector).text(a.length);if(0!=a.length)for(var b in a){var c=a[b];c&&c instanceof SNSChatRoomFile&&this.addShareFile(c)}};SNSInnerShareTab.prototype.addShareFile=function(a){a=TemplateUtil.genHtml(SNSInnerShareTab.fileTemplate,a);jQuery(this.containerSelector).prepend(a)};
var SNSMemberListPanel=function(){this.selector="#chatroom_member_list";this.triggerSelector="#show_chatroom_members";this.rosterListContainerSelector="ul";this.closeBtnSelector=".close_btn";this.memberLsitContentSelector=".member_list_content";this.destoryChatRoomSelector=".destory";this.quitChatRoomSelector=".quit";this.modifyNickNameSelector=".rename";this.delRosterBtnSelector=".del-btn";this.chatroomNameSelector=".chatroom_info .chatroom_name";this.chatroomPhotoUrlSelector=".chatroom_info img";
this.nickNameInputSelector=".snsim_members_info";this.modifyNickNameBtnSelector=".snsim_modify_nickname_btn";this.memberItemIdPrefix="member_item_";this.template='<li id="'+this.memberItemIdPrefix+'##{{getID()}}" rosterId="##{{getID()}}"><div><img class="head_icon" src="##{{getPhotoUrl()}}"><div class="snsim_members_info" contenteditable="false">##{{name}}</div><span class="snsim_modify_nickname_btn hide">\u786e\u5b9a</span></div><div><div class="snsim_members_mail">##{{getID()}}</div></div><div><div style="float: right;margin-right: 25px;margin-top: -15px;"><a title="\u5220\u9664" class="del-btn" style="color:#df1a00;">\u5220\u9664</a></div></div></li>'};
SNSMemberListPanel.prototype=new SNSFloatPanel;SNSMemberListPanel.isOdd=!0;SNSMemberListPanel.prototype._init=function(){this.getDom().find(this.memberLsitContentSelector).perfectScrollbar({suppressScrollX:!0});this._bindDomEvent();SNSFloatPanel.prototype._init.call(this)};SNSMemberListPanel.prototype.show=function(){var a=jQuery(this.triggerSelector).offset();this.getDom().css("top",a.top-34);this.getDom().css("left",a.left-134);this.renderMemberList();SNSFloatPanel.prototype.show.call(this)};
SNSMemberListPanel.prototype.renderMemberList=function(){var a=SNSIMWindow.getInstance().getChatWindow().getActiveRoster();this.getDom().find(this.chatroomNameSelector).text(a.name);this.getDom().find(this.chatroomPhotoUrlSelector).attr("src",a.getPhotoUrl());this.getDom().find(this.rosterListContainerSelector).html("");if(a instanceof SNSChatRoom)if(!a.rosterList._size||1>a.rosterList._size||!a.memberListQueryed)YYIMChat.getGroupMembers({id:a.getID(),success:jQuery.proxy(function(b){a.queryMembersHandler(b);
b=a.rosterList._list;for(var c in b)this.getDom().find(this.rosterListContainerSelector).append(TemplateUtil.genHtml(this.template,b[c])),SNSMemberListPanel.isOdd?(this.getDom().find("#"+this.memberItemIdPrefix+b[c].getID()).addClass("odd"),SNSMemberListPanel.isOdd=!1):SNSMemberListPanel.isOdd=!0;this.bindMembersOperation()},this)});else{var b=a.rosterList._list,c;for(c in b)this.getDom().find(this.rosterListContainerSelector).append(TemplateUtil.genHtml(this.template,b[c])),SNSMemberListPanel.isOdd?
(this.getDom().find("#"+this.memberItemIdPrefix+b[c].getID()).addClass("odd"),SNSMemberListPanel.isOdd=!1):SNSMemberListPanel.isOdd=!0;this.bindMembersOperation()}};
SNSMemberListPanel.prototype.bindMembersOperation=function(){var a=this.getDom().find("#"+this.memberItemIdPrefix+SNSApplication.getInstance().getUser().getID());a.find(this.modifyNickNameBtnSelector).bind("click",jQuery.proxy(function(a){this.modifyNickName(a)},this));a.find(this.nickNameInputSelector).bind("keydown",{_self:this},function(a){a.keyCode==SNS_KEY_CODE.ENTER&&(jQuery(this).blur(),jQuery(this).siblings(a.data._self.modifyNickNameBtnSelector).trigger("click"))})};
SNSMemberListPanel.prototype._bindDomEvent=function(){this.getDom().find(this.quitChatRoomSelector).bind("click",jQuery.proxy(function(){YYIMChat.quitChatGroup(SNSIMWindow.getInstance().getChatWindow().getActiveRoster().getID());this.getDom().hide()},this));this.getDom().find(this.modifyNickNameSelector).bind("click",jQuery.proxy(function(){SNSIMWindow.getInstance().getChatWindow().getActiveRoster();"true"==this.getDom().find("#"+this.memberItemIdPrefix+SNSApplication.getInstance().getUser().getID()+
" "+this.nickNameInputSelector).attr("contenteditable")?this.renderModifyNickName(!1):this.renderModifyNickName(!0)},this));this.getDom().find(this.destoryChatRoomSelector).bind("click",jQuery.proxy(function(){SNSIMWindow.getInstance().getChatWindow().getActiveRoster().destory()},this));this.getDom().on("click",this.delRosterBtnSelector,function(a){var b=SNSIMWindow.getInstance().getChatWindow().getActiveRoster().getID(),c=jQuery(a.target).closest("li");a=jQuery(a.target).closest("li").attr("rosterid");
YYIMChat.delGroupMember(b,a,function(a){c.remove()})});SNSFloatPanel.prototype._bindDomEvent.call(this)};SNSMemberListPanel.prototype.modifyNickName=function(a){var b=jQuery(a.target);a=jQuery(a.target).siblings(this.nickNameInputSelector).text();jQuery.when(SNSIMWindow.getInstance().getChatWindow().getActiveRoster().modifyNickName(b.parents("tr").attr("rosterId"),a)).done(jQuery.proxy(function(){this.renderModifyNickName(!1)},this))};
SNSMemberListPanel.prototype.renderModifyNickName=function(a){var b=this.getDom().find("#"+this.memberItemIdPrefix+SNSApplication.getInstance().getUser().getID()+" "+this.nickNameInputSelector);a?(b.addClass("cur"),b.siblings(this.modifyNickNameBtnSelector).removeClass("hide"),b.attr("contenteditable","true")):(b.removeClass("cur"),b.siblings(this.modifyNickNameBtnSelector).addClass("hide"),b.attr("contenteditable","false"))};
var SNSInvitationWindow=function(a){this.currentChatroom;this.selector="#snsim_invite_window";this.closeBtnSelector="#snsim_invite_window .invite_window_close";this.invitationSubmitBtnSelector="#snsim_invite_footer .submit_btn";this.invitationCancelBtnSelector="#snsim_invite_footer .cancel_btn";this.currentChatroomHeadSelector="#sns_invite_chatroom_head_icon";this.currentChatroomNameSelector="#sns_invite_chatroom_name";this.tabContainer=new SNSInviteTabContainer;this.inviteFromRosterTab;this.inviteFromOrgTab;
this.inviteFromSearchPanel=new SNSInviteFromSearchPanel;this.selectedListPanel=new SNSSelectedListPanel;this.maskOthers=!0};SNSInvitationWindow.prototype=new SNSFloatPanel;SNSInvitationWindow.prototype._init=function(){SNSFloatPanel.prototype._init.call(this);this.tabContainer._init();this.inviteFromRosterTab=new SNSInviteFromRosterTab;this.tabContainer.addTab(this.inviteFromRosterTab);this.inviteFromOrgTab=new SNSInviteFromOrgTab;this.tabContainer.addTab(this.inviteFromOrgTab);this._bindInvitationEvent()};
SNSInvitationWindow.prototype._bindInvitationEvent=function(){jQuery(this.invitationSubmitBtnSelector).on("click",jQuery.proxy(function(){var a=this.selectedListPanel.list._list,b=[],c;for(c in a)b.push(a[c].getID());YYIMChat.addGroupMember({roomId:this.currentChatroom.getID(),ids:b});this.hide()},this));jQuery(this.invitationCancelBtnSelector).on("click",jQuery.proxy(function(){jQuery(this.closeBtnSelector).trigger("click")},this));jQuery(this.closeBtnSelector).on("click",jQuery.proxy(this.hide,
this))};SNSInvitationWindow.prototype.show=function(a){this.currentChatroom=SNSApplication.getInstance().getUser().getRosterOrChatRoom(a);jQuery(this.currentChatroomHeadSelector).attr("src",this.currentChatroom.getPhotoUrl());jQuery(this.currentChatroomNameSelector).text(this.currentChatroom.name);this.inviteFromRosterTab.show();SNSFloatPanel.prototype.show.call(this)};
SNSInvitationWindow.prototype.selectToInvite=function(a){var b=jQuery(a).attr("rosterId");a=jQuery(a).attr("name");var c=SNSApplication.getInstance().getUser().getRoster(b);c||(c=new SNSRoster(b,a));SNSIMWindow.getInstance().getInvitationWindow().selectedListPanel.add(c)};
var SNSInviteFromOrgTab=function(){this.name="inviteFromOrg";this.headSelector="#snsim_tab_head_invite_from_org";this.contentSelector="#snsim_tab_content_invite_from_org";this.ztreeSelector="#invite_from_org_tree";this.ztree;this.zTreeSetting={data:{simpleData:{enable:!0}},view:{nameIsHTML:!0,showLine:!1,showTitle:!1},callback:{onExpand:jQuery.proxy(this.onNodeExpand,this)}};this.operationMenuTemplate='##{{name}} <span jid="##{{jid}}" class="organization_list_opt" hidefloat="true" style="display:none;"></span>'};
SNSInviteFromOrgTab.prototype=new SNSTab;SNSInviteFromOrgTab.prototype._init=function(){YYIMChat.log("SNSInviteFromOrgTab.prototype._init",3);jQuery(this.contentSelector).perfectScrollbar();SNSTab.prototype._init.call(this)};SNSInviteFromOrgTab.prototype.beforeSelect=function(){this.ztree||this.loadRootNode()};
SNSInviteFromOrgTab.prototype.loadRootNode=function(){var a=new JSJaCIQ;a.setType(SNS_TYPE.GET);a.setTo("1@org."+SNSApplication.getInstance().getDomain());var b=a.buildNode("query",{xmlns:NS_ORGANIZATION});a.appendNode(b);YYIMChat.send(a,jQuery.proxy(function(a){if(a.isError())YYIMChat.log("SNSInviteFromOrgTab.prototype.loadNodeByParent ",0);else{var b=[],e=[];a=jQuery(a.doc.xml).find("item[id]");for(var h=0;h<a.length;h++){var s=jQuery(a[h]),u={};u.id=s.attr("id");u.name=s.attr("name");var t=s.attr("isUser");
"false"==s.attr("isLeaf")?(u.isParent=!0,u.iconSkin="department"):u.isParent=!1;"true"==t&&(u.iconSkin="person",u.name=this.getOperationHtml(u),u.click="SNSIMWindow.getInstance().getInvitationWindow().selectToInvite('"+s.attr("id")+"','"+s.attr("name")+"')");e.push(u);b.push({id:u.id,name:u.name,open:!1,isParent:u.isParent,iconSkin:u.iconSkin})}this.ztree=jQuery.fn.zTree.init(jQuery(this.ztreeSelector),this.zTreeSetting,b)}},this))};
SNSInviteFromOrgTab.prototype.loadNodeByParent=function(a){if(!a.loaded&&!a.loading){this.addLoadingNode(a);a.loading=!0;var b=new JSJaCIQ;b.setType(SNS_TYPE.GET);b.setTo(a.id+"@org."+SNSApplication.getInstance().getDomain());var c=b.buildNode("query",{xmlns:NS_ORGANIZATION});b.appendNode(c);YYIMChat.send(b,jQuery.proxy(function(b,c){if(b.isError())YYIMChat.log("SNSInviteFromOrgTab.prototype.loadNodeByParent ",0,c);else{for(var h=[],s=jQuery(b.doc.xml).find("item[id]"),u=0;u<s.length;u++){var t=jQuery(s[u]),
v={};v.id=t.attr("id");v.name=t.attr("name");var Q=t.attr("isUser");"false"==t.attr("isLeaf")?(v.isParent=!0,v.iconSkin="department"):v.isParent=!1;"true"==Q&&(v.iconSkin="person",v.name=this.getOperationHtml(v),v.click="SNSIMWindow.getInstance().getInvitationWindow().selectToInvite('"+t.attr("id")+"','"+t.attr("name")+"')");h.push(v)}a.loaded=!0;a.loading=!1;this.ztree.addNodes(c.parent,h);this.removeLoadingNode(c.parent)}},this),{parent:a})}};
SNSInviteFromOrgTab.prototype.onNodeExpand=function(a,b,c){this.loadNodeByParent(c)};SNSInviteFromOrgTab.prototype.addLoadingNode=function(a){var b={};b.id=Math.round(1E3*Math.random())+1E3;b.iconSkin="loading";b.name="\u6b63\u5728\u52a0\u8f7d...";this.ztree.addNodes(a,b,!1)};SNSInviteFromOrgTab.prototype.removeLoadingNode=function(a){a=this.ztree.getNodesByParam("iconSkin","loading",a);for(var b=0;b<a.length;b++)this.ztree.removeNode(a[b])};
SNSInviteFromOrgTab.prototype.getOperationHtml=function(a){return TemplateUtil.genHtml(this.operationMenuTemplate,{jid:a.id,name:a.name})};SNSInviteFromOrgTab.prototype.chatWithRoster=function(a,b){var c=new SNSRoster(a,b);SNSIMWindow.getInstance().getChatWindow().openChatWith(c)};
var SNSInviteFromRosterTab=function(){this.name="inviteFromRoster";this.headSelector="#snsim_tab_head_invite_from_roster";this.contentSelector="#snsim_tab_content_invite_from_roster";this.rosterListSelector="#snsim_invite_roster_List";this.groupInfoSelector=".group_info";this.groupToggleBtnSelector=".invite_window_group_name";this.addWholeGroupSelector=".add_whole_group";this.groupArraySelector=".group_arrow";this.rightArrowClass="group_arrow_right";this.bottomArrowClass="group_arrow_bottom";this.excludeGroups=
[SNSConfig.GROUP.GROUP_PUB_ACCOUNT,SNSConfig.GROUP.GROUP_DEVICE];this.rosterTemplate='<li rosterId="##{{getID()}}" name="##{{name}}" class="invite_from_roster_item" onclick="SNSIMWindow.getInstance().getInvitationWindow().selectToInvite(this)"><span class="user_name">##{{name}}</span></li>';this.groupTempalte='<div id="'+SNSInviteFromRosterTab.groupItemIdPrefix+'##{{name}}" style="margin-bottom: 14px;"><div class="group_info"><span class="group_arrow"></span><a class="invite_window_group_name" name="##{{name}}">##{{name}}</a><span class="add_whole_group hide" name="##{{name}}"></span></div><ul></ul></div>'};
SNSInviteFromRosterTab.groupItemIdPrefix="snsim_invite_group_item_";SNSInviteFromRosterTab.prototype=new SNSTab;SNSInviteFromRosterTab.getInstance=function(){return SNSInviteFromRosterTab._instance};SNSInviteFromRosterTab.prototype._init=function(){SNSInviteFromRosterTab._instance=this;jQuery(this.contentSelector).perfectScrollbar({suppressScrollX:!0});YYIMChat.log("SNSInviteFromRosterTab.prototype._init",3)};
SNSInviteFromRosterTab.prototype.getGroupIdSelector=function(a){return"#"+SNSInviteFromRosterTab.groupItemIdPrefix+a};SNSInviteFromRosterTab.prototype.show=function(){jQuery(this.rosterListSelector).empty();this.showRosterList()};
SNSInviteFromRosterTab.prototype.toggle=function(a,b){var c=jQuery(a.target).siblings(this.groupArraySelector),d=jQuery(this.getGroupIdSelector(b)+" ul");d.is(":visible")?(d.hide(),c.removeClass(this.bottomArrowClass),c.addClass(this.rightArrowClass)):(d.show(),c.removeClass(this.rightArrowClass),c.addClass(this.bottomArrowClass))};SNSInviteFromRosterTab.prototype.selectWholeGroup=function(a,b){jQuery(this.getGroupIdSelector(b)).find("ul li").trigger("click")};
SNSInviteFromRosterTab.prototype.showRosterList=function(){var a=SNSApplication.getInstance().getUser().getGroupList().toArray(),b;for(b in a){var c=a[b];c&&c instanceof SNSGroup&&this.showGroup(c)}};
SNSInviteFromRosterTab.prototype.showGroup=function(a){if(!YYIMChat.getArrayUtil().contains(this.excludeGroups,a.name)){jQuery(this.rosterListSelector).append(TemplateUtil.genHtml(this.groupTempalte,a));var b=SNSApplication.getInstance().getUser().getRosterListByGroup(a).toArray(),c;for(c in b)b[c]&&b[c]instanceof SNSRoster&&jQuery(this.getGroupIdSelector(a.name)+" ul").append(TemplateUtil.genHtml(this.rosterTemplate,b[c]));this.bindGroupEvent(a.name)}};
SNSInviteFromRosterTab.prototype.bindGroupEvent=function(a){jQuery(this.getGroupIdSelector(a)+" "+this.groupInfoSelector).bind("mouseenter",{groupName:a},jQuery.proxy(function(a){jQuery(this.getGroupIdSelector(a.data.groupName)+" "+this.addWholeGroupSelector).show()},this));jQuery(this.getGroupIdSelector(a)+" "+this.groupInfoSelector).bind("mouseleave",{groupName:a},jQuery.proxy(function(a){jQuery(this.getGroupIdSelector(a.data.groupName)+" "+this.addWholeGroupSelector).hide()},this));jQuery(this.getGroupIdSelector(a)+
" "+this.groupToggleBtnSelector).bind("click",jQuery.proxy(function(a){this.toggle(a,a.target.name)},this));jQuery(this.getGroupIdSelector(a)+" "+this.addWholeGroupSelector).bind("click",{groupName:a},jQuery.proxy(function(a){this.selectWholeGroup(a,a.data.groupName)},this))};
var SNSInviteFromSearchPanel=function(){this.selector="#snsim_invite_from_search";this.searchInputSelector="#snsim_invite_search_input";this.searchResultListSelector="#snsim_invite_search_result_list";this.searchResultContainerSelector="#invite_roster_list_box";this.searchResultTemplate='<li class="search_result_item" rosterId="##{{getID()}}" name="##{{name}}" onclick="SNSIMWindow.getInstance().getInvitationWindow().selectToInvite(this)"><span title="##{{name}}">##{{name}}</span></li>';this._init()};
SNSInviteFromSearchPanel.prototype=new SNSComponent;SNSInviteFromSearchPanel.getInstance=function(){if(SNSInviteFromSearchPanel._instance)return SNSInviteFromSearchPanel._instance};SNSInviteFromSearchPanel.prototype._init=function(){YYIMChat.log("SNSInviteFromOrgTab.prototype._init",3);SNSInviteFromSearchPanel._instance=this;jQuery(this.searchResultContainerSelector).perfectScrollbar({suppressScrollX:!0});this._bindDomEvent()};
SNSInviteFromSearchPanel.prototype._bindDomEvent=function(){jQuery(this.searchInputSelector).bind("keydown",jQuery.proxy(function(a){var b=jQuery(this.searchInputSelector).val();a.keyCode==SNS_KEY_CODE.ENTER&&(this.clearSearchResult(),YYIMChat.queryRosterItem({keyword:b,success:jQuery.proxy(this.showSearchResult,this)}))},this));jQuery(this.searchInputSelector).bind("keyup",jQuery.proxy(function(a){jQuery(this.searchInputSelector).val()||(this.getDom().find(this.searchResultContainerSelector).hide(),
SNSIMWindow.getInstance().getInvitationWindow().tabContainer.getDom().show())},this))};SNSInviteFromSearchPanel.prototype.showSearchResult=function(a){this.getDom().find(this.searchResultContainerSelector).show();SNSIMWindow.getInstance().getInvitationWindow().tabContainer.getDom().hide();a=a.items;for(var b=0;b<a.length;b++)a[b]=jQuery.extend(new SNSRoster(a[b].id),a[b]),jQuery(this.searchResultListSelector).append(TemplateUtil.genHtml(this.searchResultTemplate,a[b]))};
SNSInviteFromSearchPanel.prototype.clearSearchResult=function(){jQuery(this.searchResultListSelector).html("")};var SNSInviteTabContainer=function(a){this.selector="#snsim_invite_tab_content_container";this.headContainerSelector="#snsim_invite_window .snsim_tab_head_container";this.contentContainerSelector="#snsim_invite_tab_content_container"};SNSInviteTabContainer.prototype=new SNSTabContainer;
SNSInviteTabContainer.prototype._init=function(){YYIMChat.log("SNSInviteTabContainer.prototype._init ",3)};
var SNSSelectedListPanel=function(){this.selector="#snsim_selected_container";this.selectedListContainerSelector=".selected_list_container";this.selectedListSelector=".selected_list";this.selectedNumSelector=".selected_num";this.deleteBtnSelector=".delete_btn";this.list=new SNSBaseRosterList;this.itemTemplate='<li rosterId="##{{getID()}}"><img src="##{{getPhotoUrl()}}" class="head_icon"><span style="margin-left: 8px;vertical-align: top;" title="##{{name}}">##{{name}}</span><span class="remove_btn" onclick="SNSSelectedListPanel.getInstance().remove(\'##{{getID()}}\')">\u5220\u9664</span></li>';this._init()};
SNSSelectedListPanel.prototype=new SNSComponent;SNSSelectedListPanel.getInstance=function(){if(SNSSelectedListPanel._instance)return SNSSelectedListPanel._instance};SNSSelectedListPanel.prototype._init=function(){YYIMChat.log("SNSInviteMembersSelectedPanel.prototype._init",3);SNSSelectedListPanel._instance=this;this.getDom().find(this.selectedListContainerSelector).perfectScrollbar()};
SNSSelectedListPanel.prototype.add=function(a){a&&this.list.add(a)&&(this.getDom().find(this.selectedListSelector).append(TemplateUtil.genHtml(this.itemTemplate,a)),this.getDom().find(this.selectedNumSelector).text(this.list.size()))};SNSSelectedListPanel.prototype.remove=function(a){a&&(this.getDom().find(this.selectedListSelector+" li[rosterId='"+a+"']").remove(),this.list.remove(a),this.getDom().find(this.selectedNumSelector).text(this.list.size()))};
var SNSReconnectPanel=function(){this.selector="#snsim_list_relink";this.relinkCountDownPanel="#snsim_connecting_wait";this.relinkCountDownText="#snsim_relink_wait_seconds";this.connectingPanel="#snsim_relink_connecting";this.cancelConnectingBtn="#snsim_relink_cancel_connect";this.connectFailPanel="#snsim_relink_connecting_fail";this.connectBtn="#snsim_relink_connect_imm, #snsim_relink_reconnect_imm";this.reconnectTimer=SNSConfig.CONNECTION.RECONNECT_TIMER;this.reconnecting=!1};
SNSReconnectPanel.prototype=new SNSFloatPanel;SNSReconnectPanel.prototype._init=function(){SNSApplication.getInstance().getGlobalEventManager().registerEventHandler(SNS_EVENT_SUBJECT.CONNECT_FAILED,!1,this.startReconnectCount,this);SNSApplication.getInstance().getGlobalEventManager().registerEventHandler(SNS_EVENT_SUBJECT.AFTER_CONNECT,!0,this.onConnected,this);this._bindDomEvent()};
SNSReconnectPanel.prototype._bindDomEvent=function(){jQuery(this.connectBtn).bind("click",{self:this},function(a){a.data.self.reconnectImmedately();YYIMChat.getOfflineMessage()});jQuery(this.cancelConnectingBtn).bind("click",{self:this},function(a){a.data.self.cancelReconnect()})};
SNSReconnectPanel.prototype.startReconnectCount=function(a){YYIMChat.log("SNSConnectDaemon.prototype.startReconnectCount",2);!this.reconnecting&&a.errorCode&&401!=a.errorCode&&(this.reconnecting=!0,this.reconnectInterval=setInterval(jQuery.proxy(this._doReconnect,this),1E3))};
SNSReconnectPanel.prototype._doReconnect=function(){YYIMChat.log("SNSConnectDaemon.prototype._doReconnect ",2);0<this.reconnectTimer?(this.setCountDownNum(this.reconnectTimer--),this.showRelinkCountDown(),this.getDom().show()):this.reconnectImmedately()};SNSReconnectPanel.prototype.cancelReconnect=function(){clearInterval(this.reconnectInterval);this.showConnectFailedPanel()};SNSReconnectPanel.prototype.clearReconnectInterval=function(){clearInterval(this.reconnectInterval);this.reconnecting=!1};
SNSReconnectPanel.prototype.reconnectImmedately=function(){this.showRelinkPanel();YYIMChat.disConnect();YYIMChat.connect();clearInterval(this.reconnectInterval);this.reconnecting=!1;this.reconnectTimer=SNSConfig.CONNECTION.RECONNECT_TIMER};SNSReconnectPanel.prototype.onConnected=function(){this.clearReconnectInterval();this.getDom().hide()};SNSReconnectPanel.prototype.showRelinkPanel=function(){jQuery(this.relinkCountDownPanel).hide();jQuery(this.connectingPanel).show()};
SNSReconnectPanel.prototype.showRelinkCountDown=function(){jQuery(this.connectingPanel).hide();jQuery(this.relinkCountDownPanel).show()};SNSReconnectPanel.prototype.setCountDownNum=function(a){jQuery(this.relinkCountDownText).text(a)};SNSReconnectPanel.prototype.showConnectFailedPanel=function(){jQuery(this.connectingPanel).hide();jQuery(this.connectFailPanel).show()};
var SNSDialog=function(){this.selector="#snsim_dialog";this.titleSelector="";this.iconSelector=".snsim_cfmicon_stat";this.textSelector=".txt";this.inputSelector="input";this.btnOkSelector=".snsim_btn_a";this.btnCancelSelector=".snsim_btn_b";this.type=DIALOG_TYPE.ALERT;this._init()},DIALOG_TYPE={ALERT:0,CONFIRM:1,PROMPT:2};SNSDialog.prototype=new SNSWindow({mask:!0});
SNSDialog.prototype._init=function(){this.getDom().find(this.btnOkSelector).unbind();this.getDom().find(this.btnCancelSelector).unbind();this.getDom().find(this.btnCancelSelector).show();this.getDom().find(this.inputSelector).show();this.getDom().find(this.inputSelector).val("");this.getDom().find(this.btnCancelSelector).bind("click",jQuery.proxy(function(){this.hide()},this));this.hide()};
SNSDialog.prototype.set=function(a,b,c,d){this._init();this.setText(b);this.setType(a);this.setCallback(c,d);this.getDom().find(this.btnCancelSelector).bind("click",jQuery.proxy(function(){this.hide();SNSIMWindow.getInstance().cover.hide()},this))};SNSDialog.prototype.setType=function(a){this.type=a;switch(a){case DIALOG_TYPE.ALERT:this.getDom().find(this.btnCancelSelector).hide();case DIALOG_TYPE.CONFIRM:this.getDom().find(this.inputSelector).hide()}};SNSDialog.prototype.setText=function(a){this.getDom().find(this.textSelector).text(a)};
SNSDialog.prototype.setCallback=function(a,b){this.getDom().find(this.btnOkSelector).off("click").on("click",function(){a.apply(b);SNSIMWindow.getInstance().cover.hide()})};SNSDialog.prototype.getInput=function(){return this.getDom().find(this.inputSelector).val()};var SNSImagePreviewPanel=function(){this.selector="#snsim_img_preview_window";this.imgSelector="img";this.closeBtnSelector=".snsim_img_preview_close"};SNSImagePreviewPanel.prototype=new SNSFloatPanel;
SNSImagePreviewPanel.prototype._init=function(){SNSFloatPanel.prototype._init.call(this);this._bindDomEvent()};SNSImagePreviewPanel.prototype._bindDomEvent=function(){this.getDom().find(this.imgSelector).bind("click",{_self:this},function(a){a.data._self.hide()});SNSFloatPanel.prototype._bindDomEvent.call(this)};SNSImagePreviewPanel.prototype.updateImg=function(a){this.show();this.getDom().find(this.imgSelector).attr("src",a)};
var SNSAvailableGroupPanel=function(){this.selector="#snsim_roster_operation_available_panel";this.triggerSelector="#snsim_move_roster_btn, #snsim_copy_roster_btn";this.containerSelector=this.selector+" ul";this.groupTemplate='<li class="snsim_available_groups" style="width:70px;" groupname="##{{name}}" title="##{{name}}"><a class="setting_cho"><span class="setting_txt">##{{name}}</span></a></li>';this.hideFloat=SNSComponent.HIDE_TYPE.HIDE};SNSAvailableGroupPanel.prototype=new SNSFloatPanel;
SNSAvailableGroupPanel.prototype._init=function(){SNSFloatPanel.prototype._init.call(this)};SNSAvailableGroupPanel.prototype.setGroups=function(a){this.groups=a};
SNSAvailableGroupPanel.prototype.beforeShow=function(){this.getContainerDom().empty();var a="",b;for(b in this.groups)this.groups[b]instanceof SNSGroup&&(a+=TemplateUtil.genHtml(this.groupTemplate,this.groups[b]));this.getContainerDom().append(a);a=SNSIMWindow.getInstance().getRosterOperationPanel();b=a.getDom().offset();this.getDom().css("top",b.top);this.getDom().css("left",b.left-80);this._bindClickEvent(a)};
SNSAvailableGroupPanel.prototype._bindClickEvent=function(a){this.getDom().find(".snsim_available_groups").bind("click",{panel:a},function(a){var c=a.data.panel;a=c.getCurrentGroup();var d=c.getCurrentRoster(),c=c.getCurrentOperation(),e=SNSApplication.getInstance().getUser().getGroupList(),h=e.getGroup(jQuery(this).attr("groupname"));e.moveRoster(d,c,a,h);e=SNSIMWindow.getInstance().getWideWindow().getTab("roster");c==SNS_MOVE_ROSTER_TYPE.MOVE?e.moveRosterBetweenGroups(d,a,h):c==SNS_MOVE_ROSTER_TYPE.COPY&&
e.addRosterToGroup(d,h)})};var SNSRosterOperationPanel=function(){this.selector="#snsim_roster_operation_panel";this.moveBtn="#snsim_move_roster_btn";this.copyBtn="#snsim_copy_roster_btn";this.deleteBtn="#snsim_delete_roster_btn";this.modifyNameBtn="#snsim_modify_roster_name_btn";this.createGroupBtn="#snsim_create_group_btn";this.availableGroupsPanel=new SNSAvailableGroupPanel;this.hideFloat=SNSComponent.HIDE_TYPE.HIDE};SNSRosterOperationPanel.prototype=new SNSFloatPanel;
SNSRosterOperationPanel.prototype._init=function(){this._bindDomEvent();this.availableGroupsPanel._init();SNSFloatPanel.prototype._init.call(this)};SNSRosterOperationPanel.prototype.attachDom=function(a){this._triggerDom=jQuery(a);a=this.getTriggerDom().offset();this.getDom().css("top",a.top+5);this.getDom().css("left",a.left-65)};SNSRosterOperationPanel.prototype.getCurRosterDom=function(){return this.getTriggerDom().parents("li.sns_roster_list_wide_item")};
SNSRosterOperationPanel.prototype.getCurrentRoster=function(){var a=this.getCurRosterDom().attr("rosterId");return SNSApplication.getInstance().getUser().getRoster(a)};SNSRosterOperationPanel.prototype.getCurrentGroup=function(){return SNSApplication.getInstance().getUser().getGroupList().getGroup(this.getCurRosterDom().attr("groupname"))};SNSRosterOperationPanel.prototype.getCurrentOperation=function(){return this._currentOperation};
SNSRosterOperationPanel.prototype.beforeShow=function(){var a=jQuery(this.copyBtn),b=SNSApplication.getInstance().getUser().getGroupList();this.getCurrentGroup()==b.groupNone||this.getCurrentGroup()instanceof SNSPublicServiceGroup?a.hide():a.show();a=jQuery(this.moveBtn);this.getCurrentGroup()instanceof SNSPublicServiceGroup?a.hide():a.show()};
SNSRosterOperationPanel.prototype._bindDomEvent=function(){jQuery(this.moveBtn).bind("click",jQuery.proxy(function(a){var b=SNSApplication.getInstance().getUser().groupList.availableGroups(this.getCurrentRoster());0!=b.length&&(this.availableGroupsPanel.setGroups(b),this._currentOperation=SNS_MOVE_ROSTER_TYPE.MOVE,this.availableGroupsPanel.show(),a.stopPropagation(),a.preventDefault())},this));jQuery(this.copyBtn).bind("click",jQuery.proxy(function(a){var b=SNSApplication.getInstance().getUser().groupList.availableGroups(this.getCurrentRoster());
0!=b.length&&(this.availableGroupsPanel.setGroups(b),this._currentOperation=SNS_MOVE_ROSTER_TYPE.COPY,this.availableGroupsPanel.show(),a.stopPropagation(),a.preventDefault())},this));jQuery(this.deleteBtn).bind("click",{_self:this},function(a){SNSIMWindow.getInstance().getDialog().set(DIALOG_TYPE.CONFIRM,SNS_I18N.subscribe_remove+a.data._self.getCurrentRoster().name,function(){SNSIMWindow.getInstance().getWideWindow().getTab("roster");SNSApplication.getInstance().getGlobalEventManager().trigger(SNS_EVENT_SUBJECT.ON_REMOVE_ROSTER,
[{roster:this.getCurrentRoster()}]);SNSIMWindow.getInstance().getDialog().hide()},a.data._self);SNSIMWindow.getInstance().getDialog().show()});jQuery(this.modifyNameBtn).bind("click",{_self:this},function(a){SNSIMWindow.getInstance().getDialog().set(DIALOG_TYPE.PROMPT,SNS_I18N.roster_rename.replace("#",a.data._self.getCurrentRoster().name),function(){var a=SNSIMWindow.getInstance().getWideWindow().getTab("roster"),c=this.getCurrentRoster(),d=SNSIMWindow.getInstance().getDialog().getInput();c.name=
d.trim();a.renameRoster(c);SNSIMWindow.getInstance().getDialog().hide()},a.data._self);SNSIMWindow.getInstance().getDialog().show()});jQuery(this.createGroupBtn).bind("click",{_self:this},function(a){SNSIMWindow.getInstance().getDialog().set(DIALOG_TYPE.PROMPT,SNS_I18N.group_name,function(){var a=new SNSGroup(SNSIMWindow.getInstance().getDialog().getInput());SNSApplication.getInstance().getUser().groupList.addGroup(a);SNSIMWindow.getInstance().getWideWindow().getTab("roster").addGroup(a);SNSIMWindow.getInstance().getDialog().hide()},
a.data._self);SNSIMWindow.getInstance().getDialog().show()})};var SNSPresencePanel=function(){this.selector="#snsim_layer_presence_panel";this.triggerSelector=".snsim_user_presence_btn";this.presenceItemSelector="#snsim_layer_presence_panel li a.setting_cho";this.hideFloat=SNSComponent.HIDE_TYPE.HIDE};SNSPresencePanel.prototype=new SNSFloatPanel;
SNSPresencePanel.prototype._init=function(){SNSFloatPanel.prototype._init.call(this);this._isEventBound||(this._bindPreseceBtnEvent(),this._bindPresenceItemEvent(),this._isEventBound=!0)};
SNSPresencePanel.prototype._bindPreseceBtnEvent=function(){jQuery(this.triggerSelector).bind("click",jQuery.proxy(function(a){a=jQuery(a.currentTarget).offset();SNSIMWindow.getInstance().getWideWindow().visible()?(this.getDom().css("top",a.top-111),this.getDom().css("left",a.left-76)):(this.getDom().css("top",a.top+1),this.getDom().css("left",a.left-66));this.toggle()},this))};
SNSPresencePanel.prototype._bindPresenceItemEvent=function(){jQuery(this.presenceItemSelector).bind("click",function(){var a=jQuery(this).attr("presence");SNSApplication.getInstance().getUser().setPresence(a,!0)})};
var SNSPresenceRender=function(){this.userPresenceSelector=".snsim_user_presence";this.userPresenceTextSelector=".snsim_user_presence_text";this.rosterPresenceSelector=".snsim_roster_presence";var a="",b;for(b in SNS_STATUS)SNS_STATUS[b]&&"string"==typeof SNS_STATUS[b]&&(a+=" snsim_"+SNS_STATUS[b]);this.allStatusClass=a;this.presencePanel=new SNSPresencePanel};
SNSPresenceRender.prototype._init=function(){SNSApplication.getInstance().getGlobalEventManager().registerEventHandler(SNS_EVENT_SUBJECT.AFTER_CONNECT,!0,this.presencePanel._init,this.presencePanel);SNSApplication.getInstance().getGlobalEventManager().registerEventHandler(SNS_EVENT_SUBJECT.ON_USER_PRESENCE_CHANGE,!0,this.updateUserPresence,this);SNSApplication.getInstance().getGlobalEventManager().registerEventHandler(SNS_EVENT_SUBJECT.ON_ROSTER_PRESENCE_CHANGE,!0,this.updateRosterPresence,this)};
SNSPresenceRender.prototype.onConnected=function(){var a=SNSApplication.getInstance().getUser();a.presence.status==SNS_STATUS.UNAVAILABLE&&(jQuery.when(a.setPresence(SNS_STATUS.AVAILABLE,!0)).done(jQuery.proxy(this.updateUserPresence,this)).fail(function(){YYIMChat.log("change user presence fail")}),this.updateUserPresence())};
SNSPresenceRender.prototype.updateUserPresence=function(){var a=SNSApplication.getInstance().getUser().presence;jQuery(this.userPresenceTextSelector).text(SNS_ONLINE_SHOW[a.status.toUpperCase()]);var b=jQuery(this.userPresenceSelector);b.removeClass(this.allStatusClass);b.addClass("snsim_"+a.status)};
SNSPresenceRender.prototype.updateRosterPresence=function(a,b){var c=b.target,d=c.presence,e=jQuery("li[id$='_"+c.getID()+"'] "+this.rosterPresenceSelector);e.removeClass(this.allStatusClass);e.addClass("snsim_"+d.status);d=jQuery("#narrow_roster_container");if(0<c.groups.length)for(e=0;e<c.groups.length;e++){var h=jQuery("#grouproster_"+c.groups[e].name+"_"+c.id);jQuery("#list_content_"+c.groups[e].name).prepend(h)}c=jQuery("#narrow_roster_"+c.id);d.prepend(c);SNSIMWindow.getInstance().getWideWindow().getTab("roster").updateGroupsInfo()};
var SNSVCardPanel=function(a){this.roster=a;this.selector="#snsim_float_panel_vcard_"+a.getID();SNSVCardPanel.panelList._add(this.roster.getID(),this);this.mouseover=!1};SNSVCardPanel.idPrefix="snsim_float_panel_vcard_";SNSVCardPanel.template='<div id="'+SNSVCardPanel.idPrefix+'##{{roster.getID()}}" class="roster_info" style="display:none;"><div class="snsim_list_head snsim_head_30 roster_info_head" ><img width="36" height="36" src="##{{roster.getPhotoUrl()}}" class="snsim_user_item_img"><div style="height: 39px; margin: -24px 0 -29px 60px;"><span class="user_name">##{{roster.name}}</span></div></div><div class="snsim_vcard_info"><ul class="snsim_vcard_info_basic">##{{buildInfoListHtml()}}</ul></div></div>';
SNSVCardPanel.prototype=new SNSFloatPanel;SNSVCardPanel.panelList=new SNSBaseList;SNSVCardPanel.getInstance=function(a){var b=a.id?a.id:a,c=SNSVCardPanel.panelList._get(b);return c?c:(a instanceof SNSRoster||(a=SNSApplication.getInstance().getUser().getRoster(b)),new SNSVCardPanel(a))};
SNSVCardPanel.prototype.show=function(a){function b(){if(0==c.getDom().length){var b=c.buildHtml();jQuery("body").append(b);c._bindDomEvent();c.mouseover&&c.showWhenVcardRequest(a)}}if(!(this.roster instanceof SNSPublicAccountRoster||this.roster instanceof SNSPublicServiceRoster)){var c=this;this.roster.vcard?(b(),this.showWhenVcardRequest(a)):jQuery.when(this.roster.queryVCard()).done(jQuery.proxy(function(){b()},this))}};
SNSVCardPanel.prototype.showWhenVcardRequest=function(a){a&&(a=jQuery(a).offset(),this.getDom().css("top",a.top-10),this.getDom().css("left",a.left-230));SNSComponent.prototype.show.call(this);return this};
SNSVCardPanel.prototype._bindDomEvent=function(){this.getDom().bind("mouseenter",{roster:this.roster},function(a){a=SNSVCardPanel.getInstance(a.data.roster);a.mouseover=!0;a.show()});this.getDom().bind("mouseleave",{roster:this.roster},function(a){a=SNSVCardPanel.getInstance(a.data.roster);a.mouseover=!1;a.hide()})};
SNSVCardPanel.prototype.buildInfoListHtml=function(){for(var a="",b=0;b<this.roster.vcard.showpropList.length;b++){var c=this.roster.vcard.showpropList[b],d=SNS_LANG_TEMPLATE["vcard_"+c.replace(".","_")],e=this.roster.vcard[c],h=c.indexOf(".");-1!=h&&(e=this.roster.vcard[c.substr(0,h)][c.substr(h+1)]);e=e?e:"";a+='<li><span style="color: #9fa5a7;">'+d+'</span><span style="color:rgb(80, 80, 80);margin-left: 22px;">'+e+"</span></li>"}return a};
SNSFloatPanel.prototype.buildHtml=function(){return TemplateUtil.genHtml(this.getTemplate(),this)};SNSVCardPanel.prototype.getTemplate=function(){return SNSVCardPanel.template};
var SNSIMWindow=function(a){if(!a||"SNSIMWindow cannot be new, use SNSApplication.getInstance() instead."!==a)throw"SNSIMWindow cannot be new, use SNSApplication.getInstance() instead.";this.selector="#sns_webim";this.foldButtonSelector=".snsim_toggle_fold_btn";this.chatBoxSelector=".snsim_chat_box";this.coverlayer="#snsim_coverlayer";this._narrowWindow=new SNSNarrowWindow;this._wideWindow=new SNSWideWindow;this._chatWindow=new SNSChatWindow;this._miniChatWindow=new SNSMiniChatWindow;this._invitationWindow=
new SNSInvitationWindow;this._presenceRender=new SNSPresenceRender;this._reconnectPanel=new SNSReconnectPanel;this._unreadMessagePanel=new SNSUnreadMessagePanel;this._rosterOperationPanel=new SNSRosterOperationPanel;this._chatroomMembersPanel=new SNSMemberListPanel;this._dialog=new SNSDialog;this._imgPreviewPanel=new SNSImagePreviewPanel;this._chatRoomController=new SNSChatRoomController;this._subscribeController=new SNSSubscribeController;jQuery("#snsim_tab_content_roster").perfectScrollbar();jQuery("#snsim_tab_content_chatroom").perfectScrollbar()};
SNSIMWindow.prototype=new SNSWindow;SNSIMWindow.prototype._bindClickEmptyAreaEvent=function(){jQuery("body").bind("click",function(a){SNSApplication.getInstance().getGlobalEventManager().trigger(SNS_EVENT_SUBJECT.HIDE_FLOAT,[{event:a}])})};SNSIMWindow.prototype._bindFoldEvent=function(){jQuery(this.foldButtonSelector).bind("click",jQuery.proxy(function(){this._toggleNarrowWideWindow()},this))};
SNSIMWindow.prototype._initNarrowWideWindow=function(){var a=window.localStorage.getItem(YYIMChat.getUserNode()+"_window");a&&"narrow"===a?(jQuery(this._narrowWindow.rosterContainerSelector).parent().css("height",jQuery(window).height()-80),this._wideWindow.hide(),this._narrowWindow.show(),this._chatWindow.transPosition(!1),window.localStorage.setItem(YYIMChat.getUserNode()+"_window","narrow")):(this._wideWindow.show(),this._narrowWindow.hide(),this._chatWindow.transPosition(!0),window.localStorage.setItem(YYIMChat.getUserNode()+
"_window","wide"))};
SNSIMWindow.prototype._toggleNarrowWideWindow=function(){this._narrowWindow.visible()?(this._wideWindow.show(),this._narrowWindow.hide(),this._chatWindow.transPosition(!0),window.localStorage.setItem(YYIMChat.getUserNode()+"_window","wide")):(jQuery(this._narrowWindow.rosterContainerSelector).parent().css("height",jQuery(window).height()-80),this._wideWindow.hide(),this._narrowWindow.show(),this._chatWindow.transPosition(!1),window.localStorage.setItem(YYIMChat.getUserNode()+"_window","narrow"))};
SNSIMWindow.prototype._toggleMiniChatWindow=function(){this._miniChatWindow.visible()?(this._chatWindow.show(),this._miniChatWindow.hide()):(this._chatWindow.hide(),this._miniChatWindow.show())};SNSIMWindow.prototype.getMiniChatWindow=function(){return this._miniChatWindow};SNSIMWindow.prototype.getChatWindow=function(){return this._chatWindow};SNSIMWindow.prototype.getWideWindow=function(){return this._wideWindow};SNSIMWindow.prototype.getNarrowWindow=function(){return this._narrowWindow};
SNSIMWindow.prototype.getInvitationWindow=function(){return this._invitationWindow};SNSIMWindow.prototype.getPresenceRender=function(){return this._presenceRender};SNSIMWindow.prototype.getReconnectPanel=function(){return this._reconnectPanel};SNSIMWindow.prototype.getUnreadMessagePanel=function(){return this._unreadMessagePanel};SNSIMWindow.prototype.getRosterOperationPanel=function(){return this._rosterOperationPanel};SNSIMWindow.prototype.getChatroomMembersPanel=function(){return this._chatroomMembersPanel};
SNSIMWindow.prototype.getDialog=function(){return this._dialog};SNSIMWindow.prototype.getImgPreviewPanel=function(){return this._imgPreviewPanel};SNSIMWindow.prototype.getChatRoomController=function(){return this._chatRoomController};SNSIMWindow.prototype.getSubscribeController=function(){return this._subscribeController};SNSIMWindow.prototype.onConnected=function(){this.show();this._wideWindow.show()};
SNSIMWindow.getInstance=function(){if(!SNSIMWindow._instance){SNSIMWindow._instance=new SNSIMWindow("SNSIMWindow cannot be new, use SNSApplication.getInstance() instead.");SNSApplication._instance.getGlobalEventManager().registerEventHandler(SNS_EVENT_SUBJECT.AFTER_CONNECT,!1,SNSIMWindow.getInstance().onConnected,SNSIMWindow.getInstance());SNSIMWindow._instance._bindFoldEvent();SNSIMWindow._instance._bindClickEmptyAreaEvent();for(var a in SNSIMWindow._instance){var b=SNSIMWindow._instance[a];b&&b._init&&
"function"==typeof b._init&&b._init()}}return SNSIMWindow._instance};SNSIMWindow.prototype.cover={show:function(){jQuery("#snsim_coverlayer").show()},hide:function(){jQuery("#snsim_coverlayer").hide()}};var Drag=function(a,b){this.initialize(a,b)};
Drag.prototype.initialize=function(a,b){this.Drag=SNSAvatarCropper.getInstance().getElement(a);this._marginLeft=this._marginTop=this._x=this._y=0;this._fM=SNSAvatarCropper.getInstance().bindAsEventListener(this,this.Move);this._fS=SNSAvatarCropper.getInstance().bind(this,this.Stop);this.SetOptions(b);this.Limit=!!this.options.Limit;this.mxLeft=parseInt(this.options.mxLeft);this.mxRight=parseInt(this.options.mxRight);this.mxTop=parseInt(this.options.mxTop);this.mxBottom=parseInt(this.options.mxBottom);
this.LockX=!!this.options.LockX;this.LockY=!!this.options.LockY;this.Lock=!!this.options.Lock;this.onStart=this.options.onStart;this.onMove=this.options.onMove;this.onStop=this.options.onStop;this._Handle=SNSAvatarCropper.getInstance().getElement(this.options.Handle)||this.Drag;this._mxContainer=SNSAvatarCropper.getInstance().getElement(this.options.mxContainer)||null;this.Drag.style.position="absolute";if(isIE&&this.options.Transparent)with(this._Handle.appendChild(document.createElement("div")).style)width=
height="100%",backgroundColor="#fff",filter="alpha(opacity:0)",fontSize=0;this.Repair();SNSAvatarCropper.getInstance().addEventHandler(this._Handle,"mousedown",SNSAvatarCropper.getInstance().bindAsEventListener(this,this.Start))};
Drag.prototype.SetOptions=function(a){this.options={Handle:"",Limit:!1,mxLeft:0,mxRight:9999,mxTop:0,mxBottom:9999,mxContainer:"",LockX:!1,LockY:!1,Lock:!1,Transparent:!1,onStart:function(){},onMove:function(){},onStop:function(){}};SNSAvatarCropper.getInstance().extend(this.options,a||{})};
Drag.prototype.Start=function(a){this.Lock||(this.Repair(),this._x=a.clientX-this.Drag.offsetLeft,this._y=a.clientY-this.Drag.offsetTop,this._marginLeft=parseInt(SNSAvatarCropper.getInstance().currentStyle(this.Drag).marginLeft)||0,this._marginTop=parseInt(SNSAvatarCropper.getInstance().currentStyle(this.Drag).marginTop)||0,SNSAvatarCropper.getInstance().addEventHandler(document,"mousemove",this._fM),SNSAvatarCropper.getInstance().addEventHandler(document,"mouseup",this._fS),isIE?(SNSAvatarCropper.getInstance().addEventHandler(this._Handle,
"losecapture",this._fS),this._Handle.setCapture()):(SNSAvatarCropper.getInstance().addEventHandler(window,"blur",this._fS),a.preventDefault()),this.onStart())};
Drag.prototype.Repair=function(){this.Limit&&(this.mxRight=Math.max(this.mxRight,this.mxLeft+this.Drag.offsetWidth),this.mxBottom=Math.max(this.mxBottom,this.mxTop+this.Drag.offsetHeight),!this._mxContainer||"relative"==SNSAvatarCropper.getInstance().currentStyle(this._mxContainer).position||"absolute"==SNSAvatarCropper.getInstance().currentStyle(this._mxContainer).position||(this._mxContainer.style.position="relative"))};
Drag.prototype.Move=function(a){if(this.Lock)this.Stop();else{window.getSelection?window.getSelection().removeAllRanges():document.selection.empty();var b=a.clientX-this._x;a=a.clientY-this._y;if(this.Limit){var c=this.mxLeft,d=this.mxRight,e=this.mxTop,h=this.mxBottom;this._mxContainer&&(c=Math.max(c,0),e=Math.max(e,0),d=Math.min(d,this._mxContainer.clientWidth),h=Math.min(h,this._mxContainer.clientHeight));b=Math.max(Math.min(b,d-this.Drag.offsetWidth),c);a=Math.max(Math.min(a,h-this.Drag.offsetHeight),
e)}this.LockX||(this.Drag.style.left=b-this._marginLeft+"px");this.LockY||(this.Drag.style.top=a-this._marginTop+"px");this.onMove()}};
Drag.prototype.Stop=function(){SNSAvatarCropper.getInstance().removeEventHandler(document,"mousemove",this._fM);SNSAvatarCropper.getInstance().removeEventHandler(document,"mouseup",this._fS);isIE?(SNSAvatarCropper.getInstance().removeEventHandler(this._Handle,"losecapture",this._fS),this._Handle.releaseCapture()):SNSAvatarCropper.getInstance().removeEventHandler(window,"blur",this._fS);this.onStop()};var Resize=function(a,b){this.initialize(a,b)};
Resize.prototype.initialize=function(a,b){this._obj=SNSAvatarCropper.getInstance().getElement(a);this._scaleLeft=this._scaleTop=this._fixLeft=this._fixTop=this._sideRight=this._sideDown=this._sideLeft=this._sideUp=this._styleWidth=this._styleHeight=this._styleLeft=this._styleTop=0;this._mxSet=function(){};this._mxScaleWidth=this._mxScaleHeight=this._mxRightWidth=this._mxDownHeight=this._mxUpHeight=this._mxLeftWidth=0;this._fun=function(){};var c=SNSAvatarCropper.getInstance().currentStyle(this._obj);
this._borderX=(parseInt(c.borderLeftWidth)||0)+(parseInt(c.borderRightWidth)||0);this._borderY=(parseInt(c.borderTopWidth)||0)+(parseInt(c.borderBottomWidth)||0);this._fR=SNSAvatarCropper.getInstance().bindAsEventListener(this,this.Resize);this._fS=SNSAvatarCropper.getInstance().bind(this,this.Stop);this.SetOptions(b);this.Max=!!this.options.Max;this._mxContainer=SNSAvatarCropper.getInstance().getElement(this.options.mxContainer)||null;this.mxLeft=Math.round(this.options.mxLeft);this.mxRight=Math.round(this.options.mxRight);
this.mxTop=Math.round(this.options.mxTop);this.mxBottom=Math.round(this.options.mxBottom);this.Min=!!this.options.Min;this.minWidth=Math.round(this.options.minWidth);this.minHeight=Math.round(this.options.minHeight);this.Scale=!!this.options.Scale;this.Ratio=Math.max(this.options.Ratio,0);this.onResize=this.options.onResize;this._obj.style.position="absolute";!this._mxContainer||"relative"==SNSAvatarCropper.getInstance().currentStyle(this._mxContainer).position||(this._mxContainer.style.position=
"relative")};Resize.prototype.SetOptions=function(a){this.options={Max:!1,mxContainer:"",mxLeft:0,mxRight:9999,mxTop:0,mxBottom:9999,Min:!1,minWidth:50,minHeight:50,Scale:!1,Ratio:0,onResize:function(){}};SNSAvatarCropper.getInstance().extend(this.options,a||{})};
Resize.prototype.Set=function(a,b){a=SNSAvatarCropper.getInstance().getElement(a);var c;if(a){switch(b.toLowerCase()){case "up":c=this.Up;break;case "down":c=this.Down;break;case "left":c=this.Left;break;case "right":c=this.Right;break;case "left-up":c=this.LeftUp;break;case "right-up":c=this.RightUp;break;case "left-down":c=this.LeftDown;break;default:c=this.RightDown}SNSAvatarCropper.getInstance().addEventHandler(a,"mousedown",SNSAvatarCropper.getInstance().bindAsEventListener(this,this.Start,c))}};
Resize.prototype.Start=function(a,b,c){a.stopPropagation?a.stopPropagation():a.cancelBubble=!0;this._fun=b;this._styleWidth=this._obj.clientWidth;this._styleHeight=this._obj.clientHeight;this._styleLeft=this._obj.offsetLeft;this._styleTop=this._obj.offsetTop;this._sideLeft=a.clientX-this._styleWidth;this._sideRight=a.clientX+this._styleWidth;this._sideUp=a.clientY-this._styleHeight;this._sideDown=a.clientY+this._styleHeight;this._fixLeft=this._styleLeft+this._styleWidth;this._fixTop=this._styleTop+
this._styleHeight;this.Scale&&(this.Ratio=Math.max(this.Ratio,0)||this._styleWidth/this._styleHeight,this._scaleLeft=this._styleLeft+this._styleWidth/2,this._scaleTop=this._styleTop+this._styleHeight/2);if(this.Max){var d=this.mxLeft,e=this.mxRight,h=this.mxTop,s=this.mxBottom;this._mxContainer&&(d=Math.max(d,0),h=Math.max(h,0),e=Math.min(e,this._mxContainer.clientWidth),s=Math.min(s,this._mxContainer.clientHeight));e=Math.max(e,d+(this.Min?this.minWidth:0)+this._borderX);s=Math.max(s,h+(this.Min?
this.minHeight:0)+this._borderY);this._mxSet=function(){this._mxRightWidth=e-this._styleLeft-this._borderX;this._mxDownHeight=s-this._styleTop-this._borderY;this._mxUpHeight=Math.max(this._fixTop-h,this.Min?this.minHeight:0);this._mxLeftWidth=Math.max(this._fixLeft-d,this.Min?this.minWidth:0)};this._mxSet();this.Scale&&(this._mxScaleWidth=2*Math.min(this._scaleLeft-d,e-this._scaleLeft-this._borderX),this._mxScaleHeight=2*Math.min(this._scaleTop-h,s-this._scaleTop-this._borderY))}SNSAvatarCropper.getInstance().addEventHandler(document,
"mousemove",this._fR);SNSAvatarCropper.getInstance().addEventHandler(document,"mouseup",this._fS);isIE?(SNSAvatarCropper.getInstance().addEventHandler(this._obj,"losecapture",this._fS),this._obj.setCapture()):(SNSAvatarCropper.getInstance().addEventHandler(window,"blur",this._fS),a.preventDefault())};
Resize.prototype.Resize=function(a){window.getSelection?window.getSelection().removeAllRanges():document.selection.empty();this._fun(a);this._obj.style.width=this._styleWidth+"px";this._obj.style.height=this._styleHeight+"px";this._obj.style.top=this._styleTop+"px";this._obj.style.left=this._styleLeft+"px";this.onResize()};Resize.prototype.Resize.prototype.Up=function(a){this.RepairY(this._sideDown-a.clientY,this._mxUpHeight);this.RepairTop();this.TurnDown(this.Down)};
Resize.prototype.Resize.prototype.Down=function(a){this.RepairY(a.clientY-this._sideUp,this._mxDownHeight);this.TurnUp(this.Up)};Resize.prototype.Right=function(a){this.RepairX(a.clientX-this._sideLeft,this._mxRightWidth);this.TurnLeft(this.Left)};Resize.prototype.Resize.prototype.Left=function(a){this.RepairX(this._sideRight-a.clientX,this._mxLeftWidth);this.RepairLeft();this.TurnRight(this.Right)};
Resize.prototype.RightDown=function(a){this.RepairAngle(a.clientX-this._sideLeft,this._mxRightWidth,a.clientY-this._sideUp,this._mxDownHeight);this.TurnLeft(this.LeftDown)||this.Scale||this.TurnUp(this.RightUp)};Resize.prototype.RightUp=function(a){this.RepairAngle(a.clientX-this._sideLeft,this._mxRightWidth,this._sideDown-a.clientY,this._mxUpHeight);this.RepairTop();this.TurnLeft(this.LeftUp)||this.Scale||this.TurnDown(this.RightDown)};
Resize.prototype.Resize.prototype.LeftDown=function(a){this.RepairAngle(this._sideRight-a.clientX,this._mxLeftWidth,a.clientY-this._sideUp,this._mxDownHeight);this.RepairLeft();this.TurnRight(this.RightDown)||this.Scale||this.TurnUp(this.LeftUp)};Resize.prototype.LeftUp=function(a){this.RepairAngle(this._sideRight-a.clientX,this._mxLeftWidth,this._sideDown-a.clientY,this._mxUpHeight);this.RepairTop();this.RepairLeft();this.TurnRight(this.RightUp)||this.Scale||this.TurnDown(this.LeftDown)};
Resize.prototype.RepairX=function(a,b){a=this.RepairWidth(a,b);if(this.Scale){var c=this.RepairScaleHeight(a);if(this.Max&&c>this._mxScaleHeight)c=this._mxScaleHeight,a=this.RepairScaleWidth(c);else if(this.Min&&c<this.minHeight){var d=this.RepairScaleWidth(this.minHeight);d<b&&(c=this.minHeight,a=d)}this._styleHeight=c;this._styleTop=this._scaleTop-c/2}this._styleWidth=a};
Resize.prototype.RepairY=function(a,b){a=this.RepairHeight(a,b);if(this.Scale){var c=this.RepairScaleWidth(a);if(this.Max&&c>this._mxScaleWidth)c=this._mxScaleWidth,a=this.RepairScaleHeight(c);else if(this.Min&&c<this.minWidth){var d=this.RepairScaleHeight(this.minWidth);d<b&&(c=this.minWidth,a=d)}this._styleWidth=c;this._styleLeft=this._scaleLeft-c/2}this._styleHeight=a};
Resize.prototype.RepairAngle=function(a,b,c,d){a=this.RepairWidth(a,b);this.Scale?(c=this.RepairScaleHeight(a),this.Max&&c>d?(c=d,a=this.RepairScaleWidth(c)):this.Min&&c<this.minHeight&&(d=this.RepairScaleWidth(this.minHeight),d<b&&(c=this.minHeight,a=d))):c=this.RepairHeight(c,d);this._styleWidth=a;this._styleHeight=c};Resize.prototype.RepairTop=function(){this._styleTop=this._fixTop-this._styleHeight};Resize.prototype.RepairLeft=function(){this._styleLeft=this._fixLeft-this._styleWidth};
Resize.prototype.RepairHeight=function(a,b){a=Math.min(this.Max?b:a,a);return a=Math.max(this.Min?this.minHeight:a,a,0)};Resize.prototype.RepairWidth=function(a,b){a=Math.min(this.Max?b:a,a);return a=Math.max(this.Min?this.minWidth:a,a,0)};Resize.prototype.RepairScaleHeight=function(a){return Math.max(Math.round((a+this._borderX)/this.Ratio-this._borderY),0)};Resize.prototype.RepairScaleWidth=function(a){return Math.max(Math.round((a+this._borderY)*this.Ratio-this._borderX),0)};
Resize.prototype.TurnRight=function(a){if(!this.Min&&!this._styleWidth)return this._fun=a,this._sideLeft=this._sideRight,this.Max&&this._mxSet(),!0};Resize.prototype.TurnLeft=function(a){if(!this.Min&&!this._styleWidth)return this._fun=a,this._sideRight=this._sideLeft,this._fixLeft=this._styleLeft,this.Max&&this._mxSet(),!0};Resize.prototype.TurnUp=function(a){if(!this.Min&&!this._styleHeight)return this._fun=a,this._sideDown=this._sideUp,this._fixTop=this._styleTop,this.Max&&this._mxSet(),!0};
Resize.prototype.TurnDown=function(a){if(!this.Min&&!this._styleHeight)return this._fun=a,this._sideUp=this._sideDown,this.Max&&this._mxSet(),!0};
Resize.prototype.Stop=function(){SNSAvatarCropper.getInstance().removeEventHandler(document,"mousemove",this._fR);SNSAvatarCropper.getInstance().removeEventHandler(document,"mouseup",this._fS);isIE?(SNSAvatarCropper.getInstance().removeEventHandler(this._obj,"losecapture",this._fS),this._obj.releaseCapture()):SNSAvatarCropper.getInstance().removeEventHandler(window,"blur",this._fS)};var isIE=document.all?!0:!1,SNSAvatarCropper=function(a,b,c,d){this.initialize(a,b,c,d)};
SNSAvatarCropper.getInstance=function(){return SNSAvatarCropper._instance};SNSAvatarCropper.prototype.getElement=function(a){return"string"==typeof a?document.getElementById(a):a};SNSAvatarCropper.prototype.extend=function(a,b){for(var c in b)a[c]=b[c]};SNSAvatarCropper.prototype.bind=function(a,b){return function(){return b.apply(a,arguments)}};
SNSAvatarCropper.prototype.bindAsEventListener=function(a,b){var c=Array.prototype.slice.call(arguments).slice(2);return function(d){return b.apply(a,[d||window.event].concat(c))}};SNSAvatarCropper.prototype.currentStyle=function(a){return a.currentStyle||document.defaultView.getComputedStyle(a,null)};SNSAvatarCropper.prototype.addEventHandler=function(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent?a.attachEvent("on"+b,c):a["on"+b]=c};
SNSAvatarCropper.prototype.removeEventHandler=function(a,b,c){a.removeEventListener?a.removeEventListener(b,c,!1):a.detachEvent?a.detachEvent("on"+b,c):a["on"+b]=null};
SNSAvatarCropper.prototype.initialize=function(a,b,c,d){SNSAvatarCropper._instance=this;this._Container=this.getElement(a);this._layHandle=this.getElement(b);this.Url=c;this._layBase=this._Container.appendChild(document.createElement("img"));this._layCropper=this._Container.appendChild(document.createElement("img"));this._layCropper.onload=this.bind(this,this.setPos);this._tempImg=document.createElement("img");this._tempImg.onload=this.bind(this,this.setSize);this.setOptions(d);this.Opacity=Math.round(this.options.Opacity);
this.Color=this.options.Color;this.Scale=!!this.options.Scale;this.Ratio=Math.max(this.options.Ratio,0);this.Width=Math.round(this.options.Width);this.Height=Math.round(this.options.Height);if(a=this.getElement(this.options.Preview))a.style.position="relative",a.style.overflow="hidden",this.viewWidth=Math.round(this.options.viewWidth),this.viewHeight=Math.round(this.options.viewHeight),this._view=a.appendChild(document.createElement("img")),this._view.style.position="absolute",this._view.onload=this.bind(this,
this.setPreview);this._drag=new Drag(this._layHandle,{Limit:!0,onMove:this.bind(this,this.setPos),Transparent:!0});if(this.Resize=!!this.options.Resize)a=this.options,b=new Resize(this._layHandle,{Max:!0,onResize:this.bind(this,this.setPos)}),a.RightDown&&b.Set(a.RightDown,"right-down"),a.LeftDown&&b.Set(a.LeftDown,"left-down"),a.RightUp&&b.Set(a.RightUp,"right-up"),a.LeftUp&&b.Set(a.LeftUp,"left-up"),a.Right&&b.Set(a.Right,"right"),a.Left&&b.Set(a.Left,"left"),a.Down&&b.Set(a.Down,"down"),a.Up&&
b.Set(a.Up,"up"),this.Min=!!this.options.Min,this.minWidth=Math.round(this.options.minWidth),this.minHeight=Math.round(this.options.minHeight),this._resize=b;this._Container.style.position="relative";this._Container.style.overflow="hidden";this._layHandle.style.zIndex=200;this._layCropper.style.zIndex=100;this._layBase.style.position=this._layCropper.style.position="absolute";this._layBase.style.top=this._layBase.style.left=this._layCropper.style.top=this._layCropper.style.left=0;this.init()};
SNSAvatarCropper.prototype.setOptions=function(a){this.options={Opacity:50,Color:"",Width:0,Height:0,Resize:!1,Right:"",Left:"",Up:"",Down:"",RightDown:"",LeftDown:"",RightUp:"",LeftUp:"",Min:!0,minWidth:50,minHeight:50,Scale:!0,Ratio:1,Preview:"",viewWidth:0,viewHeight:0};this.extend(this.options,a||{})};
SNSAvatarCropper.prototype.init=function(){this.Color&&(this._Container.style.backgroundColor=this.Color);this._tempImg.src=this._layBase.src=this._layCropper.src=this.Url;isIE?this._layBase.style.filter="alpha(opacity:"+this.Opacity+")":this._layBase.style.opacity=this.Opacity/100;this._view&&(this._view.src=this.Url);if(this.Resize)with(this._resize)Scale=this.Scale,Ratio=this.Ratio,Min=this.Min,minWidth=this.minWidth,minHeight=this.minHeight};
SNSAvatarCropper.prototype.setPos=function(){var a=this.getPos();this._layCropper.style.clip="rect("+a.Top+"px "+(a.Left+a.Width)+"px "+(a.Top+a.Height)+"px "+a.Left+"px)";this.setPreview()};
SNSAvatarCropper.prototype.setPreview=function(){if(this._view){var a=this.getPos(),b=this.getSize(a.Width,a.Height,this.viewWidth,this.viewHeight),c=b.Height/a.Height,d=this._layBase.height*c,e=a.Top*c,a=a.Left*c;this._view.style.width=this._layBase.width*c+"px";this._view.style.height=d+"px";this._view.style.top=-e+"px ";this._view.style.left=-a+"px";this._view.style.clip="rect("+e+"px "+(a+b.Width)+"px "+(e+b.Height)+"px "+a+"px)"}};
SNSAvatarCropper.prototype.setSize=function(){var a=this.getSize(this._tempImg.width,this._tempImg.height,this.Width,this.Height);this._layBase.style.width=this._layCropper.style.width=a.Width+"px";this._layBase.style.height=this._layCropper.style.height=a.Height+"px";this._drag.mxRight=a.Width;this._drag.mxBottom=a.Height;this.Resize&&(this._resize.mxRight=a.Width,this._resize.mxBottom=a.Height)};
SNSAvatarCropper.prototype.getPos=function(){with(this._layHandle)return{startX:offsetLeft,startY:offsetTop,endX:offsetLeft+offsetWidth,endY:offsetTop+offsetHeight}};SNSAvatarCropper.prototype.getSize=function(a,b,c,d){var e=a/b;d&&(a=(b=d)*e);c&&(!d||a>c)&&(b=(a=c)/e);return{Width:a,Height:b}};var SNSCapturePlugin=function(){this.name="capturePlugin";this.enable=!0;this.triggerBtn;this.loadPeriod=SNS_EVENT_SUBJECT.AFTER_CONNECT};SNSCapturePlugin.prototype=new SNSPlugin;
SNSCapturePlugin.prototype._init=function(){};SNSCapturePlugin.getInstance=function(){return SNSCapturePlugin._instance};(new SNSCapturePlugin).start();var udCapCtl=null,UDCAPTURE_VERSION="1.6.0",UDCAPTURE_MIME_TYPE="application/udcapture-plugin",UDCAPTURE_LICENSE="",UDCAPTURE_SETUP="http://static.uudoc.com/files/UdCapture/UdCapture.msi",supportActiveX=void 0!==window.ActiveXObject;!supportActiveX||"Win64"!=window.navigator.platform&&"x64"!=window.navigator.cpuClass||(UDCAPTURE_SETUP="http://static.uudoc.com/files/UdCapture/UdCapture64.msi");
var controlLoaded=!1;function f_hasNewVer(a){"v"==a.substring(0,1)&&(a=a.substring(1,a.length));var b=UDCAPTURE_VERSION.split(".");a=a.split(".");return parseInt(b[0])>parseInt(a[0])||parseInt(b[0])==parseInt(a[0])&&parseInt(b[1])>parseInt(a[1])||parseInt(b[0])==parseInt(a[0])&&parseInt(b[1])==parseInt(a[1])&&parseInt(b[2])>parseInt(a[2])?!0:!1}function f_addEvent(a,b,c){a.attachEvent?a.attachEvent(b,c):f_attachIE11Event(a,b,c)}
function f_attachIE11Event(a,b,c){var d=/^function\s?([^\s(]*)/,e=c.toString().match(/\(\)|\(.+\)/)[0];c=c.name||c.toString().match(d)[1];d=document.createElement("script");d.setAttribute("for",a.id);d.event=b+e;d.appendChild(document.createTextNode(c+e+";"));document.body.appendChild(d)}
function f_installCheck(){if(udCapCtl)return controlLoaded=!0;if(supportActiveX){document.getElementById("captureBtn").innerHTML='<object id="udCaptureCtl" width="0" height="0" classid="CLSID:0FAE7655-7C34-4DEE-9620-CD7ED969B3F2"></object>';var a=document.getElementById("udCaptureCtl");if(void 0!=a.PostUrl)if(f_hasNewVer(a.GetVersion()))confirm("\u4f18\u9053\u5728\u7ebf\u5c4f\u5e55\u622a\u56fe\u63a7\u4ef6\u6709\u65b0\u7248\u672c\uff0c\u5347\u7ea7\u540e\u624d\u80fd\u4f7f\u7528\uff01\r\n\u70b9\u786e\u5b9a\u8fdb\u884c\u5347\u7ea7\uff0c\u5347\u7ea7\u65f6\u9700\u5173\u95ed\u6d4f\u89c8\u5668\u7a97\u53e3...\r\n\u5982\u679c\u60a8\u5df2\u7ecf\u5347\u7ea7\u5b89\u88c5,\u8bf7\u5173\u95ed\u540e\u91cd\u65b0\u6253\u5f00\u6d4f\u89c8\u5668...")&&
f_startSetup();else return udCapCtl=document.getElementById("udCaptureCtl"),udCapCtl.PostUrl=YYIMChat.getServletPath().FILE_UPLOAD_SERVLET,udCapCtl.License=UDCAPTURE_LICENSE,f_addEvent(udCapCtl,"OnBeforeCapture",f_onBeforeCapture),f_addEvent(udCapCtl,"OnCaptureCanceled",f_onCaptureCanceled),f_addEvent(udCapCtl,"OnCaptureCompleted",f_onCaptureCompleted),f_addEvent(udCapCtl,"OnBeforeUpload",f_onBeforeUpload),f_addEvent(udCapCtl,"OnUploadCompleted",f_onUploadCompleted),f_addEvent(udCapCtl,"OnUploadFailed",
f_onUploadFailed),!0;else confirm("\u60a8\u5c1a\u672a\u5b89\u88c5\u4f18\u9053\u5728\u7ebf\u5c4f\u5e55\u622a\u56fe\u63a7\u4ef6\uff0c\u70b9\u786e\u5b9a\u8fdb\u884c\u5b89\u88c5")&&(document.getElementById("captureBtn").innerHTML="",f_startSetup())}else if(navigator.plugins){var b=navigator.mimeTypes&&navigator.mimeTypes[UDCAPTURE_MIME_TYPE]?navigator.mimeTypes[UDCAPTURE_MIME_TYPE].enabledPlugin:0;if(b){a="v1.0.0";b=b.description.split(" ");"v"==b[b.length-1].substring(0,1)&&(a=b[b.length-1]);if(f_hasNewVer(a))return confirm("\u4f18\u9053\u5728\u7ebf\u5c4f\u5e55\u622a\u56fe\u63d2\u4ef6\u6709\u65b0\u7248\u672c\uff0c\u5347\u7ea7\u540e\u624d\u80fd\u4f7f\u7528\uff01\r\n\u70b9\u786e\u5b9a\u8fdb\u884c\u5347\u7ea7...")&&
f_startSetup(),!1;document.getElementById("captureBtn").innerHTML='<embed id="udCapturePlugin" width="0" height="0" type="'+UDCAPTURE_MIME_TYPE+'"></embed>';udCapCtl=document.getElementById("udCapturePlugin");udCapCtl.PostUrl=YYIMChat.getServletPath().FILE_UPLOAD_SERVLET;udCapCtl.License=UDCAPTURE_LICENSE;udCapCtl.OnBeforeCapture="f_onBeforeCapture";udCapCtl.OnCaptureCanceled="f_onCaptureCanceled";udCapCtl.OnCaptureCompleted="f_onCaptureCompleted";udCapCtl.OnBeforeUpload="f_onBeforeUpload";udCapCtl.OnUploadCompleted=
"f_onUploadCompleted";udCapCtl.OnUploadFailed="f_onUploadFailed";return!0}confirm("\u60a8\u5c1a\u672a\u5b89\u88c5\u4f18\u9053\u5728\u7ebf\u5c4f\u5e55\u622a\u56fe\u63d2\u4ef6\uff0c\u70b9\u786e\u5b9a\u8fdb\u884c\u5b89\u88c5")&&f_startSetup()}return!1}function f_startSetup(){document.getElementById("setupFrame").setAttribute("src",UDCAPTURE_SETUP)}function f_loadPlugin(){navigator.plugins&&navigator.plugins.refresh(!1)}
function f_capture(){navigator.plugins&&navigator.plugins.refresh(!1);f_installCheck()&&(udCapCtl.AutoMinimize=!1,supportActiveX||controlLoaded||!udCapCtl.AutoMinimize?udCapCtl.StartCapture():setTimeout(function(){udCapCtl.StartCapture()},300))}function f_onBeforeCapture(){YYIMChat.log("\u5f00\u59cb\u622a\u56fe...",3)}function f_onCaptureCanceled(){YYIMChat.log("\u5df2\u53d6\u6d88\u622a\u56fe\u3002",3)}function f_onCaptureCompleted(a){YYIMChat.log("\u622a\u56fe\u5b8c\u6210:"+a,3)}
function f_onBeforeUpload(a,b){var c,d,e;YYIMChat.isAnonymous()?(c=YYIMChat.getUserID()+"/ANONYMOUS",e="anonymous"):(c=YYIMChat.getUserNode(),e=YYIMChat.getToken());d=SNSIMWindow.getInstance().getChatWindow().getActiveRoster();d=d.resource&&"anonymous"==d.resource.toLowerCase()?d.getID()+"/ANONYMOUS":YYIMChat.getJIDUtil().getNode(d.getID());udCapCtl.PostUrl=YYIMChat.getServletPath().FILE_UPLOAD_SERVLET+"?token="+e+"&fromUser="+c+"&toUser="+d+"&fileName="+a.substr(a.lastIndexOf("\\")+1)+"&fileSize="+
b+"&uploadedSize=0&muc=1";YYIMChat.log("\u6b63\u5728\u4e0a\u4f20\u622a\u56fe...",3)}function f_onUploadCompleted(a){var b=JSON.parse(a).result.attachId;b&&(SNSIMWindow.getInstance().getChatWindow().getActiveRoster()&&SNSIMWindow.getInstance().getChatWindow().getSendBox().insertHtmlContent("##{{"+b+"}}"),YYIMChat.log("\u56fe\u7247\u4e0a\u4f20\u5b8c\u6210\uff0c \u8def\u5f84 \uff1a "+a,3))}
function f_onUploadFailed(a){YYIMChat.log("\u56fe\u7247\u4e0a\u4f20\u5931\u8d25,\u9519\u8bef\u4ee3\u7801:"+a,3)}
var SNSChatRoomSettignsWindow=function(){this.selector="#chatroom_settings_window";this.avatarEditarPreviewSelector="#snsim_chatroom_avatar_uploader_preview";this.headIconSelector=".head_icon .chatroom_head_icon";this.avatarDefaultPreviewSelector=".avatar_default_preview";this.avatarCropperSelector="bgDiv";this.avatarCropperHeight=this.avatarCropperWidth=160;this.chatroomNameInputSelector=".chatroom_name_input";this.chatroomDescInputSelector=".chatroom_desc_input";this.submitBtnSelector=".snsim_btn_a";
this.cancelBtnSelector=".snsim_btn_b";this.closeBtnSelector=".chatroom_settings_close_btn";this.avatarUploader;this.avatarCropper;this.chatroom;this.photoUrl};SNSChatRoomSettignsWindow.prototype=new SNSFloatPanel;SNSChatRoomSettignsWindow.prototype._init=function(){SNSFloatPanel.prototype._init.call(this);this._bindDomEvent();this.initAvatarUpload()};
SNSChatRoomSettignsWindow.prototype._bindDomEvent=function(){this.getDom().find(this.chatroomNameInputSelector).bind("focus",function(){jQuery(this).removeClass("error_input")});this.getDom().find(this.submitBtnSelector).bind("click",jQuery.proxy(function(){this.checkInput()&&this.save()},this));this.getDom().find(this.cancelBtnSelector).bind("click",jQuery.proxy(function(){this.getDom().find(this.closeBtnSelector).trigger("click")},this));SNSFloatPanel.prototype._bindDomEvent.call(this)};
SNSChatRoomSettignsWindow.prototype.show=function(){if(this.chatroom.infoQueryed){this.getDom().find("#"+this.avatarCropperSelector).hide();this.getDom().find(this.avatarDefaultPreviewSelector).show();var a=SNSIMWindow.getInstance().getChatroomMembersPanel().getDom().offset();this.getDom().css("top",a.top);this.getDom().css("left",a.left);jQuery(this.avatarEditarPreviewSelector).css("display","block");this.updatePhotoUrl();this.getDom().find(this.chatroomNameInputSelector).val(this.chatroom.name);
this.getDom().find(this.chatroomDescInputSelector).text(this.chatroom.desc);SNSFloatPanel.prototype.show.call(this)}else jQuery.when(this.chatroom.queryInfo()).done(jQuery.proxy(this.show,this))};SNSChatRoomSettignsWindow.prototype.updatePhotoUrl=function(a){a?(this.photoUrl=a,this.getDom().find(this.headIconSelector).attr("src",YYIMChat.getFileUrl(a))):this.getDom().find(this.headIconSelector).attr("src",this.chatroom.getPhotoUrl())};
SNSChatRoomSettignsWindow.prototype.save=function(){if(this.getDom().find(this.avatarDefaultPreviewSelector).is(":visible"))this.update();else{var a=this.avatarCropper.getPos(),a=YYIMChat.getServletPath().AVATAR_SERVLET+"?attachId="+this.photoUrl+"&width="+this.avatarCropperWidth+"&height="+this.avatarCropperHeight+"&startX="+a.startX+"&startY="+a.startY+"&endX="+a.endX+"&endY="+a.endY+"&fromUser="+YYIMChat.getUserNode()+"&token="+YYIMChat.getToken();jQuery.ajax({url:a,success:jQuery.proxy(this.update,
this),error:function(a,c,d){YYIMChat.log("ajax error",3,a.status+a.readyState+a.responseText)}})}};
SNSChatRoomSettignsWindow.prototype.update=function(a){var b;a&&(b=a.result.attachId);this.photoUrl=b?b:this.chatroom.photoUrl;jQuery.when(this.chatroom.update({name:this.getDom().find(this.chatroomNameInputSelector).val(),photoUrl:this.photoUrl})).done(jQuery.proxy(function(){var a=SNSIMWindow.getInstance().getChatWindow();this.chatroom.getID()==a.getActiveRoster().getID()&&a.getDom().find(a.currentChatPhotoSelector).attr("src",this.chatroom.getPhotoUrl());a.getTab(this.chatroom.getID()).getHeadDom().find(".snsim_username").text(this.chatroom.name);
a=SNSIMWindow.getInstance().getWideWindow().getTab("chatroom");a.getContentDom().find("#"+a.roomItemIdPrefix+this.chatroom.getID()+" .head_pic img").attr("src",this.chatroom.getPhotoUrl());a.getContentDom().find("#"+a.roomItemIdPrefix+this.chatroom.getID()+" .user_name").attr("title",this.chatroom.name).text(this.chatroom.name);this.getDom().hide()},this))};
SNSChatRoomSettignsWindow.prototype.checkInput=function(){var a=this.getDom().find(this.chatroomNameInputSelector);this.getDom().find(this.chatroomDescInputSelector);return a.val()?!0:(a.addClass("error_input"),!1)};
SNSChatRoomSettignsWindow.prototype.cropAvatar=function(a){this.getDom().find(this.avatarDefaultPreviewSelector).hide();this.getDom().find("#"+this.avatarCropperSelector).show();this.photoUrl=a;this.avatarCropper?(this.avatarCropper.Url=YYIMChat.getFileUrl(a),this.avatarCropper.init()):this.avatarCropper=new SNSAvatarCropper(this.avatarCropperSelector,"dragDiv",YYIMChat.getFileUrl(a),{Width:this.avatarCropperWidth,Height:this.avatarCropperHeight,Color:"#000",Resize:!0,Right:"rRight",Left:"rLeft",
Up:"rUp",Down:"rDown",RightDown:"rRightDown",LeftDown:"rLeftDown",RightUp:"rRightUp",LeftUp:"rLeftUp",viewWidth:100,viewHeight:100})};
SNSChatRoomSettignsWindow.prototype.initAvatarUpload=function(){var a=this;!0===isSupportHtml5Upload?(jQuery("#chatroom_change_head_icon").bind("click",{_self:this},function(a){jQuery("#room_avatar_upload_input").trigger("click")}),jQuery("#room_avatar_upload_input").bind("change",{_self:this},function(a){var c={fileInputId:this.id,to:YYIMChat.getUserBareJID(),success:function(c){a.data._self.photoUrl=c.attachId;a.data._self.cropAvatar(c.attachId)},error:function(){alert("\u5934\u50cf\u4e0a\u4f20\u5931\u8d25")}};
YYIMChat.uploadAvatar(c)})):YYIMChat.initUpload({button_placeholder_id:"chatroom_change_head_icon",flash_url:"res/js/swfupload.swf",contentType:"avatar",button_text:"<span class='room_change_head'>\u66f4\u6539\u5934\u50cf</span>",button_text_style:".room_change_head { margin-left: 13px; color: #ffffff;}",button_width:80,button_height:22,button_cursor:SWFUpload.CURSOR.HAND,button_window_mode:SWFUpload.WINDOW_MODE.TRANSPARENT,success:function(b){a.photoUrl=b;a.cropAvatar(b)},error:function(){alert("\u5934\u50cf\u4e0a\u4f20\u5931\u8d25")}})};
var SNSChatRoomSettingsPlugin=function(){this.name="chatroomSettingsPlugin";this.chatRooomSettingsWindow=new SNSChatRoomSettignsWindow;this.chatroomSettingsSelector="#chatroom_settings";this.enable=!0;this.loadPeriod=SNS_EVENT_SUBJECT.AFTER_CONNECT};SNSChatRoomSettingsPlugin.prototype=new SNSPlugin;SNSChatRoomSettingsPlugin.prototype._init=function(){SNSChatRoomSettingsPlugin._instance=this;this.chatRooomSettingsWindow._init();this._bindDomEvent();SNSPlugin.prototype._init.call(this)};
SNSChatRoomSettingsPlugin.prototype._bindDomEvent=function(){jQuery(this.chatroomSettingsSelector).bind("click",jQuery.proxy(function(){this.chatRooomSettingsWindow.chatroom=SNSIMWindow.getInstance().getChatWindow().getActiveRoster();this.chatRooomSettingsWindow.show();SNSIMWindow.getInstance().getChatroomMembersPanel().hide()},this))};SNSChatRoomSettingsPlugin.getInstance=function(){return SNSChatRoomSettingsPlugin._instance};(new SNSChatRoomSettingsPlugin).start();
!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):"object"==typeof exports?module.exports=a:a(jQuery)}(function(a){function b(b){var h=b||window.event,s=u.call(arguments,1),k=0,p=0,t=0,I=0,M=0,P=0;if(b=a.event.fix(h),b.type="mousewheel","detail"in h&&(t=-1*h.detail),"wheelDelta"in h&&(t=h.wheelDelta),"wheelDeltaY"in h&&(t=h.wheelDeltaY),"wheelDeltaX"in h&&(p=-1*h.wheelDeltaX),"axis"in h&&h.axis===h.HORIZONTAL_AXIS&&(p=-1*t,t=0),k=0===t?p:t,"deltaY"in h&&(t=-1*h.deltaY,k=t),"deltaX"in
h&&(p=h.deltaX,0===t&&(k=-1*p)),0!==t||0!==p){if(1===h.deltaMode)var f=a.data(this,"mousewheel-line-height"),k=k*f,t=t*f,p=p*f;else 2===h.deltaMode&&(f=a.data(this,"mousewheel-page-height"),k*=f,t*=f,p*=f);if(I=Math.max(Math.abs(t),Math.abs(p)),(!e||e>I)&&(e=I,v.settings.adjustOldDeltas&&"mousewheel"===h.type&&0===I%120&&(e/=40)),v.settings.adjustOldDeltas&&"mousewheel"===h.type&&0===I%120&&(k/=40,p/=40,t/=40),k=Math[1<=k?"floor":"ceil"](k/e),p=Math[1<=p?"floor":"ceil"](p/e),t=Math[1<=t?"floor":"ceil"](t/
e),v.settings.normalizeOffset&&this.getBoundingClientRect)h=this.getBoundingClientRect(),M=b.clientX-h.left,P=b.clientY-h.top;return b.deltaX=p,b.deltaY=t,b.deltaFactor=e,b.offsetX=M,b.offsetY=P,b.deltaMode=0,s.unshift(b,k,p,t),d&&clearTimeout(d),d=setTimeout(c,200),(a.event.dispatch||a.event.handle).apply(this,s)}}function c(){e=null}var d,e,h=["wheel","mousewheel","DOMMouseScroll","MozMousePixelScroll"],s="onwheel"in document||9<=document.documentMode?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"],
u=Array.prototype.slice;if(a.event.fixHooks)for(var t=h.length;t;)a.event.fixHooks[h[--t]]=a.event.mouseHooks;var v=a.event.special.mousewheel={version:"3.1.12",setup:function(){if(this.addEventListener)for(var c=s.length;c;)this.addEventListener(s[--c],b,!1);else this.onmousewheel=b;a.data(this,"mousewheel-line-height",v.getLineHeight(this));a.data(this,"mousewheel-page-height",v.getPageHeight(this))},teardown:function(){if(this.removeEventListener)for(var c=s.length;c;)this.removeEventListener(s[--c],
b,!1);else this.onmousewheel=null;a.removeData(this,"mousewheel-line-height");a.removeData(this,"mousewheel-page-height")},getLineHeight:function(b){b=a(b);var c=b["offsetParent"in a.fn?"offsetParent":"parent"]();return c.length||(c=a("body")),parseInt(c.css("fontSize"),10)||parseInt(b.css("fontSize"),10)||16},getPageHeight:function(b){return a(b).height()},settings:{adjustOldDeltas:!0,normalizeOffset:!0}};a.fn.extend({mousewheel:function(a){return a?this.bind("mousewheel",a):this.trigger("mousewheel")},
unmousewheel:function(a){return this.unbind("mousewheel",a)}})});var SNSHistoryMessage=function(){this.id;this.to;this.from;this.member;this.type;this.scrollToBottom="hide"};SNSHistoryMessage.prototype=new SNSMessage;SNSHistoryMessage.prototype.show=function(a,b){0>=jQuery("#"+SNSReceivedMessageBox.ID_PREFIX+this.id).length&&(this.from.getID()!=a.getID()&&this.to.getID()!=a.getID()||b.prepend(this.getMsgHtml()))};
SNSHistoryMessage.prototype.getMsgHtml=function(){this.body.content&&"string"==typeof this.body.content&&(this.body.content=SNSExpressionRenderFilter.decode(this.body.content));if(this.type==SNS_FILTER_TYPE.SEND)return SNSApplication.getInstance().getMessageOutBox().getFilter().doFilter(this),TemplateUtil.genHtml(SNSSentMessageBox.template,this);SNSApplication.getInstance().getMessageInBox().getFilter().doFilter(this);return TemplateUtil.genHtml(SNSReceivedMessageBox.template,this)};
SNSHistoryMessage.prototype.getBodyHtml=function(){return!this.html||this.html.isEmpty()?this.body.content:this.html};SNSHistoryMessage.prototype.getRoster=function(){if(this.from&&this.from instanceof SNSRoster)return this.from;if(this.from&&this.from instanceof SNSChatRoom){var a=this.member.name.split(".");3==a.length&&(this.member.name=a[0]);return this.member}};SNSHistoryMessage.prototype.setImage=function(a){a&&a instanceof SNSFile&&(this.body.content=a,this.body.contentType=SNS_MESSAGE_CONTENT_TYPE.IMAGE)};
SNSHistoryMessage.prototype.getRosterOrChatRoom=function(){return this.type==SNS_FILTER_TYPE.SEND?this.to:this.from};
var SNSHistoryMessageArray=function(){this.count=-1;this.currentCount=0;this.messages=[];this.msgInfoTemplate='<div id="'+SNSHistoryMessageArray.msgInfoIdPrefix+'##{{node}}" style="text-align: center; margin-top: 10px;"><a onclick="SNSHistoryMessagePlugin.getInstance().historyMessageList.showHistoryMessage(\'##{{id}}\')" class="snsim_msg_info_content">##{{msgInfo}}</a></div>';this.scrollToBottom=!1};SNSHistoryMessageArray.prototype=[];SNSHistoryMessageArray.msgInfoIdPrefix="snsim_msg_info_";
SNSHistoryMessageArray.prototype.show=function(a){for(var b=jQuery.Deferred(),c=SNSIMWindow.getInstance().getChatWindow().getTab(a).getContentDom().find(".snsim_message_box_container"),d=0;d<this.messages.length;d++)this.messages[d].scrollToBottom=this.scrollToBottom?"show":"hide",this.messages[d].show(a,c);d=jQuery("#"+SNSHistoryMessageArray.msgInfoIdPrefix+a.getID());1>d.length?c.prepend(this.getMsgInfoHtml(a)):d.insertBefore(c.children(":first"));0<=this.count&&this.currentCount>=this.count&&this.showNoMsgInfoHtml(a);
this.clear();this.scrollToBottom&&(this.scrollToBottom=!1,SNSIMWindow.getInstance().getChatWindow().getTab(a).scrollToBottom());b.resolve();return b.promise()};SNSHistoryMessageArray.prototype.clear=function(){this.messages=[]};SNSHistoryMessageArray.prototype.getMsgInfoHtml=function(a){return TemplateUtil.genHtml(this.msgInfoTemplate,{node:a.getID(),msgInfo:"\u67e5\u770b\u66f4\u591a",id:a.getID()})};
SNSHistoryMessageArray.prototype.showNoMsgInfoHtml=function(a){a=jQuery("#"+SNSHistoryMessageArray.msgInfoIdPrefix+a.getID());a.find(".snsim_msg_info_content").text("\u6ca1\u6709\u66f4\u591a\u6d88\u606f\u4e86");a.find(".snsim_msg_info_content").css("cursor","default")};var SNSHistoryMessageList=function(){this.pageSize=5;this.currentRosterOrChatroom;this.requesting=!1;this._init()};SNSHistoryMessageList.prototype=new SNSBaseList;
SNSHistoryMessageList.prototype._init=function(){SNSApplication.getInstance().getGlobalEventManager().registerEventHandler(SNS_EVENT_SUBJECT.ON_CURRENT_CHAT_CHANGE,!0,function(a,b){if(b&&b.newValue){var c=b.newValue.getTarget().getID();if(c){var d=new SNSHistoryMessageArray;this.add(c,d);d.scrollToBottom=!0;this.showHistoryMessage(SNSApplication.getInstance().getUser().getRosterOrChatRoom(c))}}},this);SNSApplication.getInstance().getGlobalEventManager().registerEventHandler(SNS_EVENT_SUBJECT.TAB_CLOSED,
!0,function(a,b){var c;b&&(b.chatroom&&(c=YYIMChat.getJIDUtil().getBareJID(b.chatroom)),b.roster&&(c=YYIMChat.getJIDUtil().getBareJID(b.roster)),this.get(c)&&this.get(c).messages?this.get(c).messages=[]:null)},this)};
SNSHistoryMessageList.prototype.showHistoryMessage=function(a){this.currentRosterOrChatroom="string"==typeof a?SNSApplication.getInstance().getUser().getRosterOrChatRoom(a):a;var b;this.currentRosterOrChatroom&&(b=this.currentRosterOrChatroom.getID());if(b){this.get(b)||(a=new SNSHistoryMessageArray,this.add(b,a));var c=this;0>=this.get(b).messages.length?this.requestHistoryMessage(this.currentRosterOrChatroom,function(a){c.get(c.currentRosterOrChatroom.getID()).show(c.currentRosterOrChatroom);c.requestHistoryMessage(c.currentRosterOrChatroom)}):
jQuery.when(this.get(this.currentRosterOrChatroom.getID()).show(this.currentRosterOrChatroom)).done(jQuery.proxy(function(){this.requestHistoryMessage(this.currentRosterOrChatroom)},this))}};
SNSHistoryMessageList.prototype.requestHistoryMessage=function(a,b){this.get(a.getID()).currentCount=this.getStart();var c=this.get(a.getID());if(c&&0<c.count&&this.getStart()>=c.count)c.showNoMsgInfoHtml(a);else if(!this.requesting){this.requesting=!0;var d=this,c={id:a.getID(),start:this.getStart(),num:this.pageSize,success:function(a){d.requesting=!1;var c=d.get(d.currentRosterOrChatroom.getID());c.count=a.count;for(var s=SNSApplication.getInstance().getUser(),u=0;u<a.result.length;u++){var t=
a.result[u],v=new SNSHistoryMessage;v.id=t.msgId;t.fromId==s.getID()?(v.type=SNS_FILTER_TYPE.SEND,v.from=s,v.to=s.getRosterOrChatRoom(t.toId)):(v.type=SNS_FILTER_TYPE.RECEIVED,v.from=s.getRosterOrChatRoom(t.fromId),v.from instanceof SNSChatRoom&&(v.member=new SNSRoster(t.memberId)),v.to=s);v.body=Object.clone(t.body);v.body&&(v.body.style&&(v.body.style=jQuery.extend(new SNSMessageStyle,v.body.style)),c.messages.push(v))}SNSCommonUtil.isFunction(b)&&b(c)}};c.chatType=a instanceof SNSRoster?"chat":
"groupchat";YYIMChat.getHistoryMessage(c)}};SNSHistoryMessageList.prototype.getStart=function(){var a=SNSIMWindow.getInstance().getChatWindow().getTab(this.currentRosterOrChatroom).getContentDom().find(".snsim_message_box_container").children().length,b=jQuery("#"+SNSHistoryMessageArray.msgInfoIdPrefix+this.currentRosterOrChatroom.getID());0<b.length&&(a-=b.length);return a?a:0};
var SNSHistoryMessagePlugin=function(){this.name="historyMessagePlugin";this.enable=!0;this.historyMessageList;this.showHistoryMessageBtnSelector="#history_message";this.loadPeriod=SNS_EVENT_SUBJECT.AFTER_CONNECT};SNSHistoryMessagePlugin.prototype=new SNSPlugin;SNSHistoryMessagePlugin.prototype._init=function(){SNSHistoryMessagePlugin._instance=this;this.historyMessageList=new SNSHistoryMessageList;this._bindDomEvent();SNSPlugin.prototype._init.call(this)};
SNSHistoryMessagePlugin.prototype._bindDomEvent=function(){jQuery(this.showHistoryMessageBtnSelector).bind("click",jQuery.proxy(function(){var a=SNSIMWindow.getInstance().getChatWindow().getActiveRoster();this.historyMessageList.showHistoryMessage(a)},this))};SNSHistoryMessagePlugin.getInstance=function(){return SNSHistoryMessagePlugin._instance};(new SNSHistoryMessagePlugin).start();
var SNSCharacterCountFilter=function(){this.name="characterCountFilter";this.priority=40;this.contentType=SNS_MESSAGE_CONTENT_TYPE.TEXT;this.type=SNS_FILTER_TYPE.SEND;this._doFilter=function(a){if((a=a.body.content)&&"string"==typeof a&&a.notEmpty()&&a.length>SNSConfig.MESSAGE.MAX_CHARACTER)throw SNS_I18N.message_character_exceed;}};SNSCharacterCountFilter.prototype=new SNSMessageFilter;(new SNSCharacterCountFilter).start();
var SNSExpressionOutFilter=function(){this.name="expressionoutFilter";this.priority=10;this.contentType=SNS_MESSAGE_CONTENT_TYPE.TEXT;this.type=SNS_FILTER_TYPE.SEND;SNSExpressionOutFilter.pattern=/<img[\w\W]+?node-type=\"expression\"[\w\W]+?>/ig;this._doFilter_=function(a){var b=a.body.content,c=b.match(SNSExpressionOutFilter.pattern);if(c){for(var d=0;d<c.length;d++)for(var e=c[d],e=e.match(/([\w_]+?\.png)/ig),h=SNSExpressionData.DEFAULT.data,s=0;s<h.length;s++){var u=h[s];if(u.url==e){b=b.replace(c[d],
u.actionData);a.body.expression++;break}}a.body.content=b}}};SNSExpressionOutFilter.prototype=new SNSMessageFilter;SNSExpressionOutFilter.genContent=function(a){var b=a.match(/<img[\w\W]+?node-type=\"expression\"[\w\W]+?>/ig);if(!b)return a;for(var c=0;c<b.length;c++)for(var d=b[c],d=d.match(/([\w_]+?\.png)/ig),e=SNSExpressionData.DEFAULT.data,h=0;h<e.length;h++){var s=e[h];s.url==d&&(a=a.replace(b[c],s.actionData))}return a};
var ScreenCaptureFilter=function(){this.priority=150;this.contentType=SNS_MESSAGE_CONTENT_TYPE.TEXT;this.type=SNS_FILTER_TYPE.RECEIVED|SNS_FILTER_TYPE.SEND;this.template='<p><span style="white-space: nowrap"><img src="##{{path}}" onclick="SNSIMWindow.getInstance().getImgPreviewPanel().updateImg(\'##{{path}}\')" style="max-width: 200px; cursor: pointer;" target="_blank"></a></span></p>';this._doFilter=function(a){var b=a.body.content,c=/##\{\{([\w()_.\/-]+)\}\}/ig;c.test(b)&&(b=b.replace(c,"$1"),a.html=
TemplateUtil.genHtml(this.template,{path:YYIMChat.getFileUrl(b)}))}};ScreenCaptureFilter.prototype=new SNSMessageFilter;(new ScreenCaptureFilter).start();
var SNSSystemMessageFilter=function(){this.name="systemMessageFilter";this.priority=100;this.contentType=SNS_MESSAGE_CONTENT_TYPE.SYSTEM;this.type=SNS_FILTER_TYPE.RECEIVED;this.acceptBtnSelector=".accept_btn";this.ignoreBtnSelector=".ignore_btn";this.invitationTemplate='<div class="snsim_system_message"><img src="##{{roster.getPhotoUrl()}}"/><div class="snsim_system_message_info"><div style="display: inline-block;"><span>##{{roster.name}}</span><span style="display: block; color: #A19F9F;">##{{SNS_I18N.chatRoom_invitation}}##{{chatroom.name}}</span></div><div class="snsim_system_message_confirm"><a class="accept_btn">\u63a5\u53d7</a><a class="ignore_btn">\u5ffd\u7565</a></div></div></div>';this.requestSubscribeTemplate=
'<div class="snsim_system_message"><img src="##{{roster.getPhotoUrl()}}"/><div class="snsim_system_message_info"><div style="display: inline-block;"><span>##{{roster.name}}</span><span style="display: block; color: #A19F9F;">##{{SNS_I18N.subscribe_request}}</span></div><div class="snsim_system_message_confirm"><a class="accept_btn">\u63a5\u53d7</a><a class="ignore_btn">\u5ffd\u7565</a></div></div></div>';this._doFilter=function(a){a.type==SNS_MESSAGE_TYPE.INVITE?a.html=TemplateUtil.genHtml(this.invitationTemplate,
a):a.type==SNS_MESSAGE_TYPE.SUBSCRIBE&&(a.html=TemplateUtil.genHtml(this.requestSubscribeTemplate,a))}};SNSSystemMessageFilter.prototype=new SNSMessageFilter;SNSSystemMessageFilter.prototype._init=function(){SNSApplication.getInstance().getGlobalEventManager().registerEventHandler(SNS_EVENT_SUBJECT.AFTER_MESSAGE_SHOW,!0,this.bindDomEvent,this);SNSMessageFilter.prototype._init.call(this)};
SNSSystemMessageFilter.prototype.bindDomEvent=function(a,b){jQuery("#"+SNSReceivedMessageBox.ID_PREFIX+b.id).find(this.acceptBtnSelector).bind("click",{_msg:b,_self:this},function(a){var b=jQuery("#"+SNSReceivedMessageBox.ID_PREFIX+a.data._msg.id);a={systemFilter:a.data._self,message:a.data._msg,container:b};a.message.type==SNS_MESSAGE_TYPE.INVITE?a.systemFilter.processInvitation(a,!0):a.message.type==SNS_MESSAGE_TYPE.SUBSCRIBE&&a.systemFilter.processSubscription(a,!0);a.systemFilter.renderProcessResult(a,
!0)});jQuery("#"+SNSReceivedMessageBox.ID_PREFIX+b.id).find(this.ignoreBtnSelector).bind("click",{_msg:b,_self:this},function(a){var b=jQuery("#"+SNSReceivedMessageBox.ID_PREFIX+a.data._msg.id);a={systemFilter:a.data._self,message:a.data._msg,container:b};a.message.type==SNS_MESSAGE_TYPE.INVITE?a.systemFilter.processInvitation(a,!1):a.message.type==SNS_MESSAGE_TYPE.SUBSCRIBE&&a.systemFilter.processSubscription(a,!1);a.systemFilter.renderProcessResult(a,!1)})};
SNSSystemMessageFilter.prototype.processInvitation=function(a,b){b&&jQuery.when(a.message.chatroom.join()).done(function(a){SNSApplication.getInstance().getUser().chatRoomList.addChatRoom(a.message.chatroom);SNSIMWindow.getInstance().getChatWindow().openChatWith(a.message.chatroom)}(a))};SNSSystemMessageFilter.prototype.processSubscription=function(a,b){b?YYIMChat.approveSubscribe(a.message.roster.getID()):YYIMChat.rejectSubscribe(a.message.roster.getID())};
SNSSystemMessageFilter.prototype.renderProcessResult=function(a,b){a.container.find(a.systemFilter.acceptBtnSelector).addClass("unuse");b?a.container.find(a.systemFilter.acceptBtnSelector).text("\u5df2\u63a5\u53d7"):a.container.find(a.systemFilter.acceptBtnSelector).text("\u5df2\u5ffd\u7565");a.container.find(a.systemFilter.acceptBtnSelector).unbind();a.container.find(a.systemFilter.ignoreBtnSelector).remove()};(new SNSSystemMessageFilter).start();
var SNSURLFilter=function(){this.name="urlFilter";this.priority=20;this.contentType=SNS_MESSAGE_CONTENT_TYPE.TEXT;this.type=SNS_FILTER_TYPE.RECEIVED|SNS_FILTER_TYPE.SEND;this.pattern=/(http|https|ftp)\:\/\/([a-zA-Z0-9\.\-]+(\:[a-zA-Z0-9\.&%\$\-]+)*@)*((25[0-5]|2[0-4][0-9]|[0-1]{1}[0-9]{2}|[1-9]{1}[0-9]{1}|[1-9])\.(25[0-5]|2[0-4][0-9]|[0-1]{1}[0-9]{2}|[1-9]{1}[0-9]{1}|[1-9]|0)\.(25[0-5]|2[0-4][0-9]|[0-1]{1}[0-9]{2}|[1-9]{1}[0-9]{1}|[1-9]|0)\.(25[0-5]|2[0-4][0-9]|[0-1]{1}[0-9]{2}|[1-9]{1}[0-9]{1}|[0-9])|localhost|([a-zA-Z0-9\-]+\.)*[a-zA-Z0-9\-]+\.(com|edu|gov|int|mil|net|org|biz|arpa|info|name|pro|aero|coop|museum|[a-zA-Z]{2}))(\:[0-9]+)*(\/($|[a-zA-Z0-9\.\,\?\'\\\+&%\$#\=~_\-]+))*/g;
this._doFilter=function(a){var b=a.body.content;if(b){var c=b.match(this.pattern),d;for(d in c)b=b.replace(c[d],"<a target='_blank' href='"+c[d]+"'>"+c[d]+"</a>");a.body.content=b}}};SNSURLFilter.prototype=new SNSMessageFilter;
var SNSExpressionRenderFilter=function(){this.name="expressionInFilter";this.priority=30;this.contentType=SNS_MESSAGE_CONTENT_TYPE.TEXT;this.type=SNS_FILTER_TYPE.RECEIVED|SNS_FILTER_TYPE.SEND;SNSExpressionRenderFilter.pattern=/\[\:[\u4e00-\u9fa5_a-zA-Z0-9]+?\]/g;this._doFilter=function(a){a.body.content=SNSExpressionRenderFilter.decode(a.body.content)};SNSExpressionRenderFilter.decode=function(a){"number"==typeof a&&(a+="");if(!a)return null;var b=a.match(SNSExpressionRenderFilter.pattern);b&&0<b.length&&
(b=YYIMChat.getArrayUtil().unique(b));for(var c in b){var d=jQuery("a[action-data='"+b[c]+"'] img");0<d.length&&(a=a.replace(new RegExp(b[c].replace("[","\\[").replace("]","\\]"),"g"),'<img node-type="expression" width="25" src="'+d.attr("src")+'"/>'))}return a}};SNSExpressionRenderFilter.prototype=new SNSMessageFilter;(new SNSExpressionRenderFilter).start();
var SNSFileContentRenderFilter=function(){this.priority=99;this.contentType=SNS_MESSAGE_CONTENT_TYPE.FILE;this.type=SNS_FILTER_TYPE.RECEIVED|SNS_FILTER_TYPE.SEND;this.inTemplate='<p><img src="##{{getSNSBasePath()}}res/skin/default/icons/filetype/##{{type}}.png" border="0" class="vm sns_msg_file_icon"><span class="sns_msg_file_info"><a href="##{{path}}" target="_blank">##{{name}}</a><em class="xg1" style="display:none;">(##{{size}})</em></span></p>';this.outTemplate='<p><img src="##{{getSNSBasePath()}}res/skin/default/icons/filetype/##{{type}}.png" border="0" class="vm sns_msg_file_icon"><span class="sns_msg_file_info"><a href="##{{path}}" target="_blank" style="color:#ffffff;">##{{name}}</a><em class="xg1" style="display:none;">(##{{renderSize()}})</em></span></p>';
this._doFilter=function(a){a instanceof SNSInMessage||a.type&&a.type==SNS_FILTER_TYPE.RECEIVED?(a.body.content.size=SNSFile.renderSize(a.body.content.size),a.html=TemplateUtil.genHtml(this.inTemplate,a.body.content)):a.html=TemplateUtil.genHtml(this.outTemplate,a.body.content)}};SNSFileContentRenderFilter.prototype=new SNSMessageFilter;(new SNSFileContentRenderFilter).start();
var SNSFontContentRenderFilter=function(){this.priority=100;this.contentType=SNS_MESSAGE_CONTENT_TYPE.TEXT;this.type=SNS_FILTER_TYPE.RECEIVED|SNS_FILTER_TYPE.SEND;this._doFilter=function(a){a.html=a.body.style&&a.body.style instanceof SNSMessageStyle?'<div style="'+a.body.style.getStyleStr()+'">'+a.body.content+"</div>":a.body.content}};SNSFontContentRenderFilter.prototype=new SNSMessageFilter;(new SNSFontContentRenderFilter).start();
var SNSImageContentRenderFilter=function(){this.priority=99;this.contentType=SNS_MESSAGE_CONTENT_TYPE.IMAGE;this.type=SNS_FILTER_TYPE.RECEIVED|SNS_FILTER_TYPE.SEND;this.template='<p><span style="white-space: nowrap"><img src="##{{body.content.path}}" onload="SNSImageContentRenderFilter.imgOnload(\'##{{rosterId}}\', \'##{{scrollToBottom}}\')" onclick="SNSIMWindow.getInstance().getImgPreviewPanel().updateImg(\'##{{body.content.path}}\')" style="max-width: 200px; cursor: pointer;" target="_blank"></a></span></p>';
this._doFilter=function(a){a.getRosterOrChatRoom()&&(a.rosterId=a.getRosterOrChatRoom().getID(),a instanceof SNSInMessage||a instanceof SNSOutMessage)&&(a.scrollToBottom="show");a.html=TemplateUtil.genHtml(this.template,a)}};SNSImageContentRenderFilter.prototype=new SNSMessageFilter;(new SNSImageContentRenderFilter).start();SNSImageContentRenderFilter.imgOnload=function(a,b){"show"==b&&SNSIMWindow.getInstance().getChatWindow().getTab(a).scrollToBottom()};
var SNSPublicContentRenderFilter=function(){this.priority=99;this.contentType=SNS_MESSAGE_CONTENT_TYPE.PUBLIC;this.type=SNS_FILTER_TYPE.RECEIVED|SNS_FILTER_TYPE.SEND;this.template=['<ul class="publicmsg">','<li><a target="_blank" href="##{{contentSourceUrl}}" class="publicitem relative first"><img src="##{{thumbUrl}}" class="publicimg"><span class="publicbanner">##{{title}}</span></a></li>','<li><a target="_blank" href="##{{contentSourceUrl}}" class="publicitem cl"><div class="as-center"><img src="##{{thumbUrl}}" class="publicimg y"><div class="publictitle">##{{title}}</div></div></a></li>',
"</ul>"];this._doFilter=function(a){a.getRosterOrChatRoom()&&(a.rosterId=a.getRosterOrChatRoom().getID(),a instanceof SNSInMessage||a instanceof SNSOutMessage)&&(a.scrollToBottom="show");var b=a.body.content;a.html=TemplateUtil.genHtml(this.template[0]);if(b.length)for(var c in b){var d=this.template[2];0==c&&(d=this.template[1]);b[c].thumbId&&(b[c].thumbUrl=YYIMChat.getFileUrl(b[c].thumbId));a.html+=TemplateUtil.genHtml(d,b[c])}a.html+=TemplateUtil.genHtml(this.template[3])}};
SNSPublicContentRenderFilter.prototype=new SNSMessageFilter;(new SNSPublicContentRenderFilter).start();SNSPublicContentRenderFilter.imgOnload=function(a,b){"show"==b&&SNSIMWindow.getInstance().getChatWindow().getTab(a).scrollToBottom()};
var SNSShareContentRenderFilter=function(){this.priority=99;this.contentType=SNS_MESSAGE_CONTENT_TYPE.SHARE;this.type=SNS_FILTER_TYPE.RECEIVED|SNS_FILTER_TYPE.SEND;this.template='<a class="share_title" style="font-size:14px;line-height:18px;max-height:36px;overflow:hidden;display:block;margin-bottom:5px;" href="##{{shareUrl}}">##{{shareTitle}}</a><a style="float:left;" href="##{{shareUrl}}"><img src="##{{shareImageUrl}}" style="width:60px;display:block;" class="share_img"></a><div style="margin-left:65px;color:#666666;" class="share_content">##{{shareDesc}}</div>';this._doFilter=
function(a){a.getRosterOrChatRoom()&&(a.rosterId=a.getRosterOrChatRoom().getID(),a instanceof SNSInMessage||a instanceof SNSOutMessage)&&(a.scrollToBottom="show");a.html=TemplateUtil.genHtml(this.template,a.body.content)}};SNSShareContentRenderFilter.prototype=new SNSMessageFilter;(new SNSShareContentRenderFilter).start();SNSShareContentRenderFilter.imgOnload=function(a,b){"show"==b&&SNSIMWindow.getInstance().getChatWindow().getTab(a).scrollToBottom()};
var SNSSinglePublicContentRenderFilter=function(){this.priority=99;this.contentType=SNS_MESSAGE_CONTENT_TYPE.SYSTEM;this.type=SNS_FILTER_TYPE.RECEIVED|SNS_FILTER_TYPE.SEND;this.template='<div class="singlemsg"><a href="##{{contentSourceUrl}}" class="title" target="_blank">##{{title}}</a><span class="timer">##{{persontime}}</span><a href="##{{contentSourceUrl}}" class="content" target="_blank"><img src="##{{thumbUrl}}" class="singlepic"><span class="summery">##{{title}}</span><span class="getmore">\u67e5\u770b\u5168\u6587</span></a></div>';
this._doFilter=function(a){a.getRosterOrChatRoom()&&(a.rosterId=a.getRosterOrChatRoom().getID(),a instanceof SNSInMessage||a instanceof SNSOutMessage)&&(a.scrollToBottom="show");a.body&&a.body.content&&a.body.content.thumbId&&(a.body.content.thumbUrl=YYIMChat.getFileUrl(a.body.content.thumbId));a.body&&a.body.dateline&&(a.body.content.persontime=getPersonalTime(a.body.dateline));a.html=TemplateUtil.genHtml(this.template,a.body.content)}};SNSSinglePublicContentRenderFilter.prototype=new SNSMessageFilter;
(new SNSSinglePublicContentRenderFilter).start();SNSSinglePublicContentRenderFilter.imgOnload=function(a,b){"show"==b&&SNSIMWindow.getInstance().getChatWindow().getTab(a).scrollToBottom()};
function getPersonalTime(a){for(var b=new Date(a),c=b.getHours()+":"+b.getMinutes(),d=0;5>d;d++){var e=new Date(Date.now()-864E5*d),h=new Date(e.getFullYear(),e.getMonth(),e.getDate(),0,0,0),e=new Date(e.getFullYear(),e.getMonth(),e.getDate(),23,59,59);if(a>=h.getTime()&&a<=e.getTime())switch(d){case 0:return"\u4eca\u65e5  "+c;case 1:return"\u6628\u5929  "+c;case 2:return"\u524d\u5929  "+c;case 3:case 4:return d+"\u5929\u524d  "+c}}return b.getMonth()+1+"\u6708"+b.getDate()+"\u65e5  "+c}
var SNSTextContentRenderFilter=function(){this.priority=99;this.contentType=SNS_MESSAGE_CONTENT_TYPE.TEXT;this.type=SNS_FILTER_TYPE.RECEIVED|SNS_FILTER_TYPE.SEND;this._doFilter=function(a){a.html=a.body.content}};SNSTextContentRenderFilter.prototype=new SNSMessageFilter;(new SNSTextContentRenderFilter).start();
var SNSExpressionData={DEFAULT:{name:SNS_I18N.Default,priority:0,folder:"res/skin/default/icons/expression/default",data:[{actionData:"[:\u6109\u5feb]",url:"smile_1f60a.png"},{actionData:"[:\u8c03\u76ae]",url:"smile_1f60b.png"},{actionData:"[:\u50b2\u5a07]",url:"smile_1f60c.png"},{actionData:"[:\u8272]",url:"smile_1f60d.png"},{actionData:"[:\u9177]",url:"smile_1f60e.png"},{actionData:"[:\u9634\u9669]",url:"smile_1f60f.png"},{actionData:"[:\u4eb2\u543b]",url:"smile_1f61a.png"},{actionData:"[:\u5410\u820c]",
url:"smile_1f61b.png"},{actionData:"[:\u9b3c\u8138]",url:"smile_1f61c.png"},{actionData:"[:\u6dd8\u6c14]",url:"smile_1f61d.png"},{actionData:"[:\u96be\u8fc7]",url:"smile_1f61e.png"},{actionData:"[:\u56e7]",url:"smile_1f61f.png"},{actionData:"[:\u53f9\u6c14]",url:"smile_1f62a.png"},{actionData:"[:\u6293\u72c2]",url:"smile_1f62b.png"},{actionData:"[:\u5475\u5475]",url:"smile_1f62c.png"},{actionData:"[:\u5927\u54ed]",url:"smile_1f62d.png"},{actionData:"[:\u60ca\u8bb6]",url:"smile_1f62e.png"},{actionData:"[:\u8be7\u5f02]",
url:"smile_1f62f.png"},{actionData:"[:\u54c8\u54c8]",url:"smile_1f600.png"},{actionData:"[:\u563b\u563b]",url:"smile_1f601.png"},{actionData:"[:\u7b11\u54ed]",url:"smile_1f602.png"},{actionData:"[:\u9ad8\u5174]",url:"smile_1f603.png"},{actionData:"[:\u5f00\u5fc3]",url:"smile_1f604.png"},{actionData:"[:\u6c57]",url:"smile_1f605.png"},{actionData:"[:\u5927\u7b11]",url:"smile_1f606.png"},{actionData:"[:\u5929\u4f7f]",url:"smile_1f607.png"},{actionData:"[:\u6076\u9b54]",url:"smile_1f608.png"},{actionData:"[:\u7728\u773c]",
url:"smile_1f609.png"},{actionData:"[:\u62bf\u5634]",url:"smile_1f610.png"},{actionData:"[:\u65e0\u89c6]",url:"smile_1f611.png"},{actionData:"[:\u9119\u89c6]",url:"smile_1f612.png"},{actionData:"[:\u65e0\u8bed]",url:"smile_1f613.png"},{actionData:"[:\u65e0\u5948]",url:"smile_1f614.png"},{actionData:"[:\u6485\u5634]",url:"smile_1f615.png"},{actionData:"[:\u96be\u53d7]",url:"smile_1f616.png"},{actionData:"[:\u4eb2]",url:"smile_1f617.png"},{actionData:"[:\u7231]",url:"smile_1f618.png"},{actionData:"[:\u4eb2\u4eb2]",
url:"smile_1f619.png"},{actionData:"[:\u6124\u6012]",url:"smile_1f620.png"},{actionData:"[:\u72c2\u6012]",url:"smile_1f621.png"},{actionData:"[:\u59d4\u5c48]",url:"smile_1f622.png"},{actionData:"[:\u75db\u82e6]",url:"smile_1f623.png"},{actionData:"[:\u6012\u6c14]",url:"smile_1f624.png"},{actionData:"[:\u5fc3\u585e]",url:"smile_1f625.png"},{actionData:"[:\u4e0d\u5f00\u5fc3]",url:"smile_1f626.png"},{actionData:"[:\u90c1\u95f7]",url:"smile_1f627.png"},{actionData:"[:\u751f\u75c5]",url:"smile_1f628.png"},
{actionData:"[:\u4f24\u5fc3]",url:"smile_1f629.png"},{actionData:"[:\u91cd\u75c5]",url:"smile_1f630.png"},{actionData:"[:\u60ca\u6050]",url:"smile_1f631.png"},{actionData:"[:\u6655]",url:"smile_1f632.png"},{actionData:"[:\u5c34\u5c2c]",url:"smile_1f633.png"},{actionData:"[:\u7761\u89c9]",url:"smile_1f634.png"},{actionData:"[:\u6655\u83dc]",url:"smile_1f635.png"},{actionData:"[:\u840c]",url:"smile_1f636.png"},{actionData:"[:\u5bb3\u7f9e]",url:"smile_263a.png"}]}},SNSExpressionPanel=function(a){this.data=
a;this.selector="#snsim_expression_panel";this.hideFloat=SNSComponent.HIDE_TYPE.HIDE_IGNORE_SELF;this.template='<div id="snsim_expression_panel" class="snsim_layer"><div><table border="0" cellspacing="0" cellpadding="0"><tbody><tr> <td><div class="content snsim_layer_faces clearfix"><a class="snsim_icon_close snsim_layer_close"  href="javascript:void(0);"></a><div class="detail"><ul class="faces_list clearfix">##{{_getExpressionHtml()}}</ul></div></div></td></tr> </tbody> </table> </div></div>';this.expressionContainer=
"#snsim_expression_panel .faces_list";this.expressionSelector="ul.faces_list li";this.closeBtnSelector="#snsim_expression_panel .snsim_icon_close";this.attachDom="#expressionBtn";this.expressionTemplate='<li><a action-data="##{{actionData}}" href="javascript:void(0);" title=""><img node-type="expression" width="25" action-data="##{{actionData}}" src="##{{getSNSBasePath()}}##{{folder}}/##{{url}}"></a></li>'};SNSExpressionPanel.prototype=new SNSFloatPanel;
SNSExpressionPanel.prototype._init=function(){if(0==this.getDom().length){var a=this.buildHtml();jQuery("body").append(a);this._bindDomEvent();this._bindExpressionDomEvent()}jQuery(this.attachDom).bind("click",jQuery.proxy(function(a){0<this.getDom().length?(this.afterShow(),this.toggle()):(this.show(),this.afterShow(),this._bindExpressionDomEvent());a.stopPropagation()},this));SNSFloatPanel.prototype._init.call(this)};
SNSExpressionPanel.prototype._getExpressionHtml=function(){var a="",b;for(b in this.data.DEFAULT.data){var c=this.data.DEFAULT.data[b];c&&c.url&&(a+=TemplateUtil.genHtml(this.expressionTemplate,[c,{folder:this.data.DEFAULT.folder}]))}return a};SNSExpressionPanel.prototype.afterShow=function(){var a=jQuery(this.attachDom).offset();this.getDom().css("top",a.top-274);this.getDom().css("left",a.left-10)};
SNSExpressionPanel.prototype._bindExpressionDomEvent=function(){var a=this;this.getDom().find(this.expressionSelector).bind("click",function(){var b=jQuery(this).find("img")[0].outerHTML;SNSIMWindow.getInstance().getChatWindow().getSendBox().insertHtmlContent(b);a.hide()});jQuery(this.closeBtnSelector).bind("click",jQuery.proxy(this.hide,this))};SNSExpressionPanel.prototype.getTemplate=function(){return this.template};var SNSExpressionPlugin=function(){this.name="exrepssion";this.panel=new SNSExpressionPanel(SNSExpressionData)};
SNSExpressionPlugin.prototype=new SNSPlugin;SNSExpressionPlugin.prototype._init=function(){this.panel._init();SNSPlugin.prototype._init.call(this)};(new SNSExpressionPlugin).start();var SNSExpressionTab=function(a){this.data=a};SNSExpressionTab.prototype=new SNSTab;SNSExpressionTab.prototype.getHeadTemplate=function(){return SNSExpressionTab.headTemplate};SNSExpressionTab.prototype.getContentTemplate=function(){return SNSExpressionTab.contentTemplate};
var SNSFontPanel=function(){this.selector="#snsim_font_panel";this.setFontFamilyBtnSelector=".set_font_family";this.setFontSizeBtnSelector=".set_font_size";this.setFontBoldBtnSelector=".set_font_bold";this.setFontItalicBtnSelector=".set_font_italic";this.setFontUnderLineBtnSelector=".set_font_underline";this.insertDom="#snsim_chat_sendbox_toolbar";this.hideFloat=SNSComponent.HIDE_TYPE.HIDE_IGNORE_SELF;this.template='<div id="snsim_font_panel" class="set_font_panel"><select class="set_font_family"></select> <select class="set_font_size"></select><a class="set_font_bold" title="\u7c97\u4f53"></a><a class="set_font_italic" title="\u659c\u4f53"></a><a class="set_font_underline" title="\u4e0b\u5212\u7ebf"></a><input type="text" id="fontColorSelector" style="display: none;" /></div>';
this.attachDom="#fontBtn"};SNSFontPanel.prototype=new SNSFloatPanel;SNSFontPanel.prototype._init=function(){jQuery(this.attachDom).bind("click",jQuery.proxy(function(a){0<this.getDom().length?(this.afterShow(),this.toggle()):(this.show(),this.initFontStyles(),this.afterShow(),this._bindFontDomEvent());a.stopPropagation()},this));SNSFloatPanel.prototype._init.call(this)};
SNSFontPanel.prototype.initFontStyles=function(){for(var a in SNSMessageStyle.FONT_FAMILYS)this.getDom().find(this.setFontFamilyBtnSelector).append("<option value ='"+a+"'>"+SNSMessageStyle.FONT_FAMILYS[a]+"</option>");for(a=12;30>=a;a+=2)this.getDom().find(this.setFontSizeBtnSelector).append("<option value ='"+a+"'>"+a+"</option>");1>jQuery("#snsim_font_panel .sp-replacer").length&&(jQuery("#fontColorSelector").spectrum({showPaletteOnly:!0,togglePaletteOnly:!0,togglePaletteMoreText:"\u66f4\u591a",
togglePaletteLessText:"\u5e38\u7528",color:"blanchedalmond",palette:["#000 #444 #666 #999 #ccc #eee #f3f3f3 #fff".split(" "),"#f00 #f90 #ff0 #0f0 #0ff #00f #90f #f0f".split(" "),"#f4cccc #fce5cd #fff2cc #d9ead3 #d0e0e3 #cfe2f3 #d9d2e9 #ead1dc".split(" "),"#ea9999 #f9cb9c #ffe599 #b6d7a8 #a2c4c9 #9fc5e8 #b4a7d6 #d5a6bd".split(" "),"#e06666 #f6b26b #ffd966 #93c47d #76a5af #6fa8dc #8e7cc3 #c27ba0".split(" "),"#c00 #e69138 #f1c232 #6aa84f #45818e #3d85c6 #674ea7 #a64d79".split(" "),"#900 #b45f06 #bf9000 #38761d #134f5c #0b5394 #351c75 #741b47".split(" "),
"#600 #783f04 #7f6000 #274e13 #0c343d #073763 #20124d #4c1130".split(" ")],move:function(a){SNSIMWindow.getInstance().getChatWindow().getSendBox().getContentDom().css("color",a.toHexString());SNSMessageStyle.getInstance().color=a.toHexString()}}),jQuery("#fontColorSelector").spectrum("show"),jQuery("#fontColorSelector").spectrum("hide"))};SNSFontPanel.prototype.afterShow=function(){var a=jQuery(this.attachDom).offset();this.getDom().css("top",a.top-33);this.getDom().css("left",a.left-12)};
SNSFontPanel.prototype._bindFontDomEvent=function(){this.getDom().find(this.setFontFamilyBtnSelector).bind("change",function(){SNSIMWindow.getInstance().getChatWindow().getSendBox().getContentDom().css("font-family",SNSMessageStyle.FONT_FAMILYS[this.value]);SNSMessageStyle.getInstance().font=this.value});this.getDom().find(this.setFontSizeBtnSelector).bind("change",function(){SNSIMWindow.getInstance().getChatWindow().getSendBox().getContentDom().css("font-size",this.value+"px");SNSMessageStyle.getInstance().size=
this.value});this.getDom().find(this.setFontBoldBtnSelector).bind("click",function(){var a=SNSIMWindow.getInstance().getChatWindow().getSendBox().getContentDom();a.hasClass("font_bold")?(a.removeClass("font_bold"),SNSMessageStyle.getInstance().biu-=SNSMessageStyle.BIU_TYPE.BOLD):(a.addClass("font_bold"),SNSMessageStyle.getInstance().biu=SNSMessageStyle.BIU_TYPE.BOLD|SNSMessageStyle.getInstance().biu)});this.getDom().find(this.setFontItalicBtnSelector).bind("click",function(){var a=SNSIMWindow.getInstance().getChatWindow().getSendBox().getContentDom();
a.hasClass("font_italic")?(a.removeClass("font_italic"),SNSMessageStyle.getInstance().biu-=SNSMessageStyle.BIU_TYPE.ITALIC):(a.addClass("font_italic"),SNSMessageStyle.getInstance().biu=SNSMessageStyle.BIU_TYPE.ITALIC|SNSMessageStyle.getInstance().biu)});this.getDom().find(this.setFontUnderLineBtnSelector).bind("click",function(){var a=SNSIMWindow.getInstance().getChatWindow().getSendBox().getContentDom();a.hasClass("font_underline")?(a.removeClass("font_underline"),SNSMessageStyle.getInstance().biu-=
SNSMessageStyle.BIU_TYPE.UNDERLINE):(a.addClass("font_underline"),SNSMessageStyle.getInstance().biu=SNSMessageStyle.BIU_TYPE.UNDERLINE|SNSMessageStyle.getInstance().biu)})};SNSFontPanel.prototype.getTemplate=function(){return this.template};SNSFontPanel.prototype.getInsertDom=function(){return this.insertDom};var SNSFontPlugin=function(){this.name="font";this.panel=new SNSFontPanel};SNSFontPlugin.prototype=new SNSPlugin;SNSFontPlugin.prototype._init=function(){this.panel._init();SNSPlugin.prototype._init.call(this)};
(new SNSFontPlugin).start();var SNSMyDevicePlugin=function(){this.name="myDevice";this.loadPeriod=SNS_EVENT_SUBJECT.AFTER_CONNECT;this.enable=!0;this.myDeviceGroup;this.myDeviceRoster};SNSMyDevicePlugin.prototype=new SNSPlugin;
SNSMyDevicePlugin.prototype._init=function(){SNSMyDevicePlugin._instance||(SNSMyDevicePlugin._instance=this);this.myDeviceGroup=new SNSDeviceGroup;this.renderDeviceGroup();var a=new SNSDeviceRoster("android-v2.0","\u6211\u7684\u8bbe\u5907");a.groups=[SNSDeviceGroup.getInstance()];this.addDevice(a);SNSPlugin.prototype._init.call(this)};
SNSMyDevicePlugin.prototype.renderDeviceGroup=function(){var a=SNSIMWindow.getInstance().getWideWindow().getTab("roster");if(!a.getGroupDom(this.myDeviceGroup)){var b=TemplateUtil.genHtml(a.groupTempalte,[this.myDeviceGroup]);a.getDom().find(a.groupContainerSelector).prepend(b);a._bindGroupFoldEvent(this.myDeviceGroup)}};
SNSMyDevicePlugin.prototype.addDevice=function(a){var b=SNSIMWindow.getInstance().getWideWindow().getTab("roster");SNSApplication.getInstance().getUser().deviceList.add(a);if(0<a.groups.length)for(var c=0;c<a.groups.length;c++){var d=a.groups[c];b.addGroup(d);var e=TemplateUtil.genHtml(b.rosterTemplate,[a,{groupname:d.name}]);jQuery("#list_content_"+d.name).append(e);b._bindRosterEvent(a,d)}};SNSMyDevicePlugin.getInstance=function(){return SNSMyDevicePlugin._instance};(new SNSMyDevicePlugin).start();
var SNSOrganizationPlugin=function(){this.name="organization";this.loadPeriod=SNS_EVENT_SUBJECT.AFTER_CONNECT;this.organizationTab;this.enable=!0};SNSOrganizationPlugin.prototype=new SNSPlugin;SNSOrganizationPlugin.prototype._init=function(){SNSOrganizationPlugin._instance||(SNSOrganizationPlugin._instance=this);this.organizationTab=new SNSOrganizationTab;SNSIMWindow.getInstance().getWideWindow().addTab(this.organizationTab);SNSPlugin.prototype._init.call(this)};
SNSOrganizationPlugin.getInstance=function(){return SNSOrganizationPlugin._instance};var SNSOrganizationTab=function(){this.name="organization";this.headSelector="#snsim_tab_head_organization";this.contentSelector="#snsim_tab_content_organization";this.ztreeSelector="#orgTree";this.ztree;this.zTreeSetting={data:{simpleData:{enable:!0}},view:{nameIsHTML:!0,showLine:!1,showTitle:!1},callback:{onExpand:jQuery.proxy(this.onNodeExpand,this)}};this.operationMenuTemplate='##{{name}} <span jid="##{{jid}}" class="organization_list_opt" hidefloat="true" style="display:none;"></span>'};
SNSOrganizationTab.headTemplate=' <li id="snsim_tab_head_organization" title="\u7ec4\u7ec7\u7ed3\u6784" class="snsim_tab_head clearfix"> <a href="javascript:void(0);"><span class="snsim_icon_tab snsim_icontab_organization"></span></a></li>';SNSOrganizationTab.contentTemplate='<div id="snsim_tab_content_organization" class="snsim_tab_content snsOrganizationScroll"><div class="snsim_list_con"><div class="zTreeDemoBackground left"><ul id="orgTree" class="ztree"></ul></div></div></div>';
SNSOrganizationTab.prototype=new SNSTab;SNSOrganizationTab.prototype._init=function(){jQuery("#snsim_tab_content_organization").perfectScrollbar();SNSTab.prototype._init.call(this)};SNSOrganizationTab.prototype.getHeadTemplate=function(){return SNSOrganizationTab.headTemplate};SNSOrganizationTab.prototype.getContentTemplate=function(){return SNSOrganizationTab.contentTemplate};SNSOrganizationTab.prototype.beforeSelect=function(){this.ztree||this.loadRootNode()};
SNSOrganizationTab.prototype.loadRootNode=function(){var a=new JSJaCIQ;a.setType(SNS_TYPE.GET);a.setTo("1@org."+SNSApplication.getInstance().getDomain());var b=a.buildNode("query",{xmlns:NS_ORGANIZATION});a.appendNode(b);YYIMChat.send(a,jQuery.proxy(function(a){if(a.isError())YYIMChat.log("SNSOrganizationTab.prototype.loadNodeByParent ",0);else{var b=[],e=[];a=jQuery(a.doc.xml).find("item[id]");for(var h=0;h<a.length;h++){var s=jQuery(a[h]),u={};u.id=s.attr("id");u.name=s.attr("name");var t=s.attr("isUser");
"false"==s.attr("isLeaf")?(u.isParent=!0,u.iconSkin="department"):u.isParent=!1;"true"==t&&(u.iconSkin="person",u.name=this.getOperationHtml(u),u.click="SNSOrganizationPlugin.getInstance().organizationTab.chatWithRoster('"+s.attr("id")+"','"+s.attr("name")+"')");e.push(u);b.push({id:u.id,name:u.name,open:!1,isParent:u.isParent,iconSkin:u.iconSkin})}this.ztree=jQuery.fn.zTree.init(jQuery(this.ztreeSelector),this.zTreeSetting,b)}},this))};
SNSOrganizationTab.prototype.loadNodeByParent=function(a){if(!a.loaded&&!a.loading){this.addLoadingNode(a);a.loading=!0;var b=new JSJaCIQ;b.setType(SNS_TYPE.GET);b.setTo(a.id+"@org."+SNSApplication.getInstance().getDomain());var c=b.buildNode("query",{xmlns:NS_ORGANIZATION});b.appendNode(c);YYIMChat.send(b,jQuery.proxy(function(b,c){if(b.isError())YYIMChat.log("SNSOrganizationTab.prototype.loadNodeByParent ",0,c);else{for(var h=[],s=jQuery(b.doc.xml).find("item[id]"),u=0;u<s.length;u++){var t=jQuery(s[u]),
v={};v.id=t.attr("id");v.name=t.attr("name");var Q=t.attr("isUser");"false"==t.attr("isLeaf")?(v.isParent=!0,v.iconSkin="department"):v.isParent=!1;"true"==Q&&(v.iconSkin="person",v.name=this.getOperationHtml(v),v.click="SNSOrganizationPlugin.getInstance().organizationTab.chatWithRoster('"+t.attr("id")+"','"+t.attr("name")+"')");h.push(v)}a.loaded=!0;a.loading=!1;this.ztree.addNodes(c.parent,h);this.removeLoadingNode(c.parent)}},this),{parent:a})}};
SNSOrganizationTab.prototype.onNodeExpand=function(a,b,c){this.loadNodeByParent(c)};SNSOrganizationTab.prototype.addLoadingNode=function(a){var b={};b.id=Math.round(1E3*Math.random())+1E3;b.iconSkin="loading";b.name="\u6b63\u5728\u52a0\u8f7d...";this.ztree.addNodes(a,b,!1)};SNSOrganizationTab.prototype.removeLoadingNode=function(a){a=this.ztree.getNodesByParam("iconSkin","loading",a);for(var b=0;b<a.length;b++)this.ztree.removeNode(a[b])};
SNSOrganizationTab.prototype.getOperationHtml=function(a){return TemplateUtil.genHtml(this.operationMenuTemplate,{jid:a.id,name:a.name})};SNSOrganizationTab.prototype.chatWithRoster=function(a,b){var c=new SNSRoster(a,b);SNSIMWindow.getInstance().getChatWindow().openChatWith(c)};
var SNSWorkflowMessageFilter=function(){this.name="workflowFilter";this.priority=0;this.contentType=SNS_MESSAGE_CONTENT_TYPE.PUBLIC;this.type=SNS_FILTER_TYPE.RECEIVED;this._doFilter=function(a){a.body.url&&a.from instanceof SNSWorkflowRoster&&(a.html='<a href="'+a.body.url+'" target="_blank">'+a.body.content+"</a>")}};SNSWorkflowMessageFilter.prototype=new SNSMessageFilter;SNSWorkflowMessageFilter.prototype.genMessageHtml=function(a){};
var SNSWorkflowPlugin=function(){this.name="workflow";this.loadPeriod=SNS_EVENT_SUBJECT.AFTER_CONNECT;this.enable=!0;this.workflowRoster;this.workflowMessageFilter};SNSWorkflowPlugin.queryUrl="http://172.20.5.212:9090/wfMessage";SNSWorkflowPlugin.prototype=new SNSPlugin;
SNSWorkflowPlugin.prototype._init=function(){SNSApplication.getInstance().getGlobalEventManager().registerEventHandler(SNS_EVENT_SUBJECT.ON_CURRENT_CHAT_CHANGE,!0,this.onCurrentChatChange,this);this.workflowMessageFilter=new SNSWorkflowMessageFilter;this.workflowMessageFilter.start();this.workflowRoster=new SNSWorkflowRoster;SNSApplication.getInstance().getUser().addRoster(this.workflowRoster);SNSPlugin.prototype._init.call(this)};
SNSWorkflowPlugin.prototype.onCurrentChatChange=function(a,b){var c=b.newValue;c.getTarget()instanceof SNSWorkflowRoster&&(c.tabContainer.getTab("todo")||c.tabContainer.addTab(new SNSInnerMessageTab(c.getTarget())),c.tabContainer.getTab("todo")||c.tabContainer.addTab(new SNSWorkflowTodoTab(c.getTarget())))};SNSWorkflowPlugin.prototype.openIframeWindow=function(a){(new SNSIFrameFloatPanel(a.data.url,a.data.id,600,400)).show()};
var SNSWorkflowRoster=function(){this.jid=new JSJaCJID("workflow@"+SNSApplication.getInstance().getDomain());this.name="\u6211\u7684\u4efb\u52a1";this.vcard=new SNSVCard;SNSPublicServiceGroup.getInstance().addRoster(this)};SNSWorkflowRoster.prototype=new SNSPublicServiceRoster;
var SNSWorkflowTodoTab=function(a){this.name="todo";this.headSelector="#snsim_tab_head_workflow_todo";this.contentSelector="#snsim_tab_content_workflow_todo";this.containerSelector="#snsim_tab_content_workflow_todo .snsim_workflow_todo_container";this.workflowTemplate='<li id="snsim_workflow_item_##{{workflowId}}" class="snsim_workflow_item"><a href="##{{url}}" target="_blank">##{{name}}</a><span class="W_fr">##{{creator}}</span><span class="W_fr">##{{createdate}}</span></li>';this.workflowData;this.publicRoster=
a};SNSWorkflowTodoTab.headTemplate=' <li id="snsim_tab_head_workflow_todo" title="\u5f85\u529e" class="snsim_tab_head clearfix"> <a href="javascript:void(0);" class="process_tab"><span class="snsim_icon_tab  ">\u5f85\u529e</span></a></li>';SNSWorkflowTodoTab.contentTemplate='<div id="snsim_tab_content_workflow_todo" class=" snsim_tab_content snsim_tab_content_roster sns_share_container snsRostersScroll"><div style="height: 22px; margin-top: 10px; border-bottom: 1px solid #d6d6d6;display:none;"><a class="snsim_workflow_todo_refresh_btn" style="margin-left: 20px;">\u5237\u65b0</a></div><div class="snsim_workflow_todo_container workflow_container  snsim_list_con"></div></div>';
SNSWorkflowTodoTab.prototype=new SNSTab;SNSWorkflowTodoTab.prototype._init=function(){this.getContainerDom().find(".snsim_workflow_todo_refresh_btn").bind("click",jQuery.proxy(this.queryWorkflowData,this))};SNSWorkflowTodoTab.prototype.getHeadTemplate=function(){return SNSWorkflowTodoTab.headTemplate};SNSWorkflowTodoTab.prototype.getContentTemplate=function(){return SNSWorkflowTodoTab.contentTemplate};
SNSWorkflowTodoTab.prototype.beforeSelect=function(){this.getContainerDom().html().isEmpty()&&(this.workflowData?this.showWorkflow():this.queryWorkflowData())};SNSWorkflowTodoTab.prototype.showWorkflow=function(){var a=this.getContainerDom();a.empty();for(var b=0;b<this.workflowData.length;b++){var c=this.workflowData[b];c&&(c=TemplateUtil.genHtml(this.workflowTemplate,c),a.append(c))}this._bindDomEvent()};
SNSWorkflowTodoTab.prototype._bindDomEvent=function(){this.getContentDom().find(".snsim_workflow_item").bind("click",function(){var a=jQuery(this).find("a[url]").attr("url");(new SNSIFrameFloatPanel(a,Math.uuid(),600,400)).show()})};SNSWorkflowTodoTab.prototype.queryWorkflowData=function(){var a=SNSApplication.getInstance().getUser();jQuery.getJSON(SNSWorkflowPlugin.queryUrl+"?usercode="+a.jid.getNode()+"&callback=?",jQuery.proxy(function(a){this.workflowData=a.result;this.showWorkflow()},this))};
var SNSChatroomSearchTab=function(){this.name="chatroomSearchTab";this.headSelector="#snsim_chatroom_search_tab_head";this.contentSelector="#snsim_chatroom_search_tab_content";this.containerSelector="#snsim_chatroom_search_tab_container";this.searchBtn=".multi_search_btn";this.searchResultHeadSelector=".search_result_head";this.searchInputBox=".multi_search_input";this.chatroomTemplate='<li><div class="head_icon"><img src="##{{photo}}"></div><div class="item_info"><span class="name" style="width: 150px;">##{{name}}</span><a class="btn" style="color:##{{color}};" title="##{{title}}" onclick="##{{clickFunc}}">##{{info}}</a></div></li>'};
SNSChatroomSearchTab.prototype=new SNSTab;SNSChatroomSearchTab.prototype._init=function(){this.getContainerDom().parent().perfectScrollbar();this._bindDomEvent()};
SNSChatroomSearchTab.prototype._bindDomEvent=function(){this.getContentDom().find(this.searchInputBox).bind("keydown",{self:this},function(a){a.keyCode==SNS_KEY_CODE.ENTER&&a.data.self.sendSearchRequest()});this.getContentDom().find(this.searchInputBox).bind("keyup",jQuery.proxy(function(a){this.getSearchText()||(this.getContainerDom().empty(),this.getContentDom().find(this.searchResultHeadSelector).hide())},this));this.getContentDom().find(this.searchBtn).bind("click",{self:this},function(a){a.data.self.sendSearchRequest()})};
SNSChatroomSearchTab.prototype.sendSearchRequest=function(){YYIMChat.queryChatGroup({keyword:this.getSearchText(),success:jQuery.proxy(this.showSearchResult,this)})};
SNSChatroomSearchTab.prototype.showSearchResult=function(a){a=a.items;this.getContainerDom().empty();this.getContentDom().find(this.searchResultHeadSelector).show();for(var b="",c="",d=0;d<a.length;d++){var e=SNSApplication.getInstance().getUser().getRoom(a[d].id);e?b+=TemplateUtil.genHtml(this.chatroomTemplate,{photo:e.getPhotoUrl(),name:e.name?e.name:e.getID(),clickFunc:"SNSIMWindow.getInstance().getChatWindow().openChatWith('"+e.getID()+"')",title:"\u804a\u5929",info:"\u804a\u5929",color:"#36c048"}):
c+=TemplateUtil.genHtml(this.chatroomTemplate,{photo:SNSConfig.CHAT_ROOM.DEFAULT_AVATAR,name:a[d].name,clickFunc:"SNSIMWindow.getInstance().getChatRoomController().joinChatRoom('"+a[d].id+"', '"+a[d].name+"')",title:"\u52a0\u5165",info:"\u52a0\u5165",color:"#ffa00a"})}this.getContainerDom().append(b+c)};SNSChatroomSearchTab.prototype.getSearchText=function(){return this.getContentDom().find(this.searchInputBox).val().trim()};
var SNSLocalSearchPanel=function(){this.selector="#snsim_local_search";this.localSearchBtnSelector="#snsim_local_search_btn";this.localSearchInputSelector="#snsim_local_search_input";this.localSearchResultSelector=".local_search_result";this.localSearchResultListSelector=".snsim_local_search_result_list";this.resultItemTemplate='<li rosterId="##{{id}}"><img src="##{{getPhotoUrl()}}"><span class="user_name">##{{name}}</span></li>'};SNSLocalSearchPanel.prototype=new SNSComponent;
SNSLocalSearchPanel.prototype._init=function(){this.getDom().find(this.localSearchResultSelector).perfectScrollbar();this._bindDomEvent()};
SNSLocalSearchPanel.prototype._bindDomEvent=function(){this.getDom().find(this.localSearchBtnSelector).bind("click",function(){});this.getDom().find(this.localSearchInputSelector).bind("keyup",jQuery.proxy(function(){this.renderResult(this.getDom().find(this.localSearchInputSelector).val())},this));this.getDom().find(this.localSearchInputSelector).bind("blur",function(){jQuery(this).attr("placeholder","\u67e5\u627e\u8054\u7cfb\u4eba")});this.getDom().find(this.localSearchInputSelector).bind("focus",
function(){jQuery(this).attr("placeholder","")})};
SNSLocalSearchPanel.prototype.renderResult=function(a){this.getDom().find(this.localSearchResultListSelector).html("");jQuery(this.localSearchResultSelector).removeClass("cover");if(a){a=SNSApplication.getInstance().getUser().localSearch(a);for(var b=0;b<a.length;b++){var c=TemplateUtil.genHtml(this.resultItemTemplate,a[b]);this.getDom().find(this.localSearchResultListSelector).append(c)}a.length&&jQuery(this.localSearchResultSelector).addClass("cover");this.getDom().find(this.localSearchResultListSelector+
" li").bind("click",function(a){a=SNSApplication.getInstance().getUser().getRosterOrChatRoom(jQuery(a.currentTarget).attr("rosterId"));SNSIMWindow.getInstance().getChatWindow().openChatWith(a)})}};
var SNSPublicAccountSearchTab=function(){this.name="publicAccountSearchTab";this.headSelector="#snsim_pulic_account_search_tab_head";this.contentSelector="#snsim_public_account_search_tab_content";this.containerSelector="#snsim_public_account_search_tab_container";this.searchBtn=".multi_search_btn";this.searchResultHeadSelector=".search_result_head";this.searchInputBox=".multi_search_input";this.publicAccountTemplate='<li><div class="head_icon"><img src="##{{photo}}"></div><div class="item_info"><span class="name">##{{name}}</span><a class="btn" style="color:##{{color}};" title="##{{title}}" onclick="##{{clickFunc}}">##{{info}}</a><div class="info">##{{name}}</div></div></li>'};
SNSPublicAccountSearchTab.prototype=new SNSTab;SNSPublicAccountSearchTab.prototype._init=function(){this.getContainerDom().parent().perfectScrollbar();this._bindDomEvent()};
SNSPublicAccountSearchTab.prototype._bindDomEvent=function(){this.getContentDom().find(this.searchInputBox).bind("keydown",{self:this},function(a){a.keyCode==SNS_KEY_CODE.ENTER&&a.data.self.sendSearchRequest()});this.getContentDom().find(this.searchInputBox).bind("keyup",jQuery.proxy(function(a){this.getSearchText()||(this.getContainerDom().empty(),this.getContentDom().find(this.searchResultHeadSelector).hide())},this));this.getContentDom().find(this.searchBtn).bind("click",{self:this},function(a){a.data.self.sendSearchRequest()})};
SNSPublicAccountSearchTab.prototype.sendSearchRequest=function(){YYIMChat.queryPubaccount({keyword:this.getSearchText(),success:jQuery.proxy(this.showSearchResult,this)})};
SNSPublicAccountSearchTab.prototype.showSearchResult=function(a){a=a.items;this.getContainerDom().empty();this.getContentDom().find(this.searchResultHeadSelector).show();for(var b="",c="",d=0;d<a.length;d++){var e=SNSApplication.getInstance().getUser().getRoster(a[d].id);e?b+=TemplateUtil.genHtml(this.publicAccountTemplate,{name:e.name?e.name:e.getID(),photo:e.getPhotoUrl(),clickFunc:"SNSIMWindow.getInstance().getChatWindow().openChatWith('"+e.getID()+"')",title:"\u804a\u5929",info:"\u804a\u5929",
color:"#36c048"}):c+=TemplateUtil.genHtml(this.publicAccountTemplate,{name:a[d].name,photo:SNSConfig.ROSTER.PUB_ACCOUNT_DEFAULT_AVATAR,clickFunc:"SNSPlugin.pluginList.get('searchPlugin').searchWindow.addPublicAccount('"+a[d].id+"', '"+a[d].name+"')",title:"\u5173\u6ce8",info:"\u5173\u6ce8",color:"#ffa00a"})}this.getContainerDom().append(b+c)};SNSPublicAccountSearchTab.prototype.getSearchText=function(){return this.getContentDom().find(this.searchInputBox).val().trim()};
var SNSRosterSearchTab=function(){this.name="rosterSearchTab";this.headSelector="#snsim_roster_search_tab_head";this.contentSelector="#snsim_roster_search_tab_content";this.containerSelector="#snsim_roster_search_tab_container";this.searchBtn=".multi_search_btn";this.searchResultHeadSelector=".search_result_head";this.searchInputBox=".multi_search_input";this.searchResultItemIdPrefix="snsim_roster_search_item";this.rosterTemplate='<li id="'+this.searchResultItemIdPrefix+'##{{roster.getID()}}"><div class="head_icon"><img src="##{{roster.getPhotoUrl()}}" onclick="SNSIMWindow.getInstance().getChatWindow().openChatWith(\'##{{roster.getID()}}\')" style="cursor:pointer" title="\u804a\u5929"></div><div class="item_info"><span class="name">##{{roster.name}}</span><a class="btn" style="color:##{{color}};" title="##{{title}}" onclick="##{{clickFunc}}">##{{info}}</a><div class="info">##{{roster.getID()}}</div></div></li>';
this.askFriends={}};SNSRosterSearchTab.prototype=new SNSTab;SNSRosterSearchTab.prototype._init=function(){this.getContainerDom().parent().perfectScrollbar();this._bindDomEvent()};
SNSRosterSearchTab.prototype._bindDomEvent=function(){this.getContentDom().find(this.searchInputBox).bind("keydown",{self:this},function(a){a.keyCode==SNS_KEY_CODE.ENTER&&a.data.self.sendSearchRequest()});this.getContentDom().find(this.searchInputBox).bind("keyup",jQuery.proxy(function(a){this.getSearchText()||(this.getContainerDom().empty(),this.getContentDom().find(this.searchResultHeadSelector).hide())},this));this.getContentDom().find(this.searchBtn).bind("click",{self:this},function(a){a.data.self.sendSearchRequest()})};
SNSRosterSearchTab.prototype.sendSearchRequest=function(){YYIMChat.queryRosterItem({keyword:this.getSearchText(),success:jQuery.proxy(this.showSearchResult,this)})};
SNSRosterSearchTab.prototype.showSearchResult=function(a){a=a.items;this.getContainerDom().empty();this.getContentDom().find(this.searchResultHeadSelector).show();for(var b="",c="",d=0;d<a.length;d++){a[d]=jQuery.extend(new SNSRoster(a[d].id),a[d]);a[d].id=a[d].id;a[d].photoUrl=a[d].photo;var e=SNSApplication.getInstance().getUser().getRoster(a[d].getID());e&&e.subscription==SNS_SUBSCRIBE.BOTH?b+=TemplateUtil.genHtml(this.rosterTemplate,{roster:a[d],clickFunc:"SNSIMWindow.getInstance().getChatWindow().openChatWith('"+
a[d].id+"')",title:"\u804a\u5929",info:"\u804a\u5929",color:"#36c048"}):"undefined"===typeof this.askFriends[a[d].id]?c+=TemplateUtil.genHtml(this.rosterTemplate,{roster:a[d],clickFunc:"SNSPlugin.pluginList.get('searchPlugin').searchWindow.addFriend('"+a[d].id+"', '"+a[d].name+"');this.innerHTML='\u8bf7\u6c42\u5df2\u53d1\u9001';this.onclick=null;this.style.color='#999'",title:"\u6dfb\u52a0",info:"\u6dfb\u52a0",color:"#ffa00a"}):"undefined"!==typeof this.askFriends[a[d].id]&&(c+=TemplateUtil.genHtml(this.rosterTemplate,
{roster:a[d],title:"\u8bf7\u6c42\u5df2\u53d1\u9001",info:"\u8bf7\u6c42\u5df2\u53d1\u9001",color:"#999"}))}a=b+c;0===a.length&&(a="<li>\u6ca1\u6709\u7b26\u5408\u6761\u4ef6\u7684\u7528\u6237...</li>");this.getContainerDom().append(a)};SNSRosterSearchTab.prototype.getSearchText=function(){return this.getContentDom().find(this.searchInputBox).val().trim()};var SNSSearchPlugin=function(){this.name="searchPlugin";this.enable=!0;this.searchWindow;this.localSearchPanel;this.triggerBtn;this.loadPeriod=SNS_EVENT_SUBJECT.AFTER_CONNECT};
SNSSearchPlugin.prototype=new SNSPlugin;
SNSSearchPlugin.prototype._init=function(){SNSSearchPlugin._instance=this;this.searchWindow=new SNSSearchWindow;this.localSearchPanel=new SNSLocalSearchPanel;this.triggerBtn=new SNSTriggerBtn;this.triggerBtn.selector="#snsim_multi_search_trigger_btn";this.triggerBtn.html='<a id="snsim_multi_search_trigger_btn" class="multi_search" title="\u67e5\u627e"  onclick="setTimeout(function(){jQuery(\'#search_roster\').focus();},0);"> </a>';this.triggerBtn.containerSelector="#snsim_wide_window_bottom_container";
this.triggerBtn.target=this.searchWindow;this.searchWindow._init();this.localSearchPanel._init();this.triggerBtn._init();SNSPlugin.prototype._init.call(this)};SNSSearchPlugin.getInstance=function(){return SNSSearchPlugin._instance};(new SNSSearchPlugin).start();
var SNSSearchWindow=function(){this.selector="#snsim_multi_search_window";this.closeBtnSelector=".multi_search_window_close";this.dragComponentSelector=".multi_search_window_menu";this.tabs=new SNSTabContainer;this.headContainerSelector=this.selector+" .snsim_tab_head_container";this.contentContainerSelector=this.selector+".snsim_tab_content_container";this.rosterSearchTab;this.chatroomSearchTab;this.publicAccountSearchTab;this.maskOthers=!0};SNSSearchWindow.prototype=new SNSFloatPanel;
SNSSearchWindow.prototype._init=function(){SNSFloatPanel.prototype._init.call(this);this.tabs.selector=this.selector;this.tabs.headContainerSelector=this.headContainerSelector;this.tabs.contentContainerSelector=this.contentContainerSelector;this.tabs._init();this.rosterSearchTab=new SNSRosterSearchTab;this.tabs.addTab(this.rosterSearchTab);this.chatroomSearchTab=new SNSChatroomSearchTab;this.tabs.addTab(this.chatroomSearchTab);this.publicAccountSearchTab=new SNSPublicAccountSearchTab;this.tabs.addTab(this.publicAccountSearchTab);
this.enableMove();this._bindDomEvent()};SNSSearchWindow.prototype.addFriend=function(a){this.rosterSearchTab.askFriends[a]=a;YYIMChat.addRosterItem(a);SNSIMWindow.getInstance().getDialog().set(DIALOG_TYPE.ALERT,SNS_I18N.confirm_add_friend,function(){SNSIMWindow.getInstance().getDialog().hide()});SNSIMWindow.getInstance().getDialog().show()};
SNSSearchWindow.prototype.addPublicAccount=function(a,b){YYIMChat.addPubaccount({id:a,success:function(){SNSApplication.getInstance().getUser().addRoster(new SNSPublicAccountRoster(a,b))}});SNSIMWindow.getInstance().getDialog().set(DIALOG_TYPE.ALERT,SNS_I18N.confirm_subscribe_pubaccount,function(){SNSIMWindow.getInstance().getDialog().hide()});SNSIMWindow.getInstance().getDialog().show()};
SNSSearchWindow.prototype.show=function(){var a=this.getDom(),b=document.body.clientHeight/2-jQuery("#snsim_multi_search_window").height()/2,c=document.body.clientWidth/2-jQuery("#snsim_multi_search_window").width()/2;a.css("left",c);a.css("top",b);SNSFloatPanel.prototype.show.call(this)};SNSSearchWindow.prototype.hide=function(){jQuery(this.selector).hide(function(){$(this).find("#snsim_roster_search_tab_container").empty()})};
SNSSearchWindow.prototype.validateMovability=function(a){return(a&&a.target?"#"+jQuery(a.target).attr("id"):"#"+jQuery(window.event.srcElement).attr("id"))==this.closeBtnSelector?!1:!0};SNSSearchWindow.prototype.getDragComponentSelector=function(){return this.selector+" "+this.dragComponentSelector};SNSSearchWindow.prototype.getMoveComponentSelector=function(){return this.selector};
var SNSSkinPlugin=function(){this.name="skin";this.enable=!0;this.loadPeriod=SNS_EVENT_SUBJECT.AFTER_CONNECT;this._skinFolder="res/skin/";this.skins={dark:this._skinFolder+"dark/css/extend_common.css"};this._nodeType="snsim_css"};SNSSkinPlugin.prototype=new SNSPlugin;SNSSkinPlugin.prototype._init=function(){SNSSkinPlugin.getInstance()||(SNSSkinPlugin._instance=this)};SNSSkinPlugin.getInstance=function(){return SNSSkinPlugin._instance};(new SNSSkinPlugin).start();
SNSSkinPlugin.prototype.changeSkin=function(a){var b=jQuery('link[node-type="'+this._nodeType+'"]');b&&0<b.length?b.remove():a&&this.skins[a]&&(a=this.skins[a],b=document.createElement("link"),b.setAttribute("rel","stylesheet"),b.setAttribute("type","text/css"),b.setAttribute("node-type",this._nodeType),b.setAttribute("href",a),document.getElementsByTagName("body")[0].appendChild(b))};
var SNSStorePlugin=function(){this.name="store";this.enable=!0;this.loadPeriod=SNS_EVENT_SUBJECT.AFTER_CONNECT;this.chatTabNames=[]};SNSStorePlugin.prototype=new SNSPlugin;SNSStorePlugin.prototype.getChatTabsKey=function(){return"chatTabs#"+YYIMChat.getUserBareJID()};SNSStorePlugin.prototype.getActiveChatTabKey=function(){return"activeChatTab#"+YYIMChat.getUserBareJID()};
SNSStorePlugin.prototype._init=function(){SNSApplication.getInstance().getGlobalEventManager().registerEventHandler(SNS_EVENT_SUBJECT.ON_CURRENT_CHAT_CHANGE,!0,this.onTabChange,this);SNSApplication.getInstance().getGlobalEventManager().registerEventHandler(SNS_EVENT_SUBJECT.AFTER_LOAD_ROSTER,!0,this.recover,this)};
SNSStorePlugin.prototype.onTabChange=function(a,b){if(b&&b.newValue){var c=b.newValue;if(c=YYIMChat.getJIDUtil().getBareJID(c.getTarget().jid))if(SNSStorage.setLocal(this.getActiveChatTabKey(),c),!SNSArrayUtil.contains(this.chatTabNames,c)){this.chatTabNames.push(c);var d;try{d=JSON.stringify(this.chatTabNames)}catch(e){YYIMChat.log("json parse error",3,e)}d&&SNSStorage.setLocal(this.getChatTabsKey(),d)}}};
SNSStorePlugin.prototype.recover=function(){var a=SNSStorage.getLocalVal(this.getActiveChatTabKey()),b=SNSStorage.getLocalVal(this.getChatTabsKey()),b=b?JSON.parse(b):null;if(SNSArrayUtil.isArray(b))for(var c=0;c<b.length;c++)SNSIMWindow.getInstance().getChatWindow().openChatWith(b[c]);a&&SNSIMWindow.getInstance().getChatWindow().openChatWith(a)};SNSStorePlugin.getInstance=function(){return SNSStorePlugin._instance};
var SNSToGroupChatPlugin=function(){this.name="toGroupChat";this.enable=!0;this.searchWindow;this.localSearchPanel;this.triggerBtn;this.loadPeriod=SNS_EVENT_SUBJECT.AFTER_CONNECT};SNSToGroupChatPlugin.prototype=new SNSPlugin;
SNSToGroupChatPlugin.prototype._init=function(){jQuery("#transToMUC").bind("click",jQuery.proxy(function(){var a=SNSIMWindow.getInstance().getChatWindow().getActiveRoster();if(a instanceof SNSRoster){var b=Math.uuid().replace(/\-/g,"").toLowerCase().substr(0,8),c=(a.name+"\u3001"+SNSApplication.getInstance().getUser().name+"_"+b).substr(0,8);YYIMChat.addChatGroup({name:c,node:b,success:jQuery.proxy(function(a){a=SNSApplication.getInstance().getUser().chatRoomList.createRoomHandler(a);YYIMChat.addGroupMember({roomId:a.getID(),
ids:[this.getID()]});SNSIMWindow.getInstance().getChatWindow().openChatWith(a);SNSIMWindow.getInstance().getInvitationWindow().show(a.getID())},a)})}},this));SNSApplication.getInstance().getGlobalEventManager().registerEventHandler(SNS_EVENT_SUBJECT.ON_CURRENT_CHAT_CHANGE,!0,function(a,b){if(b&&b.newValue){var c=b.newValue.getTarget();c instanceof SNSRoster&&!(c instanceof SNSDeviceRoster)?jQuery("#transToMUC").show():jQuery("#transToMUC").hide()}},this)};SNSToGroupChatPlugin.getInstance=function(){return SNSToGroupChatPlugin._instance};
(new SNSToGroupChatPlugin).start();var SNSUploadPlugin=function(){this.name="uploadPlugin";this.imageUpload;this.breakPointUpload;this.imageUploadId="image_upload_input";this.breakPointId="file_upload_input";this.enable=!0;this.loadPeriod=SNS_EVENT_SUBJECT.AFTER_CONNECT};SNSUploadPlugin.prototype=new SNSPlugin;
SNSUploadPlugin.prototype._init=function(){SNSUploadPlugin._instance=this;!0===isSupportHtml5Upload?(this.initImageUpload(),this.initBreakPointUpload()):YYIMChat.initUpload({button_placeholder_id:"upload",button_image_url:SNS_REST_SERVER.UPLOADSWFURL+"res/skin/default/icons/file_upload.png",flash_url:SNS_REST_SERVER.UPLOADSWFURL+"res/js/swfupload.swf",contentType:"file",getChatInfo:function(){var a=SNSIMWindow.getInstance().getChatWindow().getActiveRoster(),b=SNS_CHAT_TYPE.CHAT,c;a instanceof SNSChatRoom&&
(b=SNS_CHAT_TYPE.GROUP_CHAT);a.resource&&(c=a.resource);return{to:a.getID(),type:b,resource:c}},success:function(a){var b=new SNSOutMessage(a);b.setFile(a.body.content);SNSIMWindow.getInstance().getChatWindow().afterSendMessage(b)},error:function(){alert("\u6587\u4ef6\u53d1\u9001\u5931\u8d25")}},{button_placeholder_id:"auploadImage",button_image_url:SNS_REST_SERVER.UPLOADSWFURL+"res/skin/default/icons/image_upload.png",flash_url:SNS_REST_SERVER.UPLOADSWFURL+"res/js/swfupload.swf",contentType:"image",
getChatInfo:function(){var a=SNSIMWindow.getInstance().getChatWindow().getActiveRoster(),b=SNS_CHAT_TYPE.CHAT,c;a instanceof SNSChatRoom&&(b=SNS_CHAT_TYPE.GROUP_CHAT);a.resource&&(c=a.resource);return{to:a.getID(),type:b,resource:c}},success:function(a){var b=new SNSOutMessage(a);b.setImage(a.body.content);SNSIMWindow.getInstance().getChatWindow().afterSendMessage(b)},error:function(){alert("\u56fe\u7247\u53d1\u9001\u5931\u8d25")}});SNSPlugin.prototype._init.call(this)};
SNSUploadPlugin.prototype.initImageUpload=function(){jQuery("#auploadImage").bind("click",{_self:this},function(a){jQuery(a.target).find("#"+a.data._self.imageUploadId).trigger("click")});jQuery("#"+this.imageUploadId).bind("change",{_slef:this},function(a){a=SNSIMWindow.getInstance().getChatWindow().getActiveRoster();var b=SNS_CHAT_TYPE.CHAT;a instanceof SNSChatRoom&&(b=SNS_CHAT_TYPE.GROUP_CHAT);b={fileInputId:this.id,to:a.getID(),type:b,success:function(a){if("groupchat"!=a.type){var b=new SNSOutMessage(a);
b.setImage(a.body.content);SNSIMWindow.getInstance().getChatWindow().afterSendMessage(b)}},error:function(){alert("\u56fe\u7247\u53d1\u9001\u5931\u8d25")}};a.resource&&(b.resource=a.resource);YYIMChat.sendPic(b)})};
SNSUploadPlugin.prototype.initBreakPointUpload=function(){jQuery("#upload").bind("click",{_self:this},function(a){jQuery(a.target).find("#"+a.data._self.breakPointId).trigger("click")});jQuery("#"+this.breakPointId).bind("change",{_slef:this},function(a){a=SNSIMWindow.getInstance().getChatWindow().getActiveRoster();var b=SNS_CHAT_TYPE.CHAT;a instanceof SNSChatRoom&&(b=SNS_CHAT_TYPE.GROUP_CHAT);b={fileInputId:this.id,to:a.getID(),type:b,success:function(a){if("groupchat"!=a.type){var b=new SNSOutMessage(a);
b.setFile(a.body.content);SNSIMWindow.getInstance().getChatWindow().afterSendMessage(b)}},error:function(){alert("\u6587\u4ef6\u53d1\u9001\u5931\u8d25")},progress:function(a){}};a.resource&&(b.resource=a.resource);YYIMChat.sendFile(b)})};SNSUploadPlugin.getInstance=function(){return SNSUploadPlugin._instance};(new SNSUploadPlugin).start();
var SNSChangePasswordTab=function(){this.name="changePasswordTab";this.headSelector="#snsim_change_pasword_head";this.contentSelector="#snsim_change_pasword_content";this.oldPswInputSelector="#oldpassword";this.newPswInputSelector="#newpassword";this.newPsw2InputSelector="#newpassword2";this.errorMessageSpanSelector=".sns_psw_change_error_msg";this.submitChangePsdSelector=".sns_psw_change_btn";this.cancelChangePsdSelector=".sns_psw_change_btn_cancel"};SNSChangePasswordTab.prototype=new SNSTab;
SNSChangePasswordTab.prototype._init=function(){this._bindDomEvent();SNSTab.prototype._init.call(this)};
SNSChangePasswordTab.prototype._bindDomEvent=function(){this.getContentDom().find(this.submitChangePsdSelector).bind("click",jQuery.proxy(function(){var a=jQuery(this.newPswInputSelector).val(),b=jQuery(this.newPsw2InputSelector).val(),c=jQuery(this.oldPswInputSelector).val();c&&c.notEmpty()&&a&&a.notEmpty()&&a==b&&c!=a&&this.changePassword({oldPsw:c,newPsw:a})},this));this.getContentDom().find(this.cancelChangePsdSelector).bind("click",function(){var a=SNSSettingsPlugin.getInstance().settingsWindow;
a.getDom().find(a.closeBtnSelector).trigger("click")})};SNSChangePasswordTab.prototype.clearPswChangeInput=function(){jQuery(this.oldPswInputSelector).val("");jQuery(this.newPswInputSelector).val("");jQuery(this.newPsw2InputSelector).val("")};SNSChangePasswordTab.prototype.showPswChangeError=function(a){this.getContentDom().find(this.errorMessageSpanSelector).html(a)};
SNSChangePasswordTab.prototype.changePassword=function(a){var b=new JSJaCIQ;b.setType(SNS_TYPE.SET);var c=b.buildNode("query",{xmlns:NS_REGISTER}),d=b.buildNode("username",{},{value:SNSApplication.getInstance().getUser().name}),e=b.buildNode("password",{},{value:a.newPsw});c.appendChild(d);c.appendChild(e);b.appendNode(c);YYIMChat.send(b,jQuery.proxy(this.onChangePasswordForm,this),a)};SNSChangePasswordTab.prototype.onChangePasswordForm=function(a){a.isError()?this.showPswChangeError("error"):this.clearPswChangeInput()};
var SNSSettingsPlugin=function(){this.name="settingsPlugin";this.enable=!0;this.settingsWindow;this.triggerBtn;this.loadPeriod=SNS_EVENT_SUBJECT.AFTER_CONNECT};SNSSettingsPlugin.prototype=new SNSPlugin;
SNSSettingsPlugin.prototype._init=function(){SNSSettingsPlugin._instance=this;this.triggerBtn=new SNSTriggerBtn;this.settingsWindow=new SNSSettingsWindow;this.triggerBtn.selector="#snsim_settings_trigger_btn";this.triggerBtn.html='<a id="snsim_settings_trigger_btn" class="system_config" title="\u8bbe\u7f6e"> </a>';this.triggerBtn.containerSelector="#snsim_wide_window_bottom_container";this.triggerBtn.target=this.settingsWindow;this.triggerBtn._init();this.settingsWindow._init();SNSPlugin.prototype._init.call(this)};
SNSSettingsPlugin.getInstance=function(){return SNSSettingsPlugin._instance};(new SNSSettingsPlugin).start();
var SNSSettingsWindow=function(){this.selector="#snsim_settings_window";this.closeBtnSelector=".snsim_settings_window_close";this.tabs=new SNSTabContainer;this.headContainerSelector=this.selector+" .snsim_tab_head_container";this.contentContainerSelector=this.selector+".snsim_tab_content_container";this.triggerBtnSelector="#snsim_settings_trigger_btn";this.userInfoTab;this.systemConfigTab;this.changePasswordTab};SNSSettingsWindow.prototype=new SNSWindow;
SNSSettingsWindow.prototype._init=function(){this.tabs.selector=this.selector;this.tabs.headContainerSelector=this.headContainerSelector;this.tabs.contentContainerSelector=this.contentContainerSelector;this.tabs._init();this.userInfoTab=new SNSUserInfoTab;this.tabs.addTab(this.userInfoTab);this.systemConfigTab=new SNSSystemConfigTab;this.tabs.addTab(this.systemConfigTab);this.changePasswordTab=new SNSChangePasswordTab;this.tabs.addTab(this.changePasswordTab);this._bindDomEvent()};
SNSSettingsWindow.prototype._bindDomEvent=function(){jQuery(this.triggerBtnSelector).bind("click",jQuery.proxy(function(){this.userInfoTab.renderUserInfo()},this));SNSWindow.prototype._bindDomEvent.call(this)};var SNSSystemConfigTab=function(){this.name="systemConfigTab";this.headSelector="#snsim_system_config_head";this.contentSelector="#snsim_system_config_content"};SNSSystemConfigTab.prototype=new SNSTab;SNSSystemConfigTab.prototype._init=function(){SNSTab.prototype._init.call(this)};
var SNSUserInfoTab=function(){this.name="userInfoTab";this.selector="#snsim_user_info_content";this.headSelector="#snsim_user_info_head";this.contentSelector="#snsim_user_info_content";this.changeUserPhotoBtnId="user_change_head_icon";this.avatarUploaderSelector="#snsim_user_avatar_uploader_preview";this.avatarUploaderVisiable=!1;this.vcardContainerSelector=".snsim_vcard_container";this.vcardContainerVisiable=!1;this.headIconSelector=".user_settings_head_icon";this.vcardEditBtnSelector=".edit_vcard_content_btn";
this.submitBtnSelector=".sns_vcard_change_btn";this.cancelBtnSelector=".sns_vcard_change_btn_cancel";this.avatarUploader;this.avatarCropper;this.avatarCropperSelector="bgDiv_user";this.avatarCropperHeight=this.avatarCropperWidth=160;this.photoUrl;this.isUserInfoAcquired=!1;for(var a=["nickname","email","telephone","mobile"],b='<a class="edit_vcard_content_btn">\u4fee\u6539\u8d44\u6599</a><br><ul action-data="##{{getID()}}" class="snsim_vcard_info_list"><li node-type="vcardContentItem" class="snsim_vcard_content_item"><span class="snsim_vcard_content_item_label">\u5e10\u53f7:</span><span class="snsim_vcard_content_item_value">##{{SNSApplication.getInstance().getUser().getID()}}<span/></li>',
c=0;c<a.length;c++)b="_"==a[c]?b+'<li class="snsim_vcard_separate_line"></li>':b+('<li node-type="vcardContentItem" class="snsim_vcard_content_item"><span class="snsim_vcard_content_item_label">'+SNS_LANG_TEMPLATE["vcard_"+a[c].replace(".","_")]+':</span><input type="text" disabled="disable" name="'+a[c]+'" class="snsim_vcard_content_item_value" value="##{{vcard.'+a[c]+'}}"/></li>');this.vcardTpl=b+"</ul>"};SNSUserInfoTab.prototype=new SNSTab;
SNSUserInfoTab.prototype._init=function(){var a=SNSApplication.getInstance().getUser();a.vcard||a.requestVCard();this.initAvatarUpload();SNSTab.prototype._init.call(this)};
SNSUserInfoTab.prototype.renderUserInfo=function(){jQuery(this.avatarUploaderSelector).hide();this.avatarUploaderVisiable=!1;this.getDom().find(this.vcardContainerSelector).show();this.vcardContainerVisiable=!0;if(!this.isUserInfoAcquired){var a=TemplateUtil.genHtml(this.vcardTpl,SNSApplication.getInstance().getUser());this.getDom().find(this.vcardContainerSelector).html(a);this.getDom().find(this.headIconSelector).attr("src",SNSApplication.getInstance().getUser().getPhotoUrl());this.isUserInfoAcquired=
!0;this._bindDomEvent()}};
SNSUserInfoTab.prototype._bindVcardEditBtn=function(){jQuery(this.vcardEditBtnSelector).css("cursor","pointer");jQuery(this.vcardEditBtnSelector).bind("click",{_self:this},function(a){jQuery(this).css("cursor","not-allowed");a.data._self.getDom().find("input").each(function(a,c){jQuery(c).attr("temp",c.value).removeAttr("disabled")});a.data._self.getDom().find("input[name='org.unit']").attr("disabled","disable");a.data._self.getDom().find("input").addClass("vcard_input_edit");a.data._self.getDom().find("input[name='org.unit']").removeClass("vcard_input_edit")})};
SNSUserInfoTab.prototype._bindDomEvent=function(){this._bindVcardEditBtn();this.getDom().find(this.submitBtnSelector).bind("click",jQuery.proxy(this.submit,this));this.getDom().find(this.cancelBtnSelector).bind("click",{_self:this},jQuery.proxy(function(a){jQuery(a.data._self.vcardEditBtnSelector).css("cursor","pointer");a.data._self.getDom().find("input").each(function(a,c){jQuery(c).val(jQuery(c).attr("temp")).attr("disabled","disabled")});a.data._self.getDom().find("input[name='org.unit']").removeAttr("disabled",
"disable");a.data._self.getDom().find("input").removeClass("vcard_input_edit");a.data._self.getDom().find("input[name='org.unit']").addClass("vcard_input_edit");this.avatarUploaderVisiable&&(jQuery(this.avatarUploaderSelector).hide(),this.avatarUploaderVisiable=!1,this.getDom().find(this.vcardContainerSelector).show(),this.vcardContainerVisiable=!0)},this))};
SNSUserInfoTab.prototype.initAvatarCropper=function(a){this.avatarCropper=new SNSAvatarCropper(this.avatarCropperSelector,"dragDiv_user",YYIMChat.getFileUrl(a),{Width:this.avatarCropperWidth,Height:this.avatarCropperHeight,Color:"#000",Resize:!0,Right:"rRight_user",Left:"rLeft_user",Up:"rUp_user",Down:"rDown_user",RightDown:"rRightDown_user",LeftDown:"rLeftDown_user",RightUp:"rRightUp_user",LeftUp:"rLeftUp_user",viewWidth:100,viewHeight:100})};
SNSUserInfoTab.prototype.initAvatarUpload=function(){var a=this;!0===isSupportHtml5Upload?(jQuery("#user_change_head_icon").bind("click",{_self:this},function(a){jQuery("#user_avatar_upload_input").trigger("click");event.data._self.getDom().find("input").each(function(a,b){jQuery(b).attr("temp",b.value).removeAttr("disabled")})}),jQuery("#user_avatar_upload_input").bind("change",{_self:this},function(a){var c={fileInputId:this.id,to:YYIMChat.getUserBareJID(),success:function(c){a.data._self.photoUrl=
c.attachId;a.data._self.cropAvatar(c.attachId)},error:function(){alert("\u5934\u50cf\u4e0a\u4f20\u5931\u8d25")}};YYIMChat.uploadAvatar(c)})):YYIMChat.initUpload({button_placeholder_id:"user_change_head_icon",flash_url:"res/js/swfupload.swf",contentType:"avatar",button_text:"<span class='user_change_head'>\u66f4\u6539\u5934\u50cf</span>",button_text_style:".user_change_head { margin-left: 13px; color: #ffffff;}",button_width:80,button_height:22,button_cursor:SWFUpload.CURSOR.HAND,button_window_mode:SWFUpload.WINDOW_MODE.TRANSPARENT,
success:function(b){a.photoUrl=b;a.cropAvatar(b)},error:function(){alert("\u5934\u50cf\u4e0a\u4f20\u5931\u8d25")}})};SNSUserInfoTab.prototype.cropAvatar=function(a){jQuery(this.avatarUploaderSelector).show();this.avatarUploaderVisiable=!0;this.getDom().find(this.vcardContainerSelector).hide();this.vcardContainerVisiable=!1;this.photoUrl=a;this.avatarCropper?(this.avatarCropper.Url=YYIMChat.getFileUrl(a),this.avatarCropper.init()):this.initAvatarCropper(a)};
SNSUserInfoTab.prototype.submitPhoto=function(){var a=this.avatarCropper.getPos(),a=YYIMChat.getServletPath().AVATAR_SERVLET+"?attachId="+this.photoUrl+"&width="+this.avatarCropperWidth+"&height="+this.avatarCropperHeight+"&startX="+a.startX+"&startY="+a.startY+"&endX="+a.endX+"&endY="+a.endY+"&fromUser="+YYIMChat.getUserNode()+"&token="+YYIMChat.getToken();jQuery.ajax({url:a,success:jQuery.proxy(function(a){var c=a.result.attachId;this.photoUrl=c;Object.clone(SNSApplication.getInstance().getUser().vcard).updateUserPhotoUrl(c,
{success:jQuery.proxy(function(){this.getDom().find(this.headIconSelector).attr("src",YYIMChat.getFileUrl(c));SNSApplication.getInstance().getUser().vcard.photo.binval=c},this)})},this),error:function(a,c,d){YYIMChat.log("ajax error",3,a.status+a.readyState+a.responseText)}})};
SNSUserInfoTab.prototype.submitUserInfo=function(){this.getDom().find("input").attr("disabled","disable");this.getDom().find("input").removeClass("vcard_input_edit");this._bindVcardEditBtn();for(var a=this.getDom().find("input"),b=Object.clone(SNSApplication.getInstance().getUser().vcard),c=0;c<a.length;c++){var d=a[c].name.indexOf(".");-1!=d?b[a[c].name.substr(0,d)][a[c].name.substr(d+1)]=a[c].value:b[a[c].name]=a[c].value}b.update({success:jQuery.proxy(function(){SNSApplication.getInstance().getUser().vcard=
b;alert("\u4fee\u6539\u6210\u529f\uff01");var a=SNSSettingsPlugin.getInstance().settingsWindow;a.getDom().find(a.closeBtnSelector).trigger("click")},this)})};SNSUserInfoTab.prototype.submit=function(){this.vcardContainerVisiable?this.submitUserInfo():(this.submitPhoto(),jQuery(this.avatarUploaderSelector).hide(),this.avatarUploaderVisiable=!1,this.getDom().find(this.vcardContainerSelector).show(),this.vcardContainerVisiable=!0)};var SNSSpaceChatGroupMemberProvider=function(){};
SNSSpaceChatGroupMemberProvider.prototype.getGroupMembers=function(a){if(a){var b=SNSSpaceApplication.REST_BASE+"group/person/mid/"+YYIMChat.getUserBareNode()+"/group/"+a.id;jQuery.ajax({url:b,dataType:"jsonp",type:"get",success:jQuery.proxy(function(b,d,e){YYIMChat.log("get member list success",3,arguments);this._memberListHandler(b,a)},this),error:function(a){YYIMChat.log("get member list error",2,arguments)}})}};SNSSpaceChatGroupMemberProvider.prototype.addGroupMember=function(a,b){};
SNSSpaceChatGroupMemberProvider.prototype._memberListHandler=function(a,b){SNSCommonUtil.isFunction(b.complete)&&b.complete();var c=[],d;for(d in a){var e=a[d];c.push({id:String(e.member_id),name:String(e.username)})}SNSCommonUtil.isFunction(b.success)&&b.success(JSON.stringify(c))};var SNSSpaceChatGroupProvider=function(){};
SNSSpaceChatGroupProvider.prototype.getChatGroups=function(a){if(a){var b=SNSSpaceApplication.REST_BASE+"group/list/mid/"+YYIMChat.getUserBareNode();jQuery.ajax({url:b,dataType:"jsonp",type:"get",success:jQuery.proxy(function(b,d,e){YYIMChat.log("get group list success",3,arguments);this._roomListHandler(b,a)},this),error:function(a){YYIMChat.log("get group list error",2,arguments)}})}};
SNSSpaceChatGroupProvider.prototype.addChatGroup=function(a){if(a){var b=SNSSpaceApplication.REST_BASE+"group/info/mid/"+YYIMChat.getUserBareNode();jQuery.ajax({url:b,dataType:"jsonp",type:"POST",data:{gname:a.name,description:a.desc?a.desc:a.name},success:jQuery.proxy(function(b,d,e){YYIMChat.log("create group success",3,arguments);SNSCommonUtil.isFunction(a.success)&&a.success(a)},this),error:function(a){YYIMChat.log("get group list error",2,arguments)}})}};
SNSSpaceChatGroupProvider.prototype.deleteChatGroup=function(a){};SNSSpaceChatGroupProvider.prototype.queryChatGroup=function(a){};SNSSpaceChatGroupProvider.prototype._roomListHandler=function(a,b){SNSCommonUtil.isFunction(b.complete)&&b.complete();var c=[],d;for(d in a){var e=a[d];c.push({id:String(e.gid),name:e.group_name})}YYIMChat.syncRoom(c);SNSCommonUtil.isFunction(b.success)&&b.success(JSON.stringify(c))};var SNSSpaceRosterProvider=function(){};
SNSSpaceRosterProvider.prototype.getRosterItems=function(a){if(a){var b=SNSSpaceApplication.REST_BASE+"member/follow/mid/"+YYIMChat.getUserBareNode();jQuery.ajax({url:b,dataType:"jsonp",type:"get",success:jQuery.proxy(function(b,d,e){YYIMChat.log("get roster list success",3,arguments);this._rosterListHandler(b,a)},this),error:function(a){YYIMChat.log("get roster list error",2,arguments)}})}};SNSSpaceRosterProvider.prototype.addRosterItem=function(a){};
SNSSpaceRosterProvider.prototype.deleteRosterItem=function(a){};
SNSSpaceRosterProvider.prototype.queryRosterItem=function(a){if(a){var b=SNSSpaceApplication.REST_BASE+"member/search/mid/"+YYIMChat.getUserBareNode()+"/key/"+a.keyword;jQuery.ajax({url:b,dataType:"jsonp",type:"get",success:jQuery.proxy(function(b,d,e){YYIMChat.log("search roster results",3,b);d=[];for(var h in b)e=b[h],d.push({id:String(e.value),name:e.name});SNSCommonUtil.isFunction(a.success)&&a.success(JSON.stringify(d))},this),error:function(a){YYIMChat.log("get roster list error",2,arguments)}})}};
SNSSpaceRosterProvider.prototype._rosterListHandler=function(a,b){SNSCommonUtil.isFunction(b.complete)&&b.complete();var c=[],d;for(d in a){var e=a[d];c.push({id:String(e.id),name:e.name,photo:e.avatar,subscription:"both",group:[]})}YYIMChat.syncRoster(c);SNSCommonUtil.isFunction(b.success)&&b.success(JSON.stringify(c))};
var SNSSpaceApplication={SERVLET:getSNSBasePath()+"space",REST_BASE:"http://172.20.5.201:94/service/",initProvider:function(){YYIMChat.setRosterProvider(new SNSSpaceRosterProvider);YYIMChat.setChatGroupProvider(new SNSSpaceChatGroupProvider);YYIMChat.setChatGroupMemberProvider(new SNSSpaceChatGroupMemberProvider)}};
